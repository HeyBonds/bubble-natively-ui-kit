(() => {
  // node_modules/preact/dist/preact.module.js
  var n;
  var l;
  var u;
  var t;
  var i;
  var o;
  var r;
  var e;
  var f;
  var c;
  var s;
  var a;
  var h;
  var p = {};
  var v = [];
  var y = /acit|ex(?:s|g|n|p|$)|rph|grid|ows|mnc|ntw|ine[ch]|zoo|^ord|itera/i;
  var d = Array.isArray;
  function w(n3, l3) {
    for (var u3 in l3) n3[u3] = l3[u3];
    return n3;
  }
  function g(n3) {
    n3 && n3.parentNode && n3.parentNode.removeChild(n3);
  }
  function _(l3, u3, t3) {
    var i3, o3, r3, e3 = {};
    for (r3 in u3) "key" == r3 ? i3 = u3[r3] : "ref" == r3 ? o3 = u3[r3] : e3[r3] = u3[r3];
    if (arguments.length > 2 && (e3.children = arguments.length > 3 ? n.call(arguments, 2) : t3), "function" == typeof l3 && null != l3.defaultProps) for (r3 in l3.defaultProps) void 0 === e3[r3] && (e3[r3] = l3.defaultProps[r3]);
    return m(l3, e3, i3, o3, null);
  }
  function m(n3, t3, i3, o3, r3) {
    var e3 = { type: n3, props: t3, key: i3, ref: o3, __k: null, __: null, __b: 0, __e: null, __c: null, constructor: void 0, __v: null == r3 ? ++u : r3, __i: -1, __u: 0 };
    return null == r3 && null != l.vnode && l.vnode(e3), e3;
  }
  function b() {
    return { current: null };
  }
  function k(n3) {
    return n3.children;
  }
  function x(n3, l3) {
    this.props = n3, this.context = l3;
  }
  function S(n3, l3) {
    if (null == l3) return n3.__ ? S(n3.__, n3.__i + 1) : null;
    for (var u3; l3 < n3.__k.length; l3++) if (null != (u3 = n3.__k[l3]) && null != u3.__e) return u3.__e;
    return "function" == typeof n3.type ? S(n3) : null;
  }
  function C(n3) {
    var l3, u3;
    if (null != (n3 = n3.__) && null != n3.__c) {
      for (n3.__e = n3.__c.base = null, l3 = 0; l3 < n3.__k.length; l3++) if (null != (u3 = n3.__k[l3]) && null != u3.__e) {
        n3.__e = n3.__c.base = u3.__e;
        break;
      }
      return C(n3);
    }
  }
  function M(n3) {
    (!n3.__d && (n3.__d = true) && i.push(n3) && !$.__r++ || o != l.debounceRendering) && ((o = l.debounceRendering) || r)($);
  }
  function $() {
    for (var n3, u3, t3, o3, r3, f3, c3, s3 = 1; i.length; ) i.length > s3 && i.sort(e), n3 = i.shift(), s3 = i.length, n3.__d && (t3 = void 0, o3 = void 0, r3 = (o3 = (u3 = n3).__v).__e, f3 = [], c3 = [], u3.__P && ((t3 = w({}, o3)).__v = o3.__v + 1, l.vnode && l.vnode(t3), O(u3.__P, t3, o3, u3.__n, u3.__P.namespaceURI, 32 & o3.__u ? [r3] : null, f3, null == r3 ? S(o3) : r3, !!(32 & o3.__u), c3), t3.__v = o3.__v, t3.__.__k[t3.__i] = t3, N(f3, t3, c3), o3.__e = o3.__ = null, t3.__e != r3 && C(t3)));
    $.__r = 0;
  }
  function I(n3, l3, u3, t3, i3, o3, r3, e3, f3, c3, s3) {
    var a3, h3, y3, d3, w4, g4, _4, m3 = t3 && t3.__k || v, b2 = l3.length;
    for (f3 = P(u3, l3, m3, f3, b2), a3 = 0; a3 < b2; a3++) null != (y3 = u3.__k[a3]) && (h3 = -1 == y3.__i ? p : m3[y3.__i] || p, y3.__i = a3, g4 = O(n3, y3, h3, i3, o3, r3, e3, f3, c3, s3), d3 = y3.__e, y3.ref && h3.ref != y3.ref && (h3.ref && B(h3.ref, null, y3), s3.push(y3.ref, y3.__c || d3, y3)), null == w4 && null != d3 && (w4 = d3), (_4 = !!(4 & y3.__u)) || h3.__k === y3.__k ? f3 = A(y3, f3, n3, _4) : "function" == typeof y3.type && void 0 !== g4 ? f3 = g4 : d3 && (f3 = d3.nextSibling), y3.__u &= -7);
    return u3.__e = w4, f3;
  }
  function P(n3, l3, u3, t3, i3) {
    var o3, r3, e3, f3, c3, s3 = u3.length, a3 = s3, h3 = 0;
    for (n3.__k = new Array(i3), o3 = 0; o3 < i3; o3++) null != (r3 = l3[o3]) && "boolean" != typeof r3 && "function" != typeof r3 ? ("string" == typeof r3 || "number" == typeof r3 || "bigint" == typeof r3 || r3.constructor == String ? r3 = n3.__k[o3] = m(null, r3, null, null, null) : d(r3) ? r3 = n3.__k[o3] = m(k, { children: r3 }, null, null, null) : void 0 === r3.constructor && r3.__b > 0 ? r3 = n3.__k[o3] = m(r3.type, r3.props, r3.key, r3.ref ? r3.ref : null, r3.__v) : n3.__k[o3] = r3, f3 = o3 + h3, r3.__ = n3, r3.__b = n3.__b + 1, e3 = null, -1 != (c3 = r3.__i = L(r3, u3, f3, a3)) && (a3--, (e3 = u3[c3]) && (e3.__u |= 2)), null == e3 || null == e3.__v ? (-1 == c3 && (i3 > s3 ? h3-- : i3 < s3 && h3++), "function" != typeof r3.type && (r3.__u |= 4)) : c3 != f3 && (c3 == f3 - 1 ? h3-- : c3 == f3 + 1 ? h3++ : (c3 > f3 ? h3-- : h3++, r3.__u |= 4))) : n3.__k[o3] = null;
    if (a3) for (o3 = 0; o3 < s3; o3++) null != (e3 = u3[o3]) && 0 == (2 & e3.__u) && (e3.__e == t3 && (t3 = S(e3)), D(e3, e3));
    return t3;
  }
  function A(n3, l3, u3, t3) {
    var i3, o3;
    if ("function" == typeof n3.type) {
      for (i3 = n3.__k, o3 = 0; i3 && o3 < i3.length; o3++) i3[o3] && (i3[o3].__ = n3, l3 = A(i3[o3], l3, u3, t3));
      return l3;
    }
    n3.__e != l3 && (t3 && (l3 && n3.type && !l3.parentNode && (l3 = S(n3)), u3.insertBefore(n3.__e, l3 || null)), l3 = n3.__e);
    do {
      l3 = l3 && l3.nextSibling;
    } while (null != l3 && 8 == l3.nodeType);
    return l3;
  }
  function H(n3, l3) {
    return l3 = l3 || [], null == n3 || "boolean" == typeof n3 || (d(n3) ? n3.some(function(n4) {
      H(n4, l3);
    }) : l3.push(n3)), l3;
  }
  function L(n3, l3, u3, t3) {
    var i3, o3, r3, e3 = n3.key, f3 = n3.type, c3 = l3[u3], s3 = null != c3 && 0 == (2 & c3.__u);
    if (null === c3 && null == e3 || s3 && e3 == c3.key && f3 == c3.type) return u3;
    if (t3 > (s3 ? 1 : 0)) {
      for (i3 = u3 - 1, o3 = u3 + 1; i3 >= 0 || o3 < l3.length; ) if (null != (c3 = l3[r3 = i3 >= 0 ? i3-- : o3++]) && 0 == (2 & c3.__u) && e3 == c3.key && f3 == c3.type) return r3;
    }
    return -1;
  }
  function T(n3, l3, u3) {
    "-" == l3[0] ? n3.setProperty(l3, null == u3 ? "" : u3) : n3[l3] = null == u3 ? "" : "number" != typeof u3 || y.test(l3) ? u3 : u3 + "px";
  }
  function j(n3, l3, u3, t3, i3) {
    var o3, r3;
    n: if ("style" == l3) if ("string" == typeof u3) n3.style.cssText = u3;
    else {
      if ("string" == typeof t3 && (n3.style.cssText = t3 = ""), t3) for (l3 in t3) u3 && l3 in u3 || T(n3.style, l3, "");
      if (u3) for (l3 in u3) t3 && u3[l3] == t3[l3] || T(n3.style, l3, u3[l3]);
    }
    else if ("o" == l3[0] && "n" == l3[1]) o3 = l3 != (l3 = l3.replace(f, "$1")), r3 = l3.toLowerCase(), l3 = r3 in n3 || "onFocusOut" == l3 || "onFocusIn" == l3 ? r3.slice(2) : l3.slice(2), n3.l || (n3.l = {}), n3.l[l3 + o3] = u3, u3 ? t3 ? u3.u = t3.u : (u3.u = c, n3.addEventListener(l3, o3 ? a : s, o3)) : n3.removeEventListener(l3, o3 ? a : s, o3);
    else {
      if ("http://www.w3.org/2000/svg" == i3) l3 = l3.replace(/xlink(H|:h)/, "h").replace(/sName$/, "s");
      else if ("width" != l3 && "height" != l3 && "href" != l3 && "list" != l3 && "form" != l3 && "tabIndex" != l3 && "download" != l3 && "rowSpan" != l3 && "colSpan" != l3 && "role" != l3 && "popover" != l3 && l3 in n3) try {
        n3[l3] = null == u3 ? "" : u3;
        break n;
      } catch (n4) {
      }
      "function" == typeof u3 || (null == u3 || false === u3 && "-" != l3[4] ? n3.removeAttribute(l3) : n3.setAttribute(l3, "popover" == l3 && 1 == u3 ? "" : u3));
    }
  }
  function F(n3) {
    return function(u3) {
      if (this.l) {
        var t3 = this.l[u3.type + n3];
        if (null == u3.t) u3.t = c++;
        else if (u3.t < t3.u) return;
        return t3(l.event ? l.event(u3) : u3);
      }
    };
  }
  function O(n3, u3, t3, i3, o3, r3, e3, f3, c3, s3) {
    var a3, h3, p3, v3, y3, _4, m3, b2, S2, C4, M3, $3, P4, A4, H3, L3, T4, j4 = u3.type;
    if (void 0 !== u3.constructor) return null;
    128 & t3.__u && (c3 = !!(32 & t3.__u), r3 = [f3 = u3.__e = t3.__e]), (a3 = l.__b) && a3(u3);
    n: if ("function" == typeof j4) try {
      if (b2 = u3.props, S2 = "prototype" in j4 && j4.prototype.render, C4 = (a3 = j4.contextType) && i3[a3.__c], M3 = a3 ? C4 ? C4.props.value : a3.__ : i3, t3.__c ? m3 = (h3 = u3.__c = t3.__c).__ = h3.__E : (S2 ? u3.__c = h3 = new j4(b2, M3) : (u3.__c = h3 = new x(b2, M3), h3.constructor = j4, h3.render = E), C4 && C4.sub(h3), h3.state || (h3.state = {}), h3.__n = i3, p3 = h3.__d = true, h3.__h = [], h3._sb = []), S2 && null == h3.__s && (h3.__s = h3.state), S2 && null != j4.getDerivedStateFromProps && (h3.__s == h3.state && (h3.__s = w({}, h3.__s)), w(h3.__s, j4.getDerivedStateFromProps(b2, h3.__s))), v3 = h3.props, y3 = h3.state, h3.__v = u3, p3) S2 && null == j4.getDerivedStateFromProps && null != h3.componentWillMount && h3.componentWillMount(), S2 && null != h3.componentDidMount && h3.__h.push(h3.componentDidMount);
      else {
        if (S2 && null == j4.getDerivedStateFromProps && b2 !== v3 && null != h3.componentWillReceiveProps && h3.componentWillReceiveProps(b2, M3), u3.__v == t3.__v || !h3.__e && null != h3.shouldComponentUpdate && false === h3.shouldComponentUpdate(b2, h3.__s, M3)) {
          for (u3.__v != t3.__v && (h3.props = b2, h3.state = h3.__s, h3.__d = false), u3.__e = t3.__e, u3.__k = t3.__k, u3.__k.some(function(n4) {
            n4 && (n4.__ = u3);
          }), $3 = 0; $3 < h3._sb.length; $3++) h3.__h.push(h3._sb[$3]);
          h3._sb = [], h3.__h.length && e3.push(h3);
          break n;
        }
        null != h3.componentWillUpdate && h3.componentWillUpdate(b2, h3.__s, M3), S2 && null != h3.componentDidUpdate && h3.__h.push(function() {
          h3.componentDidUpdate(v3, y3, _4);
        });
      }
      if (h3.context = M3, h3.props = b2, h3.__P = n3, h3.__e = false, P4 = l.__r, A4 = 0, S2) {
        for (h3.state = h3.__s, h3.__d = false, P4 && P4(u3), a3 = h3.render(h3.props, h3.state, h3.context), H3 = 0; H3 < h3._sb.length; H3++) h3.__h.push(h3._sb[H3]);
        h3._sb = [];
      } else do {
        h3.__d = false, P4 && P4(u3), a3 = h3.render(h3.props, h3.state, h3.context), h3.state = h3.__s;
      } while (h3.__d && ++A4 < 25);
      h3.state = h3.__s, null != h3.getChildContext && (i3 = w(w({}, i3), h3.getChildContext())), S2 && !p3 && null != h3.getSnapshotBeforeUpdate && (_4 = h3.getSnapshotBeforeUpdate(v3, y3)), L3 = a3, null != a3 && a3.type === k && null == a3.key && (L3 = V(a3.props.children)), f3 = I(n3, d(L3) ? L3 : [L3], u3, t3, i3, o3, r3, e3, f3, c3, s3), h3.base = u3.__e, u3.__u &= -161, h3.__h.length && e3.push(h3), m3 && (h3.__E = h3.__ = null);
    } catch (n4) {
      if (u3.__v = null, c3 || null != r3) if (n4.then) {
        for (u3.__u |= c3 ? 160 : 128; f3 && 8 == f3.nodeType && f3.nextSibling; ) f3 = f3.nextSibling;
        r3[r3.indexOf(f3)] = null, u3.__e = f3;
      } else {
        for (T4 = r3.length; T4--; ) g(r3[T4]);
        z(u3);
      }
      else u3.__e = t3.__e, u3.__k = t3.__k, n4.then || z(u3);
      l.__e(n4, u3, t3);
    }
    else null == r3 && u3.__v == t3.__v ? (u3.__k = t3.__k, u3.__e = t3.__e) : f3 = u3.__e = q(t3.__e, u3, t3, i3, o3, r3, e3, c3, s3);
    return (a3 = l.diffed) && a3(u3), 128 & u3.__u ? void 0 : f3;
  }
  function z(n3) {
    n3 && n3.__c && (n3.__c.__e = true), n3 && n3.__k && n3.__k.forEach(z);
  }
  function N(n3, u3, t3) {
    for (var i3 = 0; i3 < t3.length; i3++) B(t3[i3], t3[++i3], t3[++i3]);
    l.__c && l.__c(u3, n3), n3.some(function(u4) {
      try {
        n3 = u4.__h, u4.__h = [], n3.some(function(n4) {
          n4.call(u4);
        });
      } catch (n4) {
        l.__e(n4, u4.__v);
      }
    });
  }
  function V(n3) {
    return "object" != typeof n3 || null == n3 || n3.__b && n3.__b > 0 ? n3 : d(n3) ? n3.map(V) : w({}, n3);
  }
  function q(u3, t3, i3, o3, r3, e3, f3, c3, s3) {
    var a3, h3, v3, y3, w4, _4, m3, b2 = i3.props || p, k4 = t3.props, x5 = t3.type;
    if ("svg" == x5 ? r3 = "http://www.w3.org/2000/svg" : "math" == x5 ? r3 = "http://www.w3.org/1998/Math/MathML" : r3 || (r3 = "http://www.w3.org/1999/xhtml"), null != e3) {
      for (a3 = 0; a3 < e3.length; a3++) if ((w4 = e3[a3]) && "setAttribute" in w4 == !!x5 && (x5 ? w4.localName == x5 : 3 == w4.nodeType)) {
        u3 = w4, e3[a3] = null;
        break;
      }
    }
    if (null == u3) {
      if (null == x5) return document.createTextNode(k4);
      u3 = document.createElementNS(r3, x5, k4.is && k4), c3 && (l.__m && l.__m(t3, e3), c3 = false), e3 = null;
    }
    if (null == x5) b2 === k4 || c3 && u3.data == k4 || (u3.data = k4);
    else {
      if (e3 = e3 && n.call(u3.childNodes), !c3 && null != e3) for (b2 = {}, a3 = 0; a3 < u3.attributes.length; a3++) b2[(w4 = u3.attributes[a3]).name] = w4.value;
      for (a3 in b2) if (w4 = b2[a3], "children" == a3) ;
      else if ("dangerouslySetInnerHTML" == a3) v3 = w4;
      else if (!(a3 in k4)) {
        if ("value" == a3 && "defaultValue" in k4 || "checked" == a3 && "defaultChecked" in k4) continue;
        j(u3, a3, null, w4, r3);
      }
      for (a3 in k4) w4 = k4[a3], "children" == a3 ? y3 = w4 : "dangerouslySetInnerHTML" == a3 ? h3 = w4 : "value" == a3 ? _4 = w4 : "checked" == a3 ? m3 = w4 : c3 && "function" != typeof w4 || b2[a3] === w4 || j(u3, a3, w4, b2[a3], r3);
      if (h3) c3 || v3 && (h3.__html == v3.__html || h3.__html == u3.innerHTML) || (u3.innerHTML = h3.__html), t3.__k = [];
      else if (v3 && (u3.innerHTML = ""), I("template" == t3.type ? u3.content : u3, d(y3) ? y3 : [y3], t3, i3, o3, "foreignObject" == x5 ? "http://www.w3.org/1999/xhtml" : r3, e3, f3, e3 ? e3[0] : i3.__k && S(i3, 0), c3, s3), null != e3) for (a3 = e3.length; a3--; ) g(e3[a3]);
      c3 || (a3 = "value", "progress" == x5 && null == _4 ? u3.removeAttribute("value") : null != _4 && (_4 !== u3[a3] || "progress" == x5 && !_4 || "option" == x5 && _4 != b2[a3]) && j(u3, a3, _4, b2[a3], r3), a3 = "checked", null != m3 && m3 != u3[a3] && j(u3, a3, m3, b2[a3], r3));
    }
    return u3;
  }
  function B(n3, u3, t3) {
    try {
      if ("function" == typeof n3) {
        var i3 = "function" == typeof n3.__u;
        i3 && n3.__u(), i3 && null == u3 || (n3.__u = n3(u3));
      } else n3.current = u3;
    } catch (n4) {
      l.__e(n4, t3);
    }
  }
  function D(n3, u3, t3) {
    var i3, o3;
    if (l.unmount && l.unmount(n3), (i3 = n3.ref) && (i3.current && i3.current != n3.__e || B(i3, null, u3)), null != (i3 = n3.__c)) {
      if (i3.componentWillUnmount) try {
        i3.componentWillUnmount();
      } catch (n4) {
        l.__e(n4, u3);
      }
      i3.base = i3.__P = null;
    }
    if (i3 = n3.__k) for (o3 = 0; o3 < i3.length; o3++) i3[o3] && D(i3[o3], u3, t3 || "function" != typeof n3.type);
    t3 || g(n3.__e), n3.__c = n3.__ = n3.__e = void 0;
  }
  function E(n3, l3, u3) {
    return this.constructor(n3, u3);
  }
  function G(u3, t3, i3) {
    var o3, r3, e3, f3;
    t3 == document && (t3 = document.documentElement), l.__ && l.__(u3, t3), r3 = (o3 = "function" == typeof i3) ? null : i3 && i3.__k || t3.__k, e3 = [], f3 = [], O(t3, u3 = (!o3 && i3 || t3).__k = _(k, null, [u3]), r3 || p, p, t3.namespaceURI, !o3 && i3 ? [i3] : r3 ? null : t3.firstChild ? n.call(t3.childNodes) : null, e3, !o3 && i3 ? i3 : r3 ? r3.__e : t3.firstChild, o3, f3), N(e3, u3, f3);
  }
  function J(n3, l3) {
    G(n3, l3, J);
  }
  function K(l3, u3, t3) {
    var i3, o3, r3, e3, f3 = w({}, l3.props);
    for (r3 in l3.type && l3.type.defaultProps && (e3 = l3.type.defaultProps), u3) "key" == r3 ? i3 = u3[r3] : "ref" == r3 ? o3 = u3[r3] : f3[r3] = void 0 === u3[r3] && null != e3 ? e3[r3] : u3[r3];
    return arguments.length > 2 && (f3.children = arguments.length > 3 ? n.call(arguments, 2) : t3), m(l3.type, f3, i3 || l3.key, o3 || l3.ref, null);
  }
  function Q(n3) {
    function l3(n4) {
      var u3, t3;
      return this.getChildContext || (u3 = /* @__PURE__ */ new Set(), (t3 = {})[l3.__c] = this, this.getChildContext = function() {
        return t3;
      }, this.componentWillUnmount = function() {
        u3 = null;
      }, this.shouldComponentUpdate = function(n5) {
        this.props.value != n5.value && u3.forEach(function(n6) {
          n6.__e = true, M(n6);
        });
      }, this.sub = function(n5) {
        u3.add(n5);
        var l4 = n5.componentWillUnmount;
        n5.componentWillUnmount = function() {
          u3 && u3.delete(n5), l4 && l4.call(n5);
        };
      }), n4.children;
    }
    return l3.__c = "__cC" + h++, l3.__ = n3, l3.Provider = l3.__l = (l3.Consumer = function(n4, l4) {
      return n4.children(l4);
    }).contextType = l3, l3;
  }
  n = v.slice, l = { __e: function(n3, l3, u3, t3) {
    for (var i3, o3, r3; l3 = l3.__; ) if ((i3 = l3.__c) && !i3.__) try {
      if ((o3 = i3.constructor) && null != o3.getDerivedStateFromError && (i3.setState(o3.getDerivedStateFromError(n3)), r3 = i3.__d), null != i3.componentDidCatch && (i3.componentDidCatch(n3, t3 || {}), r3 = i3.__d), r3) return i3.__E = i3;
    } catch (l4) {
      n3 = l4;
    }
    throw n3;
  } }, u = 0, t = function(n3) {
    return null != n3 && void 0 === n3.constructor;
  }, x.prototype.setState = function(n3, l3) {
    var u3;
    u3 = null != this.__s && this.__s != this.state ? this.__s : this.__s = w({}, this.state), "function" == typeof n3 && (n3 = n3(w({}, u3), this.props)), n3 && w(u3, n3), null != n3 && this.__v && (l3 && this._sb.push(l3), M(this));
  }, x.prototype.forceUpdate = function(n3) {
    this.__v && (this.__e = true, n3 && this.__h.push(n3), M(this));
  }, x.prototype.render = k, i = [], r = "function" == typeof Promise ? Promise.prototype.then.bind(Promise.resolve()) : setTimeout, e = function(n3, l3) {
    return n3.__v.__b - l3.__v.__b;
  }, $.__r = 0, f = /(PointerCapture)$|Capture$/i, c = 0, s = F(false), a = F(true), h = 0;

  // node_modules/preact/hooks/dist/hooks.module.js
  var t2;
  var r2;
  var u2;
  var i2;
  var o2 = 0;
  var f2 = [];
  var c2 = l;
  var e2 = c2.__b;
  var a2 = c2.__r;
  var v2 = c2.diffed;
  var l2 = c2.__c;
  var m2 = c2.unmount;
  var s2 = c2.__;
  function p2(n3, t3) {
    c2.__h && c2.__h(r2, n3, o2 || t3), o2 = 0;
    var u3 = r2.__H || (r2.__H = { __: [], __h: [] });
    return n3 >= u3.__.length && u3.__.push({}), u3.__[n3];
  }
  function d2(n3) {
    return o2 = 1, h2(D2, n3);
  }
  function h2(n3, u3, i3) {
    var o3 = p2(t2++, 2);
    if (o3.t = n3, !o3.__c && (o3.__ = [i3 ? i3(u3) : D2(void 0, u3), function(n4) {
      var t3 = o3.__N ? o3.__N[0] : o3.__[0], r3 = o3.t(t3, n4);
      t3 !== r3 && (o3.__N = [r3, o3.__[1]], o3.__c.setState({}));
    }], o3.__c = r2, !r2.__f)) {
      var f3 = function(n4, t3, r3) {
        if (!o3.__c.__H) return true;
        var u4 = o3.__c.__H.__.filter(function(n5) {
          return !!n5.__c;
        });
        if (u4.every(function(n5) {
          return !n5.__N;
        })) return !c3 || c3.call(this, n4, t3, r3);
        var i4 = o3.__c.props !== n4;
        return u4.forEach(function(n5) {
          if (n5.__N) {
            var t4 = n5.__[0];
            n5.__ = n5.__N, n5.__N = void 0, t4 !== n5.__[0] && (i4 = true);
          }
        }), c3 && c3.call(this, n4, t3, r3) || i4;
      };
      r2.__f = true;
      var c3 = r2.shouldComponentUpdate, e3 = r2.componentWillUpdate;
      r2.componentWillUpdate = function(n4, t3, r3) {
        if (this.__e) {
          var u4 = c3;
          c3 = void 0, f3(n4, t3, r3), c3 = u4;
        }
        e3 && e3.call(this, n4, t3, r3);
      }, r2.shouldComponentUpdate = f3;
    }
    return o3.__N || o3.__;
  }
  function y2(n3, u3) {
    var i3 = p2(t2++, 3);
    !c2.__s && C2(i3.__H, u3) && (i3.__ = n3, i3.u = u3, r2.__H.__h.push(i3));
  }
  function _2(n3, u3) {
    var i3 = p2(t2++, 4);
    !c2.__s && C2(i3.__H, u3) && (i3.__ = n3, i3.u = u3, r2.__h.push(i3));
  }
  function A2(n3) {
    return o2 = 5, T2(function() {
      return { current: n3 };
    }, []);
  }
  function F2(n3, t3, r3) {
    o2 = 6, _2(function() {
      if ("function" == typeof n3) {
        var r4 = n3(t3());
        return function() {
          n3(null), r4 && "function" == typeof r4 && r4();
        };
      }
      if (n3) return n3.current = t3(), function() {
        return n3.current = null;
      };
    }, null == r3 ? r3 : r3.concat(n3));
  }
  function T2(n3, r3) {
    var u3 = p2(t2++, 7);
    return C2(u3.__H, r3) && (u3.__ = n3(), u3.__H = r3, u3.__h = n3), u3.__;
  }
  function q2(n3, t3) {
    return o2 = 8, T2(function() {
      return n3;
    }, t3);
  }
  function x2(n3) {
    var u3 = r2.context[n3.__c], i3 = p2(t2++, 9);
    return i3.c = n3, u3 ? (null == i3.__ && (i3.__ = true, u3.sub(r2)), u3.props.value) : n3.__;
  }
  function P2(n3, t3) {
    c2.useDebugValue && c2.useDebugValue(t3 ? t3(n3) : n3);
  }
  function g2() {
    var n3 = p2(t2++, 11);
    if (!n3.__) {
      for (var u3 = r2.__v; null !== u3 && !u3.__m && null !== u3.__; ) u3 = u3.__;
      var i3 = u3.__m || (u3.__m = [0, 0]);
      n3.__ = "P" + i3[0] + "-" + i3[1]++;
    }
    return n3.__;
  }
  function j2() {
    for (var n3; n3 = f2.shift(); ) if (n3.__P && n3.__H) try {
      n3.__H.__h.forEach(z2), n3.__H.__h.forEach(B2), n3.__H.__h = [];
    } catch (t3) {
      n3.__H.__h = [], c2.__e(t3, n3.__v);
    }
  }
  c2.__b = function(n3) {
    r2 = null, e2 && e2(n3);
  }, c2.__ = function(n3, t3) {
    n3 && t3.__k && t3.__k.__m && (n3.__m = t3.__k.__m), s2 && s2(n3, t3);
  }, c2.__r = function(n3) {
    a2 && a2(n3), t2 = 0;
    var i3 = (r2 = n3.__c).__H;
    i3 && (u2 === r2 ? (i3.__h = [], r2.__h = [], i3.__.forEach(function(n4) {
      n4.__N && (n4.__ = n4.__N), n4.u = n4.__N = void 0;
    })) : (i3.__h.forEach(z2), i3.__h.forEach(B2), i3.__h = [], t2 = 0)), u2 = r2;
  }, c2.diffed = function(n3) {
    v2 && v2(n3);
    var t3 = n3.__c;
    t3 && t3.__H && (t3.__H.__h.length && (1 !== f2.push(t3) && i2 === c2.requestAnimationFrame || ((i2 = c2.requestAnimationFrame) || w2)(j2)), t3.__H.__.forEach(function(n4) {
      n4.u && (n4.__H = n4.u), n4.u = void 0;
    })), u2 = r2 = null;
  }, c2.__c = function(n3, t3) {
    t3.some(function(n4) {
      try {
        n4.__h.forEach(z2), n4.__h = n4.__h.filter(function(n5) {
          return !n5.__ || B2(n5);
        });
      } catch (r3) {
        t3.some(function(n5) {
          n5.__h && (n5.__h = []);
        }), t3 = [], c2.__e(r3, n4.__v);
      }
    }), l2 && l2(n3, t3);
  }, c2.unmount = function(n3) {
    m2 && m2(n3);
    var t3, r3 = n3.__c;
    r3 && r3.__H && (r3.__H.__.forEach(function(n4) {
      try {
        z2(n4);
      } catch (n5) {
        t3 = n5;
      }
    }), r3.__H = void 0, t3 && c2.__e(t3, r3.__v));
  };
  var k2 = "function" == typeof requestAnimationFrame;
  function w2(n3) {
    var t3, r3 = function() {
      clearTimeout(u3), k2 && cancelAnimationFrame(t3), setTimeout(n3);
    }, u3 = setTimeout(r3, 35);
    k2 && (t3 = requestAnimationFrame(r3));
  }
  function z2(n3) {
    var t3 = r2, u3 = n3.__c;
    "function" == typeof u3 && (n3.__c = void 0, u3()), r2 = t3;
  }
  function B2(n3) {
    var t3 = r2;
    n3.__c = n3.__(), r2 = t3;
  }
  function C2(n3, t3) {
    return !n3 || n3.length !== t3.length || t3.some(function(t4, r3) {
      return t4 !== n3[r3];
    });
  }
  function D2(n3, t3) {
    return "function" == typeof t3 ? t3(n3) : t3;
  }

  // node_modules/preact/compat/dist/compat.module.js
  function g3(n3, t3) {
    for (var e3 in t3) n3[e3] = t3[e3];
    return n3;
  }
  function E2(n3, t3) {
    for (var e3 in n3) if ("__source" !== e3 && !(e3 in t3)) return true;
    for (var r3 in t3) if ("__source" !== r3 && n3[r3] !== t3[r3]) return true;
    return false;
  }
  function C3(n3, t3) {
    var e3 = t3(), r3 = d2({ t: { __: e3, u: t3 } }), u3 = r3[0].t, o3 = r3[1];
    return _2(function() {
      u3.__ = e3, u3.u = t3, R(u3) && o3({ t: u3 });
    }, [n3, e3, t3]), y2(function() {
      return R(u3) && o3({ t: u3 }), n3(function() {
        R(u3) && o3({ t: u3 });
      });
    }, [n3]), e3;
  }
  function R(n3) {
    var t3, e3, r3 = n3.u, u3 = n3.__;
    try {
      var o3 = r3();
      return !((t3 = u3) === (e3 = o3) && (0 !== t3 || 1 / t3 == 1 / e3) || t3 != t3 && e3 != e3);
    } catch (n4) {
      return true;
    }
  }
  function x3(n3) {
    n3();
  }
  function w3(n3) {
    return n3;
  }
  function k3() {
    return [false, x3];
  }
  var I2 = _2;
  function N2(n3, t3) {
    this.props = n3, this.context = t3;
  }
  function M2(n3, e3) {
    function r3(n4) {
      var t3 = this.props.ref, r4 = t3 == n4.ref;
      return !r4 && t3 && (t3.call ? t3(null) : t3.current = null), e3 ? !e3(this.props, n4) || !r4 : E2(this.props, n4);
    }
    function u3(e4) {
      return this.shouldComponentUpdate = r3, _(n3, e4);
    }
    return u3.displayName = "Memo(" + (n3.displayName || n3.name) + ")", u3.prototype.isReactComponent = true, u3.__f = true, u3.type = n3, u3;
  }
  (N2.prototype = new x()).isPureReactComponent = true, N2.prototype.shouldComponentUpdate = function(n3, t3) {
    return E2(this.props, n3) || E2(this.state, t3);
  };
  var T3 = l.__b;
  l.__b = function(n3) {
    n3.type && n3.type.__f && n3.ref && (n3.props.ref = n3.ref, n3.ref = null), T3 && T3(n3);
  };
  var A3 = "undefined" != typeof Symbol && Symbol.for && /* @__PURE__ */ Symbol.for("react.forward_ref") || 3911;
  function D3(n3) {
    function t3(t4) {
      var e3 = g3({}, t4);
      return delete e3.ref, n3(e3, t4.ref || null);
    }
    return t3.$$typeof = A3, t3.render = n3, t3.prototype.isReactComponent = t3.__f = true, t3.displayName = "ForwardRef(" + (n3.displayName || n3.name) + ")", t3;
  }
  var L2 = function(n3, t3) {
    return null == n3 ? null : H(H(n3).map(t3));
  };
  var O2 = { map: L2, forEach: L2, count: function(n3) {
    return n3 ? H(n3).length : 0;
  }, only: function(n3) {
    var t3 = H(n3);
    if (1 !== t3.length) throw "Children.only";
    return t3[0];
  }, toArray: H };
  var U = l.__e;
  l.__e = function(n3, t3, e3, r3) {
    if (n3.then) {
      for (var u3, o3 = t3; o3 = o3.__; ) if ((u3 = o3.__c) && u3.__c) return null == t3.__e && (t3.__e = e3.__e, t3.__k = e3.__k), u3.__c(n3, t3);
    }
    U(n3, t3, e3, r3);
  };
  var F3 = l.unmount;
  function V2(n3, t3, e3) {
    return n3 && (n3.__c && n3.__c.__H && (n3.__c.__H.__.forEach(function(n4) {
      "function" == typeof n4.__c && n4.__c();
    }), n3.__c.__H = null), null != (n3 = g3({}, n3)).__c && (n3.__c.__P === e3 && (n3.__c.__P = t3), n3.__c.__e = true, n3.__c = null), n3.__k = n3.__k && n3.__k.map(function(n4) {
      return V2(n4, t3, e3);
    })), n3;
  }
  function W(n3, t3, e3) {
    return n3 && e3 && (n3.__v = null, n3.__k = n3.__k && n3.__k.map(function(n4) {
      return W(n4, t3, e3);
    }), n3.__c && n3.__c.__P === t3 && (n3.__e && e3.appendChild(n3.__e), n3.__c.__e = true, n3.__c.__P = e3)), n3;
  }
  function P3() {
    this.__u = 0, this.o = null, this.__b = null;
  }
  function j3(n3) {
    if (!n3.__) return null;
    var t3 = n3.__.__c;
    return t3 && t3.__a && t3.__a(n3);
  }
  function z3(n3) {
    var e3, r3, u3, o3 = null;
    function i3(i4) {
      if (e3 || (e3 = n3()).then(function(n4) {
        n4 && (o3 = n4.default || n4), u3 = true;
      }, function(n4) {
        r3 = n4, u3 = true;
      }), r3) throw r3;
      if (!u3) throw e3;
      return o3 ? _(o3, i4) : null;
    }
    return i3.displayName = "Lazy", i3.__f = true, i3;
  }
  function B3() {
    this.i = null, this.l = null;
  }
  l.unmount = function(n3) {
    var t3 = n3.__c;
    t3 && (t3.__z = true), t3 && t3.__R && t3.__R(), t3 && 32 & n3.__u && (n3.type = null), F3 && F3(n3);
  }, (P3.prototype = new x()).__c = function(n3, t3) {
    var e3 = t3.__c, r3 = this;
    null == r3.o && (r3.o = []), r3.o.push(e3);
    var u3 = j3(r3.__v), o3 = false, i3 = function() {
      o3 || r3.__z || (o3 = true, e3.__R = null, u3 ? u3(c3) : c3());
    };
    e3.__R = i3;
    var l3 = e3.__P;
    e3.__P = null;
    var c3 = function() {
      if (!--r3.__u) {
        if (r3.state.__a) {
          var n4 = r3.state.__a;
          r3.__v.__k[0] = W(n4, n4.__c.__P, n4.__c.__O);
        }
        var t4;
        for (r3.setState({ __a: r3.__b = null }); t4 = r3.o.pop(); ) t4.__P = l3, t4.forceUpdate();
      }
    };
    r3.__u++ || 32 & t3.__u || r3.setState({ __a: r3.__b = r3.__v.__k[0] }), n3.then(i3, i3);
  }, P3.prototype.componentWillUnmount = function() {
    this.o = [];
  }, P3.prototype.render = function(n3, e3) {
    if (this.__b) {
      if (this.__v.__k) {
        var r3 = document.createElement("div"), o3 = this.__v.__k[0].__c;
        this.__v.__k[0] = V2(this.__b, r3, o3.__O = o3.__P);
      }
      this.__b = null;
    }
    var i3 = e3.__a && _(k, null, n3.fallback);
    return i3 && (i3.__u &= -33), [_(k, null, e3.__a ? null : n3.children), i3];
  };
  var H2 = function(n3, t3, e3) {
    if (++e3[1] === e3[0] && n3.l.delete(t3), n3.props.revealOrder && ("t" !== n3.props.revealOrder[0] || !n3.l.size)) for (e3 = n3.i; e3; ) {
      for (; e3.length > 3; ) e3.pop()();
      if (e3[1] < e3[0]) break;
      n3.i = e3 = e3[2];
    }
  };
  function Z(n3) {
    return this.getChildContext = function() {
      return n3.context;
    }, n3.children;
  }
  function Y(n3) {
    var e3 = this, r3 = n3.h;
    if (e3.componentWillUnmount = function() {
      G(null, e3.v), e3.v = null, e3.h = null;
    }, e3.h && e3.h !== r3 && e3.componentWillUnmount(), !e3.v) {
      for (var u3 = e3.__v; null !== u3 && !u3.__m && null !== u3.__; ) u3 = u3.__;
      e3.h = r3, e3.v = { nodeType: 1, parentNode: r3, childNodes: [], __k: { __m: u3.__m }, contains: function() {
        return true;
      }, namespaceURI: r3.namespaceURI, insertBefore: function(n4, t3) {
        this.childNodes.push(n4), e3.h.insertBefore(n4, t3);
      }, removeChild: function(n4) {
        this.childNodes.splice(this.childNodes.indexOf(n4) >>> 1, 1), e3.h.removeChild(n4);
      } };
    }
    G(_(Z, { context: e3.context }, n3.__v), e3.v);
  }
  function $2(n3, e3) {
    var r3 = _(Y, { __v: n3, h: e3 });
    return r3.containerInfo = e3, r3;
  }
  (B3.prototype = new x()).__a = function(n3) {
    var t3 = this, e3 = j3(t3.__v), r3 = t3.l.get(n3);
    return r3[0]++, function(u3) {
      var o3 = function() {
        t3.props.revealOrder ? (r3.push(u3), H2(t3, n3, r3)) : u3();
      };
      e3 ? e3(o3) : o3();
    };
  }, B3.prototype.render = function(n3) {
    this.i = null, this.l = /* @__PURE__ */ new Map();
    var t3 = H(n3.children);
    n3.revealOrder && "b" === n3.revealOrder[0] && t3.reverse();
    for (var e3 = t3.length; e3--; ) this.l.set(t3[e3], this.i = [1, 0, this.i]);
    return n3.children;
  }, B3.prototype.componentDidUpdate = B3.prototype.componentDidMount = function() {
    var n3 = this;
    this.l.forEach(function(t3, e3) {
      H2(n3, e3, t3);
    });
  };
  var q3 = "undefined" != typeof Symbol && Symbol.for && /* @__PURE__ */ Symbol.for("react.element") || 60103;
  var G2 = /^(?:accent|alignment|arabic|baseline|cap|clip(?!PathU)|color|dominant|fill|flood|font|glyph(?!R)|horiz|image(!S)|letter|lighting|marker(?!H|W|U)|overline|paint|pointer|shape|stop|strikethrough|stroke|text(?!L)|transform|underline|unicode|units|v|vector|vert|word|writing|x(?!C))[A-Z]/;
  var J2 = /^on(Ani|Tra|Tou|BeforeInp|Compo)/;
  var K2 = /[A-Z0-9]/g;
  var Q2 = "undefined" != typeof document;
  var X = function(n3) {
    return ("undefined" != typeof Symbol && "symbol" == typeof /* @__PURE__ */ Symbol() ? /fil|che|rad/ : /fil|che|ra/).test(n3);
  };
  function nn(n3, t3, e3) {
    return null == t3.__k && (t3.textContent = ""), G(n3, t3), "function" == typeof e3 && e3(), n3 ? n3.__c : null;
  }
  function tn(n3, t3, e3) {
    return J(n3, t3), "function" == typeof e3 && e3(), n3 ? n3.__c : null;
  }
  x.prototype.isReactComponent = {}, ["componentWillMount", "componentWillReceiveProps", "componentWillUpdate"].forEach(function(t3) {
    Object.defineProperty(x.prototype, t3, { configurable: true, get: function() {
      return this["UNSAFE_" + t3];
    }, set: function(n3) {
      Object.defineProperty(this, t3, { configurable: true, writable: true, value: n3 });
    } });
  });
  var en = l.event;
  function rn() {
  }
  function un() {
    return this.cancelBubble;
  }
  function on() {
    return this.defaultPrevented;
  }
  l.event = function(n3) {
    return en && (n3 = en(n3)), n3.persist = rn, n3.isPropagationStopped = un, n3.isDefaultPrevented = on, n3.nativeEvent = n3;
  };
  var ln;
  var cn = { enumerable: false, configurable: true, get: function() {
    return this.class;
  } };
  var fn = l.vnode;
  l.vnode = function(n3) {
    "string" == typeof n3.type && (function(n4) {
      var t3 = n4.props, e3 = n4.type, u3 = {}, o3 = -1 === e3.indexOf("-");
      for (var i3 in t3) {
        var l3 = t3[i3];
        if (!("value" === i3 && "defaultValue" in t3 && null == l3 || Q2 && "children" === i3 && "noscript" === e3 || "class" === i3 || "className" === i3)) {
          var c3 = i3.toLowerCase();
          "defaultValue" === i3 && "value" in t3 && null == t3.value ? i3 = "value" : "download" === i3 && true === l3 ? l3 = "" : "translate" === c3 && "no" === l3 ? l3 = false : "o" === c3[0] && "n" === c3[1] ? "ondoubleclick" === c3 ? i3 = "ondblclick" : "onchange" !== c3 || "input" !== e3 && "textarea" !== e3 || X(t3.type) ? "onfocus" === c3 ? i3 = "onfocusin" : "onblur" === c3 ? i3 = "onfocusout" : J2.test(i3) && (i3 = c3) : c3 = i3 = "oninput" : o3 && G2.test(i3) ? i3 = i3.replace(K2, "-$&").toLowerCase() : null === l3 && (l3 = void 0), "oninput" === c3 && u3[i3 = c3] && (i3 = "oninputCapture"), u3[i3] = l3;
        }
      }
      "select" == e3 && u3.multiple && Array.isArray(u3.value) && (u3.value = H(t3.children).forEach(function(n5) {
        n5.props.selected = -1 != u3.value.indexOf(n5.props.value);
      })), "select" == e3 && null != u3.defaultValue && (u3.value = H(t3.children).forEach(function(n5) {
        n5.props.selected = u3.multiple ? -1 != u3.defaultValue.indexOf(n5.props.value) : u3.defaultValue == n5.props.value;
      })), t3.class && !t3.className ? (u3.class = t3.class, Object.defineProperty(u3, "className", cn)) : (t3.className && !t3.class || t3.class && t3.className) && (u3.class = u3.className = t3.className), n4.props = u3;
    })(n3), n3.$$typeof = q3, fn && fn(n3);
  };
  var an = l.__r;
  l.__r = function(n3) {
    an && an(n3), ln = n3.__c;
  };
  var sn = l.diffed;
  l.diffed = function(n3) {
    sn && sn(n3);
    var t3 = n3.props, e3 = n3.__e;
    null != e3 && "textarea" === n3.type && "value" in t3 && t3.value !== e3.value && (e3.value = null == t3.value ? "" : t3.value), ln = null;
  };
  var hn = { ReactCurrentDispatcher: { current: { readContext: function(n3) {
    return ln.__n[n3.__c].props.value;
  }, useCallback: q2, useContext: x2, useDebugValue: P2, useDeferredValue: w3, useEffect: y2, useId: g2, useImperativeHandle: F2, useInsertionEffect: I2, useLayoutEffect: _2, useMemo: T2, useReducer: h2, useRef: A2, useState: d2, useSyncExternalStore: C3, useTransition: k3 } } };
  function dn(n3) {
    return _.bind(null, n3);
  }
  function mn(n3) {
    return !!n3 && n3.$$typeof === q3;
  }
  function pn(n3) {
    return mn(n3) && n3.type === k;
  }
  function yn(n3) {
    return !!n3 && !!n3.displayName && ("string" == typeof n3.displayName || n3.displayName instanceof String) && n3.displayName.startsWith("Memo(");
  }
  function _n(n3) {
    return mn(n3) ? K.apply(null, arguments) : n3;
  }
  function bn(n3) {
    return !!n3.__k && (G(null, n3), true);
  }
  function Sn(n3) {
    return n3 && (n3.base || 1 === n3.nodeType && n3) || null;
  }
  var gn = function(n3, t3) {
    return n3(t3);
  };
  var En = function(n3, t3) {
    return n3(t3);
  };
  var Cn = k;
  var Rn = mn;
  var xn = { useState: d2, useId: g2, useReducer: h2, useEffect: y2, useLayoutEffect: _2, useInsertionEffect: I2, useTransition: k3, useDeferredValue: w3, useSyncExternalStore: C3, startTransition: x3, useRef: A2, useImperativeHandle: F2, useMemo: T2, useCallback: q2, useContext: x2, useDebugValue: P2, version: "18.3.1", Children: O2, render: nn, hydrate: tn, unmountComponentAtNode: bn, createPortal: $2, createElement: _, createContext: Q, createFactory: dn, cloneElement: _n, createRef: b, Fragment: k, isValidElement: mn, isElement: Rn, isFragment: pn, isMemo: yn, findDOMNode: Sn, Component: x, PureComponent: N2, memo: M2, forwardRef: D3, flushSync: En, unstable_batchedUpdates: gn, StrictMode: Cn, Suspense: P3, SuspenseList: B3, lazy: z3, __SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED: hn };

  // node_modules/preact/compat/client.mjs
  function createRoot(container2) {
    return {
      // eslint-disable-next-line
      render: function(children) {
        nn(children, container2);
      },
      // eslint-disable-next-line
      unmount: function() {
        bn(container2);
      }
    };
  }

  // node_modules/mixpanel-browser/dist/mixpanel.module.js
  var win;
  if (typeof window === "undefined") {
    loc = {
      hostname: ""
    };
    win = {
      crypto: { randomUUID: function() {
        throw Error("unsupported");
      } },
      navigator: { userAgent: "", onLine: true },
      document: {
        createElement: function() {
          return {};
        },
        location: loc,
        referrer: ""
      },
      screen: { width: 0, height: 0 },
      location: loc,
      addEventListener: function() {
      },
      removeEventListener: function() {
      },
      dispatchEvent: function() {
      },
      CustomEvent: function() {
      }
    };
  } else {
    win = window;
  }
  var loc;
  function _array_like_to_array(arr, len) {
    if (len == null || len > arr.length) len = arr.length;
    for (var i3 = 0, arr2 = new Array(len); i3 < len; i3++) arr2[i3] = arr[i3];
    return arr2;
  }
  function asyncGeneratorStep(gen, resolve2, reject2, _next, _throw, key, arg) {
    try {
      var info = gen[key](arg);
      var value = info.value;
    } catch (error) {
      reject2(error);
      return;
    }
    if (info.done) {
      resolve2(value);
    } else {
      Promise.resolve(value).then(_next, _throw);
    }
  }
  function _async_to_generator(fn2) {
    return function() {
      var self2 = this, args = arguments;
      return new Promise(function(resolve2, reject2) {
        var gen = fn2.apply(self2, args);
        function _next(value) {
          asyncGeneratorStep(gen, resolve2, reject2, _next, _throw, "next", value);
        }
        function _throw(err) {
          asyncGeneratorStep(gen, resolve2, reject2, _next, _throw, "throw", err);
        }
        _next(void 0);
      });
    };
  }
  function _construct(Parent, args, Class) {
    if (_is_native_reflect_construct()) {
      _construct = Reflect.construct;
    } else {
      _construct = function construct(Parent2, args2, Class2) {
        var a3 = [
          null
        ];
        a3.push.apply(a3, args2);
        var Constructor = Function.bind.apply(Parent2, a3);
        var instance = new Constructor();
        if (Class2) _set_prototype_of(instance, Class2.prototype);
        return instance;
      };
    }
    return _construct.apply(null, arguments);
  }
  function _defineProperties(target, props) {
    for (var i3 = 0; i3 < props.length; i3++) {
      var descriptor = props[i3];
      descriptor.enumerable = descriptor.enumerable || false;
      descriptor.configurable = true;
      if ("value" in descriptor) descriptor.writable = true;
      Object.defineProperty(target, descriptor.key, descriptor);
    }
  }
  function _create_class(Constructor, protoProps, staticProps) {
    if (protoProps) _defineProperties(Constructor.prototype, protoProps);
    return Constructor;
  }
  function _extends() {
    _extends = Object.assign || function(target) {
      for (var i3 = 1; i3 < arguments.length; i3++) {
        var source = arguments[i3];
        for (var key in source) {
          if (Object.prototype.hasOwnProperty.call(source, key)) {
            target[key] = source[key];
          }
        }
      }
      return target;
    };
    return _extends.apply(this, arguments);
  }
  function _get_prototype_of(o3) {
    _get_prototype_of = Object.setPrototypeOf ? Object.getPrototypeOf : function getPrototypeOf(o4) {
      return o4.__proto__ || Object.getPrototypeOf(o4);
    };
    return _get_prototype_of(o3);
  }
  function _inherits(subClass, superClass) {
    if (typeof superClass !== "function" && superClass !== null) {
      throw new TypeError("Super expression must either be null or a function");
    }
    subClass.prototype = Object.create(superClass && superClass.prototype, {
      constructor: {
        value: subClass,
        writable: true,
        configurable: true
      }
    });
    if (superClass) _set_prototype_of(subClass, superClass);
  }
  function _instanceof(left, right) {
    if (right != null && typeof Symbol !== "undefined" && right[Symbol.hasInstance]) {
      return !!right[Symbol.hasInstance](left);
    } else {
      return left instanceof right;
    }
  }
  function _is_native_function(fn2) {
    return Function.toString.call(fn2).indexOf("[native code]") !== -1;
  }
  function _object_without_properties_loose(source, excluded) {
    if (source == null) return {};
    var target = {};
    var sourceKeys = Object.keys(source);
    var key, i3;
    for (i3 = 0; i3 < sourceKeys.length; i3++) {
      key = sourceKeys[i3];
      if (excluded.indexOf(key) >= 0) continue;
      target[key] = source[key];
    }
    return target;
  }
  function _set_prototype_of(o3, p3) {
    _set_prototype_of = Object.setPrototypeOf || function setPrototypeOf(o4, p4) {
      o4.__proto__ = p4;
      return o4;
    };
    return _set_prototype_of(o3, p3);
  }
  function _type_of(obj) {
    "@swc/helpers - typeof";
    return obj && typeof Symbol !== "undefined" && obj.constructor === Symbol ? "symbol" : typeof obj;
  }
  function _unsupported_iterable_to_array(o3, minLen) {
    if (!o3) return;
    if (typeof o3 === "string") return _array_like_to_array(o3, minLen);
    var n3 = Object.prototype.toString.call(o3).slice(8, -1);
    if (n3 === "Object" && o3.constructor) n3 = o3.constructor.name;
    if (n3 === "Map" || n3 === "Set") return Array.from(n3);
    if (n3 === "Arguments" || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n3)) return _array_like_to_array(o3, minLen);
  }
  function _wrap_native_super(Class) {
    var _cache = typeof Map === "function" ? /* @__PURE__ */ new Map() : void 0;
    _wrap_native_super = function wrapNativeSuper(Class2) {
      if (Class2 === null || !_is_native_function(Class2)) return Class2;
      if (typeof Class2 !== "function") {
        throw new TypeError("Super expression must either be null or a function");
      }
      if (typeof _cache !== "undefined") {
        if (_cache.has(Class2)) return _cache.get(Class2);
        _cache.set(Class2, Wrapper);
      }
      function Wrapper() {
        return _construct(Class2, arguments, _get_prototype_of(this).constructor);
      }
      Wrapper.prototype = Object.create(Class2.prototype, {
        constructor: {
          value: Wrapper,
          enumerable: false,
          writable: true,
          configurable: true
        }
      });
      return _set_prototype_of(Wrapper, Class2);
    };
    return _wrap_native_super(Class);
  }
  function _is_native_reflect_construct() {
    try {
      var result2 = !Boolean.prototype.valueOf.call(Reflect.construct(Boolean, [], function() {
      }));
    } catch (_4) {
    }
    return (_is_native_reflect_construct = function() {
      return !!result2;
    })();
  }
  function _create_for_of_iterator_helper_loose(o3, allowArrayLike) {
    var it = typeof Symbol !== "undefined" && o3[Symbol.iterator] || o3["@@iterator"];
    if (it) return (it = it.call(o3)).next.bind(it);
    if (Array.isArray(o3) || (it = _unsupported_iterable_to_array(o3)) || allowArrayLike) {
      if (it) o3 = it;
      var i3 = 0;
      return function() {
        if (i3 >= o3.length) {
          return {
            done: true
          };
        }
        return {
          done: false,
          value: o3[i3++]
        };
      };
    }
    throw new TypeError("Invalid attempt to iterate non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.");
  }
  function _ts_generator(thisArg, body) {
    var f3, y3, t3, g4, _4 = {
      label: 0,
      sent: function() {
        if (t3[0] & 1) throw t3[1];
        return t3[1];
      },
      trys: [],
      ops: []
    };
    return g4 = {
      next: verb(0),
      "throw": verb(1),
      "return": verb(2)
    }, typeof Symbol === "function" && (g4[Symbol.iterator] = function() {
      return this;
    }), g4;
    function verb(n3) {
      return function(v3) {
        return step([
          n3,
          v3
        ]);
      };
    }
    function step(op) {
      if (f3) throw new TypeError("Generator is already executing.");
      while (_4) try {
        if (f3 = 1, y3 && (t3 = op[0] & 2 ? y3["return"] : op[0] ? y3["throw"] || ((t3 = y3["return"]) && t3.call(y3), 0) : y3.next) && !(t3 = t3.call(y3, op[1])).done) return t3;
        if (y3 = 0, t3) op = [
          op[0] & 2,
          t3.value
        ];
        switch (op[0]) {
          case 0:
          case 1:
            t3 = op;
            break;
          case 4:
            _4.label++;
            return {
              value: op[1],
              done: false
            };
          case 5:
            _4.label++;
            y3 = op[1];
            op = [
              0
            ];
            continue;
          case 7:
            op = _4.ops.pop();
            _4.trys.pop();
            continue;
          default:
            if (!(t3 = _4.trys, t3 = t3.length > 0 && t3[t3.length - 1]) && (op[0] === 6 || op[0] === 2)) {
              _4 = 0;
              continue;
            }
            if (op[0] === 3 && (!t3 || op[1] > t3[0] && op[1] < t3[3])) {
              _4.label = op[1];
              break;
            }
            if (op[0] === 6 && _4.label < t3[1]) {
              _4.label = t3[1];
              t3 = op;
              break;
            }
            if (t3 && _4.label < t3[2]) {
              _4.label = t3[2];
              _4.ops.push(op);
              break;
            }
            if (t3[2]) _4.ops.pop();
            _4.trys.pop();
            continue;
        }
        op = body.call(thisArg, _4);
      } catch (e3) {
        op = [
          6,
          e3
        ];
        y3 = 0;
      } finally {
        f3 = t3 = 0;
      }
      if (op[0] & 5) throw op[1];
      return {
        value: op[0] ? op[1] : void 0,
        done: true
      };
    }
  }
  function _ts_values(o3) {
    var s3 = typeof Symbol === "function" && Symbol.iterator, m3 = s3 && o3[s3], i3 = 0;
    if (m3) return m3.call(o3);
    if (o3 && typeof o3.length === "number") return {
      next: function() {
        if (o3 && i3 >= o3.length) o3 = void 0;
        return {
          value: o3 && o3[i3++],
          done: !o3
        };
      }
    };
    throw new TypeError(s3 ? "Object is not iterable." : "Symbol.iterator is not defined.");
  }
  var __defProp$1 = Object.defineProperty;
  var __defNormalProp$1 = function(obj, key, value) {
    return key in obj ? __defProp$1(obj, key, {
      enumerable: true,
      configurable: true,
      writable: true,
      value
    }) : obj[key] = value;
  };
  var __publicField$1 = function(obj, key, value) {
    return __defNormalProp$1(obj, (typeof key === "undefined" ? "undefined" : _type_of(key)) !== "symbol" ? key + "" : key, value);
  };
  var _a;
  var __defProp$1$1 = Object.defineProperty;
  var __defNormalProp$1$1 = function(obj, key, value) {
    return key in obj ? __defProp$1$1(obj, key, {
      enumerable: true,
      configurable: true,
      writable: true,
      value
    }) : obj[key] = value;
  };
  var __publicField$1$1 = function(obj, key, value) {
    return __defNormalProp$1$1(obj, (typeof key === "undefined" ? "undefined" : _type_of(key)) !== "symbol" ? key + "" : key, value);
  };
  var NodeType$3 = /* @__PURE__ */ (function(NodeType2) {
    NodeType2[NodeType2["Document"] = 0] = "Document";
    NodeType2[NodeType2["DocumentType"] = 1] = "DocumentType";
    NodeType2[NodeType2["Element"] = 2] = "Element";
    NodeType2[NodeType2["Text"] = 3] = "Text";
    NodeType2[NodeType2["CDATA"] = 4] = "CDATA";
    NodeType2[NodeType2["Comment"] = 5] = "Comment";
    return NodeType2;
  })(NodeType$3 || {});
  var testableAccessors$1 = {
    Node: [
      "childNodes",
      "parentNode",
      "parentElement",
      "textContent"
    ],
    ShadowRoot: [
      "host",
      "styleSheets"
    ],
    Element: [
      "shadowRoot",
      "querySelector",
      "querySelectorAll"
    ],
    MutationObserver: []
  };
  var testableMethods$1 = {
    Node: [
      "contains",
      "getRootNode"
    ],
    ShadowRoot: [
      "getSelection"
    ],
    Element: [],
    MutationObserver: [
      "constructor"
    ]
  };
  var untaintedBasePrototype$1 = {};
  var isAngularZonePresent$1 = function() {
    return !!globalThis.Zone;
  };
  function getUntaintedPrototype$1(key) {
    if (untaintedBasePrototype$1[key]) return untaintedBasePrototype$1[key];
    var defaultObj = globalThis[key];
    var defaultPrototype = defaultObj.prototype;
    var accessorNames = key in testableAccessors$1 ? testableAccessors$1[key] : void 0;
    var isUntaintedAccessors = Boolean(accessorNames && // @ts-expect-error 2345
    accessorNames.every(function(accessor) {
      var _a2, _b;
      return Boolean((_b = (_a2 = Object.getOwnPropertyDescriptor(defaultPrototype, accessor)) == null ? void 0 : _a2.get) == null ? void 0 : _b.toString().includes("[native code]"));
    }));
    var methodNames = key in testableMethods$1 ? testableMethods$1[key] : void 0;
    var isUntaintedMethods = Boolean(methodNames && methodNames.every(
      // @ts-expect-error 2345
      function(method) {
        var _a2;
        return typeof defaultPrototype[method] === "function" && ((_a2 = defaultPrototype[method]) == null ? void 0 : _a2.toString().includes("[native code]"));
      }
    ));
    if (isUntaintedAccessors && isUntaintedMethods && !isAngularZonePresent$1()) {
      untaintedBasePrototype$1[key] = defaultObj.prototype;
      return defaultObj.prototype;
    }
    try {
      var iframeEl = document.createElement("iframe");
      document.body.appendChild(iframeEl);
      var win2 = iframeEl.contentWindow;
      if (!win2) return defaultObj.prototype;
      var untaintedObject = win2[key].prototype;
      document.body.removeChild(iframeEl);
      if (!untaintedObject) return defaultPrototype;
      return untaintedBasePrototype$1[key] = untaintedObject;
    } catch (e3) {
      return defaultPrototype;
    }
  }
  var untaintedAccessorCache$1 = {};
  function getUntaintedAccessor$1(key, instance, accessor) {
    var _a2;
    var cacheKey = key + "." + String(accessor);
    if (untaintedAccessorCache$1[cacheKey]) return untaintedAccessorCache$1[cacheKey].call(instance);
    var untaintedPrototype = getUntaintedPrototype$1(key);
    var untaintedAccessor = (_a2 = Object.getOwnPropertyDescriptor(untaintedPrototype, accessor)) == null ? void 0 : _a2.get;
    if (!untaintedAccessor) return instance[accessor];
    untaintedAccessorCache$1[cacheKey] = untaintedAccessor;
    return untaintedAccessor.call(instance);
  }
  var untaintedMethodCache$1 = {};
  function getUntaintedMethod$1(key, instance, method) {
    var cacheKey = key + "." + String(method);
    if (untaintedMethodCache$1[cacheKey]) return untaintedMethodCache$1[cacheKey].bind(instance);
    var untaintedPrototype = getUntaintedPrototype$1(key);
    var untaintedMethod = untaintedPrototype[method];
    if (typeof untaintedMethod !== "function") return instance[method];
    untaintedMethodCache$1[cacheKey] = untaintedMethod;
    return untaintedMethod.bind(instance);
  }
  function childNodes$1(n22) {
    return getUntaintedAccessor$1("Node", n22, "childNodes");
  }
  function parentNode$1(n22) {
    return getUntaintedAccessor$1("Node", n22, "parentNode");
  }
  function parentElement$1(n22) {
    return getUntaintedAccessor$1("Node", n22, "parentElement");
  }
  function textContent$1(n22) {
    return getUntaintedAccessor$1("Node", n22, "textContent");
  }
  function contains$1(n22, other) {
    return getUntaintedMethod$1("Node", n22, "contains")(other);
  }
  function getRootNode$1(n22) {
    return getUntaintedMethod$1("Node", n22, "getRootNode")();
  }
  function host$1(n22) {
    if (!n22 || !("host" in n22)) return null;
    return getUntaintedAccessor$1("ShadowRoot", n22, "host");
  }
  function styleSheets$1(n22) {
    return n22.styleSheets;
  }
  function shadowRoot$1(n22) {
    if (!n22 || !("shadowRoot" in n22)) return null;
    return getUntaintedAccessor$1("Element", n22, "shadowRoot");
  }
  function querySelector$1(n22, selectors) {
    return getUntaintedAccessor$1("Element", n22, "querySelector")(selectors);
  }
  function querySelectorAll$1(n22, selectors) {
    return getUntaintedAccessor$1("Element", n22, "querySelectorAll")(selectors);
  }
  function mutationObserverCtor$1() {
    return getUntaintedPrototype$1("MutationObserver").constructor;
  }
  function patch$1$1(source, name, replacement) {
    try {
      if (!(name in source)) {
        return function() {
        };
      }
      var original = source[name];
      var wrapped = replacement(original);
      if (typeof wrapped === "function") {
        wrapped.prototype = wrapped.prototype || {};
        Object.defineProperties(wrapped, {
          __rrweb_original__: {
            enumerable: false,
            value: original
          }
        });
      }
      source[name] = wrapped;
      return function() {
        source[name] = original;
      };
    } catch (e3) {
      return function() {
      };
    }
  }
  var index$1 = {
    childNodes: childNodes$1,
    parentNode: parentNode$1,
    parentElement: parentElement$1,
    textContent: textContent$1,
    contains: contains$1,
    getRootNode: getRootNode$1,
    host: host$1,
    styleSheets: styleSheets$1,
    shadowRoot: shadowRoot$1,
    querySelector: querySelector$1,
    querySelectorAll: querySelectorAll$1,
    mutationObserver: mutationObserverCtor$1,
    patch: patch$1$1
  };
  function isElement(n22) {
    return n22.nodeType === n22.ELEMENT_NODE;
  }
  function isShadowRoot(n22) {
    var hostEl = (
      // anchor and textarea elements also have a `host` property
      // but only shadow roots have a `mode` property
      n22 && "host" in n22 && "mode" in n22 && index$1.host(n22) || null
    );
    return Boolean(hostEl && "shadowRoot" in hostEl && index$1.shadowRoot(hostEl) === n22);
  }
  function isNativeShadowDom(shadowRoot2) {
    return Object.prototype.toString.call(shadowRoot2) === "[object ShadowRoot]";
  }
  function fixBrowserCompatibilityIssuesInCSS(cssText) {
    if (cssText.includes(" background-clip: text;") && !cssText.includes(" -webkit-background-clip: text;")) {
      cssText = cssText.replace(/\sbackground-clip:\s*text;/g, " -webkit-background-clip: text; background-clip: text;");
    }
    return cssText;
  }
  function escapeImportStatement(rule2) {
    var cssText = rule2.cssText;
    if (cssText.split('"').length < 3) return cssText;
    var statement = [
      "@import",
      "url(" + JSON.stringify(rule2.href) + ")"
    ];
    if (rule2.layerName === "") {
      statement.push("layer");
    } else if (rule2.layerName) {
      statement.push("layer(" + rule2.layerName + ")");
    }
    if (rule2.supportsText) {
      statement.push("supports(" + rule2.supportsText + ")");
    }
    if (rule2.media.length) {
      statement.push(rule2.media.mediaText);
    }
    return statement.join(" ") + ";";
  }
  function stringifyStylesheet(s22) {
    try {
      var rules2 = s22.rules || s22.cssRules;
      if (!rules2) {
        return null;
      }
      var sheetHref = s22.href;
      if (!sheetHref && s22.ownerNode && s22.ownerNode.ownerDocument) {
        sheetHref = s22.ownerNode.ownerDocument.location.href;
      }
      var stringifiedRules = Array.from(rules2, function(rule2) {
        return stringifyRule(rule2, sheetHref);
      }).join("");
      return fixBrowserCompatibilityIssuesInCSS(stringifiedRules);
    } catch (error) {
      return null;
    }
  }
  function stringifyRule(rule2, sheetHref) {
    if (isCSSImportRule(rule2)) {
      var importStringified;
      try {
        importStringified = // we can access the imported stylesheet rules directly
        stringifyStylesheet(rule2.styleSheet) || // work around browser issues with the raw string `@import url(...)` statement
        escapeImportStatement(rule2);
      } catch (error) {
        importStringified = rule2.cssText;
      }
      if (rule2.styleSheet.href) {
        return absolutifyURLs(importStringified, rule2.styleSheet.href);
      }
      return importStringified;
    } else {
      var ruleStringified = rule2.cssText;
      if (isCSSStyleRule(rule2) && rule2.selectorText.includes(":")) {
        ruleStringified = fixSafariColons(ruleStringified);
      }
      if (sheetHref) {
        return absolutifyURLs(ruleStringified, sheetHref);
      }
      return ruleStringified;
    }
  }
  function fixSafariColons(cssStringified) {
    var regex = /(\[(?:[\w-]+)[^\\])(:(?:[\w-]+)\])/gm;
    return cssStringified.replace(regex, "$1\\$2");
  }
  function isCSSImportRule(rule2) {
    return "styleSheet" in rule2;
  }
  function isCSSStyleRule(rule2) {
    return "selectorText" in rule2;
  }
  var Mirror = /* @__PURE__ */ (function() {
    function Mirror2() {
      __publicField$1$1(this, "idNodeMap", /* @__PURE__ */ new Map());
      __publicField$1$1(this, "nodeMetaMap", /* @__PURE__ */ new WeakMap());
    }
    var _proto = Mirror2.prototype;
    _proto.getId = function getId2(n22) {
      var _a2;
      if (!n22) return -1;
      var id = (_a2 = this.getMeta(n22)) == null ? void 0 : _a2.id;
      return id != null ? id : -1;
    };
    _proto.getNode = function getNode2(id) {
      return this.idNodeMap.get(id) || null;
    };
    _proto.getIds = function getIds() {
      return Array.from(this.idNodeMap.keys());
    };
    _proto.getMeta = function getMeta(n22) {
      return this.nodeMetaMap.get(n22) || null;
    };
    _proto.removeNodeFromMap = function removeNodeFromMap2(n22) {
      var _this = this;
      var id = this.getId(n22);
      this.idNodeMap.delete(id);
      if (n22.childNodes) {
        n22.childNodes.forEach(function(childNode) {
          return _this.removeNodeFromMap(childNode);
        });
      }
    };
    _proto.has = function has2(id) {
      return this.idNodeMap.has(id);
    };
    _proto.hasNode = function hasNode(node2) {
      return this.nodeMetaMap.has(node2);
    };
    _proto.add = function add(n22, meta) {
      var id = meta.id;
      this.idNodeMap.set(id, n22);
      this.nodeMetaMap.set(n22, meta);
    };
    _proto.replace = function replace(id, n22) {
      var oldNode = this.getNode(id);
      if (oldNode) {
        var meta = this.nodeMetaMap.get(oldNode);
        if (meta) this.nodeMetaMap.set(n22, meta);
      }
      this.idNodeMap.set(id, n22);
    };
    _proto.reset = function reset2() {
      this.idNodeMap = /* @__PURE__ */ new Map();
      this.nodeMetaMap = /* @__PURE__ */ new WeakMap();
    };
    return Mirror2;
  })();
  function createMirror$2() {
    return new Mirror();
  }
  function maskInputValue(param) {
    var element = param.element, maskInputOptions = param.maskInputOptions, tagName = param.tagName, type = param.type, value = param.value, maskInputFn = param.maskInputFn;
    var text = value || "";
    var actualType = type && toLowerCase(type);
    if (maskInputOptions[tagName.toLowerCase()] || actualType && maskInputOptions[actualType]) {
      if (maskInputFn) {
        text = maskInputFn(text, element);
      } else {
        text = "*".repeat(text.length);
      }
    }
    return text;
  }
  function toLowerCase(str) {
    return str.toLowerCase();
  }
  var ORIGINAL_ATTRIBUTE_NAME = "__rrweb_original__";
  function is2DCanvasBlank(canvas) {
    var ctx = canvas.getContext("2d");
    if (!ctx) return true;
    var chunkSize = 50;
    for (var x22 = 0; x22 < canvas.width; x22 += chunkSize) {
      for (var y3 = 0; y3 < canvas.height; y3 += chunkSize) {
        var getImageData = ctx.getImageData;
        var originalGetImageData = ORIGINAL_ATTRIBUTE_NAME in getImageData ? getImageData[ORIGINAL_ATTRIBUTE_NAME] : getImageData;
        var pixelBuffer = new Uint32Array(
          // eslint-disable-next-line @typescript-eslint/no-unsafe-argument, @typescript-eslint/no-unsafe-member-access
          originalGetImageData.call(ctx, x22, y3, Math.min(chunkSize, canvas.width - x22), Math.min(chunkSize, canvas.height - y3)).data.buffer
        );
        if (pixelBuffer.some(function(pixel) {
          return pixel !== 0;
        })) return false;
      }
    }
    return true;
  }
  function getInputType(element) {
    var type = element.type;
    return element.hasAttribute("data-rr-is-password") ? "password" : type ? (
      // eslint-disable-next-line @typescript-eslint/no-unnecessary-type-assertion
      toLowerCase(type)
    ) : null;
  }
  function extractFileExtension(path, baseURL) {
    var url;
    try {
      url = new URL(path, baseURL != null ? baseURL : window.location.href);
    } catch (err) {
      return null;
    }
    var regex = /\.([0-9a-z]+)(?:$)/i;
    var match = url.pathname.match(regex);
    var _ref;
    return (_ref = match == null ? void 0 : match[1]) != null ? _ref : null;
  }
  function extractOrigin(url) {
    var origin = "";
    if (url.indexOf("//") > -1) {
      origin = url.split("/").slice(0, 3).join("/");
    } else {
      origin = url.split("/")[0];
    }
    origin = origin.split("?")[0];
    return origin;
  }
  var URL_IN_CSS_REF = /url\((?:(')([^']*)'|(")(.*?)"|([^)]*))\)/gm;
  var URL_PROTOCOL_MATCH = /^(?:[a-z+]+:)?\/\//i;
  var URL_WWW_MATCH = /^www\..*/i;
  var DATA_URI = /^(data:)([^,]*),(.*)/i;
  function absolutifyURLs(cssText, href) {
    return (cssText || "").replace(URL_IN_CSS_REF, function(origin, quote1, path1, quote2, path2, path3) {
      var filePath = path1 || path2 || path3;
      var maybeQuote = quote1 || quote2 || "";
      if (!filePath) {
        return origin;
      }
      if (URL_PROTOCOL_MATCH.test(filePath) || URL_WWW_MATCH.test(filePath)) {
        return "url(" + maybeQuote + filePath + maybeQuote + ")";
      }
      if (DATA_URI.test(filePath)) {
        return "url(" + maybeQuote + filePath + maybeQuote + ")";
      }
      if (filePath[0] === "/") {
        return "url(" + maybeQuote + (extractOrigin(href) + filePath) + maybeQuote + ")";
      }
      var stack = href.split("/");
      var parts = filePath.split("/");
      stack.pop();
      for (var _iterator = _create_for_of_iterator_helper_loose(parts), _step; !(_step = _iterator()).done; ) {
        var part = _step.value;
        if (part === ".") {
          continue;
        } else if (part === "..") {
          stack.pop();
        } else {
          stack.push(part);
        }
      }
      return "url(" + maybeQuote + stack.join("/") + maybeQuote + ")";
    });
  }
  function normalizeCssString(cssText, _testNoPxNorm) {
    if (_testNoPxNorm === void 0) _testNoPxNorm = false;
    if (_testNoPxNorm) {
      return cssText.replace(/(\/\*[^*]*\*\/)|[\s;]/g, "");
    } else {
      return cssText.replace(/(\/\*[^*]*\*\/)|[\s;]/g, "").replace(/0px/g, "0");
    }
  }
  function splitCssText(cssText, style, _testNoPxNorm) {
    if (_testNoPxNorm === void 0) _testNoPxNorm = false;
    var childNodes2 = Array.from(style.childNodes);
    var splits = [];
    var iterCount = 0;
    if (childNodes2.length > 1 && cssText && typeof cssText === "string") {
      var cssTextNorm = normalizeCssString(cssText, _testNoPxNorm);
      var normFactor = cssTextNorm.length / cssText.length;
      for (var i22 = 1; i22 < childNodes2.length; i22++) {
        if (childNodes2[i22].textContent && typeof childNodes2[i22].textContent === "string") {
          var textContentNorm = normalizeCssString(childNodes2[i22].textContent, _testNoPxNorm);
          var jLimit = 100;
          var j4 = 3;
          for (; j4 < textContentNorm.length; j4++) {
            if (
              // keep consuming css identifiers (to get a decent chunk more quickly)
              textContentNorm[j4].match(/[a-zA-Z0-9]/) || // substring needs to be unique to this section
              textContentNorm.indexOf(textContentNorm.substring(0, j4), 1) !== -1
            ) {
              continue;
            }
            break;
          }
          for (; j4 < textContentNorm.length; j4++) {
            var startSubstring = textContentNorm.substring(0, j4);
            var cssNormSplits = cssTextNorm.split(startSubstring);
            var splitNorm = -1;
            if (cssNormSplits.length === 2) {
              splitNorm = cssNormSplits[0].length;
            } else if (cssNormSplits.length > 2 && cssNormSplits[0] === "" && childNodes2[i22 - 1].textContent !== "") {
              splitNorm = cssTextNorm.indexOf(startSubstring, 1);
            } else if (cssNormSplits.length === 1) {
              startSubstring = startSubstring.substring(0, startSubstring.length - 1);
              cssNormSplits = cssTextNorm.split(startSubstring);
              if (cssNormSplits.length <= 1) {
                splits.push(cssText);
                return splits;
              }
              j4 = jLimit + 1;
            } else if (j4 === textContentNorm.length - 1) {
              splitNorm = cssTextNorm.indexOf(startSubstring);
            }
            if (cssNormSplits.length >= 2 && j4 > jLimit) {
              var prevTextContent = childNodes2[i22 - 1].textContent;
              if (prevTextContent && typeof prevTextContent === "string") {
                var prevMinLength = normalizeCssString(prevTextContent).length;
                splitNorm = cssTextNorm.indexOf(startSubstring, prevMinLength);
              }
              if (splitNorm === -1) {
                splitNorm = cssNormSplits[0].length;
              }
            }
            if (splitNorm !== -1) {
              var k4 = Math.floor(splitNorm / normFactor);
              for (; k4 > 0 && k4 < cssText.length; ) {
                iterCount += 1;
                if (iterCount > 50 * childNodes2.length) {
                  splits.push(cssText);
                  return splits;
                }
                var normPart = normalizeCssString(cssText.substring(0, k4), _testNoPxNorm);
                if (normPart.length === splitNorm) {
                  splits.push(cssText.substring(0, k4));
                  cssText = cssText.substring(k4);
                  cssTextNorm = cssTextNorm.substring(splitNorm);
                  break;
                } else if (normPart.length < splitNorm) {
                  k4 += Math.max(1, Math.floor((splitNorm - normPart.length) / normFactor));
                } else {
                  k4 -= Math.max(1, Math.floor((normPart.length - splitNorm) * normFactor));
                }
              }
              break;
            }
          }
        }
      }
    }
    splits.push(cssText);
    return splits;
  }
  function markCssSplits(cssText, style) {
    return splitCssText(cssText, style).join("/* rr_split */");
  }
  var _id = 1;
  var tagNameRegex = new RegExp("[^a-z0-9-_:]");
  var IGNORED_NODE = -2;
  function genId() {
    return _id++;
  }
  function getValidTagName$1(element) {
    if (_instanceof(element, HTMLFormElement)) {
      return "form";
    }
    var processedTagName = toLowerCase(element.tagName);
    if (tagNameRegex.test(processedTagName)) {
      return "div";
    }
    return processedTagName;
  }
  var canvasService;
  var canvasCtx;
  var SRCSET_NOT_SPACES = /^[^ \t\n\r\u000c]+/;
  var SRCSET_COMMAS_OR_SPACES = /^[, \t\n\r\u000c]+/;
  function getAbsoluteSrcsetString(doc, attributeValue) {
    if (attributeValue.trim() === "") {
      return attributeValue;
    }
    var pos = 0;
    function collectCharacters(regEx) {
      var chars2;
      var match = regEx.exec(attributeValue.substring(pos));
      if (match) {
        chars2 = match[0];
        pos += chars2.length;
        return chars2;
      }
      return "";
    }
    var output = [];
    while (true) {
      collectCharacters(SRCSET_COMMAS_OR_SPACES);
      if (pos >= attributeValue.length) {
        break;
      }
      var url = collectCharacters(SRCSET_NOT_SPACES);
      if (url.slice(-1) === ",") {
        url = absoluteToDoc(doc, url.substring(0, url.length - 1));
        output.push(url);
      } else {
        var descriptorsStr = "";
        url = absoluteToDoc(doc, url);
        var inParens = false;
        while (true) {
          var c22 = attributeValue.charAt(pos);
          if (c22 === "") {
            output.push((url + descriptorsStr).trim());
            break;
          } else if (!inParens) {
            if (c22 === ",") {
              pos += 1;
              output.push((url + descriptorsStr).trim());
              break;
            } else if (c22 === "(") {
              inParens = true;
            }
          } else {
            if (c22 === ")") {
              inParens = false;
            }
          }
          descriptorsStr += c22;
          pos += 1;
        }
      }
    }
    return output.join(", ");
  }
  var cachedDocument = /* @__PURE__ */ new WeakMap();
  function absoluteToDoc(doc, attributeValue) {
    if (!attributeValue || attributeValue.trim() === "") {
      return attributeValue;
    }
    return getHref(doc, attributeValue);
  }
  function isSVGElement(el) {
    return Boolean(el.tagName === "svg" || el.ownerSVGElement);
  }
  function getHref(doc, customHref) {
    var a22 = cachedDocument.get(doc);
    if (!a22) {
      a22 = doc.createElement("a");
      cachedDocument.set(doc, a22);
    }
    if (!customHref) {
      customHref = "";
    } else if (customHref.startsWith("blob:") || customHref.startsWith("data:")) {
      return customHref;
    }
    a22.setAttribute("href", customHref);
    return a22.href;
  }
  function transformAttribute(doc, tagName, name, value) {
    if (!value) {
      return value;
    }
    if (name === "src" || name === "href" && !(tagName === "use" && value[0] === "#")) {
      return absoluteToDoc(doc, value);
    } else if (name === "xlink:href" && value[0] !== "#") {
      return absoluteToDoc(doc, value);
    } else if (name === "background" && (tagName === "table" || tagName === "td" || tagName === "th")) {
      return absoluteToDoc(doc, value);
    } else if (name === "srcset") {
      return getAbsoluteSrcsetString(doc, value);
    } else if (name === "style") {
      return absolutifyURLs(value, getHref(doc));
    } else if (tagName === "object" && name === "data") {
      return absoluteToDoc(doc, value);
    }
    return value;
  }
  function ignoreAttribute(tagName, name, _value) {
    return (tagName === "video" || tagName === "audio") && name === "autoplay";
  }
  function _isBlockedElement(element, blockClass, blockSelector) {
    try {
      if (typeof blockClass === "string") {
        if (element.classList.contains(blockClass)) {
          return true;
        }
      } else {
        for (var eIndex = element.classList.length; eIndex--; ) {
          var className = element.classList[eIndex];
          if (blockClass.test(className)) {
            return true;
          }
        }
      }
      if (blockSelector) {
        return element.matches(blockSelector);
      }
    } catch (e22) {
    }
    return false;
  }
  function classMatchesRegex$1(node2, regex, checkAncestors) {
    if (!node2) return false;
    if (node2.nodeType !== node2.ELEMENT_NODE) {
      if (!checkAncestors) return false;
      return classMatchesRegex$1(index$1.parentNode(node2), regex, checkAncestors);
    }
    for (var eIndex = node2.classList.length; eIndex--; ) {
      var className = node2.classList[eIndex];
      if (regex.test(className)) {
        return true;
      }
    }
    if (!checkAncestors) return false;
    return classMatchesRegex$1(index$1.parentNode(node2), regex, checkAncestors);
  }
  function needMaskingText(node2, maskTextClass, maskTextSelector, checkAncestors) {
    var el;
    if (isElement(node2)) {
      el = node2;
      if (!index$1.childNodes(el).length) {
        return false;
      }
    } else if (index$1.parentElement(node2) === null) {
      return false;
    } else {
      el = index$1.parentElement(node2);
    }
    try {
      if (typeof maskTextClass === "string") {
        if (checkAncestors) {
          if (el.closest("." + maskTextClass)) return true;
        } else {
          if (el.classList.contains(maskTextClass)) return true;
        }
      } else {
        if (classMatchesRegex$1(el, maskTextClass, checkAncestors)) return true;
      }
      if (maskTextSelector) {
        if (checkAncestors) {
          if (el.closest(maskTextSelector)) return true;
        } else {
          if (el.matches(maskTextSelector)) return true;
        }
      }
    } catch (e22) {
    }
    return false;
  }
  function onceIframeLoaded(iframeEl, listener, iframeLoadTimeout) {
    var win2 = iframeEl.contentWindow;
    if (!win2) {
      return;
    }
    var fired = false;
    var readyState;
    try {
      readyState = win2.document.readyState;
    } catch (error) {
      return;
    }
    if (readyState !== "complete") {
      var timer3 = setTimeout(function() {
        if (!fired) {
          listener();
          fired = true;
        }
      }, iframeLoadTimeout);
      iframeEl.addEventListener("load", function() {
        clearTimeout(timer3);
        fired = true;
        listener();
      });
      return;
    }
    var blankUrl = "about:blank";
    if (win2.location.href !== blankUrl || iframeEl.src === blankUrl || iframeEl.src === "") {
      setTimeout(listener, 0);
      return iframeEl.addEventListener("load", listener);
    }
    iframeEl.addEventListener("load", listener);
  }
  function onceStylesheetLoaded(link, listener, styleSheetLoadTimeout) {
    var fired = false;
    var styleSheetLoaded;
    try {
      styleSheetLoaded = link.sheet;
    } catch (error) {
      return;
    }
    if (styleSheetLoaded) return;
    var timer3 = setTimeout(function() {
      if (!fired) {
        listener();
        fired = true;
      }
    }, styleSheetLoadTimeout);
    link.addEventListener("load", function() {
      clearTimeout(timer3);
      fired = true;
      listener();
    });
  }
  function serializeNode(n22, options) {
    var doc = options.doc, mirror2 = options.mirror, blockClass = options.blockClass, blockSelector = options.blockSelector, needsMask = options.needsMask, inlineStylesheet = options.inlineStylesheet, _options_maskInputOptions = options.maskInputOptions, maskInputOptions = _options_maskInputOptions === void 0 ? {} : _options_maskInputOptions, maskTextFn = options.maskTextFn, maskInputFn = options.maskInputFn, _options_dataURLOptions = options.dataURLOptions, dataURLOptions = _options_dataURLOptions === void 0 ? {} : _options_dataURLOptions, inlineImages = options.inlineImages, recordCanvas = options.recordCanvas, keepIframeSrcFn = options.keepIframeSrcFn, _options_newlyAddedElement = options.newlyAddedElement, newlyAddedElement = _options_newlyAddedElement === void 0 ? false : _options_newlyAddedElement, _options_cssCaptured = options.cssCaptured, cssCaptured = _options_cssCaptured === void 0 ? false : _options_cssCaptured;
    var rootId = getRootId(doc, mirror2);
    switch (n22.nodeType) {
      case n22.DOCUMENT_NODE:
        if (n22.compatMode !== "CSS1Compat") {
          return {
            type: NodeType$3.Document,
            childNodes: [],
            compatMode: n22.compatMode
          };
        } else {
          return {
            type: NodeType$3.Document,
            childNodes: []
          };
        }
      case n22.DOCUMENT_TYPE_NODE:
        return {
          type: NodeType$3.DocumentType,
          name: n22.name,
          publicId: n22.publicId,
          systemId: n22.systemId,
          rootId
        };
      case n22.ELEMENT_NODE:
        return serializeElementNode(n22, {
          doc,
          blockClass,
          blockSelector,
          inlineStylesheet,
          maskInputOptions,
          maskInputFn,
          dataURLOptions,
          inlineImages,
          recordCanvas,
          keepIframeSrcFn,
          newlyAddedElement,
          rootId
        });
      case n22.TEXT_NODE:
        return serializeTextNode(n22, {
          doc,
          needsMask,
          maskTextFn,
          rootId,
          cssCaptured
        });
      case n22.CDATA_SECTION_NODE:
        return {
          type: NodeType$3.CDATA,
          textContent: "",
          rootId
        };
      case n22.COMMENT_NODE:
        return {
          type: NodeType$3.Comment,
          textContent: index$1.textContent(n22) || "",
          rootId
        };
      default:
        return false;
    }
  }
  function getRootId(doc, mirror2) {
    if (!mirror2.hasNode(doc)) return void 0;
    var docId = mirror2.getId(doc);
    return docId === 1 ? void 0 : docId;
  }
  function serializeTextNode(n22, options) {
    var needsMask = options.needsMask, maskTextFn = options.maskTextFn, rootId = options.rootId, cssCaptured = options.cssCaptured;
    var parent = index$1.parentNode(n22);
    var parentTagName = parent && parent.tagName;
    var textContent2 = "";
    var isStyle = parentTagName === "STYLE" ? true : void 0;
    var isScript = parentTagName === "SCRIPT" ? true : void 0;
    if (isScript) {
      textContent2 = "SCRIPT_PLACEHOLDER";
    } else if (!cssCaptured) {
      textContent2 = index$1.textContent(n22);
      if (isStyle && textContent2) {
        textContent2 = absolutifyURLs(textContent2, getHref(options.doc));
      }
    }
    if (!isStyle && !isScript && textContent2 && needsMask) {
      textContent2 = maskTextFn ? maskTextFn(textContent2, index$1.parentElement(n22)) : textContent2.replace(/[\S]/g, "*");
    }
    return {
      type: NodeType$3.Text,
      textContent: textContent2 || "",
      rootId
    };
  }
  function serializeElementNode(n22, options) {
    var doc = options.doc, blockClass = options.blockClass, blockSelector = options.blockSelector, inlineStylesheet = options.inlineStylesheet, _options_maskInputOptions = options.maskInputOptions, maskInputOptions = _options_maskInputOptions === void 0 ? {} : _options_maskInputOptions, maskInputFn = options.maskInputFn, _options_dataURLOptions = options.dataURLOptions, dataURLOptions = _options_dataURLOptions === void 0 ? {} : _options_dataURLOptions, inlineImages = options.inlineImages, recordCanvas = options.recordCanvas, keepIframeSrcFn = options.keepIframeSrcFn, _options_newlyAddedElement = options.newlyAddedElement, newlyAddedElement = _options_newlyAddedElement === void 0 ? false : _options_newlyAddedElement, rootId = options.rootId;
    var needBlock = _isBlockedElement(n22, blockClass, blockSelector);
    var tagName = getValidTagName$1(n22);
    var attributes = {};
    var len = n22.attributes.length;
    for (var i22 = 0; i22 < len; i22++) {
      var attr = n22.attributes[i22];
      if (!ignoreAttribute(tagName, attr.name, attr.value)) {
        attributes[attr.name] = transformAttribute(doc, tagName, toLowerCase(attr.name), attr.value);
      }
    }
    if (tagName === "link" && inlineStylesheet) {
      var stylesheet = Array.from(doc.styleSheets).find(function(s22) {
        return s22.href === n22.href;
      });
      var cssText = null;
      if (stylesheet) {
        cssText = stringifyStylesheet(stylesheet);
      }
      if (cssText) {
        delete attributes.rel;
        delete attributes.href;
        attributes._cssText = cssText;
      }
    }
    if (tagName === "style" && n22.sheet) {
      var cssText1 = stringifyStylesheet(n22.sheet);
      if (cssText1) {
        if (n22.childNodes.length > 1) {
          cssText1 = markCssSplits(cssText1, n22);
        }
        attributes._cssText = cssText1;
      }
    }
    if (tagName === "input" || tagName === "textarea" || tagName === "select") {
      var value = n22.value;
      var checked = n22.checked;
      if (attributes.type !== "radio" && attributes.type !== "checkbox" && attributes.type !== "submit" && attributes.type !== "button" && value) {
        attributes.value = maskInputValue({
          element: n22,
          type: getInputType(n22),
          tagName,
          value,
          maskInputOptions,
          maskInputFn
        });
      } else if (checked) {
        attributes.checked = checked;
      }
    }
    if (tagName === "option") {
      if (n22.selected && !maskInputOptions["select"]) {
        attributes.selected = true;
      } else {
        delete attributes.selected;
      }
    }
    if (tagName === "dialog" && n22.open) {
      attributes.rr_open_mode = n22.matches("dialog:modal") ? "modal" : "non-modal";
    }
    if (tagName === "canvas" && recordCanvas) {
      if (n22.__context === "2d") {
        if (!is2DCanvasBlank(n22)) {
          attributes.rr_dataURL = n22.toDataURL(dataURLOptions.type, dataURLOptions.quality);
        }
      } else if (!("__context" in n22)) {
        var canvasDataURL = n22.toDataURL(dataURLOptions.type, dataURLOptions.quality);
        var blankCanvas = doc.createElement("canvas");
        blankCanvas.width = n22.width;
        blankCanvas.height = n22.height;
        var blankCanvasDataURL = blankCanvas.toDataURL(dataURLOptions.type, dataURLOptions.quality);
        if (canvasDataURL !== blankCanvasDataURL) {
          attributes.rr_dataURL = canvasDataURL;
        }
      }
    }
    if (tagName === "img" && inlineImages) {
      if (!canvasService) {
        canvasService = doc.createElement("canvas");
        canvasCtx = canvasService.getContext("2d");
      }
      var image = n22;
      var imageSrc = image.currentSrc || image.getAttribute("src") || "<unknown-src>";
      var priorCrossOrigin = image.crossOrigin;
      var recordInlineImage = function() {
        image.removeEventListener("load", recordInlineImage);
        try {
          canvasService.width = image.naturalWidth;
          canvasService.height = image.naturalHeight;
          canvasCtx.drawImage(image, 0, 0);
          attributes.rr_dataURL = canvasService.toDataURL(dataURLOptions.type, dataURLOptions.quality);
        } catch (err) {
          if (image.crossOrigin !== "anonymous") {
            image.crossOrigin = "anonymous";
            if (image.complete && image.naturalWidth !== 0) recordInlineImage();
            else image.addEventListener("load", recordInlineImage);
            return;
          } else {
            console.warn("Cannot inline img src=" + imageSrc + "! Error: " + err);
          }
        }
        if (image.crossOrigin === "anonymous") {
          priorCrossOrigin ? attributes.crossOrigin = priorCrossOrigin : image.removeAttribute("crossorigin");
        }
      };
      if (image.complete && image.naturalWidth !== 0) recordInlineImage();
      else image.addEventListener("load", recordInlineImage);
    }
    if (tagName === "audio" || tagName === "video") {
      var mediaAttributes = attributes;
      mediaAttributes.rr_mediaState = n22.paused ? "paused" : "played";
      mediaAttributes.rr_mediaCurrentTime = n22.currentTime;
      mediaAttributes.rr_mediaPlaybackRate = n22.playbackRate;
      mediaAttributes.rr_mediaMuted = n22.muted;
      mediaAttributes.rr_mediaLoop = n22.loop;
      mediaAttributes.rr_mediaVolume = n22.volume;
    }
    if (!newlyAddedElement) {
      if (n22.scrollLeft) {
        attributes.rr_scrollLeft = n22.scrollLeft;
      }
      if (n22.scrollTop) {
        attributes.rr_scrollTop = n22.scrollTop;
      }
    }
    if (needBlock) {
      var _n2_getBoundingClientRect = n22.getBoundingClientRect(), width = _n2_getBoundingClientRect.width, height = _n2_getBoundingClientRect.height;
      attributes = {
        class: attributes.class,
        rr_width: "" + width + "px",
        rr_height: "" + height + "px"
      };
    }
    if (tagName === "iframe" && !keepIframeSrcFn(attributes.src)) {
      if (!n22.contentDocument) {
        attributes.rr_src = attributes.src;
      }
      delete attributes.src;
    }
    var isCustomElement;
    try {
      if (customElements.get(tagName)) isCustomElement = true;
    } catch (e22) {
    }
    return {
      type: NodeType$3.Element,
      tagName,
      attributes,
      childNodes: [],
      isSVG: isSVGElement(n22) || void 0,
      needBlock,
      rootId,
      isCustom: isCustomElement
    };
  }
  function lowerIfExists(maybeAttr) {
    if (maybeAttr === void 0 || maybeAttr === null) {
      return "";
    } else {
      return maybeAttr.toLowerCase();
    }
  }
  function slimDOMExcluded(sn2, slimDOMOptions) {
    if (slimDOMOptions.comment && sn2.type === NodeType$3.Comment) {
      return true;
    } else if (sn2.type === NodeType$3.Element) {
      if (slimDOMOptions.script && // script tag
      (sn2.tagName === "script" || // (module)preload link
      sn2.tagName === "link" && (sn2.attributes.rel === "preload" && sn2.attributes.as === "script" || sn2.attributes.rel === "modulepreload") || // prefetch link
      sn2.tagName === "link" && sn2.attributes.rel === "prefetch" && typeof sn2.attributes.href === "string" && extractFileExtension(sn2.attributes.href) === "js")) {
        return true;
      } else if (slimDOMOptions.headFavicon && (sn2.tagName === "link" && sn2.attributes.rel === "shortcut icon" || sn2.tagName === "meta" && (lowerIfExists(sn2.attributes.name).match(/^msapplication-tile(image|color)$/) || lowerIfExists(sn2.attributes.name) === "application-name" || lowerIfExists(sn2.attributes.rel) === "icon" || lowerIfExists(sn2.attributes.rel) === "apple-touch-icon" || lowerIfExists(sn2.attributes.rel) === "shortcut icon"))) {
        return true;
      } else if (sn2.tagName === "meta") {
        if (slimDOMOptions.headMetaDescKeywords && lowerIfExists(sn2.attributes.name).match(/^description|keywords$/)) {
          return true;
        } else if (slimDOMOptions.headMetaSocial && (lowerIfExists(sn2.attributes.property).match(/^(og|twitter|fb):/) || // og = opengraph (facebook)
        lowerIfExists(sn2.attributes.name).match(/^(og|twitter):/) || lowerIfExists(sn2.attributes.name) === "pinterest")) {
          return true;
        } else if (slimDOMOptions.headMetaRobots && (lowerIfExists(sn2.attributes.name) === "robots" || lowerIfExists(sn2.attributes.name) === "googlebot" || lowerIfExists(sn2.attributes.name) === "bingbot")) {
          return true;
        } else if (slimDOMOptions.headMetaHttpEquiv && sn2.attributes["http-equiv"] !== void 0) {
          return true;
        } else if (slimDOMOptions.headMetaAuthorship && (lowerIfExists(sn2.attributes.name) === "author" || lowerIfExists(sn2.attributes.name) === "generator" || lowerIfExists(sn2.attributes.name) === "framework" || lowerIfExists(sn2.attributes.name) === "publisher" || lowerIfExists(sn2.attributes.name) === "progid" || lowerIfExists(sn2.attributes.property).match(/^article:/) || lowerIfExists(sn2.attributes.property).match(/^product:/))) {
          return true;
        } else if (slimDOMOptions.headMetaVerification && (lowerIfExists(sn2.attributes.name) === "google-site-verification" || lowerIfExists(sn2.attributes.name) === "yandex-verification" || lowerIfExists(sn2.attributes.name) === "csrf-token" || lowerIfExists(sn2.attributes.name) === "p:domain_verify" || lowerIfExists(sn2.attributes.name) === "verify-v1" || lowerIfExists(sn2.attributes.name) === "verification" || lowerIfExists(sn2.attributes.name) === "shopify-checkout-api-token")) {
          return true;
        }
      }
    }
    return false;
  }
  function serializeNodeWithId(n22, options) {
    var doc = options.doc, mirror2 = options.mirror, blockClass = options.blockClass, blockSelector = options.blockSelector, maskTextClass = options.maskTextClass, maskTextSelector = options.maskTextSelector, _options_skipChild = options.skipChild, skipChild = _options_skipChild === void 0 ? false : _options_skipChild, _options_inlineStylesheet = options.inlineStylesheet, inlineStylesheet = _options_inlineStylesheet === void 0 ? true : _options_inlineStylesheet, _options_maskInputOptions = options.maskInputOptions, maskInputOptions = _options_maskInputOptions === void 0 ? {} : _options_maskInputOptions, maskTextFn = options.maskTextFn, maskInputFn = options.maskInputFn, slimDOMOptions = options.slimDOMOptions, _options_dataURLOptions = options.dataURLOptions, dataURLOptions = _options_dataURLOptions === void 0 ? {} : _options_dataURLOptions, _options_inlineImages = options.inlineImages, inlineImages = _options_inlineImages === void 0 ? false : _options_inlineImages, _options_recordCanvas = options.recordCanvas, recordCanvas = _options_recordCanvas === void 0 ? false : _options_recordCanvas, onSerialize = options.onSerialize, onIframeLoad = options.onIframeLoad, _options_iframeLoadTimeout = options.iframeLoadTimeout, iframeLoadTimeout = _options_iframeLoadTimeout === void 0 ? 5e3 : _options_iframeLoadTimeout, onStylesheetLoad = options.onStylesheetLoad, _options_stylesheetLoadTimeout = options.stylesheetLoadTimeout, stylesheetLoadTimeout = _options_stylesheetLoadTimeout === void 0 ? 5e3 : _options_stylesheetLoadTimeout, _options_keepIframeSrcFn = options.keepIframeSrcFn, keepIframeSrcFn = _options_keepIframeSrcFn === void 0 ? function() {
      return false;
    } : _options_keepIframeSrcFn, _options_newlyAddedElement = options.newlyAddedElement, newlyAddedElement = _options_newlyAddedElement === void 0 ? false : _options_newlyAddedElement, _options_cssCaptured = options.cssCaptured, cssCaptured = _options_cssCaptured === void 0 ? false : _options_cssCaptured;
    var needsMask = options.needsMask;
    var _options_preserveWhiteSpace = options.preserveWhiteSpace, preserveWhiteSpace = _options_preserveWhiteSpace === void 0 ? true : _options_preserveWhiteSpace;
    if (!needsMask) {
      var checkAncestors = needsMask === void 0;
      needsMask = needMaskingText(n22, maskTextClass, maskTextSelector, checkAncestors);
    }
    var _serializedNode = serializeNode(n22, {
      doc,
      mirror: mirror2,
      blockClass,
      blockSelector,
      needsMask,
      inlineStylesheet,
      maskInputOptions,
      maskTextFn,
      maskInputFn,
      dataURLOptions,
      inlineImages,
      recordCanvas,
      keepIframeSrcFn,
      newlyAddedElement,
      cssCaptured
    });
    if (!_serializedNode) {
      console.warn(n22, "not serialized");
      return null;
    }
    var id;
    if (mirror2.hasNode(n22)) {
      id = mirror2.getId(n22);
    } else if (slimDOMExcluded(_serializedNode, slimDOMOptions) || !preserveWhiteSpace && _serializedNode.type === NodeType$3.Text && !_serializedNode.textContent.replace(/^\s+|\s+$/gm, "").length) {
      id = IGNORED_NODE;
    } else {
      id = genId();
    }
    var serializedNode = Object.assign(_serializedNode, {
      id
    });
    mirror2.add(n22, serializedNode);
    if (id === IGNORED_NODE) {
      return null;
    }
    if (onSerialize) {
      onSerialize(n22);
    }
    var recordChild = !skipChild;
    if (serializedNode.type === NodeType$3.Element) {
      recordChild = recordChild && !serializedNode.needBlock;
      delete serializedNode.needBlock;
      var shadowRootEl = index$1.shadowRoot(n22);
      if (shadowRootEl && isNativeShadowDom(shadowRootEl)) serializedNode.isShadowHost = true;
    }
    if ((serializedNode.type === NodeType$3.Document || serializedNode.type === NodeType$3.Element) && recordChild) {
      if (slimDOMOptions.headWhitespace && serializedNode.type === NodeType$3.Element && serializedNode.tagName === "head") {
        preserveWhiteSpace = false;
      }
      var bypassOptions = {
        doc,
        mirror: mirror2,
        blockClass,
        blockSelector,
        needsMask,
        maskTextClass,
        maskTextSelector,
        skipChild,
        inlineStylesheet,
        maskInputOptions,
        maskTextFn,
        maskInputFn,
        slimDOMOptions,
        dataURLOptions,
        inlineImages,
        recordCanvas,
        preserveWhiteSpace,
        onSerialize,
        onIframeLoad,
        iframeLoadTimeout,
        onStylesheetLoad,
        stylesheetLoadTimeout,
        keepIframeSrcFn,
        cssCaptured: false
      };
      if (serializedNode.type === NodeType$3.Element && serializedNode.tagName === "textarea" && serializedNode.attributes.value !== void 0) ;
      else {
        if (serializedNode.type === NodeType$3.Element && serializedNode.attributes._cssText !== void 0 && typeof serializedNode.attributes._cssText === "string") {
          bypassOptions.cssCaptured = true;
        }
        for (var _iterator = _create_for_of_iterator_helper_loose(Array.from(index$1.childNodes(n22))), _step; !(_step = _iterator()).done; ) {
          var childN = _step.value;
          var serializedChildNode = serializeNodeWithId(childN, bypassOptions);
          if (serializedChildNode) {
            serializedNode.childNodes.push(serializedChildNode);
          }
        }
      }
      var shadowRootEl1 = null;
      if (isElement(n22) && (shadowRootEl1 = index$1.shadowRoot(n22))) {
        for (var _iterator1 = _create_for_of_iterator_helper_loose(Array.from(index$1.childNodes(shadowRootEl1))), _step1; !(_step1 = _iterator1()).done; ) {
          var childN1 = _step1.value;
          var serializedChildNode1 = serializeNodeWithId(childN1, bypassOptions);
          if (serializedChildNode1) {
            isNativeShadowDom(shadowRootEl1) && (serializedChildNode1.isShadow = true);
            serializedNode.childNodes.push(serializedChildNode1);
          }
        }
      }
    }
    var parent = index$1.parentNode(n22);
    if (parent && isShadowRoot(parent) && isNativeShadowDom(parent)) {
      serializedNode.isShadow = true;
    }
    if (serializedNode.type === NodeType$3.Element && serializedNode.tagName === "iframe") {
      onceIframeLoaded(n22, function() {
        var iframeDoc = n22.contentDocument;
        if (iframeDoc && onIframeLoad) {
          var serializedIframeNode = serializeNodeWithId(iframeDoc, {
            doc: iframeDoc,
            mirror: mirror2,
            blockClass,
            blockSelector,
            needsMask,
            maskTextClass,
            maskTextSelector,
            skipChild: false,
            inlineStylesheet,
            maskInputOptions,
            maskTextFn,
            maskInputFn,
            slimDOMOptions,
            dataURLOptions,
            inlineImages,
            recordCanvas,
            preserveWhiteSpace,
            onSerialize,
            onIframeLoad,
            iframeLoadTimeout,
            onStylesheetLoad,
            stylesheetLoadTimeout,
            keepIframeSrcFn
          });
          if (serializedIframeNode) {
            onIframeLoad(n22, serializedIframeNode);
          }
        }
      }, iframeLoadTimeout);
    }
    if (serializedNode.type === NodeType$3.Element && serializedNode.tagName === "link" && typeof serializedNode.attributes.rel === "string" && (serializedNode.attributes.rel === "stylesheet" || serializedNode.attributes.rel === "preload" && typeof serializedNode.attributes.href === "string" && extractFileExtension(serializedNode.attributes.href) === "css")) {
      onceStylesheetLoaded(n22, function() {
        if (onStylesheetLoad) {
          var serializedLinkNode = serializeNodeWithId(n22, {
            doc,
            mirror: mirror2,
            blockClass,
            blockSelector,
            needsMask,
            maskTextClass,
            maskTextSelector,
            skipChild: false,
            inlineStylesheet,
            maskInputOptions,
            maskTextFn,
            maskInputFn,
            slimDOMOptions,
            dataURLOptions,
            inlineImages,
            recordCanvas,
            preserveWhiteSpace,
            onSerialize,
            onIframeLoad,
            iframeLoadTimeout,
            onStylesheetLoad,
            stylesheetLoadTimeout,
            keepIframeSrcFn
          });
          if (serializedLinkNode) {
            onStylesheetLoad(n22, serializedLinkNode);
          }
        }
      }, stylesheetLoadTimeout);
    }
    return serializedNode;
  }
  function snapshot(n22, options) {
    var _ref = options || {}, tmp = _ref.mirror, mirror2 = tmp === void 0 ? new Mirror() : tmp, _ref_blockClass = _ref.blockClass, blockClass = _ref_blockClass === void 0 ? "rr-block" : _ref_blockClass, _ref_blockSelector = _ref.blockSelector, blockSelector = _ref_blockSelector === void 0 ? null : _ref_blockSelector, _ref_maskTextClass = _ref.maskTextClass, maskTextClass = _ref_maskTextClass === void 0 ? "rr-mask" : _ref_maskTextClass, _ref_maskTextSelector = _ref.maskTextSelector, maskTextSelector = _ref_maskTextSelector === void 0 ? null : _ref_maskTextSelector, _ref_inlineStylesheet = _ref.inlineStylesheet, inlineStylesheet = _ref_inlineStylesheet === void 0 ? true : _ref_inlineStylesheet, _ref_inlineImages = _ref.inlineImages, inlineImages = _ref_inlineImages === void 0 ? false : _ref_inlineImages, _ref_recordCanvas = _ref.recordCanvas, recordCanvas = _ref_recordCanvas === void 0 ? false : _ref_recordCanvas, _ref_maskAllInputs = _ref.maskAllInputs, maskAllInputs = _ref_maskAllInputs === void 0 ? false : _ref_maskAllInputs, maskTextFn = _ref.maskTextFn, maskInputFn = _ref.maskInputFn, _ref_slimDOM = _ref.slimDOM, slimDOM = _ref_slimDOM === void 0 ? false : _ref_slimDOM, dataURLOptions = _ref.dataURLOptions, preserveWhiteSpace = _ref.preserveWhiteSpace, onSerialize = _ref.onSerialize, onIframeLoad = _ref.onIframeLoad, iframeLoadTimeout = _ref.iframeLoadTimeout, onStylesheetLoad = _ref.onStylesheetLoad, stylesheetLoadTimeout = _ref.stylesheetLoadTimeout, _ref_keepIframeSrcFn = _ref.keepIframeSrcFn, keepIframeSrcFn = _ref_keepIframeSrcFn === void 0 ? function() {
      return false;
    } : _ref_keepIframeSrcFn;
    var maskInputOptions = maskAllInputs === true ? {
      color: true,
      date: true,
      "datetime-local": true,
      email: true,
      month: true,
      number: true,
      range: true,
      search: true,
      tel: true,
      text: true,
      time: true,
      url: true,
      week: true,
      textarea: true,
      select: true,
      password: true,
      hidden: true
    } : maskAllInputs === false ? {
      password: true
    } : maskAllInputs;
    var slimDOMOptions = slimDOM === true || slimDOM === "all" ? (
      // if true: set of sensible options that should not throw away any information
      {
        script: true,
        comment: true,
        headFavicon: true,
        headWhitespace: true,
        headMetaDescKeywords: slimDOM === "all",
        // destructive
        headMetaSocial: true,
        headMetaRobots: true,
        headMetaHttpEquiv: true,
        headMetaAuthorship: true,
        headMetaVerification: true
      }
    ) : slimDOM === false ? {} : slimDOM;
    return serializeNodeWithId(n22, {
      doc: n22,
      mirror: mirror2,
      blockClass,
      blockSelector,
      maskTextClass,
      maskTextSelector,
      skipChild: false,
      inlineStylesheet,
      maskInputOptions,
      maskTextFn,
      maskInputFn,
      slimDOMOptions,
      dataURLOptions,
      inlineImages,
      recordCanvas,
      preserveWhiteSpace,
      onSerialize,
      onIframeLoad,
      iframeLoadTimeout,
      onStylesheetLoad,
      stylesheetLoadTimeout,
      keepIframeSrcFn,
      newlyAddedElement: false
    });
  }
  function getDefaultExportFromCjs$1(x22) {
    return x22 && x22.__esModule && Object.prototype.hasOwnProperty.call(x22, "default") ? x22["default"] : x22;
  }
  function getAugmentedNamespace$1(n22) {
    if (n22.__esModule) return n22;
    var f22 = n22.default;
    if (typeof f22 == "function") {
      var a22 = function a222() {
        if (_instanceof(this, a222)) {
          return Reflect.construct(f22, arguments, this.constructor);
        }
        return f22.apply(this, arguments);
      };
      a22.prototype = f22.prototype;
    } else a22 = {};
    Object.defineProperty(a22, "__esModule", {
      value: true
    });
    Object.keys(n22).forEach(function(k4) {
      var d3 = Object.getOwnPropertyDescriptor(n22, k4);
      Object.defineProperty(a22, k4, d3.get ? d3 : {
        enumerable: true,
        get: function get() {
          return n22[k4];
        }
      });
    });
    return a22;
  }
  var picocolors_browser$1 = {
    exports: {}
  };
  var x$1 = String;
  var create$1 = function create$12() {
    return {
      isColorSupported: false,
      reset: x$1,
      bold: x$1,
      dim: x$1,
      italic: x$1,
      underline: x$1,
      inverse: x$1,
      hidden: x$1,
      strikethrough: x$1,
      black: x$1,
      red: x$1,
      green: x$1,
      yellow: x$1,
      blue: x$1,
      magenta: x$1,
      cyan: x$1,
      white: x$1,
      gray: x$1,
      bgBlack: x$1,
      bgRed: x$1,
      bgGreen: x$1,
      bgYellow: x$1,
      bgBlue: x$1,
      bgMagenta: x$1,
      bgCyan: x$1,
      bgWhite: x$1
    };
  };
  picocolors_browser$1.exports = create$1();
  picocolors_browser$1.exports.createColors = create$1;
  var picocolors_browserExports$1 = picocolors_browser$1.exports;
  var __viteBrowserExternal$2 = {};
  var __viteBrowserExternal$1$1 = /* @__PURE__ */ Object.freeze(/* @__PURE__ */ Object.defineProperty({
    __proto__: null,
    default: __viteBrowserExternal$2
  }, Symbol.toStringTag, {
    value: "Module"
  }));
  var require$$2$1 = /* @__PURE__ */ getAugmentedNamespace$1(__viteBrowserExternal$1$1);
  var pico$1 = picocolors_browserExports$1;
  var terminalHighlight$1$1 = require$$2$1;
  var CssSyntaxError$3$1 = /* @__PURE__ */ (function(Error1) {
    _inherits(CssSyntaxError, Error1);
    function CssSyntaxError(message, line, column, source, file, plugin22) {
      var _this;
      _this = Error1.call(this, message) || this;
      _this.name = "CssSyntaxError";
      _this.reason = message;
      if (file) {
        _this.file = file;
      }
      if (source) {
        _this.source = source;
      }
      if (plugin22) {
        _this.plugin = plugin22;
      }
      if (typeof line !== "undefined" && typeof column !== "undefined") {
        if (typeof line === "number") {
          _this.line = line;
          _this.column = column;
        } else {
          _this.line = line.line;
          _this.column = line.column;
          _this.endLine = column.line;
          _this.endColumn = column.column;
        }
      }
      _this.setMessage();
      if (Error.captureStackTrace) {
        Error.captureStackTrace(_this, CssSyntaxError);
      }
      return _this;
    }
    var _proto = CssSyntaxError.prototype;
    _proto.setMessage = function setMessage() {
      this.message = this.plugin ? this.plugin + ": " : "";
      this.message += this.file ? this.file : "<css input>";
      if (typeof this.line !== "undefined") {
        this.message += ":" + this.line + ":" + this.column;
      }
      this.message += ": " + this.reason;
    };
    _proto.showSourceCode = function showSourceCode(color) {
      var _this = this;
      if (!this.source) return "";
      var css = this.source;
      if (color == null) color = pico$1.isColorSupported;
      if (terminalHighlight$1$1) {
        if (color) css = terminalHighlight$1$1(css);
      }
      var lines = css.split(/\r?\n/);
      var start = Math.max(this.line - 3, 0);
      var end = Math.min(this.line + 2, lines.length);
      var maxWidth = String(end).length;
      var mark, aside;
      if (color) {
        var _pico$1_createColors = pico$1.createColors(true), bold = _pico$1_createColors.bold, gray = _pico$1_createColors.gray, red = _pico$1_createColors.red;
        mark = function(text) {
          return bold(red(text));
        };
        aside = function(text) {
          return gray(text);
        };
      } else {
        mark = aside = function(str) {
          return str;
        };
      }
      return lines.slice(start, end).map(function(line, index2) {
        var number = start + 1 + index2;
        var gutter = " " + (" " + number).slice(-maxWidth) + " | ";
        if (number === _this.line) {
          var spacing = aside(gutter.replace(/\d/g, " ")) + line.slice(0, _this.column - 1).replace(/[^\t]/g, " ");
          return mark(">") + aside(gutter) + line + "\n " + spacing + mark("^");
        }
        return " " + aside(gutter) + line;
      }).join("\n");
    };
    _proto.toString = function toString2() {
      var code = this.showSourceCode();
      if (code) {
        code = "\n\n" + code + "\n";
      }
      return this.name + ": " + this.message + code;
    };
    return CssSyntaxError;
  })(_wrap_native_super(Error));
  var cssSyntaxError$1 = CssSyntaxError$3$1;
  CssSyntaxError$3$1.default = CssSyntaxError$3$1;
  var symbols$1 = {};
  symbols$1.isClean = /* @__PURE__ */ Symbol("isClean");
  symbols$1.my = /* @__PURE__ */ Symbol("my");
  var DEFAULT_RAW$1 = {
    after: "\n",
    beforeClose: "\n",
    beforeComment: "\n",
    beforeDecl: "\n",
    beforeOpen: " ",
    beforeRule: "\n",
    colon: ": ",
    commentLeft: " ",
    commentRight: " ",
    emptyBody: "",
    indent: "    ",
    semicolon: false
  };
  function capitalize$1(str) {
    return str[0].toUpperCase() + str.slice(1);
  }
  var Stringifier$2$1 = /* @__PURE__ */ (function() {
    function Stringifier(builder) {
      this.builder = builder;
    }
    var _proto = Stringifier.prototype;
    _proto.atrule = function atrule(node2, semicolon) {
      var name = "@" + node2.name;
      var params = node2.params ? this.rawValue(node2, "params") : "";
      if (typeof node2.raws.afterName !== "undefined") {
        name += node2.raws.afterName;
      } else if (params) {
        name += " ";
      }
      if (node2.nodes) {
        this.block(node2, name + params);
      } else {
        var end = (node2.raws.between || "") + (semicolon ? ";" : "");
        this.builder(name + params + end, node2);
      }
    };
    _proto.beforeAfter = function beforeAfter(node2, detect) {
      var value;
      if (node2.type === "decl") {
        value = this.raw(node2, null, "beforeDecl");
      } else if (node2.type === "comment") {
        value = this.raw(node2, null, "beforeComment");
      } else if (detect === "before") {
        value = this.raw(node2, null, "beforeRule");
      } else {
        value = this.raw(node2, null, "beforeClose");
      }
      var buf = node2.parent;
      var depth = 0;
      while (buf && buf.type !== "root") {
        depth += 1;
        buf = buf.parent;
      }
      if (value.includes("\n")) {
        var indent = this.raw(node2, null, "indent");
        if (indent.length) {
          for (var step = 0; step < depth; step++) value += indent;
        }
      }
      return value;
    };
    _proto.block = function block(node2, start) {
      var between = this.raw(node2, "between", "beforeOpen");
      this.builder(start + between + "{", node2, "start");
      var after;
      if (node2.nodes && node2.nodes.length) {
        this.body(node2);
        after = this.raw(node2, "after");
      } else {
        after = this.raw(node2, "after", "emptyBody");
      }
      if (after) this.builder(after);
      this.builder("}", node2, "end");
    };
    _proto.body = function body(node2) {
      var last = node2.nodes.length - 1;
      while (last > 0) {
        if (node2.nodes[last].type !== "comment") break;
        last -= 1;
      }
      var semicolon = this.raw(node2, "semicolon");
      for (var i22 = 0; i22 < node2.nodes.length; i22++) {
        var child = node2.nodes[i22];
        var before = this.raw(child, "before");
        if (before) this.builder(before);
        this.stringify(child, last !== i22 || semicolon);
      }
    };
    _proto.comment = function comment2(node2) {
      var left = this.raw(node2, "left", "commentLeft");
      var right = this.raw(node2, "right", "commentRight");
      this.builder("/*" + left + node2.text + right + "*/", node2);
    };
    _proto.decl = function decl(node2, semicolon) {
      var between = this.raw(node2, "between", "colon");
      var string = node2.prop + between + this.rawValue(node2, "value");
      if (node2.important) {
        string += node2.raws.important || " !important";
      }
      if (semicolon) string += ";";
      this.builder(string, node2);
    };
    _proto.document = function document1(node2) {
      this.body(node2);
    };
    _proto.raw = function raw(node2, own, detect) {
      var value;
      if (!detect) detect = own;
      if (own) {
        value = node2.raws[own];
        if (typeof value !== "undefined") return value;
      }
      var parent = node2.parent;
      if (detect === "before") {
        if (!parent || parent.type === "root" && parent.first === node2) {
          return "";
        }
        if (parent && parent.type === "document") {
          return "";
        }
      }
      if (!parent) return DEFAULT_RAW$1[detect];
      var root2 = node2.root();
      if (!root2.rawCache) root2.rawCache = {};
      if (typeof root2.rawCache[detect] !== "undefined") {
        return root2.rawCache[detect];
      }
      if (detect === "before" || detect === "after") {
        return this.beforeAfter(node2, detect);
      } else {
        var method = "raw" + capitalize$1(detect);
        if (this[method]) {
          value = this[method](root2, node2);
        } else {
          root2.walk(function(i22) {
            value = i22.raws[own];
            if (typeof value !== "undefined") return false;
          });
        }
      }
      if (typeof value === "undefined") value = DEFAULT_RAW$1[detect];
      root2.rawCache[detect] = value;
      return value;
    };
    _proto.rawBeforeClose = function rawBeforeClose(root2) {
      var value;
      root2.walk(function(i22) {
        if (i22.nodes && i22.nodes.length > 0) {
          if (typeof i22.raws.after !== "undefined") {
            value = i22.raws.after;
            if (value.includes("\n")) {
              value = value.replace(/[^\n]+$/, "");
            }
            return false;
          }
        }
      });
      if (value) value = value.replace(/\S/g, "");
      return value;
    };
    _proto.rawBeforeComment = function rawBeforeComment(root2, node2) {
      var value;
      root2.walkComments(function(i22) {
        if (typeof i22.raws.before !== "undefined") {
          value = i22.raws.before;
          if (value.includes("\n")) {
            value = value.replace(/[^\n]+$/, "");
          }
          return false;
        }
      });
      if (typeof value === "undefined") {
        value = this.raw(node2, null, "beforeDecl");
      } else if (value) {
        value = value.replace(/\S/g, "");
      }
      return value;
    };
    _proto.rawBeforeDecl = function rawBeforeDecl(root2, node2) {
      var value;
      root2.walkDecls(function(i22) {
        if (typeof i22.raws.before !== "undefined") {
          value = i22.raws.before;
          if (value.includes("\n")) {
            value = value.replace(/[^\n]+$/, "");
          }
          return false;
        }
      });
      if (typeof value === "undefined") {
        value = this.raw(node2, null, "beforeRule");
      } else if (value) {
        value = value.replace(/\S/g, "");
      }
      return value;
    };
    _proto.rawBeforeOpen = function rawBeforeOpen(root2) {
      var value;
      root2.walk(function(i22) {
        if (i22.type !== "decl") {
          value = i22.raws.between;
          if (typeof value !== "undefined") return false;
        }
      });
      return value;
    };
    _proto.rawBeforeRule = function rawBeforeRule(root2) {
      var value;
      root2.walk(function(i22) {
        if (i22.nodes && (i22.parent !== root2 || root2.first !== i22)) {
          if (typeof i22.raws.before !== "undefined") {
            value = i22.raws.before;
            if (value.includes("\n")) {
              value = value.replace(/[^\n]+$/, "");
            }
            return false;
          }
        }
      });
      if (value) value = value.replace(/\S/g, "");
      return value;
    };
    _proto.rawColon = function rawColon(root2) {
      var value;
      root2.walkDecls(function(i22) {
        if (typeof i22.raws.between !== "undefined") {
          value = i22.raws.between.replace(/[^\s:]/g, "");
          return false;
        }
      });
      return value;
    };
    _proto.rawEmptyBody = function rawEmptyBody(root2) {
      var value;
      root2.walk(function(i22) {
        if (i22.nodes && i22.nodes.length === 0) {
          value = i22.raws.after;
          if (typeof value !== "undefined") return false;
        }
      });
      return value;
    };
    _proto.rawIndent = function rawIndent(root2) {
      if (root2.raws.indent) return root2.raws.indent;
      var value;
      root2.walk(function(i22) {
        var p3 = i22.parent;
        if (p3 && p3 !== root2 && p3.parent && p3.parent === root2) {
          if (typeof i22.raws.before !== "undefined") {
            var parts = i22.raws.before.split("\n");
            value = parts[parts.length - 1];
            value = value.replace(/\S/g, "");
            return false;
          }
        }
      });
      return value;
    };
    _proto.rawSemicolon = function rawSemicolon(root2) {
      var value;
      root2.walk(function(i22) {
        if (i22.nodes && i22.nodes.length && i22.last.type === "decl") {
          value = i22.raws.semicolon;
          if (typeof value !== "undefined") return false;
        }
      });
      return value;
    };
    _proto.rawValue = function rawValue(node2, prop) {
      var value = node2[prop];
      var raw = node2.raws[prop];
      if (raw && raw.value === value) {
        return raw.raw;
      }
      return value;
    };
    _proto.root = function root2(node2) {
      this.body(node2);
      if (node2.raws.after) this.builder(node2.raws.after);
    };
    _proto.rule = function rule2(node2) {
      this.block(node2, this.rawValue(node2, "selector"));
      if (node2.raws.ownSemicolon) {
        this.builder(node2.raws.ownSemicolon, node2, "end");
      }
    };
    _proto.stringify = function stringify2(node2, semicolon) {
      if (!this[node2.type]) {
        throw new Error("Unknown AST node type " + node2.type + ". Maybe you need to change PostCSS stringifier.");
      }
      this[node2.type](node2, semicolon);
    };
    return Stringifier;
  })();
  var stringifier$1 = Stringifier$2$1;
  Stringifier$2$1.default = Stringifier$2$1;
  var Stringifier$1$1 = stringifier$1;
  function stringify$4$1(node2, builder) {
    var str = new Stringifier$1$1(builder);
    str.stringify(node2);
  }
  var stringify_1$1 = stringify$4$1;
  stringify$4$1.default = stringify$4$1;
  var isClean$2$1 = symbols$1.isClean;
  var my$2$1 = symbols$1.my;
  var CssSyntaxError$2$1 = cssSyntaxError$1;
  var Stringifier2$1 = stringifier$1;
  var stringify$3$1 = stringify_1$1;
  function cloneNode$1(obj, parent) {
    var cloned = new obj.constructor();
    for (var i22 in obj) {
      if (!Object.prototype.hasOwnProperty.call(obj, i22)) {
        continue;
      }
      if (i22 === "proxyCache") continue;
      var value = obj[i22];
      var type = typeof value === "undefined" ? "undefined" : _type_of(value);
      if (i22 === "parent" && type === "object") {
        if (parent) cloned[i22] = parent;
      } else if (i22 === "source") {
        cloned[i22] = value;
      } else if (Array.isArray(value)) {
        cloned[i22] = value.map(function(j4) {
          return cloneNode$1(j4, cloned);
        });
      } else {
        if (type === "object" && value !== null) value = cloneNode$1(value);
        cloned[i22] = value;
      }
    }
    return cloned;
  }
  var Node$4$1 = /* @__PURE__ */ (function() {
    function Node23(defaults) {
      if (defaults === void 0) defaults = {};
      this.raws = {};
      this[isClean$2$1] = false;
      this[my$2$1] = true;
      for (var name in defaults) {
        if (name === "nodes") {
          this.nodes = [];
          for (var _iterator = _create_for_of_iterator_helper_loose(defaults[name]), _step; !(_step = _iterator()).done; ) {
            var node2 = _step.value;
            if (typeof node2.clone === "function") {
              this.append(node2.clone());
            } else {
              this.append(node2);
            }
          }
        } else {
          this[name] = defaults[name];
        }
      }
    }
    var _proto = Node23.prototype;
    _proto.addToError = function addToError(error) {
      error.postcssNode = this;
      if (error.stack && this.source && /\n\s{4}at /.test(error.stack)) {
        var s22 = this.source;
        error.stack = error.stack.replace(/\n\s{4}at /, "$&" + s22.input.from + ":" + s22.start.line + ":" + s22.start.column + "$&");
      }
      return error;
    };
    _proto.after = function after(add) {
      this.parent.insertAfter(this, add);
      return this;
    };
    _proto.assign = function assign(overrides) {
      if (overrides === void 0) overrides = {};
      for (var name in overrides) {
        this[name] = overrides[name];
      }
      return this;
    };
    _proto.before = function before(add) {
      this.parent.insertBefore(this, add);
      return this;
    };
    _proto.cleanRaws = function cleanRaws(keepBetween) {
      delete this.raws.before;
      delete this.raws.after;
      if (!keepBetween) delete this.raws.between;
    };
    _proto.clone = function clone(overrides) {
      if (overrides === void 0) overrides = {};
      var cloned = cloneNode$1(this);
      for (var name in overrides) {
        cloned[name] = overrides[name];
      }
      return cloned;
    };
    _proto.cloneAfter = function cloneAfter(overrides) {
      if (overrides === void 0) overrides = {};
      var cloned = this.clone(overrides);
      this.parent.insertAfter(this, cloned);
      return cloned;
    };
    _proto.cloneBefore = function cloneBefore(overrides) {
      if (overrides === void 0) overrides = {};
      var cloned = this.clone(overrides);
      this.parent.insertBefore(this, cloned);
      return cloned;
    };
    _proto.error = function error(message, opts) {
      if (opts === void 0) opts = {};
      if (this.source) {
        var _this_rangeBy = this.rangeBy(opts), end = _this_rangeBy.end, start = _this_rangeBy.start;
        return this.source.input.error(message, {
          column: start.column,
          line: start.line
        }, {
          column: end.column,
          line: end.line
        }, opts);
      }
      return new CssSyntaxError$2$1(message);
    };
    _proto.getProxyProcessor = function getProxyProcessor() {
      return {
        get: function get(node2, prop) {
          if (prop === "proxyOf") {
            return node2;
          } else if (prop === "root") {
            return function() {
              return node2.root().toProxy();
            };
          } else {
            return node2[prop];
          }
        },
        set: function set(node2, prop, value) {
          if (node2[prop] === value) return true;
          node2[prop] = value;
          if (prop === "prop" || prop === "value" || prop === "name" || prop === "params" || prop === "important" || /* c8 ignore next */
          prop === "text") {
            node2.markDirty();
          }
          return true;
        }
      };
    };
    _proto.markDirty = function markDirty() {
      if (this[isClean$2$1]) {
        this[isClean$2$1] = false;
        var next = this;
        while (next = next.parent) {
          next[isClean$2$1] = false;
        }
      }
    };
    _proto.next = function next() {
      if (!this.parent) return void 0;
      var index2 = this.parent.index(this);
      return this.parent.nodes[index2 + 1];
    };
    _proto.positionBy = function positionBy(opts, stringRepresentation) {
      var pos = this.source.start;
      if (opts.index) {
        pos = this.positionInside(opts.index, stringRepresentation);
      } else if (opts.word) {
        stringRepresentation = this.toString();
        var index2 = stringRepresentation.indexOf(opts.word);
        if (index2 !== -1) pos = this.positionInside(index2, stringRepresentation);
      }
      return pos;
    };
    _proto.positionInside = function positionInside(index2, stringRepresentation) {
      var string = stringRepresentation || this.toString();
      var column = this.source.start.column;
      var line = this.source.start.line;
      for (var i22 = 0; i22 < index2; i22++) {
        if (string[i22] === "\n") {
          column = 1;
          line += 1;
        } else {
          column += 1;
        }
      }
      return {
        column,
        line
      };
    };
    _proto.prev = function prev() {
      if (!this.parent) return void 0;
      var index2 = this.parent.index(this);
      return this.parent.nodes[index2 - 1];
    };
    _proto.rangeBy = function rangeBy(opts) {
      var start = {
        column: this.source.start.column,
        line: this.source.start.line
      };
      var end = this.source.end ? {
        column: this.source.end.column + 1,
        line: this.source.end.line
      } : {
        column: start.column + 1,
        line: start.line
      };
      if (opts.word) {
        var stringRepresentation = this.toString();
        var index2 = stringRepresentation.indexOf(opts.word);
        if (index2 !== -1) {
          start = this.positionInside(index2, stringRepresentation);
          end = this.positionInside(index2 + opts.word.length, stringRepresentation);
        }
      } else {
        if (opts.start) {
          start = {
            column: opts.start.column,
            line: opts.start.line
          };
        } else if (opts.index) {
          start = this.positionInside(opts.index);
        }
        if (opts.end) {
          end = {
            column: opts.end.column,
            line: opts.end.line
          };
        } else if (typeof opts.endIndex === "number") {
          end = this.positionInside(opts.endIndex);
        } else if (opts.index) {
          end = this.positionInside(opts.index + 1);
        }
      }
      if (end.line < start.line || end.line === start.line && end.column <= start.column) {
        end = {
          column: start.column + 1,
          line: start.line
        };
      }
      return {
        end,
        start
      };
    };
    _proto.raw = function raw(prop, defaultType) {
      var str = new Stringifier2$1();
      return str.raw(this, prop, defaultType);
    };
    _proto.remove = function remove() {
      if (this.parent) {
        this.parent.removeChild(this);
      }
      this.parent = void 0;
      return this;
    };
    _proto.replaceWith = function replaceWith() {
      for (var _len = arguments.length, nodes = new Array(_len), _key = 0; _key < _len; _key++) {
        nodes[_key] = arguments[_key];
      }
      if (this.parent) {
        var bookmark = this;
        var foundSelf = false;
        for (var _iterator = _create_for_of_iterator_helper_loose(nodes), _step; !(_step = _iterator()).done; ) {
          var node2 = _step.value;
          if (node2 === this) {
            foundSelf = true;
          } else if (foundSelf) {
            this.parent.insertAfter(bookmark, node2);
            bookmark = node2;
          } else {
            this.parent.insertBefore(bookmark, node2);
          }
        }
        if (!foundSelf) {
          this.remove();
        }
      }
      return this;
    };
    _proto.root = function root2() {
      var result2 = this;
      while (result2.parent && result2.parent.type !== "document") {
        result2 = result2.parent;
      }
      return result2;
    };
    _proto.toJSON = function toJSON(_4, inputs) {
      var fixed = {};
      var emitInputs = inputs == null;
      inputs = inputs || /* @__PURE__ */ new Map();
      var inputsNextIndex = 0;
      for (var name in this) {
        if (!Object.prototype.hasOwnProperty.call(this, name)) {
          continue;
        }
        if (name === "parent" || name === "proxyCache") continue;
        var value = this[name];
        if (Array.isArray(value)) {
          fixed[name] = value.map(function(i22) {
            if ((typeof i22 === "undefined" ? "undefined" : _type_of(i22)) === "object" && i22.toJSON) {
              return i22.toJSON(null, inputs);
            } else {
              return i22;
            }
          });
        } else if ((typeof value === "undefined" ? "undefined" : _type_of(value)) === "object" && value.toJSON) {
          fixed[name] = value.toJSON(null, inputs);
        } else if (name === "source") {
          var inputId = inputs.get(value.input);
          if (inputId == null) {
            inputId = inputsNextIndex;
            inputs.set(value.input, inputsNextIndex);
            inputsNextIndex++;
          }
          fixed[name] = {
            end: value.end,
            inputId,
            start: value.start
          };
        } else {
          fixed[name] = value;
        }
      }
      if (emitInputs) {
        fixed.inputs = [].concat(inputs.keys()).map(function(input2) {
          return input2.toJSON();
        });
      }
      return fixed;
    };
    _proto.toProxy = function toProxy() {
      if (!this.proxyCache) {
        this.proxyCache = new Proxy(this, this.getProxyProcessor());
      }
      return this.proxyCache;
    };
    _proto.toString = function toString2(stringifier2) {
      if (stringifier2 === void 0) stringifier2 = stringify$3$1;
      if (stringifier2.stringify) stringifier2 = stringifier2.stringify;
      var result2 = "";
      stringifier2(this, function(i22) {
        result2 += i22;
      });
      return result2;
    };
    _proto.warn = function warn(result2, text, opts) {
      var data = {
        node: this
      };
      for (var i22 in opts) data[i22] = opts[i22];
      return result2.warn(text, data);
    };
    _create_class(Node23, [
      {
        key: "proxyOf",
        get: function get() {
          return this;
        }
      }
    ]);
    return Node23;
  })();
  var node$1 = Node$4$1;
  Node$4$1.default = Node$4$1;
  var Node$3$1 = node$1;
  var Declaration$4$1 = /* @__PURE__ */ (function(Node$3$12) {
    _inherits(Declaration, Node$3$12);
    function Declaration(defaults) {
      var _this;
      if (defaults && typeof defaults.value !== "undefined" && typeof defaults.value !== "string") {
        defaults = _extends({}, defaults, {
          value: String(defaults.value)
        });
      }
      _this = Node$3$12.call(this, defaults) || this;
      _this.type = "decl";
      return _this;
    }
    _create_class(Declaration, [
      {
        key: "variable",
        get: function get() {
          return this.prop.startsWith("--") || this.prop[0] === "$";
        }
      }
    ]);
    return Declaration;
  })(Node$3$1);
  var declaration$1 = Declaration$4$1;
  Declaration$4$1.default = Declaration$4$1;
  var urlAlphabet$1 = "useandom-26T198340PX75pxJACKVERYMINDBUSHWOLF_GQZbfghjklqvwyzrict";
  var nanoid$1$1 = function(size) {
    if (size === void 0) size = 21;
    var id = "";
    var i22 = size;
    while (i22--) {
      id += urlAlphabet$1[Math.random() * 64 | 0];
    }
    return id;
  };
  var nonSecure$1 = {
    nanoid: nanoid$1$1
  };
  var SourceMapConsumer$2$1 = require$$2$1.SourceMapConsumer;
  var SourceMapGenerator$2$1 = require$$2$1.SourceMapGenerator;
  var existsSync$1 = require$$2$1.existsSync;
  var readFileSync$1 = require$$2$1.readFileSync;
  var dirname$1$1 = require$$2$1.dirname;
  var join$1 = require$$2$1.join;
  function fromBase64$1(str) {
    if (Buffer) {
      return Buffer.from(str, "base64").toString();
    } else {
      return window.atob(str);
    }
  }
  var PreviousMap$2$1 = /* @__PURE__ */ (function() {
    function PreviousMap(css, opts) {
      if (opts.map === false) return;
      this.loadAnnotation(css);
      this.inline = this.startWith(this.annotation, "data:");
      var prev = opts.map ? opts.map.prev : void 0;
      var text = this.loadMap(opts.from, prev);
      if (!this.mapFile && opts.from) {
        this.mapFile = opts.from;
      }
      if (this.mapFile) this.root = dirname$1$1(this.mapFile);
      if (text) this.text = text;
    }
    var _proto = PreviousMap.prototype;
    _proto.consumer = function consumer() {
      if (!this.consumerCache) {
        this.consumerCache = new SourceMapConsumer$2$1(this.text);
      }
      return this.consumerCache;
    };
    _proto.decodeInline = function decodeInline(text) {
      var baseCharsetUri = /^data:application\/json;charset=utf-?8;base64,/;
      var baseUri = /^data:application\/json;base64,/;
      var charsetUri = /^data:application\/json;charset=utf-?8,/;
      var uri = /^data:application\/json,/;
      if (charsetUri.test(text) || uri.test(text)) {
        return decodeURIComponent(text.substr(RegExp.lastMatch.length));
      }
      if (baseCharsetUri.test(text) || baseUri.test(text)) {
        return fromBase64$1(text.substr(RegExp.lastMatch.length));
      }
      var encoding = text.match(/data:application\/json;([^,]+),/)[1];
      throw new Error("Unsupported source map encoding " + encoding);
    };
    _proto.getAnnotationURL = function getAnnotationURL(sourceMapString) {
      return sourceMapString.replace(/^\/\*\s*# sourceMappingURL=/, "").trim();
    };
    _proto.isMap = function isMap(map) {
      if ((typeof map === "undefined" ? "undefined" : _type_of(map)) !== "object") return false;
      return typeof map.mappings === "string" || typeof map._mappings === "string" || Array.isArray(map.sections);
    };
    _proto.loadAnnotation = function loadAnnotation(css) {
      var comments = css.match(/\/\*\s*# sourceMappingURL=/gm);
      if (!comments) return;
      var start = css.lastIndexOf(comments.pop());
      var end = css.indexOf("*/", start);
      if (start > -1 && end > -1) {
        this.annotation = this.getAnnotationURL(css.substring(start, end));
      }
    };
    _proto.loadFile = function loadFile(path) {
      this.root = dirname$1$1(path);
      if (existsSync$1(path)) {
        this.mapFile = path;
        return readFileSync$1(path, "utf-8").toString().trim();
      }
    };
    _proto.loadMap = function loadMap(file, prev) {
      if (prev === false) return false;
      if (prev) {
        if (typeof prev === "string") {
          return prev;
        } else if (typeof prev === "function") {
          var prevPath = prev(file);
          if (prevPath) {
            var map = this.loadFile(prevPath);
            if (!map) {
              throw new Error("Unable to load previous source map: " + prevPath.toString());
            }
            return map;
          }
        } else if (_instanceof(prev, SourceMapConsumer$2$1)) {
          return SourceMapGenerator$2$1.fromSourceMap(prev).toString();
        } else if (_instanceof(prev, SourceMapGenerator$2$1)) {
          return prev.toString();
        } else if (this.isMap(prev)) {
          return JSON.stringify(prev);
        } else {
          throw new Error("Unsupported previous source map format: " + prev.toString());
        }
      } else if (this.inline) {
        return this.decodeInline(this.annotation);
      } else if (this.annotation) {
        var map1 = this.annotation;
        if (file) map1 = join$1(dirname$1$1(file), map1);
        return this.loadFile(map1);
      }
    };
    _proto.startWith = function startWith(string, start) {
      if (!string) return false;
      return string.substr(0, start.length) === start;
    };
    _proto.withContent = function withContent() {
      return !!(this.consumer().sourcesContent && this.consumer().sourcesContent.length > 0);
    };
    return PreviousMap;
  })();
  var previousMap$1 = PreviousMap$2$1;
  PreviousMap$2$1.default = PreviousMap$2$1;
  var SourceMapConsumer$1$1 = require$$2$1.SourceMapConsumer;
  var SourceMapGenerator$1$1 = require$$2$1.SourceMapGenerator;
  var fileURLToPath$1 = require$$2$1.fileURLToPath;
  var pathToFileURL$1$1 = require$$2$1.pathToFileURL;
  var isAbsolute$1 = require$$2$1.isAbsolute;
  var resolve$1$1 = require$$2$1.resolve;
  var nanoid$2 = nonSecure$1.nanoid;
  var terminalHighlight$2 = require$$2$1;
  var CssSyntaxError$1$1 = cssSyntaxError$1;
  var PreviousMap$1$1 = previousMap$1;
  var fromOffsetCache$1 = /* @__PURE__ */ Symbol("fromOffsetCache");
  var sourceMapAvailable$1$1 = Boolean(SourceMapConsumer$1$1 && SourceMapGenerator$1$1);
  var pathAvailable$1$1 = Boolean(resolve$1$1 && isAbsolute$1);
  var Input$4$1 = /* @__PURE__ */ (function() {
    function Input(css, opts) {
      if (opts === void 0) opts = {};
      if (css === null || typeof css === "undefined" || (typeof css === "undefined" ? "undefined" : _type_of(css)) === "object" && !css.toString) {
        throw new Error("PostCSS received " + css + " instead of CSS string");
      }
      this.css = css.toString();
      if (this.css[0] === "\uFEFF" || this.css[0] === "\uFFFE") {
        this.hasBOM = true;
        this.css = this.css.slice(1);
      } else {
        this.hasBOM = false;
      }
      if (opts.from) {
        if (!pathAvailable$1$1 || /^\w+:\/\//.test(opts.from) || isAbsolute$1(opts.from)) {
          this.file = opts.from;
        } else {
          this.file = resolve$1$1(opts.from);
        }
      }
      if (pathAvailable$1$1 && sourceMapAvailable$1$1) {
        var map = new PreviousMap$1$1(this.css, opts);
        if (map.text) {
          this.map = map;
          var file = map.consumer().file;
          if (!this.file && file) this.file = this.mapResolve(file);
        }
      }
      if (!this.file) {
        this.id = "<input css " + nanoid$2(6) + ">";
      }
      if (this.map) this.map.file = this.from;
    }
    var _proto = Input.prototype;
    _proto.error = function error(message, line, column, opts) {
      if (opts === void 0) opts = {};
      var result2, endLine, endColumn;
      if (line && (typeof line === "undefined" ? "undefined" : _type_of(line)) === "object") {
        var start = line;
        var end = column;
        if (typeof start.offset === "number") {
          var pos = this.fromOffset(start.offset);
          line = pos.line;
          column = pos.col;
        } else {
          line = start.line;
          column = start.column;
        }
        if (typeof end.offset === "number") {
          var pos1 = this.fromOffset(end.offset);
          endLine = pos1.line;
          endColumn = pos1.col;
        } else {
          endLine = end.line;
          endColumn = end.column;
        }
      } else if (!column) {
        var pos2 = this.fromOffset(line);
        line = pos2.line;
        column = pos2.col;
      }
      var origin = this.origin(line, column, endLine, endColumn);
      if (origin) {
        result2 = new CssSyntaxError$1$1(message, origin.endLine === void 0 ? origin.line : {
          column: origin.column,
          line: origin.line
        }, origin.endLine === void 0 ? origin.column : {
          column: origin.endColumn,
          line: origin.endLine
        }, origin.source, origin.file, opts.plugin);
      } else {
        result2 = new CssSyntaxError$1$1(message, endLine === void 0 ? line : {
          column,
          line
        }, endLine === void 0 ? column : {
          column: endColumn,
          line: endLine
        }, this.css, this.file, opts.plugin);
      }
      result2.input = {
        column,
        endColumn,
        endLine,
        line,
        source: this.css
      };
      if (this.file) {
        if (pathToFileURL$1$1) {
          result2.input.url = pathToFileURL$1$1(this.file).toString();
        }
        result2.input.file = this.file;
      }
      return result2;
    };
    _proto.fromOffset = function fromOffset(offset) {
      var lastLine, lineToIndex;
      if (!this[fromOffsetCache$1]) {
        var lines = this.css.split("\n");
        lineToIndex = new Array(lines.length);
        var prevIndex = 0;
        for (var i22 = 0, l22 = lines.length; i22 < l22; i22++) {
          lineToIndex[i22] = prevIndex;
          prevIndex += lines[i22].length + 1;
        }
        this[fromOffsetCache$1] = lineToIndex;
      } else {
        lineToIndex = this[fromOffsetCache$1];
      }
      lastLine = lineToIndex[lineToIndex.length - 1];
      var min = 0;
      if (offset >= lastLine) {
        min = lineToIndex.length - 1;
      } else {
        var max = lineToIndex.length - 2;
        var mid;
        while (min < max) {
          mid = min + (max - min >> 1);
          if (offset < lineToIndex[mid]) {
            max = mid - 1;
          } else if (offset >= lineToIndex[mid + 1]) {
            min = mid + 1;
          } else {
            min = mid;
            break;
          }
        }
      }
      return {
        col: offset - lineToIndex[min] + 1,
        line: min + 1
      };
    };
    _proto.mapResolve = function mapResolve(file) {
      if (/^\w+:\/\//.test(file)) {
        return file;
      }
      return resolve$1$1(this.map.consumer().sourceRoot || this.map.root || ".", file);
    };
    _proto.origin = function origin(line, column, endLine, endColumn) {
      if (!this.map) return false;
      var consumer = this.map.consumer();
      var from = consumer.originalPositionFor({
        column,
        line
      });
      if (!from.source) return false;
      var to;
      if (typeof endLine === "number") {
        to = consumer.originalPositionFor({
          column: endColumn,
          line: endLine
        });
      }
      var fromUrl;
      if (isAbsolute$1(from.source)) {
        fromUrl = pathToFileURL$1$1(from.source);
      } else {
        fromUrl = new URL(from.source, this.map.consumer().sourceRoot || pathToFileURL$1$1(this.map.mapFile));
      }
      var result2 = {
        column: from.column,
        endColumn: to && to.column,
        endLine: to && to.line,
        line: from.line,
        url: fromUrl.toString()
      };
      if (fromUrl.protocol === "file:") {
        if (fileURLToPath$1) {
          result2.file = fileURLToPath$1(fromUrl);
        } else {
          throw new Error("file: protocol is not available in this PostCSS build");
        }
      }
      var source = consumer.sourceContentFor(from.source);
      if (source) result2.source = source;
      return result2;
    };
    _proto.toJSON = function toJSON() {
      var json = {};
      for (var _i = 0, _iter = [
        "hasBOM",
        "css",
        "file",
        "id"
      ]; _i < _iter.length; _i++) {
        var name = _iter[_i];
        if (this[name] != null) {
          json[name] = this[name];
        }
      }
      if (this.map) {
        json.map = _extends({}, this.map);
        if (json.map.consumerCache) {
          json.map.consumerCache = void 0;
        }
      }
      return json;
    };
    _create_class(Input, [
      {
        key: "from",
        get: function get() {
          return this.file || this.id;
        }
      }
    ]);
    return Input;
  })();
  var input$1 = Input$4$1;
  Input$4$1.default = Input$4$1;
  if (terminalHighlight$2 && terminalHighlight$2.registerInput) {
    terminalHighlight$2.registerInput(Input$4$1);
  }
  var SourceMapConsumer$3 = require$$2$1.SourceMapConsumer;
  var SourceMapGenerator$3 = require$$2$1.SourceMapGenerator;
  var dirname$2 = require$$2$1.dirname;
  var relative$1 = require$$2$1.relative;
  var resolve$2 = require$$2$1.resolve;
  var sep$1 = require$$2$1.sep;
  var pathToFileURL$2 = require$$2$1.pathToFileURL;
  var Input$3$1 = input$1;
  var sourceMapAvailable$2 = Boolean(SourceMapConsumer$3 && SourceMapGenerator$3);
  var pathAvailable$2 = Boolean(dirname$2 && resolve$2 && relative$1 && sep$1);
  var MapGenerator$2$1 = /* @__PURE__ */ (function() {
    function MapGenerator(stringify2, root2, opts, cssString) {
      this.stringify = stringify2;
      this.mapOpts = opts.map || {};
      this.root = root2;
      this.opts = opts;
      this.css = cssString;
      this.originalCSS = cssString;
      this.usesFileUrls = !this.mapOpts.from && this.mapOpts.absolute;
      this.memoizedFileURLs = /* @__PURE__ */ new Map();
      this.memoizedPaths = /* @__PURE__ */ new Map();
      this.memoizedURLs = /* @__PURE__ */ new Map();
    }
    var _proto = MapGenerator.prototype;
    _proto.addAnnotation = function addAnnotation() {
      var content;
      if (this.isInline()) {
        content = "data:application/json;base64," + this.toBase64(this.map.toString());
      } else if (typeof this.mapOpts.annotation === "string") {
        content = this.mapOpts.annotation;
      } else if (typeof this.mapOpts.annotation === "function") {
        content = this.mapOpts.annotation(this.opts.to, this.root);
      } else {
        content = this.outputFile() + ".map";
      }
      var eol = "\n";
      if (this.css.includes("\r\n")) eol = "\r\n";
      this.css += eol + "/*# sourceMappingURL=" + content + " */";
    };
    _proto.applyPrevMaps = function applyPrevMaps() {
      for (var _iterator = _create_for_of_iterator_helper_loose(this.previous()), _step; !(_step = _iterator()).done; ) {
        var prev = _step.value;
        var from = this.toUrl(this.path(prev.file));
        var root2 = prev.root || dirname$2(prev.file);
        var map = void 0;
        if (this.mapOpts.sourcesContent === false) {
          map = new SourceMapConsumer$3(prev.text);
          if (map.sourcesContent) {
            map.sourcesContent = null;
          }
        } else {
          map = prev.consumer();
        }
        this.map.applySourceMap(map, from, this.toUrl(this.path(root2)));
      }
    };
    _proto.clearAnnotation = function clearAnnotation() {
      if (this.mapOpts.annotation === false) return;
      if (this.root) {
        var node2;
        for (var i22 = this.root.nodes.length - 1; i22 >= 0; i22--) {
          node2 = this.root.nodes[i22];
          if (node2.type !== "comment") continue;
          if (node2.text.indexOf("# sourceMappingURL=") === 0) {
            this.root.removeChild(i22);
          }
        }
      } else if (this.css) {
        this.css = this.css.replace(/\n*?\/\*#[\S\s]*?\*\/$/gm, "");
      }
    };
    _proto.generate = function generate() {
      this.clearAnnotation();
      if (pathAvailable$2 && sourceMapAvailable$2 && this.isMap()) {
        return this.generateMap();
      } else {
        var result2 = "";
        this.stringify(this.root, function(i22) {
          result2 += i22;
        });
        return [
          result2
        ];
      }
    };
    _proto.generateMap = function generateMap() {
      if (this.root) {
        this.generateString();
      } else if (this.previous().length === 1) {
        var prev = this.previous()[0].consumer();
        prev.file = this.outputFile();
        this.map = SourceMapGenerator$3.fromSourceMap(prev, {
          ignoreInvalidMapping: true
        });
      } else {
        this.map = new SourceMapGenerator$3({
          file: this.outputFile(),
          ignoreInvalidMapping: true
        });
        this.map.addMapping({
          generated: {
            column: 0,
            line: 1
          },
          original: {
            column: 0,
            line: 1
          },
          source: this.opts.from ? this.toUrl(this.path(this.opts.from)) : "<no source>"
        });
      }
      if (this.isSourcesContent()) this.setSourcesContent();
      if (this.root && this.previous().length > 0) this.applyPrevMaps();
      if (this.isAnnotation()) this.addAnnotation();
      if (this.isInline()) {
        return [
          this.css
        ];
      } else {
        return [
          this.css,
          this.map
        ];
      }
    };
    _proto.generateString = function generateString() {
      var _this = this;
      this.css = "";
      this.map = new SourceMapGenerator$3({
        file: this.outputFile(),
        ignoreInvalidMapping: true
      });
      var line = 1;
      var column = 1;
      var noSource = "<no source>";
      var mapping = {
        generated: {
          column: 0,
          line: 0
        },
        original: {
          column: 0,
          line: 0
        },
        source: ""
      };
      var lines, last;
      this.stringify(this.root, function(str, node2, type) {
        _this.css += str;
        if (node2 && type !== "end") {
          mapping.generated.line = line;
          mapping.generated.column = column - 1;
          if (node2.source && node2.source.start) {
            mapping.source = _this.sourcePath(node2);
            mapping.original.line = node2.source.start.line;
            mapping.original.column = node2.source.start.column - 1;
            _this.map.addMapping(mapping);
          } else {
            mapping.source = noSource;
            mapping.original.line = 1;
            mapping.original.column = 0;
            _this.map.addMapping(mapping);
          }
        }
        lines = str.match(/\n/g);
        if (lines) {
          line += lines.length;
          last = str.lastIndexOf("\n");
          column = str.length - last;
        } else {
          column += str.length;
        }
        if (node2 && type !== "start") {
          var p3 = node2.parent || {
            raws: {}
          };
          var childless = node2.type === "decl" || node2.type === "atrule" && !node2.nodes;
          if (!childless || node2 !== p3.last || p3.raws.semicolon) {
            if (node2.source && node2.source.end) {
              mapping.source = _this.sourcePath(node2);
              mapping.original.line = node2.source.end.line;
              mapping.original.column = node2.source.end.column - 1;
              mapping.generated.line = line;
              mapping.generated.column = column - 2;
              _this.map.addMapping(mapping);
            } else {
              mapping.source = noSource;
              mapping.original.line = 1;
              mapping.original.column = 0;
              mapping.generated.line = line;
              mapping.generated.column = column - 1;
              _this.map.addMapping(mapping);
            }
          }
        }
      });
    };
    _proto.isAnnotation = function isAnnotation() {
      if (this.isInline()) {
        return true;
      }
      if (typeof this.mapOpts.annotation !== "undefined") {
        return this.mapOpts.annotation;
      }
      if (this.previous().length) {
        return this.previous().some(function(i22) {
          return i22.annotation;
        });
      }
      return true;
    };
    _proto.isInline = function isInline() {
      if (typeof this.mapOpts.inline !== "undefined") {
        return this.mapOpts.inline;
      }
      var annotation = this.mapOpts.annotation;
      if (typeof annotation !== "undefined" && annotation !== true) {
        return false;
      }
      if (this.previous().length) {
        return this.previous().some(function(i22) {
          return i22.inline;
        });
      }
      return true;
    };
    _proto.isMap = function isMap() {
      if (typeof this.opts.map !== "undefined") {
        return !!this.opts.map;
      }
      return this.previous().length > 0;
    };
    _proto.isSourcesContent = function isSourcesContent() {
      if (typeof this.mapOpts.sourcesContent !== "undefined") {
        return this.mapOpts.sourcesContent;
      }
      if (this.previous().length) {
        return this.previous().some(function(i22) {
          return i22.withContent();
        });
      }
      return true;
    };
    _proto.outputFile = function outputFile() {
      if (this.opts.to) {
        return this.path(this.opts.to);
      } else if (this.opts.from) {
        return this.path(this.opts.from);
      } else {
        return "to.css";
      }
    };
    _proto.path = function path(file) {
      if (this.mapOpts.absolute) return file;
      if (file.charCodeAt(0) === 60) return file;
      if (/^\w+:\/\//.test(file)) return file;
      var cached = this.memoizedPaths.get(file);
      if (cached) return cached;
      var from = this.opts.to ? dirname$2(this.opts.to) : ".";
      if (typeof this.mapOpts.annotation === "string") {
        from = dirname$2(resolve$2(from, this.mapOpts.annotation));
      }
      var path2 = relative$1(from, file);
      this.memoizedPaths.set(file, path2);
      return path2;
    };
    _proto.previous = function previous() {
      var _this = this;
      if (!this.previousMaps) {
        this.previousMaps = [];
        if (this.root) {
          this.root.walk(function(node2) {
            if (node2.source && node2.source.input.map) {
              var map = node2.source.input.map;
              if (!_this.previousMaps.includes(map)) {
                _this.previousMaps.push(map);
              }
            }
          });
        } else {
          var input2 = new Input$3$1(this.originalCSS, this.opts);
          if (input2.map) this.previousMaps.push(input2.map);
        }
      }
      return this.previousMaps;
    };
    _proto.setSourcesContent = function setSourcesContent() {
      var _this = this;
      var already = {};
      if (this.root) {
        this.root.walk(function(node2) {
          if (node2.source) {
            var from2 = node2.source.input.from;
            if (from2 && !already[from2]) {
              already[from2] = true;
              var fromUrl = _this.usesFileUrls ? _this.toFileUrl(from2) : _this.toUrl(_this.path(from2));
              _this.map.setSourceContent(fromUrl, node2.source.input.css);
            }
          }
        });
      } else if (this.css) {
        var from = this.opts.from ? this.toUrl(this.path(this.opts.from)) : "<no source>";
        this.map.setSourceContent(from, this.css);
      }
    };
    _proto.sourcePath = function sourcePath(node2) {
      if (this.mapOpts.from) {
        return this.toUrl(this.mapOpts.from);
      } else if (this.usesFileUrls) {
        return this.toFileUrl(node2.source.input.from);
      } else {
        return this.toUrl(this.path(node2.source.input.from));
      }
    };
    _proto.toBase64 = function toBase64(str) {
      if (Buffer) {
        return Buffer.from(str).toString("base64");
      } else {
        return window.btoa(unescape(encodeURIComponent(str)));
      }
    };
    _proto.toFileUrl = function toFileUrl(path) {
      var cached = this.memoizedFileURLs.get(path);
      if (cached) return cached;
      if (pathToFileURL$2) {
        var fileURL = pathToFileURL$2(path).toString();
        this.memoizedFileURLs.set(path, fileURL);
        return fileURL;
      } else {
        throw new Error("`map.absolute` option is not available in this PostCSS build");
      }
    };
    _proto.toUrl = function toUrl(path) {
      var cached = this.memoizedURLs.get(path);
      if (cached) return cached;
      if (sep$1 === "\\") {
        path = path.replace(/\\/g, "/");
      }
      var url = encodeURI(path).replace(/[#?]/g, encodeURIComponent);
      this.memoizedURLs.set(path, url);
      return url;
    };
    return MapGenerator;
  })();
  var mapGenerator$1 = MapGenerator$2$1;
  var Node$2$1 = node$1;
  var Comment$4$1 = /* @__PURE__ */ (function(Node$2$12) {
    _inherits(Comment, Node$2$12);
    function Comment(defaults) {
      var _this;
      _this = Node$2$12.call(this, defaults) || this;
      _this.type = "comment";
      return _this;
    }
    return Comment;
  })(Node$2$1);
  var comment$1 = Comment$4$1;
  Comment$4$1.default = Comment$4$1;
  var isClean$1$1 = symbols$1.isClean;
  var my$1$1 = symbols$1.my;
  var Declaration$3$1 = declaration$1;
  var Comment$3$1 = comment$1;
  var Node$1$1 = node$1;
  var parse$4$1;
  var Rule$4$1;
  var AtRule$4$1;
  var Root$6$1;
  function cleanSource$1(nodes) {
    return nodes.map(function(i22) {
      if (i22.nodes) i22.nodes = cleanSource$1(i22.nodes);
      delete i22.source;
      return i22;
    });
  }
  function markDirtyUp$1(node2) {
    node2[isClean$1$1] = false;
    if (node2.proxyOf.nodes) {
      for (var _iterator = _create_for_of_iterator_helper_loose(node2.proxyOf.nodes), _step; !(_step = _iterator()).done; ) {
        var i22 = _step.value;
        markDirtyUp$1(i22);
      }
    }
  }
  var Container$7$1 = /* @__PURE__ */ (function(Node$1$12) {
    _inherits(Container, Node$1$12);
    function Container() {
      return Node$1$12.apply(this, arguments) || this;
    }
    var _proto = Container.prototype;
    _proto.append = function append() {
      for (var _len = arguments.length, children = new Array(_len), _key = 0; _key < _len; _key++) {
        children[_key] = arguments[_key];
      }
      for (var _iterator = _create_for_of_iterator_helper_loose(children), _step; !(_step = _iterator()).done; ) {
        var child = _step.value;
        var nodes = this.normalize(child, this.last);
        for (var _iterator1 = _create_for_of_iterator_helper_loose(nodes), _step1; !(_step1 = _iterator1()).done; ) {
          var node2 = _step1.value;
          this.proxyOf.nodes.push(node2);
        }
      }
      this.markDirty();
      return this;
    };
    _proto.cleanRaws = function cleanRaws(keepBetween) {
      Node$1$12.prototype.cleanRaws.call(this, keepBetween);
      if (this.nodes) {
        for (var _iterator = _create_for_of_iterator_helper_loose(this.nodes), _step; !(_step = _iterator()).done; ) {
          var node2 = _step.value;
          node2.cleanRaws(keepBetween);
        }
      }
    };
    _proto.each = function each(callback) {
      if (!this.proxyOf.nodes) return void 0;
      var iterator = this.getIterator();
      var index2, result2;
      while (this.indexes[iterator] < this.proxyOf.nodes.length) {
        index2 = this.indexes[iterator];
        result2 = callback(this.proxyOf.nodes[index2], index2);
        if (result2 === false) break;
        this.indexes[iterator] += 1;
      }
      delete this.indexes[iterator];
      return result2;
    };
    _proto.every = function every(condition) {
      return this.nodes.every(condition);
    };
    _proto.getIterator = function getIterator() {
      if (!this.lastEach) this.lastEach = 0;
      if (!this.indexes) this.indexes = {};
      this.lastEach += 1;
      var iterator = this.lastEach;
      this.indexes[iterator] = 0;
      return iterator;
    };
    _proto.getProxyProcessor = function getProxyProcessor() {
      return {
        get: function get(node2, prop) {
          if (prop === "proxyOf") {
            return node2;
          } else if (!node2[prop]) {
            return node2[prop];
          } else if (prop === "each" || typeof prop === "string" && prop.startsWith("walk")) {
            return function() {
              for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {
                args[_key] = arguments[_key];
              }
              var _node2;
              return (_node2 = node2)[prop].apply(_node2, [].concat(args.map(function(i22) {
                if (typeof i22 === "function") {
                  return function(child, index2) {
                    return i22(child.toProxy(), index2);
                  };
                } else {
                  return i22;
                }
              })));
            };
          } else if (prop === "every" || prop === "some") {
            return function(cb) {
              return node2[prop](function(child) {
                for (var _len = arguments.length, other = new Array(_len > 1 ? _len - 1 : 0), _key = 1; _key < _len; _key++) {
                  other[_key - 1] = arguments[_key];
                }
                return cb.apply(void 0, [].concat([
                  child.toProxy()
                ], other));
              });
            };
          } else if (prop === "root") {
            return function() {
              return node2.root().toProxy();
            };
          } else if (prop === "nodes") {
            return node2.nodes.map(function(i22) {
              return i22.toProxy();
            });
          } else if (prop === "first" || prop === "last") {
            return node2[prop].toProxy();
          } else {
            return node2[prop];
          }
        },
        set: function set(node2, prop, value) {
          if (node2[prop] === value) return true;
          node2[prop] = value;
          if (prop === "name" || prop === "params" || prop === "selector") {
            node2.markDirty();
          }
          return true;
        }
      };
    };
    _proto.index = function index2(child) {
      if (typeof child === "number") return child;
      if (child.proxyOf) child = child.proxyOf;
      return this.proxyOf.nodes.indexOf(child);
    };
    _proto.insertAfter = function insertAfter(exist, add) {
      var existIndex = this.index(exist);
      var nodes = this.normalize(add, this.proxyOf.nodes[existIndex]).reverse();
      existIndex = this.index(exist);
      for (var _iterator = _create_for_of_iterator_helper_loose(nodes), _step; !(_step = _iterator()).done; ) {
        var node2 = _step.value;
        this.proxyOf.nodes.splice(existIndex + 1, 0, node2);
      }
      var index2;
      for (var id in this.indexes) {
        index2 = this.indexes[id];
        if (existIndex < index2) {
          this.indexes[id] = index2 + nodes.length;
        }
      }
      this.markDirty();
      return this;
    };
    _proto.insertBefore = function insertBefore(exist, add) {
      var existIndex = this.index(exist);
      var type = existIndex === 0 ? "prepend" : false;
      var nodes = this.normalize(add, this.proxyOf.nodes[existIndex], type).reverse();
      existIndex = this.index(exist);
      for (var _iterator = _create_for_of_iterator_helper_loose(nodes), _step; !(_step = _iterator()).done; ) {
        var node2 = _step.value;
        this.proxyOf.nodes.splice(existIndex, 0, node2);
      }
      var index2;
      for (var id in this.indexes) {
        index2 = this.indexes[id];
        if (existIndex <= index2) {
          this.indexes[id] = index2 + nodes.length;
        }
      }
      this.markDirty();
      return this;
    };
    _proto.normalize = function normalize(nodes, sample) {
      var _this = this;
      if (typeof nodes === "string") {
        nodes = cleanSource$1(parse$4$1(nodes).nodes);
      } else if (typeof nodes === "undefined") {
        nodes = [];
      } else if (Array.isArray(nodes)) {
        nodes = nodes.slice(0);
        for (var _iterator = _create_for_of_iterator_helper_loose(nodes), _step; !(_step = _iterator()).done; ) {
          var i22 = _step.value;
          if (i22.parent) i22.parent.removeChild(i22, "ignore");
        }
      } else if (nodes.type === "root" && this.type !== "document") {
        nodes = nodes.nodes.slice(0);
        for (var _iterator1 = _create_for_of_iterator_helper_loose(nodes), _step1; !(_step1 = _iterator1()).done; ) {
          var i21 = _step1.value;
          if (i21.parent) i21.parent.removeChild(i21, "ignore");
        }
      } else if (nodes.type) {
        nodes = [
          nodes
        ];
      } else if (nodes.prop) {
        if (typeof nodes.value === "undefined") {
          throw new Error("Value field is missed in node creation");
        } else if (typeof nodes.value !== "string") {
          nodes.value = String(nodes.value);
        }
        nodes = [
          new Declaration$3$1(nodes)
        ];
      } else if (nodes.selector) {
        nodes = [
          new Rule$4$1(nodes)
        ];
      } else if (nodes.name) {
        nodes = [
          new AtRule$4$1(nodes)
        ];
      } else if (nodes.text) {
        nodes = [
          new Comment$3$1(nodes)
        ];
      } else {
        throw new Error("Unknown node type in node creation");
      }
      var processed = nodes.map(function(i23) {
        if (!i23[my$1$1]) Container.rebuild(i23);
        i23 = i23.proxyOf;
        if (i23.parent) i23.parent.removeChild(i23);
        if (i23[isClean$1$1]) markDirtyUp$1(i23);
        if (typeof i23.raws.before === "undefined") {
          if (sample && typeof sample.raws.before !== "undefined") {
            i23.raws.before = sample.raws.before.replace(/\S/g, "");
          }
        }
        i23.parent = _this.proxyOf;
        return i23;
      });
      return processed;
    };
    _proto.prepend = function prepend() {
      for (var _len = arguments.length, children = new Array(_len), _key = 0; _key < _len; _key++) {
        children[_key] = arguments[_key];
      }
      children = children.reverse();
      for (var _iterator = _create_for_of_iterator_helper_loose(children), _step; !(_step = _iterator()).done; ) {
        var child = _step.value;
        var nodes = this.normalize(child, this.first, "prepend").reverse();
        for (var _iterator1 = _create_for_of_iterator_helper_loose(nodes), _step1; !(_step1 = _iterator1()).done; ) {
          var node2 = _step1.value;
          this.proxyOf.nodes.unshift(node2);
        }
        for (var id in this.indexes) {
          this.indexes[id] = this.indexes[id] + nodes.length;
        }
      }
      this.markDirty();
      return this;
    };
    _proto.push = function push(child) {
      child.parent = this;
      this.proxyOf.nodes.push(child);
      return this;
    };
    _proto.removeAll = function removeAll() {
      for (var _iterator = _create_for_of_iterator_helper_loose(this.proxyOf.nodes), _step; !(_step = _iterator()).done; ) {
        var node2 = _step.value;
        node2.parent = void 0;
      }
      this.proxyOf.nodes = [];
      this.markDirty();
      return this;
    };
    _proto.removeChild = function removeChild(child) {
      child = this.index(child);
      this.proxyOf.nodes[child].parent = void 0;
      this.proxyOf.nodes.splice(child, 1);
      var index2;
      for (var id in this.indexes) {
        index2 = this.indexes[id];
        if (index2 >= child) {
          this.indexes[id] = index2 - 1;
        }
      }
      this.markDirty();
      return this;
    };
    _proto.replaceValues = function replaceValues(pattern, opts, callback) {
      if (!callback) {
        callback = opts;
        opts = {};
      }
      this.walkDecls(function(decl) {
        if (opts.props && !opts.props.includes(decl.prop)) return;
        if (opts.fast && !decl.value.includes(opts.fast)) return;
        decl.value = decl.value.replace(pattern, callback);
      });
      this.markDirty();
      return this;
    };
    _proto.some = function some(condition) {
      return this.nodes.some(condition);
    };
    _proto.walk = function walk(callback) {
      return this.each(function(child, i22) {
        var result2;
        try {
          result2 = callback(child, i22);
        } catch (e22) {
          throw child.addToError(e22);
        }
        if (result2 !== false && child.walk) {
          result2 = child.walk(callback);
        }
        return result2;
      });
    };
    _proto.walkAtRules = function walkAtRules(name, callback) {
      if (!callback) {
        callback = name;
        return this.walk(function(child, i22) {
          if (child.type === "atrule") {
            return callback(child, i22);
          }
        });
      }
      if (_instanceof(name, RegExp)) {
        return this.walk(function(child, i22) {
          if (child.type === "atrule" && name.test(child.name)) {
            return callback(child, i22);
          }
        });
      }
      return this.walk(function(child, i22) {
        if (child.type === "atrule" && child.name === name) {
          return callback(child, i22);
        }
      });
    };
    _proto.walkComments = function walkComments(callback) {
      return this.walk(function(child, i22) {
        if (child.type === "comment") {
          return callback(child, i22);
        }
      });
    };
    _proto.walkDecls = function walkDecls(prop, callback) {
      if (!callback) {
        callback = prop;
        return this.walk(function(child, i22) {
          if (child.type === "decl") {
            return callback(child, i22);
          }
        });
      }
      if (_instanceof(prop, RegExp)) {
        return this.walk(function(child, i22) {
          if (child.type === "decl" && prop.test(child.prop)) {
            return callback(child, i22);
          }
        });
      }
      return this.walk(function(child, i22) {
        if (child.type === "decl" && child.prop === prop) {
          return callback(child, i22);
        }
      });
    };
    _proto.walkRules = function walkRules(selector, callback) {
      if (!callback) {
        callback = selector;
        return this.walk(function(child, i22) {
          if (child.type === "rule") {
            return callback(child, i22);
          }
        });
      }
      if (_instanceof(selector, RegExp)) {
        return this.walk(function(child, i22) {
          if (child.type === "rule" && selector.test(child.selector)) {
            return callback(child, i22);
          }
        });
      }
      return this.walk(function(child, i22) {
        if (child.type === "rule" && child.selector === selector) {
          return callback(child, i22);
        }
      });
    };
    _create_class(Container, [
      {
        key: "first",
        get: function get() {
          if (!this.proxyOf.nodes) return void 0;
          return this.proxyOf.nodes[0];
        }
      },
      {
        key: "last",
        get: function get() {
          if (!this.proxyOf.nodes) return void 0;
          return this.proxyOf.nodes[this.proxyOf.nodes.length - 1];
        }
      }
    ]);
    return Container;
  })(Node$1$1);
  Container$7$1.registerParse = function(dependant) {
    parse$4$1 = dependant;
  };
  Container$7$1.registerRule = function(dependant) {
    Rule$4$1 = dependant;
  };
  Container$7$1.registerAtRule = function(dependant) {
    AtRule$4$1 = dependant;
  };
  Container$7$1.registerRoot = function(dependant) {
    Root$6$1 = dependant;
  };
  var container$1 = Container$7$1;
  Container$7$1.default = Container$7$1;
  Container$7$1.rebuild = function(node2) {
    if (node2.type === "atrule") {
      Object.setPrototypeOf(node2, AtRule$4$1.prototype);
    } else if (node2.type === "rule") {
      Object.setPrototypeOf(node2, Rule$4$1.prototype);
    } else if (node2.type === "decl") {
      Object.setPrototypeOf(node2, Declaration$3$1.prototype);
    } else if (node2.type === "comment") {
      Object.setPrototypeOf(node2, Comment$3$1.prototype);
    } else if (node2.type === "root") {
      Object.setPrototypeOf(node2, Root$6$1.prototype);
    }
    node2[my$1$1] = true;
    if (node2.nodes) {
      node2.nodes.forEach(function(child) {
        Container$7$1.rebuild(child);
      });
    }
  };
  var Container$6$1 = container$1;
  var LazyResult$4$1;
  var Processor$3$1;
  var Document$3$1 = /* @__PURE__ */ (function(Container$6$12) {
    _inherits(Document23, Container$6$12);
    function Document23(defaults) {
      var _this;
      _this = Container$6$12.call(this, _extends({
        type: "document"
      }, defaults)) || this;
      if (!_this.nodes) {
        _this.nodes = [];
      }
      return _this;
    }
    var _proto = Document23.prototype;
    _proto.toResult = function toResult(opts) {
      if (opts === void 0) opts = {};
      var lazy = new LazyResult$4$1(new Processor$3$1(), this, opts);
      return lazy.stringify();
    };
    return Document23;
  })(Container$6$1);
  Document$3$1.registerLazyResult = function(dependant) {
    LazyResult$4$1 = dependant;
  };
  Document$3$1.registerProcessor = function(dependant) {
    Processor$3$1 = dependant;
  };
  var document$1$1 = Document$3$1;
  Document$3$1.default = Document$3$1;
  var printed$1 = {};
  var warnOnce$2$1 = function warnOnce(message) {
    if (printed$1[message]) return;
    printed$1[message] = true;
    if (typeof console !== "undefined" && console.warn) {
      console.warn(message);
    }
  };
  var Warning$2$1 = /* @__PURE__ */ (function() {
    function Warning(text, opts) {
      if (opts === void 0) opts = {};
      this.type = "warning";
      this.text = text;
      if (opts.node && opts.node.source) {
        var range = opts.node.rangeBy(opts);
        this.line = range.start.line;
        this.column = range.start.column;
        this.endLine = range.end.line;
        this.endColumn = range.end.column;
      }
      for (var opt in opts) this[opt] = opts[opt];
    }
    var _proto = Warning.prototype;
    _proto.toString = function toString2() {
      if (this.node) {
        return this.node.error(this.text, {
          index: this.index,
          plugin: this.plugin,
          word: this.word
        }).message;
      }
      if (this.plugin) {
        return this.plugin + ": " + this.text;
      }
      return this.text;
    };
    return Warning;
  })();
  var warning$1 = Warning$2$1;
  Warning$2$1.default = Warning$2$1;
  var Warning$1$1 = warning$1;
  var Result$3$1 = /* @__PURE__ */ (function() {
    function Result(processor2, root2, opts) {
      this.processor = processor2;
      this.messages = [];
      this.root = root2;
      this.opts = opts;
      this.css = void 0;
      this.map = void 0;
    }
    var _proto = Result.prototype;
    _proto.toString = function toString2() {
      return this.css;
    };
    _proto.warn = function warn(text, opts) {
      if (opts === void 0) opts = {};
      if (!opts.plugin) {
        if (this.lastPlugin && this.lastPlugin.postcssPlugin) {
          opts.plugin = this.lastPlugin.postcssPlugin;
        }
      }
      var warning2 = new Warning$1$1(text, opts);
      this.messages.push(warning2);
      return warning2;
    };
    _proto.warnings = function warnings() {
      return this.messages.filter(function(i22) {
        return i22.type === "warning";
      });
    };
    _create_class(Result, [
      {
        key: "content",
        get: function get() {
          return this.css;
        }
      }
    ]);
    return Result;
  })();
  var result$1 = Result$3$1;
  Result$3$1.default = Result$3$1;
  var SINGLE_QUOTE$1 = "'".charCodeAt(0);
  var DOUBLE_QUOTE$1 = '"'.charCodeAt(0);
  var BACKSLASH$1 = "\\".charCodeAt(0);
  var SLASH$1 = "/".charCodeAt(0);
  var NEWLINE$1 = "\n".charCodeAt(0);
  var SPACE$1 = " ".charCodeAt(0);
  var FEED$1 = "\f".charCodeAt(0);
  var TAB$1 = "	".charCodeAt(0);
  var CR$1 = "\r".charCodeAt(0);
  var OPEN_SQUARE$1 = "[".charCodeAt(0);
  var CLOSE_SQUARE$1 = "]".charCodeAt(0);
  var OPEN_PARENTHESES$1 = "(".charCodeAt(0);
  var CLOSE_PARENTHESES$1 = ")".charCodeAt(0);
  var OPEN_CURLY$1 = "{".charCodeAt(0);
  var CLOSE_CURLY$1 = "}".charCodeAt(0);
  var SEMICOLON$1 = ";".charCodeAt(0);
  var ASTERISK$1 = "*".charCodeAt(0);
  var COLON$1 = ":".charCodeAt(0);
  var AT$1 = "@".charCodeAt(0);
  var RE_AT_END$1 = /[\t\n\f\r "#'()/;[\\\]{}]/g;
  var RE_WORD_END$1 = /[\t\n\f\r !"#'():;@[\\\]{}]|\/(?=\*)/g;
  var RE_BAD_BRACKET$1 = /.[\r\n"'(/\\]/;
  var RE_HEX_ESCAPE$1 = /[\da-f]/i;
  var tokenize$1 = function tokenizer(input2, options) {
    if (options === void 0) options = {};
    var css = input2.css.valueOf();
    var ignore = options.ignoreErrors;
    var code, next, quote, content, escape;
    var escaped, escapePos, prev, n22, currentToken;
    var length = css.length;
    var pos = 0;
    var buffer = [];
    var returned = [];
    function position() {
      return pos;
    }
    function unclosed(what) {
      throw input2.error("Unclosed " + what, pos);
    }
    function endOfFile() {
      return returned.length === 0 && pos >= length;
    }
    function nextToken(opts) {
      if (returned.length) return returned.pop();
      if (pos >= length) return;
      var ignoreUnclosed = opts ? opts.ignoreUnclosed : false;
      code = css.charCodeAt(pos);
      switch (code) {
        case NEWLINE$1:
        case SPACE$1:
        case TAB$1:
        case CR$1:
        case FEED$1: {
          next = pos;
          do {
            next += 1;
            code = css.charCodeAt(next);
          } while (code === SPACE$1 || code === NEWLINE$1 || code === TAB$1 || code === CR$1 || code === FEED$1);
          currentToken = [
            "space",
            css.slice(pos, next)
          ];
          pos = next - 1;
          break;
        }
        case OPEN_SQUARE$1:
        case CLOSE_SQUARE$1:
        case OPEN_CURLY$1:
        case CLOSE_CURLY$1:
        case COLON$1:
        case SEMICOLON$1:
        case CLOSE_PARENTHESES$1: {
          var controlChar = String.fromCharCode(code);
          currentToken = [
            controlChar,
            controlChar,
            pos
          ];
          break;
        }
        case OPEN_PARENTHESES$1: {
          prev = buffer.length ? buffer.pop()[1] : "";
          n22 = css.charCodeAt(pos + 1);
          if (prev === "url" && n22 !== SINGLE_QUOTE$1 && n22 !== DOUBLE_QUOTE$1 && n22 !== SPACE$1 && n22 !== NEWLINE$1 && n22 !== TAB$1 && n22 !== FEED$1 && n22 !== CR$1) {
            next = pos;
            do {
              escaped = false;
              next = css.indexOf(")", next + 1);
              if (next === -1) {
                if (ignore || ignoreUnclosed) {
                  next = pos;
                  break;
                } else {
                  unclosed("bracket");
                }
              }
              escapePos = next;
              while (css.charCodeAt(escapePos - 1) === BACKSLASH$1) {
                escapePos -= 1;
                escaped = !escaped;
              }
            } while (escaped);
            currentToken = [
              "brackets",
              css.slice(pos, next + 1),
              pos,
              next
            ];
            pos = next;
          } else {
            next = css.indexOf(")", pos + 1);
            content = css.slice(pos, next + 1);
            if (next === -1 || RE_BAD_BRACKET$1.test(content)) {
              currentToken = [
                "(",
                "(",
                pos
              ];
            } else {
              currentToken = [
                "brackets",
                content,
                pos,
                next
              ];
              pos = next;
            }
          }
          break;
        }
        case SINGLE_QUOTE$1:
        case DOUBLE_QUOTE$1: {
          quote = code === SINGLE_QUOTE$1 ? "'" : '"';
          next = pos;
          do {
            escaped = false;
            next = css.indexOf(quote, next + 1);
            if (next === -1) {
              if (ignore || ignoreUnclosed) {
                next = pos + 1;
                break;
              } else {
                unclosed("string");
              }
            }
            escapePos = next;
            while (css.charCodeAt(escapePos - 1) === BACKSLASH$1) {
              escapePos -= 1;
              escaped = !escaped;
            }
          } while (escaped);
          currentToken = [
            "string",
            css.slice(pos, next + 1),
            pos,
            next
          ];
          pos = next;
          break;
        }
        case AT$1: {
          RE_AT_END$1.lastIndex = pos + 1;
          RE_AT_END$1.test(css);
          if (RE_AT_END$1.lastIndex === 0) {
            next = css.length - 1;
          } else {
            next = RE_AT_END$1.lastIndex - 2;
          }
          currentToken = [
            "at-word",
            css.slice(pos, next + 1),
            pos,
            next
          ];
          pos = next;
          break;
        }
        case BACKSLASH$1: {
          next = pos;
          escape = true;
          while (css.charCodeAt(next + 1) === BACKSLASH$1) {
            next += 1;
            escape = !escape;
          }
          code = css.charCodeAt(next + 1);
          if (escape && code !== SLASH$1 && code !== SPACE$1 && code !== NEWLINE$1 && code !== TAB$1 && code !== CR$1 && code !== FEED$1) {
            next += 1;
            if (RE_HEX_ESCAPE$1.test(css.charAt(next))) {
              while (RE_HEX_ESCAPE$1.test(css.charAt(next + 1))) {
                next += 1;
              }
              if (css.charCodeAt(next + 1) === SPACE$1) {
                next += 1;
              }
            }
          }
          currentToken = [
            "word",
            css.slice(pos, next + 1),
            pos,
            next
          ];
          pos = next;
          break;
        }
        default: {
          if (code === SLASH$1 && css.charCodeAt(pos + 1) === ASTERISK$1) {
            next = css.indexOf("*/", pos + 2) + 1;
            if (next === 0) {
              if (ignore || ignoreUnclosed) {
                next = css.length;
              } else {
                unclosed("comment");
              }
            }
            currentToken = [
              "comment",
              css.slice(pos, next + 1),
              pos,
              next
            ];
            pos = next;
          } else {
            RE_WORD_END$1.lastIndex = pos + 1;
            RE_WORD_END$1.test(css);
            if (RE_WORD_END$1.lastIndex === 0) {
              next = css.length - 1;
            } else {
              next = RE_WORD_END$1.lastIndex - 2;
            }
            currentToken = [
              "word",
              css.slice(pos, next + 1),
              pos,
              next
            ];
            buffer.push(currentToken);
            pos = next;
          }
          break;
        }
      }
      pos++;
      return currentToken;
    }
    function back(token) {
      returned.push(token);
    }
    return {
      back,
      endOfFile,
      nextToken,
      position
    };
  };
  var Container$5$1 = container$1;
  var AtRule$3$1 = /* @__PURE__ */ (function(Container$5$12) {
    _inherits(AtRule, Container$5$12);
    function AtRule(defaults) {
      var _this;
      _this = Container$5$12.call(this, defaults) || this;
      _this.type = "atrule";
      return _this;
    }
    var _proto = AtRule.prototype;
    _proto.append = function append() {
      for (var _len = arguments.length, children = new Array(_len), _key = 0; _key < _len; _key++) {
        children[_key] = arguments[_key];
      }
      var _Container$5$1_prototype_append;
      if (!this.proxyOf.nodes) this.nodes = [];
      return (_Container$5$1_prototype_append = Container$5$12.prototype.append).call.apply(_Container$5$1_prototype_append, [].concat([
        this
      ], children));
    };
    _proto.prepend = function prepend() {
      for (var _len = arguments.length, children = new Array(_len), _key = 0; _key < _len; _key++) {
        children[_key] = arguments[_key];
      }
      var _Container$5$1_prototype_prepend;
      if (!this.proxyOf.nodes) this.nodes = [];
      return (_Container$5$1_prototype_prepend = Container$5$12.prototype.prepend).call.apply(_Container$5$1_prototype_prepend, [].concat([
        this
      ], children));
    };
    return AtRule;
  })(Container$5$1);
  var atRule$1 = AtRule$3$1;
  AtRule$3$1.default = AtRule$3$1;
  Container$5$1.registerAtRule(AtRule$3$1);
  var Container$4$1 = container$1;
  var LazyResult$3$1;
  var Processor$2$1;
  var Root$5$1 = /* @__PURE__ */ (function(Container$4$12) {
    _inherits(Root, Container$4$12);
    function Root(defaults) {
      var _this;
      _this = Container$4$12.call(this, defaults) || this;
      _this.type = "root";
      if (!_this.nodes) _this.nodes = [];
      return _this;
    }
    var _proto = Root.prototype;
    _proto.normalize = function normalize(child, sample, type) {
      var nodes = Container$4$12.prototype.normalize.call(this, child);
      if (sample) {
        if (type === "prepend") {
          if (this.nodes.length > 1) {
            sample.raws.before = this.nodes[1].raws.before;
          } else {
            delete sample.raws.before;
          }
        } else if (this.first !== sample) {
          for (var _iterator = _create_for_of_iterator_helper_loose(nodes), _step; !(_step = _iterator()).done; ) {
            var node2 = _step.value;
            node2.raws.before = sample.raws.before;
          }
        }
      }
      return nodes;
    };
    _proto.removeChild = function removeChild(child, ignore) {
      var index2 = this.index(child);
      if (!ignore && index2 === 0 && this.nodes.length > 1) {
        this.nodes[1].raws.before = this.nodes[index2].raws.before;
      }
      return Container$4$12.prototype.removeChild.call(this, child);
    };
    _proto.toResult = function toResult(opts) {
      if (opts === void 0) opts = {};
      var lazy = new LazyResult$3$1(new Processor$2$1(), this, opts);
      return lazy.stringify();
    };
    return Root;
  })(Container$4$1);
  Root$5$1.registerLazyResult = function(dependant) {
    LazyResult$3$1 = dependant;
  };
  Root$5$1.registerProcessor = function(dependant) {
    Processor$2$1 = dependant;
  };
  var root$1 = Root$5$1;
  Root$5$1.default = Root$5$1;
  Container$4$1.registerRoot(Root$5$1);
  var list$2$1 = {
    comma: function comma(string) {
      return list$2$1.split(string, [
        ","
      ], true);
    },
    space: function space(string) {
      var spaces = [
        " ",
        "\n",
        "	"
      ];
      return list$2$1.split(string, spaces);
    },
    split: function split(string, separators, last) {
      var array = [];
      var current = "";
      var split4 = false;
      var func = 0;
      var inQuote = false;
      var prevQuote = "";
      var escape = false;
      for (var _iterator = _create_for_of_iterator_helper_loose(string), _step; !(_step = _iterator()).done; ) {
        var letter = _step.value;
        if (escape) {
          escape = false;
        } else if (letter === "\\") {
          escape = true;
        } else if (inQuote) {
          if (letter === prevQuote) {
            inQuote = false;
          }
        } else if (letter === '"' || letter === "'") {
          inQuote = true;
          prevQuote = letter;
        } else if (letter === "(") {
          func += 1;
        } else if (letter === ")") {
          if (func > 0) func -= 1;
        } else if (func === 0) {
          if (separators.includes(letter)) split4 = true;
        }
        if (split4) {
          if (current !== "") array.push(current.trim());
          current = "";
          split4 = false;
        } else {
          current += letter;
        }
      }
      if (last || current !== "") array.push(current.trim());
      return array;
    }
  };
  var list_1$1 = list$2$1;
  list$2$1.default = list$2$1;
  var Container$3$1 = container$1;
  var list$1$1 = list_1$1;
  var Rule$3$1 = /* @__PURE__ */ (function(Container$3$12) {
    _inherits(Rule, Container$3$12);
    function Rule(defaults) {
      var _this;
      _this = Container$3$12.call(this, defaults) || this;
      _this.type = "rule";
      if (!_this.nodes) _this.nodes = [];
      return _this;
    }
    _create_class(Rule, [
      {
        key: "selectors",
        get: function get() {
          return list$1$1.comma(this.selector);
        },
        set: function set(values) {
          var match = this.selector ? this.selector.match(/,\s*/) : null;
          var sep2 = match ? match[0] : "," + this.raw("between", "beforeOpen");
          this.selector = values.join(sep2);
        }
      }
    ]);
    return Rule;
  })(Container$3$1);
  var rule$1 = Rule$3$1;
  Rule$3$1.default = Rule$3$1;
  Container$3$1.registerRule(Rule$3$1);
  var Declaration$2$1 = declaration$1;
  var tokenizer2$1 = tokenize$1;
  var Comment$2$1 = comment$1;
  var AtRule$2$1 = atRule$1;
  var Root$4$1 = root$1;
  var Rule$2$1 = rule$1;
  var SAFE_COMMENT_NEIGHBOR$1 = {
    empty: true,
    space: true
  };
  function findLastWithPosition$1(tokens) {
    for (var i22 = tokens.length - 1; i22 >= 0; i22--) {
      var token = tokens[i22];
      var pos = token[3] || token[2];
      if (pos) return pos;
    }
  }
  var Parser$1$1 = /* @__PURE__ */ (function() {
    function Parser(input2) {
      this.input = input2;
      this.root = new Root$4$1();
      this.current = this.root;
      this.spaces = "";
      this.semicolon = false;
      this.createTokenizer();
      this.root.source = {
        input: input2,
        start: {
          column: 1,
          line: 1,
          offset: 0
        }
      };
    }
    var _proto = Parser.prototype;
    _proto.atrule = function atrule(token) {
      var node2 = new AtRule$2$1();
      node2.name = token[1].slice(1);
      if (node2.name === "") {
        this.unnamedAtrule(node2, token);
      }
      this.init(node2, token[2]);
      var type;
      var prev;
      var shift;
      var last = false;
      var open = false;
      var params = [];
      var brackets = [];
      while (!this.tokenizer.endOfFile()) {
        token = this.tokenizer.nextToken();
        type = token[0];
        if (type === "(" || type === "[") {
          brackets.push(type === "(" ? ")" : "]");
        } else if (type === "{" && brackets.length > 0) {
          brackets.push("}");
        } else if (type === brackets[brackets.length - 1]) {
          brackets.pop();
        }
        if (brackets.length === 0) {
          if (type === ";") {
            node2.source.end = this.getPosition(token[2]);
            node2.source.end.offset++;
            this.semicolon = true;
            break;
          } else if (type === "{") {
            open = true;
            break;
          } else if (type === "}") {
            if (params.length > 0) {
              shift = params.length - 1;
              prev = params[shift];
              while (prev && prev[0] === "space") {
                prev = params[--shift];
              }
              if (prev) {
                node2.source.end = this.getPosition(prev[3] || prev[2]);
                node2.source.end.offset++;
              }
            }
            this.end(token);
            break;
          } else {
            params.push(token);
          }
        } else {
          params.push(token);
        }
        if (this.tokenizer.endOfFile()) {
          last = true;
          break;
        }
      }
      node2.raws.between = this.spacesAndCommentsFromEnd(params);
      if (params.length) {
        node2.raws.afterName = this.spacesAndCommentsFromStart(params);
        this.raw(node2, "params", params);
        if (last) {
          token = params[params.length - 1];
          node2.source.end = this.getPosition(token[3] || token[2]);
          node2.source.end.offset++;
          this.spaces = node2.raws.between;
          node2.raws.between = "";
        }
      } else {
        node2.raws.afterName = "";
        node2.params = "";
      }
      if (open) {
        node2.nodes = [];
        this.current = node2;
      }
    };
    _proto.checkMissedSemicolon = function checkMissedSemicolon(tokens) {
      var colon = this.colon(tokens);
      if (colon === false) return;
      var founded = 0;
      var token;
      for (var j4 = colon - 1; j4 >= 0; j4--) {
        token = tokens[j4];
        if (token[0] !== "space") {
          founded += 1;
          if (founded === 2) break;
        }
      }
      throw this.input.error("Missed semicolon", token[0] === "word" ? token[3] + 1 : token[2]);
    };
    _proto.colon = function colon(tokens) {
      var brackets = 0;
      var token, type, prev;
      for (var _iterator = _create_for_of_iterator_helper_loose(tokens.entries()), _step; !(_step = _iterator()).done; ) {
        var _step_value = _step.value, i22 = _step_value[0], element = _step_value[1];
        token = element;
        type = token[0];
        if (type === "(") {
          brackets += 1;
        }
        if (type === ")") {
          brackets -= 1;
        }
        if (brackets === 0 && type === ":") {
          if (!prev) {
            this.doubleColon(token);
          } else if (prev[0] === "word" && prev[1] === "progid") {
            continue;
          } else {
            return i22;
          }
        }
        prev = token;
      }
      return false;
    };
    _proto.comment = function comment2(token) {
      var node2 = new Comment$2$1();
      this.init(node2, token[2]);
      node2.source.end = this.getPosition(token[3] || token[2]);
      node2.source.end.offset++;
      var text = token[1].slice(2, -2);
      if (/^\s*$/.test(text)) {
        node2.text = "";
        node2.raws.left = text;
        node2.raws.right = "";
      } else {
        var match = text.match(/^(\s*)([^]*\S)(\s*)$/);
        node2.text = match[2];
        node2.raws.left = match[1];
        node2.raws.right = match[3];
      }
    };
    _proto.createTokenizer = function createTokenizer() {
      this.tokenizer = tokenizer2$1(this.input);
    };
    _proto.decl = function decl(tokens, customProperty) {
      var node2 = new Declaration$2$1();
      this.init(node2, tokens[0][2]);
      var last = tokens[tokens.length - 1];
      if (last[0] === ";") {
        this.semicolon = true;
        tokens.pop();
      }
      node2.source.end = this.getPosition(last[3] || last[2] || findLastWithPosition$1(tokens));
      node2.source.end.offset++;
      while (tokens[0][0] !== "word") {
        if (tokens.length === 1) this.unknownWord(tokens);
        node2.raws.before += tokens.shift()[1];
      }
      node2.source.start = this.getPosition(tokens[0][2]);
      node2.prop = "";
      while (tokens.length) {
        var type = tokens[0][0];
        if (type === ":" || type === "space" || type === "comment") {
          break;
        }
        node2.prop += tokens.shift()[1];
      }
      node2.raws.between = "";
      var token;
      while (tokens.length) {
        token = tokens.shift();
        if (token[0] === ":") {
          node2.raws.between += token[1];
          break;
        } else {
          if (token[0] === "word" && /\w/.test(token[1])) {
            this.unknownWord([
              token
            ]);
          }
          node2.raws.between += token[1];
        }
      }
      if (node2.prop[0] === "_" || node2.prop[0] === "*") {
        node2.raws.before += node2.prop[0];
        node2.prop = node2.prop.slice(1);
      }
      var firstSpaces = [];
      var next;
      while (tokens.length) {
        next = tokens[0][0];
        if (next !== "space" && next !== "comment") break;
        firstSpaces.push(tokens.shift());
      }
      this.precheckMissedSemicolon(tokens);
      for (var i22 = tokens.length - 1; i22 >= 0; i22--) {
        token = tokens[i22];
        if (token[1].toLowerCase() === "!important") {
          node2.important = true;
          var string = this.stringFrom(tokens, i22);
          string = this.spacesFromEnd(tokens) + string;
          if (string !== " !important") node2.raws.important = string;
          break;
        } else if (token[1].toLowerCase() === "important") {
          var cache = tokens.slice(0);
          var str = "";
          for (var j4 = i22; j4 > 0; j4--) {
            var type1 = cache[j4][0];
            if (str.trim().indexOf("!") === 0 && type1 !== "space") {
              break;
            }
            str = cache.pop()[1] + str;
          }
          if (str.trim().indexOf("!") === 0) {
            node2.important = true;
            node2.raws.important = str;
            tokens = cache;
          }
        }
        if (token[0] !== "space" && token[0] !== "comment") {
          break;
        }
      }
      var hasWord = tokens.some(function(i23) {
        return i23[0] !== "space" && i23[0] !== "comment";
      });
      if (hasWord) {
        node2.raws.between += firstSpaces.map(function(i23) {
          return i23[1];
        }).join("");
        firstSpaces = [];
      }
      this.raw(node2, "value", firstSpaces.concat(tokens), customProperty);
      if (node2.value.includes(":") && !customProperty) {
        this.checkMissedSemicolon(tokens);
      }
    };
    _proto.doubleColon = function doubleColon(token) {
      throw this.input.error("Double colon", {
        offset: token[2]
      }, {
        offset: token[2] + token[1].length
      });
    };
    _proto.emptyRule = function emptyRule(token) {
      var node2 = new Rule$2$1();
      this.init(node2, token[2]);
      node2.selector = "";
      node2.raws.between = "";
      this.current = node2;
    };
    _proto.end = function end(token) {
      if (this.current.nodes && this.current.nodes.length) {
        this.current.raws.semicolon = this.semicolon;
      }
      this.semicolon = false;
      this.current.raws.after = (this.current.raws.after || "") + this.spaces;
      this.spaces = "";
      if (this.current.parent) {
        this.current.source.end = this.getPosition(token[2]);
        this.current.source.end.offset++;
        this.current = this.current.parent;
      } else {
        this.unexpectedClose(token);
      }
    };
    _proto.endFile = function endFile() {
      if (this.current.parent) this.unclosedBlock();
      if (this.current.nodes && this.current.nodes.length) {
        this.current.raws.semicolon = this.semicolon;
      }
      this.current.raws.after = (this.current.raws.after || "") + this.spaces;
      this.root.source.end = this.getPosition(this.tokenizer.position());
    };
    _proto.freeSemicolon = function freeSemicolon(token) {
      this.spaces += token[1];
      if (this.current.nodes) {
        var prev = this.current.nodes[this.current.nodes.length - 1];
        if (prev && prev.type === "rule" && !prev.raws.ownSemicolon) {
          prev.raws.ownSemicolon = this.spaces;
          this.spaces = "";
        }
      }
    };
    _proto.getPosition = function getPosition(offset) {
      var pos = this.input.fromOffset(offset);
      return {
        column: pos.col,
        line: pos.line,
        offset
      };
    };
    _proto.init = function init(node2, offset) {
      this.current.push(node2);
      node2.source = {
        input: this.input,
        start: this.getPosition(offset)
      };
      node2.raws.before = this.spaces;
      this.spaces = "";
      if (node2.type !== "comment") this.semicolon = false;
    };
    _proto.other = function other(start) {
      var end = false;
      var type = null;
      var colon = false;
      var bracket = null;
      var brackets = [];
      var customProperty = start[1].startsWith("--");
      var tokens = [];
      var token = start;
      while (token) {
        type = token[0];
        tokens.push(token);
        if (type === "(" || type === "[") {
          if (!bracket) bracket = token;
          brackets.push(type === "(" ? ")" : "]");
        } else if (customProperty && colon && type === "{") {
          if (!bracket) bracket = token;
          brackets.push("}");
        } else if (brackets.length === 0) {
          if (type === ";") {
            if (colon) {
              this.decl(tokens, customProperty);
              return;
            } else {
              break;
            }
          } else if (type === "{") {
            this.rule(tokens);
            return;
          } else if (type === "}") {
            this.tokenizer.back(tokens.pop());
            end = true;
            break;
          } else if (type === ":") {
            colon = true;
          }
        } else if (type === brackets[brackets.length - 1]) {
          brackets.pop();
          if (brackets.length === 0) bracket = null;
        }
        token = this.tokenizer.nextToken();
      }
      if (this.tokenizer.endOfFile()) end = true;
      if (brackets.length > 0) this.unclosedBracket(bracket);
      if (end && colon) {
        if (!customProperty) {
          while (tokens.length) {
            token = tokens[tokens.length - 1][0];
            if (token !== "space" && token !== "comment") break;
            this.tokenizer.back(tokens.pop());
          }
        }
        this.decl(tokens, customProperty);
      } else {
        this.unknownWord(tokens);
      }
    };
    _proto.parse = function parse3() {
      var token;
      while (!this.tokenizer.endOfFile()) {
        token = this.tokenizer.nextToken();
        switch (token[0]) {
          case "space":
            this.spaces += token[1];
            break;
          case ";":
            this.freeSemicolon(token);
            break;
          case "}":
            this.end(token);
            break;
          case "comment":
            this.comment(token);
            break;
          case "at-word":
            this.atrule(token);
            break;
          case "{":
            this.emptyRule(token);
            break;
          default:
            this.other(token);
            break;
        }
      }
      this.endFile();
    };
    _proto.precheckMissedSemicolon = function precheckMissedSemicolon() {
    };
    _proto.raw = function raw(node2, prop, tokens, customProperty) {
      var token, type;
      var length = tokens.length;
      var value = "";
      var clean = true;
      var next, prev;
      for (var i22 = 0; i22 < length; i22 += 1) {
        token = tokens[i22];
        type = token[0];
        if (type === "space" && i22 === length - 1 && !customProperty) {
          clean = false;
        } else if (type === "comment") {
          prev = tokens[i22 - 1] ? tokens[i22 - 1][0] : "empty";
          next = tokens[i22 + 1] ? tokens[i22 + 1][0] : "empty";
          if (!SAFE_COMMENT_NEIGHBOR$1[prev] && !SAFE_COMMENT_NEIGHBOR$1[next]) {
            if (value.slice(-1) === ",") {
              clean = false;
            } else {
              value += token[1];
            }
          } else {
            clean = false;
          }
        } else {
          value += token[1];
        }
      }
      if (!clean) {
        var raw2 = tokens.reduce(function(all, i23) {
          return all + i23[1];
        }, "");
        node2.raws[prop] = {
          raw: raw2,
          value
        };
      }
      node2[prop] = value;
    };
    _proto.rule = function rule2(tokens) {
      tokens.pop();
      var node2 = new Rule$2$1();
      this.init(node2, tokens[0][2]);
      node2.raws.between = this.spacesAndCommentsFromEnd(tokens);
      this.raw(node2, "selector", tokens);
      this.current = node2;
    };
    _proto.spacesAndCommentsFromEnd = function spacesAndCommentsFromEnd(tokens) {
      var lastTokenType;
      var spaces = "";
      while (tokens.length) {
        lastTokenType = tokens[tokens.length - 1][0];
        if (lastTokenType !== "space" && lastTokenType !== "comment") break;
        spaces = tokens.pop()[1] + spaces;
      }
      return spaces;
    };
    _proto.spacesAndCommentsFromStart = function spacesAndCommentsFromStart(tokens) {
      var next;
      var spaces = "";
      while (tokens.length) {
        next = tokens[0][0];
        if (next !== "space" && next !== "comment") break;
        spaces += tokens.shift()[1];
      }
      return spaces;
    };
    _proto.spacesFromEnd = function spacesFromEnd(tokens) {
      var lastTokenType;
      var spaces = "";
      while (tokens.length) {
        lastTokenType = tokens[tokens.length - 1][0];
        if (lastTokenType !== "space") break;
        spaces = tokens.pop()[1] + spaces;
      }
      return spaces;
    };
    _proto.stringFrom = function stringFrom(tokens, from) {
      var result2 = "";
      for (var i22 = from; i22 < tokens.length; i22++) {
        result2 += tokens[i22][1];
      }
      tokens.splice(from, tokens.length - from);
      return result2;
    };
    _proto.unclosedBlock = function unclosedBlock() {
      var pos = this.current.source.start;
      throw this.input.error("Unclosed block", pos.line, pos.column);
    };
    _proto.unclosedBracket = function unclosedBracket(bracket) {
      throw this.input.error("Unclosed bracket", {
        offset: bracket[2]
      }, {
        offset: bracket[2] + 1
      });
    };
    _proto.unexpectedClose = function unexpectedClose(token) {
      throw this.input.error("Unexpected }", {
        offset: token[2]
      }, {
        offset: token[2] + 1
      });
    };
    _proto.unknownWord = function unknownWord(tokens) {
      throw this.input.error("Unknown word", {
        offset: tokens[0][2]
      }, {
        offset: tokens[0][2] + tokens[0][1].length
      });
    };
    _proto.unnamedAtrule = function unnamedAtrule(node2, token) {
      throw this.input.error("At-rule without name", {
        offset: token[2]
      }, {
        offset: token[2] + token[1].length
      });
    };
    return Parser;
  })();
  var parser$1 = Parser$1$1;
  var Container$2$1 = container$1;
  var Parser2$1 = parser$1;
  var Input$2$1 = input$1;
  function parse$3$1(css, opts) {
    var input2 = new Input$2$1(css, opts);
    var parser2 = new Parser2$1(input2);
    try {
      parser2.parse();
    } catch (e22) {
      if (true) {
        if (e22.name === "CssSyntaxError" && opts && opts.from) {
          if (/\.scss$/i.test(opts.from)) {
            e22.message += "\nYou tried to parse SCSS with the standard CSS parser; try again with the postcss-scss parser";
          } else if (/\.sass/i.test(opts.from)) {
            e22.message += "\nYou tried to parse Sass with the standard CSS parser; try again with the postcss-sass parser";
          } else if (/\.less$/i.test(opts.from)) {
            e22.message += "\nYou tried to parse Less with the standard CSS parser; try again with the postcss-less parser";
          }
        }
      }
      throw e22;
    }
    return parser2.root;
  }
  var parse_1$1 = parse$3$1;
  parse$3$1.default = parse$3$1;
  Container$2$1.registerParse(parse$3$1);
  var isClean$3 = symbols$1.isClean;
  var my$3 = symbols$1.my;
  var MapGenerator$1$1 = mapGenerator$1;
  var stringify$2$1 = stringify_1$1;
  var Container$1$1 = container$1;
  var Document$2$1 = document$1$1;
  var warnOnce$1$1 = warnOnce$2$1;
  var Result$2$1 = result$1;
  var parse$2$1 = parse_1$1;
  var Root$3$1 = root$1;
  var TYPE_TO_CLASS_NAME$1 = {
    atrule: "AtRule",
    comment: "Comment",
    decl: "Declaration",
    document: "Document",
    root: "Root",
    rule: "Rule"
  };
  var PLUGIN_PROPS$1 = {
    AtRule: true,
    AtRuleExit: true,
    Comment: true,
    CommentExit: true,
    Declaration: true,
    DeclarationExit: true,
    Document: true,
    DocumentExit: true,
    Once: true,
    OnceExit: true,
    postcssPlugin: true,
    prepare: true,
    Root: true,
    RootExit: true,
    Rule: true,
    RuleExit: true
  };
  var NOT_VISITORS$1 = {
    Once: true,
    postcssPlugin: true,
    prepare: true
  };
  var CHILDREN$1 = 0;
  function isPromise$1(obj) {
    return (typeof obj === "undefined" ? "undefined" : _type_of(obj)) === "object" && typeof obj.then === "function";
  }
  function getEvents$1(node2) {
    var key = false;
    var type = TYPE_TO_CLASS_NAME$1[node2.type];
    if (node2.type === "decl") {
      key = node2.prop.toLowerCase();
    } else if (node2.type === "atrule") {
      key = node2.name.toLowerCase();
    }
    if (key && node2.append) {
      return [
        type,
        type + "-" + key,
        CHILDREN$1,
        type + "Exit",
        type + "Exit-" + key
      ];
    } else if (key) {
      return [
        type,
        type + "-" + key,
        type + "Exit",
        type + "Exit-" + key
      ];
    } else if (node2.append) {
      return [
        type,
        CHILDREN$1,
        type + "Exit"
      ];
    } else {
      return [
        type,
        type + "Exit"
      ];
    }
  }
  function toStack$1(node2) {
    var events;
    if (node2.type === "document") {
      events = [
        "Document",
        CHILDREN$1,
        "DocumentExit"
      ];
    } else if (node2.type === "root") {
      events = [
        "Root",
        CHILDREN$1,
        "RootExit"
      ];
    } else {
      events = getEvents$1(node2);
    }
    return {
      eventIndex: 0,
      events,
      iterator: 0,
      node: node2,
      visitorIndex: 0,
      visitors: []
    };
  }
  function cleanMarks$1(node2) {
    node2[isClean$3] = false;
    if (node2.nodes) node2.nodes.forEach(function(i22) {
      return cleanMarks$1(i22);
    });
    return node2;
  }
  var postcss$2$1 = {};
  var LazyResult$2$1 = /* @__PURE__ */ (function() {
    function LazyResult(processor2, css, opts) {
      var _this = this;
      this.stringified = false;
      this.processed = false;
      var root2;
      if ((typeof css === "undefined" ? "undefined" : _type_of(css)) === "object" && css !== null && (css.type === "root" || css.type === "document")) {
        root2 = cleanMarks$1(css);
      } else if (_instanceof(css, LazyResult) || _instanceof(css, Result$2$1)) {
        root2 = cleanMarks$1(css.root);
        if (css.map) {
          if (typeof opts.map === "undefined") opts.map = {};
          if (!opts.map.inline) opts.map.inline = false;
          opts.map.prev = css.map;
        }
      } else {
        var parser2 = parse$2$1;
        if (opts.syntax) parser2 = opts.syntax.parse;
        if (opts.parser) parser2 = opts.parser;
        if (parser2.parse) parser2 = parser2.parse;
        try {
          root2 = parser2(css, opts);
        } catch (error) {
          this.processed = true;
          this.error = error;
        }
        if (root2 && !root2[my$3]) {
          Container$1$1.rebuild(root2);
        }
      }
      this.result = new Result$2$1(processor2, root2, opts);
      this.helpers = _extends({}, postcss$2$1, {
        postcss: postcss$2$1,
        result: this.result
      });
      this.plugins = this.processor.plugins.map(function(plugin22) {
        if ((typeof plugin22 === "undefined" ? "undefined" : _type_of(plugin22)) === "object" && plugin22.prepare) {
          return _extends({}, plugin22, plugin22.prepare(_this.result));
        } else {
          return plugin22;
        }
      });
    }
    var _proto = LazyResult.prototype;
    _proto.async = function async() {
      if (this.error) return Promise.reject(this.error);
      if (this.processed) return Promise.resolve(this.result);
      if (!this.processing) {
        this.processing = this.runAsync();
      }
      return this.processing;
    };
    _proto.catch = function _catch(onRejected) {
      return this.async().catch(onRejected);
    };
    _proto.finally = function _finally(onFinally) {
      return this.async().then(onFinally, onFinally);
    };
    _proto.getAsyncError = function getAsyncError() {
      throw new Error("Use process(css).then(cb) to work with async plugins");
    };
    _proto.handleError = function handleError(error, node2) {
      var plugin22 = this.result.lastPlugin;
      try {
        if (node2) node2.addToError(error);
        this.error = error;
        if (error.name === "CssSyntaxError" && !error.plugin) {
          error.plugin = plugin22.postcssPlugin;
          error.setMessage();
        } else if (plugin22.postcssVersion) {
          if (true) {
            var pluginName = plugin22.postcssPlugin;
            var pluginVer = plugin22.postcssVersion;
            var runtimeVer = this.result.processor.version;
            var a22 = pluginVer.split(".");
            var b2 = runtimeVer.split(".");
            if (a22[0] !== b2[0] || parseInt(a22[1]) > parseInt(b2[1])) {
              console.error("Unknown error from PostCSS plugin. Your current PostCSS version is " + runtimeVer + ", but " + pluginName + " uses " + pluginVer + ". Perhaps this is the source of the error below.");
            }
          }
        }
      } catch (err) {
        if (console && console.error) console.error(err);
      }
      return error;
    };
    _proto.prepareVisitors = function prepareVisitors() {
      var _this = this;
      this.listeners = {};
      var add = function(plugin222, type, cb) {
        if (!_this.listeners[type]) _this.listeners[type] = [];
        _this.listeners[type].push([
          plugin222,
          cb
        ]);
      };
      for (var _iterator = _create_for_of_iterator_helper_loose(this.plugins), _step; !(_step = _iterator()).done; ) {
        var plugin22 = _step.value;
        if ((typeof plugin22 === "undefined" ? "undefined" : _type_of(plugin22)) === "object") {
          for (var event in plugin22) {
            if (!PLUGIN_PROPS$1[event] && /^[A-Z]/.test(event)) {
              throw new Error("Unknown event " + event + " in " + plugin22.postcssPlugin + ". Try to update PostCSS (" + this.processor.version + " now).");
            }
            if (!NOT_VISITORS$1[event]) {
              if (_type_of(plugin22[event]) === "object") {
                for (var filter in plugin22[event]) {
                  if (filter === "*") {
                    add(plugin22, event, plugin22[event][filter]);
                  } else {
                    add(plugin22, event + "-" + filter.toLowerCase(), plugin22[event][filter]);
                  }
                }
              } else if (typeof plugin22[event] === "function") {
                add(plugin22, event, plugin22[event]);
              }
            }
          }
        }
      }
      this.hasListener = Object.keys(this.listeners).length > 0;
    };
    _proto.runAsync = function runAsync() {
      var _this = this;
      return _async_to_generator(function() {
        var i22, plugin22, promise, error, root2, stack, promise1, e22, node2, _loop, _iterator, _step;
        return _ts_generator(this, function(_state) {
          switch (_state.label) {
            case 0:
              _this.plugin = 0;
              i22 = 0;
              _state.label = 1;
            case 1:
              if (!(i22 < _this.plugins.length)) return [
                3,
                6
              ];
              plugin22 = _this.plugins[i22];
              promise = _this.runOnRoot(plugin22);
              if (!isPromise$1(promise)) return [
                3,
                5
              ];
              _state.label = 2;
            case 2:
              _state.trys.push([
                2,
                4,
                ,
                5
              ]);
              return [
                4,
                promise
              ];
            case 3:
              _state.sent();
              return [
                3,
                5
              ];
            case 4:
              error = _state.sent();
              throw _this.handleError(error);
            case 5:
              i22++;
              return [
                3,
                1
              ];
            case 6:
              _this.prepareVisitors();
              if (!_this.hasListener) return [
                3,
                18
              ];
              root2 = _this.result.root;
              _state.label = 7;
            case 7:
              if (!!root2[isClean$3]) return [
                3,
                14
              ];
              root2[isClean$3] = true;
              stack = [
                toStack$1(root2)
              ];
              _state.label = 8;
            case 8:
              if (!(stack.length > 0)) return [
                3,
                13
              ];
              promise1 = _this.visitTick(stack);
              if (!isPromise$1(promise1)) return [
                3,
                12
              ];
              _state.label = 9;
            case 9:
              _state.trys.push([
                9,
                11,
                ,
                12
              ]);
              return [
                4,
                promise1
              ];
            case 10:
              _state.sent();
              return [
                3,
                12
              ];
            case 11:
              e22 = _state.sent();
              node2 = stack[stack.length - 1].node;
              throw _this.handleError(e22, node2);
            case 12:
              return [
                3,
                8
              ];
            case 13:
              return [
                3,
                7
              ];
            case 14:
              if (!_this.listeners.OnceExit) return [
                3,
                18
              ];
              _loop = function() {
                var _step_value, plugin222, visitor, roots, e23;
                return _ts_generator(this, function(_state2) {
                  switch (_state2.label) {
                    case 0:
                      _step_value = _step.value, plugin222 = _step_value[0], visitor = _step_value[1];
                      _this.result.lastPlugin = plugin222;
                      _state2.label = 1;
                    case 1:
                      _state2.trys.push([
                        1,
                        6,
                        ,
                        7
                      ]);
                      if (!(root2.type === "document")) return [
                        3,
                        3
                      ];
                      roots = root2.nodes.map(function(subRoot) {
                        return visitor(subRoot, _this.helpers);
                      });
                      return [
                        4,
                        Promise.all(roots)
                      ];
                    case 2:
                      _state2.sent();
                      return [
                        3,
                        5
                      ];
                    case 3:
                      return [
                        4,
                        visitor(root2, _this.helpers)
                      ];
                    case 4:
                      _state2.sent();
                      _state2.label = 5;
                    case 5:
                      return [
                        3,
                        7
                      ];
                    case 6:
                      e23 = _state2.sent();
                      throw _this.handleError(e23);
                    case 7:
                      return [
                        2
                      ];
                  }
                });
              };
              _iterator = _create_for_of_iterator_helper_loose(_this.listeners.OnceExit);
              _state.label = 15;
            case 15:
              if (!!(_step = _iterator()).done) return [
                3,
                18
              ];
              return [
                5,
                _ts_values(_loop())
              ];
            case 16:
              _state.sent();
              _state.label = 17;
            case 17:
              return [
                3,
                15
              ];
            case 18:
              _this.processed = true;
              return [
                2,
                _this.stringify()
              ];
          }
        });
      })();
    };
    _proto.runOnRoot = function runOnRoot(plugin22) {
      var _this = this;
      this.result.lastPlugin = plugin22;
      try {
        if ((typeof plugin22 === "undefined" ? "undefined" : _type_of(plugin22)) === "object" && plugin22.Once) {
          if (this.result.root.type === "document") {
            var roots = this.result.root.nodes.map(function(root2) {
              return plugin22.Once(root2, _this.helpers);
            });
            if (isPromise$1(roots[0])) {
              return Promise.all(roots);
            }
            return roots;
          }
          return plugin22.Once(this.result.root, this.helpers);
        } else if (typeof plugin22 === "function") {
          return plugin22(this.result.root, this.result);
        }
      } catch (error) {
        throw this.handleError(error);
      }
    };
    _proto.stringify = function stringify2() {
      if (this.error) throw this.error;
      if (this.stringified) return this.result;
      this.stringified = true;
      this.sync();
      var opts = this.result.opts;
      var str = stringify$2$1;
      if (opts.syntax) str = opts.syntax.stringify;
      if (opts.stringifier) str = opts.stringifier;
      if (str.stringify) str = str.stringify;
      var map = new MapGenerator$1$1(str, this.result.root, this.result.opts);
      var data = map.generate();
      this.result.css = data[0];
      this.result.map = data[1];
      return this.result;
    };
    _proto.sync = function sync() {
      if (this.error) throw this.error;
      if (this.processed) return this.result;
      this.processed = true;
      if (this.processing) {
        throw this.getAsyncError();
      }
      for (var _iterator = _create_for_of_iterator_helper_loose(this.plugins), _step; !(_step = _iterator()).done; ) {
        var plugin22 = _step.value;
        var promise = this.runOnRoot(plugin22);
        if (isPromise$1(promise)) {
          throw this.getAsyncError();
        }
      }
      this.prepareVisitors();
      if (this.hasListener) {
        var root2 = this.result.root;
        while (!root2[isClean$3]) {
          root2[isClean$3] = true;
          this.walkSync(root2);
        }
        if (this.listeners.OnceExit) {
          if (root2.type === "document") {
            for (var _iterator1 = _create_for_of_iterator_helper_loose(root2.nodes), _step1; !(_step1 = _iterator1()).done; ) {
              var subRoot = _step1.value;
              this.visitSync(this.listeners.OnceExit, subRoot);
            }
          } else {
            this.visitSync(this.listeners.OnceExit, root2);
          }
        }
      }
      return this.result;
    };
    _proto.then = function then(onFulfilled, onRejected) {
      if (true) {
        if (!("from" in this.opts)) {
          warnOnce$1$1("Without `from` option PostCSS could generate wrong source map and will not find Browserslist config. Set it to CSS file path or to `undefined` to prevent this warning.");
        }
      }
      return this.async().then(onFulfilled, onRejected);
    };
    _proto.toString = function toString2() {
      return this.css;
    };
    _proto.visitSync = function visitSync(visitors, node2) {
      for (var _iterator = _create_for_of_iterator_helper_loose(visitors), _step; !(_step = _iterator()).done; ) {
        var _step_value = _step.value, plugin22 = _step_value[0], visitor = _step_value[1];
        this.result.lastPlugin = plugin22;
        var promise = void 0;
        try {
          promise = visitor(node2, this.helpers);
        } catch (e22) {
          throw this.handleError(e22, node2.proxyOf);
        }
        if (node2.type !== "root" && node2.type !== "document" && !node2.parent) {
          return true;
        }
        if (isPromise$1(promise)) {
          throw this.getAsyncError();
        }
      }
    };
    _proto.visitTick = function visitTick(stack) {
      var visit2 = stack[stack.length - 1];
      var node2 = visit2.node, visitors = visit2.visitors;
      if (node2.type !== "root" && node2.type !== "document" && !node2.parent) {
        stack.pop();
        return;
      }
      if (visitors.length > 0 && visit2.visitorIndex < visitors.length) {
        var _visitors_visit2_visitorIndex = visitors[visit2.visitorIndex], plugin22 = _visitors_visit2_visitorIndex[0], visitor = _visitors_visit2_visitorIndex[1];
        visit2.visitorIndex += 1;
        if (visit2.visitorIndex === visitors.length) {
          visit2.visitors = [];
          visit2.visitorIndex = 0;
        }
        this.result.lastPlugin = plugin22;
        try {
          return visitor(node2.toProxy(), this.helpers);
        } catch (e22) {
          throw this.handleError(e22, node2);
        }
      }
      if (visit2.iterator !== 0) {
        var iterator = visit2.iterator;
        var child;
        while (child = node2.nodes[node2.indexes[iterator]]) {
          node2.indexes[iterator] += 1;
          if (!child[isClean$3]) {
            child[isClean$3] = true;
            stack.push(toStack$1(child));
            return;
          }
        }
        visit2.iterator = 0;
        delete node2.indexes[iterator];
      }
      var events = visit2.events;
      while (visit2.eventIndex < events.length) {
        var event = events[visit2.eventIndex];
        visit2.eventIndex += 1;
        if (event === CHILDREN$1) {
          if (node2.nodes && node2.nodes.length) {
            node2[isClean$3] = true;
            visit2.iterator = node2.getIterator();
          }
          return;
        } else if (this.listeners[event]) {
          visit2.visitors = this.listeners[event];
          return;
        }
      }
      stack.pop();
    };
    _proto.walkSync = function walkSync(node2) {
      var _this = this;
      node2[isClean$3] = true;
      var events = getEvents$1(node2);
      for (var _iterator = _create_for_of_iterator_helper_loose(events), _step; !(_step = _iterator()).done; ) {
        var event = _step.value;
        if (event === CHILDREN$1) {
          if (node2.nodes) {
            node2.each(function(child) {
              if (!child[isClean$3]) _this.walkSync(child);
            });
          }
        } else {
          var visitors = this.listeners[event];
          if (visitors) {
            if (this.visitSync(visitors, node2.toProxy())) return;
          }
        }
      }
    };
    _proto.warnings = function warnings() {
      return this.sync().warnings();
    };
    _create_class(LazyResult, [
      {
        key: "content",
        get: function get() {
          return this.stringify().content;
        }
      },
      {
        key: "css",
        get: function get() {
          return this.stringify().css;
        }
      },
      {
        key: "map",
        get: function get() {
          return this.stringify().map;
        }
      },
      {
        key: "messages",
        get: function get() {
          return this.sync().messages;
        }
      },
      {
        key: "opts",
        get: function get() {
          return this.result.opts;
        }
      },
      {
        key: "processor",
        get: function get() {
          return this.result.processor;
        }
      },
      {
        key: "root",
        get: function get() {
          return this.sync().root;
        }
      },
      {
        key: Symbol.toStringTag,
        get: function get() {
          return "LazyResult";
        }
      }
    ]);
    return LazyResult;
  })();
  LazyResult$2$1.registerPostcss = function(dependant) {
    postcss$2$1 = dependant;
  };
  var lazyResult$1 = LazyResult$2$1;
  LazyResult$2$1.default = LazyResult$2$1;
  Root$3$1.registerLazyResult(LazyResult$2$1);
  Document$2$1.registerLazyResult(LazyResult$2$1);
  var MapGenerator2$1 = mapGenerator$1;
  var stringify$1$1 = stringify_1$1;
  var warnOnce2$1 = warnOnce$2$1;
  var parse$1$1 = parse_1$1;
  var Result$1$1 = result$1;
  var NoWorkResult$1$1 = /* @__PURE__ */ (function() {
    function NoWorkResult(processor2, css, opts) {
      css = css.toString();
      this.stringified = false;
      this._processor = processor2;
      this._css = css;
      this._opts = opts;
      this._map = void 0;
      var root2;
      var str = stringify$1$1;
      this.result = new Result$1$1(this._processor, root2, this._opts);
      this.result.css = css;
      var self2 = this;
      Object.defineProperty(this.result, "root", {
        get: function get() {
          return self2.root;
        }
      });
      var map = new MapGenerator2$1(str, root2, this._opts, css);
      if (map.isMap()) {
        var _map_generate = map.generate(), generatedCSS = _map_generate[0], generatedMap = _map_generate[1];
        if (generatedCSS) {
          this.result.css = generatedCSS;
        }
        if (generatedMap) {
          this.result.map = generatedMap;
        }
      } else {
        map.clearAnnotation();
        this.result.css = map.css;
      }
    }
    var _proto = NoWorkResult.prototype;
    _proto.async = function async() {
      if (this.error) return Promise.reject(this.error);
      return Promise.resolve(this.result);
    };
    _proto.catch = function _catch(onRejected) {
      return this.async().catch(onRejected);
    };
    _proto.finally = function _finally(onFinally) {
      return this.async().then(onFinally, onFinally);
    };
    _proto.sync = function sync() {
      if (this.error) throw this.error;
      return this.result;
    };
    _proto.then = function then(onFulfilled, onRejected) {
      if (true) {
        if (!("from" in this._opts)) {
          warnOnce2$1("Without `from` option PostCSS could generate wrong source map and will not find Browserslist config. Set it to CSS file path or to `undefined` to prevent this warning.");
        }
      }
      return this.async().then(onFulfilled, onRejected);
    };
    _proto.toString = function toString2() {
      return this._css;
    };
    _proto.warnings = function warnings() {
      return [];
    };
    _create_class(NoWorkResult, [
      {
        key: "content",
        get: function get() {
          return this.result.css;
        }
      },
      {
        key: "css",
        get: function get() {
          return this.result.css;
        }
      },
      {
        key: "map",
        get: function get() {
          return this.result.map;
        }
      },
      {
        key: "messages",
        get: function get() {
          return [];
        }
      },
      {
        key: "opts",
        get: function get() {
          return this.result.opts;
        }
      },
      {
        key: "processor",
        get: function get() {
          return this.result.processor;
        }
      },
      {
        key: "root",
        get: function get() {
          if (this._root) {
            return this._root;
          }
          var root2;
          var parser2 = parse$1$1;
          try {
            root2 = parser2(this._css, this._opts);
          } catch (error) {
            this.error = error;
          }
          if (this.error) {
            throw this.error;
          } else {
            this._root = root2;
            return root2;
          }
        }
      },
      {
        key: Symbol.toStringTag,
        get: function get() {
          return "NoWorkResult";
        }
      }
    ]);
    return NoWorkResult;
  })();
  var noWorkResult$1 = NoWorkResult$1$1;
  NoWorkResult$1$1.default = NoWorkResult$1$1;
  var NoWorkResult2$1 = noWorkResult$1;
  var LazyResult$1$1 = lazyResult$1;
  var Document$1$1 = document$1$1;
  var Root$2$1 = root$1;
  var Processor$1$1 = /* @__PURE__ */ (function() {
    function Processor(plugins) {
      if (plugins === void 0) plugins = [];
      this.version = "8.4.38";
      this.plugins = this.normalize(plugins);
    }
    var _proto = Processor.prototype;
    _proto.normalize = function normalize(plugins) {
      var normalized = [];
      for (var _iterator = _create_for_of_iterator_helper_loose(plugins), _step; !(_step = _iterator()).done; ) {
        var i22 = _step.value;
        if (i22.postcss === true) {
          i22 = i22();
        } else if (i22.postcss) {
          i22 = i22.postcss;
        }
        if ((typeof i22 === "undefined" ? "undefined" : _type_of(i22)) === "object" && Array.isArray(i22.plugins)) {
          normalized = normalized.concat(i22.plugins);
        } else if ((typeof i22 === "undefined" ? "undefined" : _type_of(i22)) === "object" && i22.postcssPlugin) {
          normalized.push(i22);
        } else if (typeof i22 === "function") {
          normalized.push(i22);
        } else if ((typeof i22 === "undefined" ? "undefined" : _type_of(i22)) === "object" && (i22.parse || i22.stringify)) {
          if (true) {
            throw new Error("PostCSS syntaxes cannot be used as plugins. Instead, please use one of the syntax/parser/stringifier options as outlined in your PostCSS runner documentation.");
          }
        } else {
          throw new Error(i22 + " is not a PostCSS plugin");
        }
      }
      return normalized;
    };
    _proto.process = function process1(css, opts) {
      if (opts === void 0) opts = {};
      if (!this.plugins.length && !opts.parser && !opts.stringifier && !opts.syntax) {
        return new NoWorkResult2$1(this, css, opts);
      } else {
        return new LazyResult$1$1(this, css, opts);
      }
    };
    _proto.use = function use(plugin22) {
      this.plugins = this.plugins.concat(this.normalize([
        plugin22
      ]));
      return this;
    };
    return Processor;
  })();
  var processor$1 = Processor$1$1;
  Processor$1$1.default = Processor$1$1;
  Root$2$1.registerProcessor(Processor$1$1);
  Document$1$1.registerProcessor(Processor$1$1);
  var Declaration$1$1 = declaration$1;
  var PreviousMap2$1 = previousMap$1;
  var Comment$1$1 = comment$1;
  var AtRule$1$1 = atRule$1;
  var Input$1$1 = input$1;
  var Root$1$1 = root$1;
  var Rule$1$1 = rule$1;
  function fromJSON$1$1(json, inputs) {
    if (Array.isArray(json)) return json.map(function(n22) {
      return fromJSON$1$1(n22);
    });
    var ownInputs = json.inputs, defaults = _object_without_properties_loose(json, [
      "inputs"
    ]);
    if (ownInputs) {
      inputs = [];
      for (var _iterator = _create_for_of_iterator_helper_loose(ownInputs), _step; !(_step = _iterator()).done; ) {
        var input2 = _step.value;
        var inputHydrated = _extends({}, input2, {
          __proto__: Input$1$1.prototype
        });
        if (inputHydrated.map) {
          inputHydrated.map = _extends({}, inputHydrated.map, {
            __proto__: PreviousMap2$1.prototype
          });
        }
        inputs.push(inputHydrated);
      }
    }
    if (defaults.nodes) {
      defaults.nodes = json.nodes.map(function(n22) {
        return fromJSON$1$1(n22, inputs);
      });
    }
    if (defaults.source) {
      var _defaults_source = defaults.source, inputId = _defaults_source.inputId, source = _object_without_properties_loose(_defaults_source, [
        "inputId"
      ]);
      defaults.source = source;
      if (inputId != null) {
        defaults.source.input = inputs[inputId];
      }
    }
    if (defaults.type === "root") {
      return new Root$1$1(defaults);
    } else if (defaults.type === "decl") {
      return new Declaration$1$1(defaults);
    } else if (defaults.type === "rule") {
      return new Rule$1$1(defaults);
    } else if (defaults.type === "comment") {
      return new Comment$1$1(defaults);
    } else if (defaults.type === "atrule") {
      return new AtRule$1$1(defaults);
    } else {
      throw new Error("Unknown node type: " + json.type);
    }
  }
  var fromJSON_1$1 = fromJSON$1$1;
  fromJSON$1$1.default = fromJSON$1$1;
  var CssSyntaxError2$1 = cssSyntaxError$1;
  var Declaration2$1 = declaration$1;
  var LazyResult2$1 = lazyResult$1;
  var Container2$1 = container$1;
  var Processor2$1 = processor$1;
  var stringify$5$1 = stringify_1$1;
  var fromJSON$2 = fromJSON_1$1;
  var Document22 = document$1$1;
  var Warning2$1 = warning$1;
  var Comment2$1 = comment$1;
  var AtRule2$1 = atRule$1;
  var Result2$1 = result$1;
  var Input2$1 = input$1;
  var parse$5 = parse_1$1;
  var list$3 = list_1$1;
  var Rule2$1 = rule$1;
  var Root2$1 = root$1;
  var Node2$1 = node$1;
  function postcss$3() {
    for (var _len = arguments.length, plugins = new Array(_len), _key = 0; _key < _len; _key++) {
      plugins[_key] = arguments[_key];
    }
    if (plugins.length === 1 && Array.isArray(plugins[0])) {
      plugins = plugins[0];
    }
    return new Processor2$1(plugins);
  }
  postcss$3.plugin = function plugin(name, initializer) {
    var warningPrinted = false;
    function creator() {
      for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {
        args[_key] = arguments[_key];
      }
      if (console && console.warn && !warningPrinted) {
        warningPrinted = true;
        console.warn(name + ": postcss.plugin was deprecated. Migration guide:\nhttps://evilmartians.com/chronicles/postcss-8-plugin-migration");
        if (process.env.LANG && process.env.LANG.startsWith("cn")) {
          console.warn(name + ": \u91CC\u9762 postcss.plugin \u88AB\u5F03\u7528. \u8FC1\u79FB\u6307\u5357:\nhttps://www.w3ctech.com/topic/2226");
        }
      }
      var transformer = initializer.apply(void 0, [].concat(args));
      transformer.postcssPlugin = name;
      transformer.postcssVersion = new Processor2$1().version;
      return transformer;
    }
    var cache;
    Object.defineProperty(creator, "postcss", {
      get: function get() {
        if (!cache) cache = creator();
        return cache;
      }
    });
    creator.process = function(css, processOpts, pluginOpts) {
      return postcss$3([
        creator(pluginOpts)
      ]).process(css, processOpts);
    };
    return creator;
  };
  postcss$3.stringify = stringify$5$1;
  postcss$3.parse = parse$5;
  postcss$3.fromJSON = fromJSON$2;
  postcss$3.list = list$3;
  postcss$3.comment = function(defaults) {
    return new Comment2$1(defaults);
  };
  postcss$3.atRule = function(defaults) {
    return new AtRule2$1(defaults);
  };
  postcss$3.decl = function(defaults) {
    return new Declaration2$1(defaults);
  };
  postcss$3.rule = function(defaults) {
    return new Rule2$1(defaults);
  };
  postcss$3.root = function(defaults) {
    return new Root2$1(defaults);
  };
  postcss$3.document = function(defaults) {
    return new Document22(defaults);
  };
  postcss$3.CssSyntaxError = CssSyntaxError2$1;
  postcss$3.Declaration = Declaration2$1;
  postcss$3.Container = Container2$1;
  postcss$3.Processor = Processor2$1;
  postcss$3.Document = Document22;
  postcss$3.Comment = Comment2$1;
  postcss$3.Warning = Warning2$1;
  postcss$3.AtRule = AtRule2$1;
  postcss$3.Result = Result2$1;
  postcss$3.Input = Input2$1;
  postcss$3.Rule = Rule2$1;
  postcss$3.Root = Root2$1;
  postcss$3.Node = Node2$1;
  LazyResult2$1.registerPostcss(postcss$3);
  var postcss_1$1 = postcss$3;
  postcss$3.default = postcss$3;
  var postcss$1$1 = /* @__PURE__ */ getDefaultExportFromCjs$1(postcss_1$1);
  postcss$1$1.stringify;
  postcss$1$1.fromJSON;
  postcss$1$1.plugin;
  postcss$1$1.parse;
  postcss$1$1.list;
  postcss$1$1.document;
  postcss$1$1.comment;
  postcss$1$1.atRule;
  postcss$1$1.rule;
  postcss$1$1.decl;
  postcss$1$1.root;
  postcss$1$1.CssSyntaxError;
  postcss$1$1.Declaration;
  postcss$1$1.Container;
  postcss$1$1.Processor;
  postcss$1$1.Document;
  postcss$1$1.Comment;
  postcss$1$1.Warning;
  postcss$1$1.AtRule;
  postcss$1$1.Result;
  postcss$1$1.Input;
  postcss$1$1.Rule;
  postcss$1$1.Root;
  postcss$1$1.Node;
  var __defProp2 = Object.defineProperty;
  var __defNormalProp2 = function(obj, key, value) {
    return key in obj ? __defProp2(obj, key, {
      enumerable: true,
      configurable: true,
      writable: true,
      value
    }) : obj[key] = value;
  };
  var __publicField2 = function(obj, key, value) {
    return __defNormalProp2(obj, (typeof key === "undefined" ? "undefined" : _type_of(key)) !== "symbol" ? key + "" : key, value);
  };
  function getDefaultExportFromCjs$2(x22) {
    return x22 && x22.__esModule && Object.prototype.hasOwnProperty.call(x22, "default") ? x22["default"] : x22;
  }
  function getAugmentedNamespace$2(n22) {
    if (n22.__esModule) return n22;
    var f22 = n22.default;
    if (typeof f22 == "function") {
      var a22 = function a222() {
        if (_instanceof(this, a222)) {
          return Reflect.construct(f22, arguments, this.constructor);
        }
        return f22.apply(this, arguments);
      };
      a22.prototype = f22.prototype;
    } else a22 = {};
    Object.defineProperty(a22, "__esModule", {
      value: true
    });
    Object.keys(n22).forEach(function(k4) {
      var d3 = Object.getOwnPropertyDescriptor(n22, k4);
      Object.defineProperty(a22, k4, d3.get ? d3 : {
        enumerable: true,
        get: function get() {
          return n22[k4];
        }
      });
    });
    return a22;
  }
  var picocolors_browser$2 = {
    exports: {}
  };
  var x$2 = String;
  var create$2 = function create$22() {
    return {
      isColorSupported: false,
      reset: x$2,
      bold: x$2,
      dim: x$2,
      italic: x$2,
      underline: x$2,
      inverse: x$2,
      hidden: x$2,
      strikethrough: x$2,
      black: x$2,
      red: x$2,
      green: x$2,
      yellow: x$2,
      blue: x$2,
      magenta: x$2,
      cyan: x$2,
      white: x$2,
      gray: x$2,
      bgBlack: x$2,
      bgRed: x$2,
      bgGreen: x$2,
      bgYellow: x$2,
      bgBlue: x$2,
      bgMagenta: x$2,
      bgCyan: x$2,
      bgWhite: x$2
    };
  };
  picocolors_browser$2.exports = create$2();
  picocolors_browser$2.exports.createColors = create$2;
  var picocolors_browserExports$2 = picocolors_browser$2.exports;
  var __viteBrowserExternal$3 = {};
  var __viteBrowserExternal$1$2 = /* @__PURE__ */ Object.freeze(/* @__PURE__ */ Object.defineProperty({
    __proto__: null,
    default: __viteBrowserExternal$3
  }, Symbol.toStringTag, {
    value: "Module"
  }));
  var require$$2$2 = /* @__PURE__ */ getAugmentedNamespace$2(__viteBrowserExternal$1$2);
  var pico$2 = picocolors_browserExports$2;
  var terminalHighlight$1$2 = require$$2$2;
  var CssSyntaxError$3$2 = /* @__PURE__ */ (function(Error1) {
    _inherits(CssSyntaxError23, Error1);
    function CssSyntaxError23(message, line, column, source, file, plugin22) {
      var _this;
      _this = Error1.call(this, message) || this;
      _this.name = "CssSyntaxError";
      _this.reason = message;
      if (file) {
        _this.file = file;
      }
      if (source) {
        _this.source = source;
      }
      if (plugin22) {
        _this.plugin = plugin22;
      }
      if (typeof line !== "undefined" && typeof column !== "undefined") {
        if (typeof line === "number") {
          _this.line = line;
          _this.column = column;
        } else {
          _this.line = line.line;
          _this.column = line.column;
          _this.endLine = column.line;
          _this.endColumn = column.column;
        }
      }
      _this.setMessage();
      if (Error.captureStackTrace) {
        Error.captureStackTrace(_this, CssSyntaxError23);
      }
      return _this;
    }
    var _proto = CssSyntaxError23.prototype;
    _proto.setMessage = function setMessage() {
      this.message = this.plugin ? this.plugin + ": " : "";
      this.message += this.file ? this.file : "<css input>";
      if (typeof this.line !== "undefined") {
        this.message += ":" + this.line + ":" + this.column;
      }
      this.message += ": " + this.reason;
    };
    _proto.showSourceCode = function showSourceCode(color) {
      var _this = this;
      if (!this.source) return "";
      var css = this.source;
      if (color == null) color = pico$2.isColorSupported;
      if (terminalHighlight$1$2) {
        if (color) css = terminalHighlight$1$2(css);
      }
      var lines = css.split(/\r?\n/);
      var start = Math.max(this.line - 3, 0);
      var end = Math.min(this.line + 2, lines.length);
      var maxWidth = String(end).length;
      var mark, aside;
      if (color) {
        var _pico$2_createColors = pico$2.createColors(true), bold = _pico$2_createColors.bold, gray = _pico$2_createColors.gray, red = _pico$2_createColors.red;
        mark = function(text) {
          return bold(red(text));
        };
        aside = function(text) {
          return gray(text);
        };
      } else {
        mark = aside = function(str) {
          return str;
        };
      }
      return lines.slice(start, end).map(function(line, index2) {
        var number = start + 1 + index2;
        var gutter = " " + (" " + number).slice(-maxWidth) + " | ";
        if (number === _this.line) {
          var spacing = aside(gutter.replace(/\d/g, " ")) + line.slice(0, _this.column - 1).replace(/[^\t]/g, " ");
          return mark(">") + aside(gutter) + line + "\n " + spacing + mark("^");
        }
        return " " + aside(gutter) + line;
      }).join("\n");
    };
    _proto.toString = function toString2() {
      var code = this.showSourceCode();
      if (code) {
        code = "\n\n" + code + "\n";
      }
      return this.name + ": " + this.message + code;
    };
    return CssSyntaxError23;
  })(_wrap_native_super(Error));
  var cssSyntaxError$2 = CssSyntaxError$3$2;
  CssSyntaxError$3$2.default = CssSyntaxError$3$2;
  var symbols$2 = {};
  symbols$2.isClean = /* @__PURE__ */ Symbol("isClean");
  symbols$2.my = /* @__PURE__ */ Symbol("my");
  var DEFAULT_RAW$2 = {
    after: "\n",
    beforeClose: "\n",
    beforeComment: "\n",
    beforeDecl: "\n",
    beforeOpen: " ",
    beforeRule: "\n",
    colon: ": ",
    commentLeft: " ",
    commentRight: " ",
    emptyBody: "",
    indent: "    ",
    semicolon: false
  };
  function capitalize$2(str) {
    return str[0].toUpperCase() + str.slice(1);
  }
  var Stringifier$2$2 = /* @__PURE__ */ (function() {
    function Stringifier23(builder) {
      this.builder = builder;
    }
    var _proto = Stringifier23.prototype;
    _proto.atrule = function atrule(node2, semicolon) {
      var name = "@" + node2.name;
      var params = node2.params ? this.rawValue(node2, "params") : "";
      if (typeof node2.raws.afterName !== "undefined") {
        name += node2.raws.afterName;
      } else if (params) {
        name += " ";
      }
      if (node2.nodes) {
        this.block(node2, name + params);
      } else {
        var end = (node2.raws.between || "") + (semicolon ? ";" : "");
        this.builder(name + params + end, node2);
      }
    };
    _proto.beforeAfter = function beforeAfter(node2, detect) {
      var value;
      if (node2.type === "decl") {
        value = this.raw(node2, null, "beforeDecl");
      } else if (node2.type === "comment") {
        value = this.raw(node2, null, "beforeComment");
      } else if (detect === "before") {
        value = this.raw(node2, null, "beforeRule");
      } else {
        value = this.raw(node2, null, "beforeClose");
      }
      var buf = node2.parent;
      var depth = 0;
      while (buf && buf.type !== "root") {
        depth += 1;
        buf = buf.parent;
      }
      if (value.includes("\n")) {
        var indent = this.raw(node2, null, "indent");
        if (indent.length) {
          for (var step = 0; step < depth; step++) value += indent;
        }
      }
      return value;
    };
    _proto.block = function block(node2, start) {
      var between = this.raw(node2, "between", "beforeOpen");
      this.builder(start + between + "{", node2, "start");
      var after;
      if (node2.nodes && node2.nodes.length) {
        this.body(node2);
        after = this.raw(node2, "after");
      } else {
        after = this.raw(node2, "after", "emptyBody");
      }
      if (after) this.builder(after);
      this.builder("}", node2, "end");
    };
    _proto.body = function body(node2) {
      var last = node2.nodes.length - 1;
      while (last > 0) {
        if (node2.nodes[last].type !== "comment") break;
        last -= 1;
      }
      var semicolon = this.raw(node2, "semicolon");
      for (var i22 = 0; i22 < node2.nodes.length; i22++) {
        var child = node2.nodes[i22];
        var before = this.raw(child, "before");
        if (before) this.builder(before);
        this.stringify(child, last !== i22 || semicolon);
      }
    };
    _proto.comment = function comment2(node2) {
      var left = this.raw(node2, "left", "commentLeft");
      var right = this.raw(node2, "right", "commentRight");
      this.builder("/*" + left + node2.text + right + "*/", node2);
    };
    _proto.decl = function decl(node2, semicolon) {
      var between = this.raw(node2, "between", "colon");
      var string = node2.prop + between + this.rawValue(node2, "value");
      if (node2.important) {
        string += node2.raws.important || " !important";
      }
      if (semicolon) string += ";";
      this.builder(string, node2);
    };
    _proto.document = function document1(node2) {
      this.body(node2);
    };
    _proto.raw = function raw(node2, own, detect) {
      var value;
      if (!detect) detect = own;
      if (own) {
        value = node2.raws[own];
        if (typeof value !== "undefined") return value;
      }
      var parent = node2.parent;
      if (detect === "before") {
        if (!parent || parent.type === "root" && parent.first === node2) {
          return "";
        }
        if (parent && parent.type === "document") {
          return "";
        }
      }
      if (!parent) return DEFAULT_RAW$2[detect];
      var root2 = node2.root();
      if (!root2.rawCache) root2.rawCache = {};
      if (typeof root2.rawCache[detect] !== "undefined") {
        return root2.rawCache[detect];
      }
      if (detect === "before" || detect === "after") {
        return this.beforeAfter(node2, detect);
      } else {
        var method = "raw" + capitalize$2(detect);
        if (this[method]) {
          value = this[method](root2, node2);
        } else {
          root2.walk(function(i22) {
            value = i22.raws[own];
            if (typeof value !== "undefined") return false;
          });
        }
      }
      if (typeof value === "undefined") value = DEFAULT_RAW$2[detect];
      root2.rawCache[detect] = value;
      return value;
    };
    _proto.rawBeforeClose = function rawBeforeClose(root2) {
      var value;
      root2.walk(function(i22) {
        if (i22.nodes && i22.nodes.length > 0) {
          if (typeof i22.raws.after !== "undefined") {
            value = i22.raws.after;
            if (value.includes("\n")) {
              value = value.replace(/[^\n]+$/, "");
            }
            return false;
          }
        }
      });
      if (value) value = value.replace(/\S/g, "");
      return value;
    };
    _proto.rawBeforeComment = function rawBeforeComment(root2, node2) {
      var value;
      root2.walkComments(function(i22) {
        if (typeof i22.raws.before !== "undefined") {
          value = i22.raws.before;
          if (value.includes("\n")) {
            value = value.replace(/[^\n]+$/, "");
          }
          return false;
        }
      });
      if (typeof value === "undefined") {
        value = this.raw(node2, null, "beforeDecl");
      } else if (value) {
        value = value.replace(/\S/g, "");
      }
      return value;
    };
    _proto.rawBeforeDecl = function rawBeforeDecl(root2, node2) {
      var value;
      root2.walkDecls(function(i22) {
        if (typeof i22.raws.before !== "undefined") {
          value = i22.raws.before;
          if (value.includes("\n")) {
            value = value.replace(/[^\n]+$/, "");
          }
          return false;
        }
      });
      if (typeof value === "undefined") {
        value = this.raw(node2, null, "beforeRule");
      } else if (value) {
        value = value.replace(/\S/g, "");
      }
      return value;
    };
    _proto.rawBeforeOpen = function rawBeforeOpen(root2) {
      var value;
      root2.walk(function(i22) {
        if (i22.type !== "decl") {
          value = i22.raws.between;
          if (typeof value !== "undefined") return false;
        }
      });
      return value;
    };
    _proto.rawBeforeRule = function rawBeforeRule(root2) {
      var value;
      root2.walk(function(i22) {
        if (i22.nodes && (i22.parent !== root2 || root2.first !== i22)) {
          if (typeof i22.raws.before !== "undefined") {
            value = i22.raws.before;
            if (value.includes("\n")) {
              value = value.replace(/[^\n]+$/, "");
            }
            return false;
          }
        }
      });
      if (value) value = value.replace(/\S/g, "");
      return value;
    };
    _proto.rawColon = function rawColon(root2) {
      var value;
      root2.walkDecls(function(i22) {
        if (typeof i22.raws.between !== "undefined") {
          value = i22.raws.between.replace(/[^\s:]/g, "");
          return false;
        }
      });
      return value;
    };
    _proto.rawEmptyBody = function rawEmptyBody(root2) {
      var value;
      root2.walk(function(i22) {
        if (i22.nodes && i22.nodes.length === 0) {
          value = i22.raws.after;
          if (typeof value !== "undefined") return false;
        }
      });
      return value;
    };
    _proto.rawIndent = function rawIndent(root2) {
      if (root2.raws.indent) return root2.raws.indent;
      var value;
      root2.walk(function(i22) {
        var p3 = i22.parent;
        if (p3 && p3 !== root2 && p3.parent && p3.parent === root2) {
          if (typeof i22.raws.before !== "undefined") {
            var parts = i22.raws.before.split("\n");
            value = parts[parts.length - 1];
            value = value.replace(/\S/g, "");
            return false;
          }
        }
      });
      return value;
    };
    _proto.rawSemicolon = function rawSemicolon(root2) {
      var value;
      root2.walk(function(i22) {
        if (i22.nodes && i22.nodes.length && i22.last.type === "decl") {
          value = i22.raws.semicolon;
          if (typeof value !== "undefined") return false;
        }
      });
      return value;
    };
    _proto.rawValue = function rawValue(node2, prop) {
      var value = node2[prop];
      var raw = node2.raws[prop];
      if (raw && raw.value === value) {
        return raw.raw;
      }
      return value;
    };
    _proto.root = function root2(node2) {
      this.body(node2);
      if (node2.raws.after) this.builder(node2.raws.after);
    };
    _proto.rule = function rule2(node2) {
      this.block(node2, this.rawValue(node2, "selector"));
      if (node2.raws.ownSemicolon) {
        this.builder(node2.raws.ownSemicolon, node2, "end");
      }
    };
    _proto.stringify = function stringify2(node2, semicolon) {
      if (!this[node2.type]) {
        throw new Error("Unknown AST node type " + node2.type + ". Maybe you need to change PostCSS stringifier.");
      }
      this[node2.type](node2, semicolon);
    };
    return Stringifier23;
  })();
  var stringifier$2 = Stringifier$2$2;
  Stringifier$2$2.default = Stringifier$2$2;
  var Stringifier$1$2 = stringifier$2;
  function stringify$4$2(node2, builder) {
    var str = new Stringifier$1$2(builder);
    str.stringify(node2);
  }
  var stringify_1$2 = stringify$4$2;
  stringify$4$2.default = stringify$4$2;
  var isClean$2$2 = symbols$2.isClean;
  var my$2$2 = symbols$2.my;
  var CssSyntaxError$2$2 = cssSyntaxError$2;
  var Stringifier22 = stringifier$2;
  var stringify$3$2 = stringify_1$2;
  function cloneNode$2(obj, parent) {
    var cloned = new obj.constructor();
    for (var i22 in obj) {
      if (!Object.prototype.hasOwnProperty.call(obj, i22)) {
        continue;
      }
      if (i22 === "proxyCache") continue;
      var value = obj[i22];
      var type = typeof value === "undefined" ? "undefined" : _type_of(value);
      if (i22 === "parent" && type === "object") {
        if (parent) cloned[i22] = parent;
      } else if (i22 === "source") {
        cloned[i22] = value;
      } else if (Array.isArray(value)) {
        cloned[i22] = value.map(function(j4) {
          return cloneNode$2(j4, cloned);
        });
      } else {
        if (type === "object" && value !== null) value = cloneNode$2(value);
        cloned[i22] = value;
      }
    }
    return cloned;
  }
  var Node$4$2 = /* @__PURE__ */ (function() {
    function Node3(defaults) {
      if (defaults === void 0) defaults = {};
      this.raws = {};
      this[isClean$2$2] = false;
      this[my$2$2] = true;
      for (var name in defaults) {
        if (name === "nodes") {
          this.nodes = [];
          for (var _iterator = _create_for_of_iterator_helper_loose(defaults[name]), _step; !(_step = _iterator()).done; ) {
            var node2 = _step.value;
            if (typeof node2.clone === "function") {
              this.append(node2.clone());
            } else {
              this.append(node2);
            }
          }
        } else {
          this[name] = defaults[name];
        }
      }
    }
    var _proto = Node3.prototype;
    _proto.addToError = function addToError(error) {
      error.postcssNode = this;
      if (error.stack && this.source && /\n\s{4}at /.test(error.stack)) {
        var s22 = this.source;
        error.stack = error.stack.replace(/\n\s{4}at /, "$&" + s22.input.from + ":" + s22.start.line + ":" + s22.start.column + "$&");
      }
      return error;
    };
    _proto.after = function after(add) {
      this.parent.insertAfter(this, add);
      return this;
    };
    _proto.assign = function assign(overrides) {
      if (overrides === void 0) overrides = {};
      for (var name in overrides) {
        this[name] = overrides[name];
      }
      return this;
    };
    _proto.before = function before(add) {
      this.parent.insertBefore(this, add);
      return this;
    };
    _proto.cleanRaws = function cleanRaws(keepBetween) {
      delete this.raws.before;
      delete this.raws.after;
      if (!keepBetween) delete this.raws.between;
    };
    _proto.clone = function clone(overrides) {
      if (overrides === void 0) overrides = {};
      var cloned = cloneNode$2(this);
      for (var name in overrides) {
        cloned[name] = overrides[name];
      }
      return cloned;
    };
    _proto.cloneAfter = function cloneAfter(overrides) {
      if (overrides === void 0) overrides = {};
      var cloned = this.clone(overrides);
      this.parent.insertAfter(this, cloned);
      return cloned;
    };
    _proto.cloneBefore = function cloneBefore(overrides) {
      if (overrides === void 0) overrides = {};
      var cloned = this.clone(overrides);
      this.parent.insertBefore(this, cloned);
      return cloned;
    };
    _proto.error = function error(message, opts) {
      if (opts === void 0) opts = {};
      if (this.source) {
        var _this_rangeBy = this.rangeBy(opts), end = _this_rangeBy.end, start = _this_rangeBy.start;
        return this.source.input.error(message, {
          column: start.column,
          line: start.line
        }, {
          column: end.column,
          line: end.line
        }, opts);
      }
      return new CssSyntaxError$2$2(message);
    };
    _proto.getProxyProcessor = function getProxyProcessor() {
      return {
        get: function get(node2, prop) {
          if (prop === "proxyOf") {
            return node2;
          } else if (prop === "root") {
            return function() {
              return node2.root().toProxy();
            };
          } else {
            return node2[prop];
          }
        },
        set: function set(node2, prop, value) {
          if (node2[prop] === value) return true;
          node2[prop] = value;
          if (prop === "prop" || prop === "value" || prop === "name" || prop === "params" || prop === "important" || /* c8 ignore next */
          prop === "text") {
            node2.markDirty();
          }
          return true;
        }
      };
    };
    _proto.markDirty = function markDirty() {
      if (this[isClean$2$2]) {
        this[isClean$2$2] = false;
        var next = this;
        while (next = next.parent) {
          next[isClean$2$2] = false;
        }
      }
    };
    _proto.next = function next() {
      if (!this.parent) return void 0;
      var index2 = this.parent.index(this);
      return this.parent.nodes[index2 + 1];
    };
    _proto.positionBy = function positionBy(opts, stringRepresentation) {
      var pos = this.source.start;
      if (opts.index) {
        pos = this.positionInside(opts.index, stringRepresentation);
      } else if (opts.word) {
        stringRepresentation = this.toString();
        var index2 = stringRepresentation.indexOf(opts.word);
        if (index2 !== -1) pos = this.positionInside(index2, stringRepresentation);
      }
      return pos;
    };
    _proto.positionInside = function positionInside(index2, stringRepresentation) {
      var string = stringRepresentation || this.toString();
      var column = this.source.start.column;
      var line = this.source.start.line;
      for (var i22 = 0; i22 < index2; i22++) {
        if (string[i22] === "\n") {
          column = 1;
          line += 1;
        } else {
          column += 1;
        }
      }
      return {
        column,
        line
      };
    };
    _proto.prev = function prev() {
      if (!this.parent) return void 0;
      var index2 = this.parent.index(this);
      return this.parent.nodes[index2 - 1];
    };
    _proto.rangeBy = function rangeBy(opts) {
      var start = {
        column: this.source.start.column,
        line: this.source.start.line
      };
      var end = this.source.end ? {
        column: this.source.end.column + 1,
        line: this.source.end.line
      } : {
        column: start.column + 1,
        line: start.line
      };
      if (opts.word) {
        var stringRepresentation = this.toString();
        var index2 = stringRepresentation.indexOf(opts.word);
        if (index2 !== -1) {
          start = this.positionInside(index2, stringRepresentation);
          end = this.positionInside(index2 + opts.word.length, stringRepresentation);
        }
      } else {
        if (opts.start) {
          start = {
            column: opts.start.column,
            line: opts.start.line
          };
        } else if (opts.index) {
          start = this.positionInside(opts.index);
        }
        if (opts.end) {
          end = {
            column: opts.end.column,
            line: opts.end.line
          };
        } else if (typeof opts.endIndex === "number") {
          end = this.positionInside(opts.endIndex);
        } else if (opts.index) {
          end = this.positionInside(opts.index + 1);
        }
      }
      if (end.line < start.line || end.line === start.line && end.column <= start.column) {
        end = {
          column: start.column + 1,
          line: start.line
        };
      }
      return {
        end,
        start
      };
    };
    _proto.raw = function raw(prop, defaultType) {
      var str = new Stringifier22();
      return str.raw(this, prop, defaultType);
    };
    _proto.remove = function remove() {
      if (this.parent) {
        this.parent.removeChild(this);
      }
      this.parent = void 0;
      return this;
    };
    _proto.replaceWith = function replaceWith() {
      for (var _len = arguments.length, nodes = new Array(_len), _key = 0; _key < _len; _key++) {
        nodes[_key] = arguments[_key];
      }
      if (this.parent) {
        var bookmark = this;
        var foundSelf = false;
        for (var _iterator = _create_for_of_iterator_helper_loose(nodes), _step; !(_step = _iterator()).done; ) {
          var node2 = _step.value;
          if (node2 === this) {
            foundSelf = true;
          } else if (foundSelf) {
            this.parent.insertAfter(bookmark, node2);
            bookmark = node2;
          } else {
            this.parent.insertBefore(bookmark, node2);
          }
        }
        if (!foundSelf) {
          this.remove();
        }
      }
      return this;
    };
    _proto.root = function root2() {
      var result2 = this;
      while (result2.parent && result2.parent.type !== "document") {
        result2 = result2.parent;
      }
      return result2;
    };
    _proto.toJSON = function toJSON(_4, inputs) {
      var fixed = {};
      var emitInputs = inputs == null;
      inputs = inputs || /* @__PURE__ */ new Map();
      var inputsNextIndex = 0;
      for (var name in this) {
        if (!Object.prototype.hasOwnProperty.call(this, name)) {
          continue;
        }
        if (name === "parent" || name === "proxyCache") continue;
        var value = this[name];
        if (Array.isArray(value)) {
          fixed[name] = value.map(function(i22) {
            if ((typeof i22 === "undefined" ? "undefined" : _type_of(i22)) === "object" && i22.toJSON) {
              return i22.toJSON(null, inputs);
            } else {
              return i22;
            }
          });
        } else if ((typeof value === "undefined" ? "undefined" : _type_of(value)) === "object" && value.toJSON) {
          fixed[name] = value.toJSON(null, inputs);
        } else if (name === "source") {
          var inputId = inputs.get(value.input);
          if (inputId == null) {
            inputId = inputsNextIndex;
            inputs.set(value.input, inputsNextIndex);
            inputsNextIndex++;
          }
          fixed[name] = {
            end: value.end,
            inputId,
            start: value.start
          };
        } else {
          fixed[name] = value;
        }
      }
      if (emitInputs) {
        fixed.inputs = [].concat(inputs.keys()).map(function(input2) {
          return input2.toJSON();
        });
      }
      return fixed;
    };
    _proto.toProxy = function toProxy() {
      if (!this.proxyCache) {
        this.proxyCache = new Proxy(this, this.getProxyProcessor());
      }
      return this.proxyCache;
    };
    _proto.toString = function toString2(stringifier2) {
      if (stringifier2 === void 0) stringifier2 = stringify$3$2;
      if (stringifier2.stringify) stringifier2 = stringifier2.stringify;
      var result2 = "";
      stringifier2(this, function(i22) {
        result2 += i22;
      });
      return result2;
    };
    _proto.warn = function warn(result2, text, opts) {
      var data = {
        node: this
      };
      for (var i22 in opts) data[i22] = opts[i22];
      return result2.warn(text, data);
    };
    _create_class(Node3, [
      {
        key: "proxyOf",
        get: function get() {
          return this;
        }
      }
    ]);
    return Node3;
  })();
  var node$2 = Node$4$2;
  Node$4$2.default = Node$4$2;
  var Node$3$2 = node$2;
  var Declaration$4$2 = /* @__PURE__ */ (function(Node$3$22) {
    _inherits(Declaration23, Node$3$22);
    function Declaration23(defaults) {
      var _this;
      if (defaults && typeof defaults.value !== "undefined" && typeof defaults.value !== "string") {
        defaults = _extends({}, defaults, {
          value: String(defaults.value)
        });
      }
      _this = Node$3$22.call(this, defaults) || this;
      _this.type = "decl";
      return _this;
    }
    _create_class(Declaration23, [
      {
        key: "variable",
        get: function get() {
          return this.prop.startsWith("--") || this.prop[0] === "$";
        }
      }
    ]);
    return Declaration23;
  })(Node$3$2);
  var declaration$2 = Declaration$4$2;
  Declaration$4$2.default = Declaration$4$2;
  var urlAlphabet$2 = "useandom-26T198340PX75pxJACKVERYMINDBUSHWOLF_GQZbfghjklqvwyzrict";
  var nanoid$1$2 = function(size) {
    if (size === void 0) size = 21;
    var id = "";
    var i22 = size;
    while (i22--) {
      id += urlAlphabet$2[Math.random() * 64 | 0];
    }
    return id;
  };
  var nonSecure$2 = {
    nanoid: nanoid$1$2
  };
  var SourceMapConsumer$2$2 = require$$2$2.SourceMapConsumer;
  var SourceMapGenerator$2$2 = require$$2$2.SourceMapGenerator;
  var existsSync$2 = require$$2$2.existsSync;
  var readFileSync$2 = require$$2$2.readFileSync;
  var dirname$1$2 = require$$2$2.dirname;
  var join$2 = require$$2$2.join;
  function fromBase64$2(str) {
    if (Buffer) {
      return Buffer.from(str, "base64").toString();
    } else {
      return window.atob(str);
    }
  }
  var PreviousMap$2$2 = /* @__PURE__ */ (function() {
    function PreviousMap23(css, opts) {
      if (opts.map === false) return;
      this.loadAnnotation(css);
      this.inline = this.startWith(this.annotation, "data:");
      var prev = opts.map ? opts.map.prev : void 0;
      var text = this.loadMap(opts.from, prev);
      if (!this.mapFile && opts.from) {
        this.mapFile = opts.from;
      }
      if (this.mapFile) this.root = dirname$1$2(this.mapFile);
      if (text) this.text = text;
    }
    var _proto = PreviousMap23.prototype;
    _proto.consumer = function consumer() {
      if (!this.consumerCache) {
        this.consumerCache = new SourceMapConsumer$2$2(this.text);
      }
      return this.consumerCache;
    };
    _proto.decodeInline = function decodeInline(text) {
      var baseCharsetUri = /^data:application\/json;charset=utf-?8;base64,/;
      var baseUri = /^data:application\/json;base64,/;
      var charsetUri = /^data:application\/json;charset=utf-?8,/;
      var uri = /^data:application\/json,/;
      if (charsetUri.test(text) || uri.test(text)) {
        return decodeURIComponent(text.substr(RegExp.lastMatch.length));
      }
      if (baseCharsetUri.test(text) || baseUri.test(text)) {
        return fromBase64$2(text.substr(RegExp.lastMatch.length));
      }
      var encoding = text.match(/data:application\/json;([^,]+),/)[1];
      throw new Error("Unsupported source map encoding " + encoding);
    };
    _proto.getAnnotationURL = function getAnnotationURL(sourceMapString) {
      return sourceMapString.replace(/^\/\*\s*# sourceMappingURL=/, "").trim();
    };
    _proto.isMap = function isMap(map) {
      if ((typeof map === "undefined" ? "undefined" : _type_of(map)) !== "object") return false;
      return typeof map.mappings === "string" || typeof map._mappings === "string" || Array.isArray(map.sections);
    };
    _proto.loadAnnotation = function loadAnnotation(css) {
      var comments = css.match(/\/\*\s*# sourceMappingURL=/gm);
      if (!comments) return;
      var start = css.lastIndexOf(comments.pop());
      var end = css.indexOf("*/", start);
      if (start > -1 && end > -1) {
        this.annotation = this.getAnnotationURL(css.substring(start, end));
      }
    };
    _proto.loadFile = function loadFile(path) {
      this.root = dirname$1$2(path);
      if (existsSync$2(path)) {
        this.mapFile = path;
        return readFileSync$2(path, "utf-8").toString().trim();
      }
    };
    _proto.loadMap = function loadMap(file, prev) {
      if (prev === false) return false;
      if (prev) {
        if (typeof prev === "string") {
          return prev;
        } else if (typeof prev === "function") {
          var prevPath = prev(file);
          if (prevPath) {
            var map = this.loadFile(prevPath);
            if (!map) {
              throw new Error("Unable to load previous source map: " + prevPath.toString());
            }
            return map;
          }
        } else if (_instanceof(prev, SourceMapConsumer$2$2)) {
          return SourceMapGenerator$2$2.fromSourceMap(prev).toString();
        } else if (_instanceof(prev, SourceMapGenerator$2$2)) {
          return prev.toString();
        } else if (this.isMap(prev)) {
          return JSON.stringify(prev);
        } else {
          throw new Error("Unsupported previous source map format: " + prev.toString());
        }
      } else if (this.inline) {
        return this.decodeInline(this.annotation);
      } else if (this.annotation) {
        var map1 = this.annotation;
        if (file) map1 = join$2(dirname$1$2(file), map1);
        return this.loadFile(map1);
      }
    };
    _proto.startWith = function startWith(string, start) {
      if (!string) return false;
      return string.substr(0, start.length) === start;
    };
    _proto.withContent = function withContent() {
      return !!(this.consumer().sourcesContent && this.consumer().sourcesContent.length > 0);
    };
    return PreviousMap23;
  })();
  var previousMap$2 = PreviousMap$2$2;
  PreviousMap$2$2.default = PreviousMap$2$2;
  var SourceMapConsumer$1$2 = require$$2$2.SourceMapConsumer;
  var SourceMapGenerator$1$2 = require$$2$2.SourceMapGenerator;
  var fileURLToPath$2 = require$$2$2.fileURLToPath;
  var pathToFileURL$1$2 = require$$2$2.pathToFileURL;
  var isAbsolute$2 = require$$2$2.isAbsolute;
  var resolve$1$2 = require$$2$2.resolve;
  var nanoid$3 = nonSecure$2.nanoid;
  var terminalHighlight$3 = require$$2$2;
  var CssSyntaxError$1$2 = cssSyntaxError$2;
  var PreviousMap$1$2 = previousMap$2;
  var fromOffsetCache$2 = /* @__PURE__ */ Symbol("fromOffsetCache");
  var sourceMapAvailable$1$2 = Boolean(SourceMapConsumer$1$2 && SourceMapGenerator$1$2);
  var pathAvailable$1$2 = Boolean(resolve$1$2 && isAbsolute$2);
  var Input$4$2 = /* @__PURE__ */ (function() {
    function Input23(css, opts) {
      if (opts === void 0) opts = {};
      if (css === null || typeof css === "undefined" || (typeof css === "undefined" ? "undefined" : _type_of(css)) === "object" && !css.toString) {
        throw new Error("PostCSS received " + css + " instead of CSS string");
      }
      this.css = css.toString();
      if (this.css[0] === "\uFEFF" || this.css[0] === "\uFFFE") {
        this.hasBOM = true;
        this.css = this.css.slice(1);
      } else {
        this.hasBOM = false;
      }
      if (opts.from) {
        if (!pathAvailable$1$2 || /^\w+:\/\//.test(opts.from) || isAbsolute$2(opts.from)) {
          this.file = opts.from;
        } else {
          this.file = resolve$1$2(opts.from);
        }
      }
      if (pathAvailable$1$2 && sourceMapAvailable$1$2) {
        var map = new PreviousMap$1$2(this.css, opts);
        if (map.text) {
          this.map = map;
          var file = map.consumer().file;
          if (!this.file && file) this.file = this.mapResolve(file);
        }
      }
      if (!this.file) {
        this.id = "<input css " + nanoid$3(6) + ">";
      }
      if (this.map) this.map.file = this.from;
    }
    var _proto = Input23.prototype;
    _proto.error = function error(message, line, column, opts) {
      if (opts === void 0) opts = {};
      var result2, endLine, endColumn;
      if (line && (typeof line === "undefined" ? "undefined" : _type_of(line)) === "object") {
        var start = line;
        var end = column;
        if (typeof start.offset === "number") {
          var pos = this.fromOffset(start.offset);
          line = pos.line;
          column = pos.col;
        } else {
          line = start.line;
          column = start.column;
        }
        if (typeof end.offset === "number") {
          var pos1 = this.fromOffset(end.offset);
          endLine = pos1.line;
          endColumn = pos1.col;
        } else {
          endLine = end.line;
          endColumn = end.column;
        }
      } else if (!column) {
        var pos2 = this.fromOffset(line);
        line = pos2.line;
        column = pos2.col;
      }
      var origin = this.origin(line, column, endLine, endColumn);
      if (origin) {
        result2 = new CssSyntaxError$1$2(message, origin.endLine === void 0 ? origin.line : {
          column: origin.column,
          line: origin.line
        }, origin.endLine === void 0 ? origin.column : {
          column: origin.endColumn,
          line: origin.endLine
        }, origin.source, origin.file, opts.plugin);
      } else {
        result2 = new CssSyntaxError$1$2(message, endLine === void 0 ? line : {
          column,
          line
        }, endLine === void 0 ? column : {
          column: endColumn,
          line: endLine
        }, this.css, this.file, opts.plugin);
      }
      result2.input = {
        column,
        endColumn,
        endLine,
        line,
        source: this.css
      };
      if (this.file) {
        if (pathToFileURL$1$2) {
          result2.input.url = pathToFileURL$1$2(this.file).toString();
        }
        result2.input.file = this.file;
      }
      return result2;
    };
    _proto.fromOffset = function fromOffset(offset) {
      var lastLine, lineToIndex;
      if (!this[fromOffsetCache$2]) {
        var lines = this.css.split("\n");
        lineToIndex = new Array(lines.length);
        var prevIndex = 0;
        for (var i22 = 0, l22 = lines.length; i22 < l22; i22++) {
          lineToIndex[i22] = prevIndex;
          prevIndex += lines[i22].length + 1;
        }
        this[fromOffsetCache$2] = lineToIndex;
      } else {
        lineToIndex = this[fromOffsetCache$2];
      }
      lastLine = lineToIndex[lineToIndex.length - 1];
      var min = 0;
      if (offset >= lastLine) {
        min = lineToIndex.length - 1;
      } else {
        var max = lineToIndex.length - 2;
        var mid;
        while (min < max) {
          mid = min + (max - min >> 1);
          if (offset < lineToIndex[mid]) {
            max = mid - 1;
          } else if (offset >= lineToIndex[mid + 1]) {
            min = mid + 1;
          } else {
            min = mid;
            break;
          }
        }
      }
      return {
        col: offset - lineToIndex[min] + 1,
        line: min + 1
      };
    };
    _proto.mapResolve = function mapResolve(file) {
      if (/^\w+:\/\//.test(file)) {
        return file;
      }
      return resolve$1$2(this.map.consumer().sourceRoot || this.map.root || ".", file);
    };
    _proto.origin = function origin(line, column, endLine, endColumn) {
      if (!this.map) return false;
      var consumer = this.map.consumer();
      var from = consumer.originalPositionFor({
        column,
        line
      });
      if (!from.source) return false;
      var to;
      if (typeof endLine === "number") {
        to = consumer.originalPositionFor({
          column: endColumn,
          line: endLine
        });
      }
      var fromUrl;
      if (isAbsolute$2(from.source)) {
        fromUrl = pathToFileURL$1$2(from.source);
      } else {
        fromUrl = new URL(from.source, this.map.consumer().sourceRoot || pathToFileURL$1$2(this.map.mapFile));
      }
      var result2 = {
        column: from.column,
        endColumn: to && to.column,
        endLine: to && to.line,
        line: from.line,
        url: fromUrl.toString()
      };
      if (fromUrl.protocol === "file:") {
        if (fileURLToPath$2) {
          result2.file = fileURLToPath$2(fromUrl);
        } else {
          throw new Error("file: protocol is not available in this PostCSS build");
        }
      }
      var source = consumer.sourceContentFor(from.source);
      if (source) result2.source = source;
      return result2;
    };
    _proto.toJSON = function toJSON() {
      var json = {};
      for (var _i = 0, _iter = [
        "hasBOM",
        "css",
        "file",
        "id"
      ]; _i < _iter.length; _i++) {
        var name = _iter[_i];
        if (this[name] != null) {
          json[name] = this[name];
        }
      }
      if (this.map) {
        json.map = _extends({}, this.map);
        if (json.map.consumerCache) {
          json.map.consumerCache = void 0;
        }
      }
      return json;
    };
    _create_class(Input23, [
      {
        key: "from",
        get: function get() {
          return this.file || this.id;
        }
      }
    ]);
    return Input23;
  })();
  var input$2 = Input$4$2;
  Input$4$2.default = Input$4$2;
  if (terminalHighlight$3 && terminalHighlight$3.registerInput) {
    terminalHighlight$3.registerInput(Input$4$2);
  }
  var SourceMapConsumer$4 = require$$2$2.SourceMapConsumer;
  var SourceMapGenerator$4 = require$$2$2.SourceMapGenerator;
  var dirname$3 = require$$2$2.dirname;
  var relative$2 = require$$2$2.relative;
  var resolve$3 = require$$2$2.resolve;
  var sep$2 = require$$2$2.sep;
  var pathToFileURL$3 = require$$2$2.pathToFileURL;
  var Input$3$2 = input$2;
  var sourceMapAvailable$3 = Boolean(SourceMapConsumer$4 && SourceMapGenerator$4);
  var pathAvailable$3 = Boolean(dirname$3 && resolve$3 && relative$2 && sep$2);
  var MapGenerator$2$2 = /* @__PURE__ */ (function() {
    function MapGenerator23(stringify2, root2, opts, cssString) {
      this.stringify = stringify2;
      this.mapOpts = opts.map || {};
      this.root = root2;
      this.opts = opts;
      this.css = cssString;
      this.originalCSS = cssString;
      this.usesFileUrls = !this.mapOpts.from && this.mapOpts.absolute;
      this.memoizedFileURLs = /* @__PURE__ */ new Map();
      this.memoizedPaths = /* @__PURE__ */ new Map();
      this.memoizedURLs = /* @__PURE__ */ new Map();
    }
    var _proto = MapGenerator23.prototype;
    _proto.addAnnotation = function addAnnotation() {
      var content;
      if (this.isInline()) {
        content = "data:application/json;base64," + this.toBase64(this.map.toString());
      } else if (typeof this.mapOpts.annotation === "string") {
        content = this.mapOpts.annotation;
      } else if (typeof this.mapOpts.annotation === "function") {
        content = this.mapOpts.annotation(this.opts.to, this.root);
      } else {
        content = this.outputFile() + ".map";
      }
      var eol = "\n";
      if (this.css.includes("\r\n")) eol = "\r\n";
      this.css += eol + "/*# sourceMappingURL=" + content + " */";
    };
    _proto.applyPrevMaps = function applyPrevMaps() {
      for (var _iterator = _create_for_of_iterator_helper_loose(this.previous()), _step; !(_step = _iterator()).done; ) {
        var prev = _step.value;
        var from = this.toUrl(this.path(prev.file));
        var root2 = prev.root || dirname$3(prev.file);
        var map = void 0;
        if (this.mapOpts.sourcesContent === false) {
          map = new SourceMapConsumer$4(prev.text);
          if (map.sourcesContent) {
            map.sourcesContent = null;
          }
        } else {
          map = prev.consumer();
        }
        this.map.applySourceMap(map, from, this.toUrl(this.path(root2)));
      }
    };
    _proto.clearAnnotation = function clearAnnotation() {
      if (this.mapOpts.annotation === false) return;
      if (this.root) {
        var node2;
        for (var i22 = this.root.nodes.length - 1; i22 >= 0; i22--) {
          node2 = this.root.nodes[i22];
          if (node2.type !== "comment") continue;
          if (node2.text.indexOf("# sourceMappingURL=") === 0) {
            this.root.removeChild(i22);
          }
        }
      } else if (this.css) {
        this.css = this.css.replace(/\n*?\/\*#[\S\s]*?\*\/$/gm, "");
      }
    };
    _proto.generate = function generate() {
      this.clearAnnotation();
      if (pathAvailable$3 && sourceMapAvailable$3 && this.isMap()) {
        return this.generateMap();
      } else {
        var result2 = "";
        this.stringify(this.root, function(i22) {
          result2 += i22;
        });
        return [
          result2
        ];
      }
    };
    _proto.generateMap = function generateMap() {
      if (this.root) {
        this.generateString();
      } else if (this.previous().length === 1) {
        var prev = this.previous()[0].consumer();
        prev.file = this.outputFile();
        this.map = SourceMapGenerator$4.fromSourceMap(prev, {
          ignoreInvalidMapping: true
        });
      } else {
        this.map = new SourceMapGenerator$4({
          file: this.outputFile(),
          ignoreInvalidMapping: true
        });
        this.map.addMapping({
          generated: {
            column: 0,
            line: 1
          },
          original: {
            column: 0,
            line: 1
          },
          source: this.opts.from ? this.toUrl(this.path(this.opts.from)) : "<no source>"
        });
      }
      if (this.isSourcesContent()) this.setSourcesContent();
      if (this.root && this.previous().length > 0) this.applyPrevMaps();
      if (this.isAnnotation()) this.addAnnotation();
      if (this.isInline()) {
        return [
          this.css
        ];
      } else {
        return [
          this.css,
          this.map
        ];
      }
    };
    _proto.generateString = function generateString() {
      var _this = this;
      this.css = "";
      this.map = new SourceMapGenerator$4({
        file: this.outputFile(),
        ignoreInvalidMapping: true
      });
      var line = 1;
      var column = 1;
      var noSource = "<no source>";
      var mapping = {
        generated: {
          column: 0,
          line: 0
        },
        original: {
          column: 0,
          line: 0
        },
        source: ""
      };
      var lines, last;
      this.stringify(this.root, function(str, node2, type) {
        _this.css += str;
        if (node2 && type !== "end") {
          mapping.generated.line = line;
          mapping.generated.column = column - 1;
          if (node2.source && node2.source.start) {
            mapping.source = _this.sourcePath(node2);
            mapping.original.line = node2.source.start.line;
            mapping.original.column = node2.source.start.column - 1;
            _this.map.addMapping(mapping);
          } else {
            mapping.source = noSource;
            mapping.original.line = 1;
            mapping.original.column = 0;
            _this.map.addMapping(mapping);
          }
        }
        lines = str.match(/\n/g);
        if (lines) {
          line += lines.length;
          last = str.lastIndexOf("\n");
          column = str.length - last;
        } else {
          column += str.length;
        }
        if (node2 && type !== "start") {
          var p3 = node2.parent || {
            raws: {}
          };
          var childless = node2.type === "decl" || node2.type === "atrule" && !node2.nodes;
          if (!childless || node2 !== p3.last || p3.raws.semicolon) {
            if (node2.source && node2.source.end) {
              mapping.source = _this.sourcePath(node2);
              mapping.original.line = node2.source.end.line;
              mapping.original.column = node2.source.end.column - 1;
              mapping.generated.line = line;
              mapping.generated.column = column - 2;
              _this.map.addMapping(mapping);
            } else {
              mapping.source = noSource;
              mapping.original.line = 1;
              mapping.original.column = 0;
              mapping.generated.line = line;
              mapping.generated.column = column - 1;
              _this.map.addMapping(mapping);
            }
          }
        }
      });
    };
    _proto.isAnnotation = function isAnnotation() {
      if (this.isInline()) {
        return true;
      }
      if (typeof this.mapOpts.annotation !== "undefined") {
        return this.mapOpts.annotation;
      }
      if (this.previous().length) {
        return this.previous().some(function(i22) {
          return i22.annotation;
        });
      }
      return true;
    };
    _proto.isInline = function isInline() {
      if (typeof this.mapOpts.inline !== "undefined") {
        return this.mapOpts.inline;
      }
      var annotation = this.mapOpts.annotation;
      if (typeof annotation !== "undefined" && annotation !== true) {
        return false;
      }
      if (this.previous().length) {
        return this.previous().some(function(i22) {
          return i22.inline;
        });
      }
      return true;
    };
    _proto.isMap = function isMap() {
      if (typeof this.opts.map !== "undefined") {
        return !!this.opts.map;
      }
      return this.previous().length > 0;
    };
    _proto.isSourcesContent = function isSourcesContent() {
      if (typeof this.mapOpts.sourcesContent !== "undefined") {
        return this.mapOpts.sourcesContent;
      }
      if (this.previous().length) {
        return this.previous().some(function(i22) {
          return i22.withContent();
        });
      }
      return true;
    };
    _proto.outputFile = function outputFile() {
      if (this.opts.to) {
        return this.path(this.opts.to);
      } else if (this.opts.from) {
        return this.path(this.opts.from);
      } else {
        return "to.css";
      }
    };
    _proto.path = function path(file) {
      if (this.mapOpts.absolute) return file;
      if (file.charCodeAt(0) === 60) return file;
      if (/^\w+:\/\//.test(file)) return file;
      var cached = this.memoizedPaths.get(file);
      if (cached) return cached;
      var from = this.opts.to ? dirname$3(this.opts.to) : ".";
      if (typeof this.mapOpts.annotation === "string") {
        from = dirname$3(resolve$3(from, this.mapOpts.annotation));
      }
      var path2 = relative$2(from, file);
      this.memoizedPaths.set(file, path2);
      return path2;
    };
    _proto.previous = function previous() {
      var _this = this;
      if (!this.previousMaps) {
        this.previousMaps = [];
        if (this.root) {
          this.root.walk(function(node2) {
            if (node2.source && node2.source.input.map) {
              var map = node2.source.input.map;
              if (!_this.previousMaps.includes(map)) {
                _this.previousMaps.push(map);
              }
            }
          });
        } else {
          var input2 = new Input$3$2(this.originalCSS, this.opts);
          if (input2.map) this.previousMaps.push(input2.map);
        }
      }
      return this.previousMaps;
    };
    _proto.setSourcesContent = function setSourcesContent() {
      var _this = this;
      var already = {};
      if (this.root) {
        this.root.walk(function(node2) {
          if (node2.source) {
            var from2 = node2.source.input.from;
            if (from2 && !already[from2]) {
              already[from2] = true;
              var fromUrl = _this.usesFileUrls ? _this.toFileUrl(from2) : _this.toUrl(_this.path(from2));
              _this.map.setSourceContent(fromUrl, node2.source.input.css);
            }
          }
        });
      } else if (this.css) {
        var from = this.opts.from ? this.toUrl(this.path(this.opts.from)) : "<no source>";
        this.map.setSourceContent(from, this.css);
      }
    };
    _proto.sourcePath = function sourcePath(node2) {
      if (this.mapOpts.from) {
        return this.toUrl(this.mapOpts.from);
      } else if (this.usesFileUrls) {
        return this.toFileUrl(node2.source.input.from);
      } else {
        return this.toUrl(this.path(node2.source.input.from));
      }
    };
    _proto.toBase64 = function toBase64(str) {
      if (Buffer) {
        return Buffer.from(str).toString("base64");
      } else {
        return window.btoa(unescape(encodeURIComponent(str)));
      }
    };
    _proto.toFileUrl = function toFileUrl(path) {
      var cached = this.memoizedFileURLs.get(path);
      if (cached) return cached;
      if (pathToFileURL$3) {
        var fileURL = pathToFileURL$3(path).toString();
        this.memoizedFileURLs.set(path, fileURL);
        return fileURL;
      } else {
        throw new Error("`map.absolute` option is not available in this PostCSS build");
      }
    };
    _proto.toUrl = function toUrl(path) {
      var cached = this.memoizedURLs.get(path);
      if (cached) return cached;
      if (sep$2 === "\\") {
        path = path.replace(/\\/g, "/");
      }
      var url = encodeURI(path).replace(/[#?]/g, encodeURIComponent);
      this.memoizedURLs.set(path, url);
      return url;
    };
    return MapGenerator23;
  })();
  var mapGenerator$2 = MapGenerator$2$2;
  var Node$2$2 = node$2;
  var Comment$4$2 = /* @__PURE__ */ (function(Node$2$22) {
    _inherits(Comment23, Node$2$22);
    function Comment23(defaults) {
      var _this;
      _this = Node$2$22.call(this, defaults) || this;
      _this.type = "comment";
      return _this;
    }
    return Comment23;
  })(Node$2$2);
  var comment$2 = Comment$4$2;
  Comment$4$2.default = Comment$4$2;
  var isClean$1$2 = symbols$2.isClean;
  var my$1$2 = symbols$2.my;
  var Declaration$3$2 = declaration$2;
  var Comment$3$2 = comment$2;
  var Node$1$2 = node$2;
  var parse$4$2;
  var Rule$4$2;
  var AtRule$4$2;
  var Root$6$2;
  function cleanSource$2(nodes) {
    return nodes.map(function(i22) {
      if (i22.nodes) i22.nodes = cleanSource$2(i22.nodes);
      delete i22.source;
      return i22;
    });
  }
  function markDirtyUp$2(node2) {
    node2[isClean$1$2] = false;
    if (node2.proxyOf.nodes) {
      for (var _iterator = _create_for_of_iterator_helper_loose(node2.proxyOf.nodes), _step; !(_step = _iterator()).done; ) {
        var i22 = _step.value;
        markDirtyUp$2(i22);
      }
    }
  }
  var Container$7$2 = /* @__PURE__ */ (function(Node$1$22) {
    _inherits(Container23, Node$1$22);
    function Container23() {
      return Node$1$22.apply(this, arguments) || this;
    }
    var _proto = Container23.prototype;
    _proto.append = function append() {
      for (var _len = arguments.length, children = new Array(_len), _key = 0; _key < _len; _key++) {
        children[_key] = arguments[_key];
      }
      for (var _iterator = _create_for_of_iterator_helper_loose(children), _step; !(_step = _iterator()).done; ) {
        var child = _step.value;
        var nodes = this.normalize(child, this.last);
        for (var _iterator1 = _create_for_of_iterator_helper_loose(nodes), _step1; !(_step1 = _iterator1()).done; ) {
          var node2 = _step1.value;
          this.proxyOf.nodes.push(node2);
        }
      }
      this.markDirty();
      return this;
    };
    _proto.cleanRaws = function cleanRaws(keepBetween) {
      Node$1$22.prototype.cleanRaws.call(this, keepBetween);
      if (this.nodes) {
        for (var _iterator = _create_for_of_iterator_helper_loose(this.nodes), _step; !(_step = _iterator()).done; ) {
          var node2 = _step.value;
          node2.cleanRaws(keepBetween);
        }
      }
    };
    _proto.each = function each(callback) {
      if (!this.proxyOf.nodes) return void 0;
      var iterator = this.getIterator();
      var index2, result2;
      while (this.indexes[iterator] < this.proxyOf.nodes.length) {
        index2 = this.indexes[iterator];
        result2 = callback(this.proxyOf.nodes[index2], index2);
        if (result2 === false) break;
        this.indexes[iterator] += 1;
      }
      delete this.indexes[iterator];
      return result2;
    };
    _proto.every = function every(condition) {
      return this.nodes.every(condition);
    };
    _proto.getIterator = function getIterator() {
      if (!this.lastEach) this.lastEach = 0;
      if (!this.indexes) this.indexes = {};
      this.lastEach += 1;
      var iterator = this.lastEach;
      this.indexes[iterator] = 0;
      return iterator;
    };
    _proto.getProxyProcessor = function getProxyProcessor() {
      return {
        get: function get(node2, prop) {
          if (prop === "proxyOf") {
            return node2;
          } else if (!node2[prop]) {
            return node2[prop];
          } else if (prop === "each" || typeof prop === "string" && prop.startsWith("walk")) {
            return function() {
              for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {
                args[_key] = arguments[_key];
              }
              var _node2;
              return (_node2 = node2)[prop].apply(_node2, [].concat(args.map(function(i22) {
                if (typeof i22 === "function") {
                  return function(child, index2) {
                    return i22(child.toProxy(), index2);
                  };
                } else {
                  return i22;
                }
              })));
            };
          } else if (prop === "every" || prop === "some") {
            return function(cb) {
              return node2[prop](function(child) {
                for (var _len = arguments.length, other = new Array(_len > 1 ? _len - 1 : 0), _key = 1; _key < _len; _key++) {
                  other[_key - 1] = arguments[_key];
                }
                return cb.apply(void 0, [].concat([
                  child.toProxy()
                ], other));
              });
            };
          } else if (prop === "root") {
            return function() {
              return node2.root().toProxy();
            };
          } else if (prop === "nodes") {
            return node2.nodes.map(function(i22) {
              return i22.toProxy();
            });
          } else if (prop === "first" || prop === "last") {
            return node2[prop].toProxy();
          } else {
            return node2[prop];
          }
        },
        set: function set(node2, prop, value) {
          if (node2[prop] === value) return true;
          node2[prop] = value;
          if (prop === "name" || prop === "params" || prop === "selector") {
            node2.markDirty();
          }
          return true;
        }
      };
    };
    _proto.index = function index2(child) {
      if (typeof child === "number") return child;
      if (child.proxyOf) child = child.proxyOf;
      return this.proxyOf.nodes.indexOf(child);
    };
    _proto.insertAfter = function insertAfter(exist, add) {
      var existIndex = this.index(exist);
      var nodes = this.normalize(add, this.proxyOf.nodes[existIndex]).reverse();
      existIndex = this.index(exist);
      for (var _iterator = _create_for_of_iterator_helper_loose(nodes), _step; !(_step = _iterator()).done; ) {
        var node2 = _step.value;
        this.proxyOf.nodes.splice(existIndex + 1, 0, node2);
      }
      var index2;
      for (var id in this.indexes) {
        index2 = this.indexes[id];
        if (existIndex < index2) {
          this.indexes[id] = index2 + nodes.length;
        }
      }
      this.markDirty();
      return this;
    };
    _proto.insertBefore = function insertBefore(exist, add) {
      var existIndex = this.index(exist);
      var type = existIndex === 0 ? "prepend" : false;
      var nodes = this.normalize(add, this.proxyOf.nodes[existIndex], type).reverse();
      existIndex = this.index(exist);
      for (var _iterator = _create_for_of_iterator_helper_loose(nodes), _step; !(_step = _iterator()).done; ) {
        var node2 = _step.value;
        this.proxyOf.nodes.splice(existIndex, 0, node2);
      }
      var index2;
      for (var id in this.indexes) {
        index2 = this.indexes[id];
        if (existIndex <= index2) {
          this.indexes[id] = index2 + nodes.length;
        }
      }
      this.markDirty();
      return this;
    };
    _proto.normalize = function normalize(nodes, sample) {
      var _this = this;
      if (typeof nodes === "string") {
        nodes = cleanSource$2(parse$4$2(nodes).nodes);
      } else if (typeof nodes === "undefined") {
        nodes = [];
      } else if (Array.isArray(nodes)) {
        nodes = nodes.slice(0);
        for (var _iterator = _create_for_of_iterator_helper_loose(nodes), _step; !(_step = _iterator()).done; ) {
          var i22 = _step.value;
          if (i22.parent) i22.parent.removeChild(i22, "ignore");
        }
      } else if (nodes.type === "root" && this.type !== "document") {
        nodes = nodes.nodes.slice(0);
        for (var _iterator1 = _create_for_of_iterator_helper_loose(nodes), _step1; !(_step1 = _iterator1()).done; ) {
          var i21 = _step1.value;
          if (i21.parent) i21.parent.removeChild(i21, "ignore");
        }
      } else if (nodes.type) {
        nodes = [
          nodes
        ];
      } else if (nodes.prop) {
        if (typeof nodes.value === "undefined") {
          throw new Error("Value field is missed in node creation");
        } else if (typeof nodes.value !== "string") {
          nodes.value = String(nodes.value);
        }
        nodes = [
          new Declaration$3$2(nodes)
        ];
      } else if (nodes.selector) {
        nodes = [
          new Rule$4$2(nodes)
        ];
      } else if (nodes.name) {
        nodes = [
          new AtRule$4$2(nodes)
        ];
      } else if (nodes.text) {
        nodes = [
          new Comment$3$2(nodes)
        ];
      } else {
        throw new Error("Unknown node type in node creation");
      }
      var processed = nodes.map(function(i23) {
        if (!i23[my$1$2]) Container23.rebuild(i23);
        i23 = i23.proxyOf;
        if (i23.parent) i23.parent.removeChild(i23);
        if (i23[isClean$1$2]) markDirtyUp$2(i23);
        if (typeof i23.raws.before === "undefined") {
          if (sample && typeof sample.raws.before !== "undefined") {
            i23.raws.before = sample.raws.before.replace(/\S/g, "");
          }
        }
        i23.parent = _this.proxyOf;
        return i23;
      });
      return processed;
    };
    _proto.prepend = function prepend() {
      for (var _len = arguments.length, children = new Array(_len), _key = 0; _key < _len; _key++) {
        children[_key] = arguments[_key];
      }
      children = children.reverse();
      for (var _iterator = _create_for_of_iterator_helper_loose(children), _step; !(_step = _iterator()).done; ) {
        var child = _step.value;
        var nodes = this.normalize(child, this.first, "prepend").reverse();
        for (var _iterator1 = _create_for_of_iterator_helper_loose(nodes), _step1; !(_step1 = _iterator1()).done; ) {
          var node2 = _step1.value;
          this.proxyOf.nodes.unshift(node2);
        }
        for (var id in this.indexes) {
          this.indexes[id] = this.indexes[id] + nodes.length;
        }
      }
      this.markDirty();
      return this;
    };
    _proto.push = function push(child) {
      child.parent = this;
      this.proxyOf.nodes.push(child);
      return this;
    };
    _proto.removeAll = function removeAll() {
      for (var _iterator = _create_for_of_iterator_helper_loose(this.proxyOf.nodes), _step; !(_step = _iterator()).done; ) {
        var node2 = _step.value;
        node2.parent = void 0;
      }
      this.proxyOf.nodes = [];
      this.markDirty();
      return this;
    };
    _proto.removeChild = function removeChild(child) {
      child = this.index(child);
      this.proxyOf.nodes[child].parent = void 0;
      this.proxyOf.nodes.splice(child, 1);
      var index2;
      for (var id in this.indexes) {
        index2 = this.indexes[id];
        if (index2 >= child) {
          this.indexes[id] = index2 - 1;
        }
      }
      this.markDirty();
      return this;
    };
    _proto.replaceValues = function replaceValues(pattern, opts, callback) {
      if (!callback) {
        callback = opts;
        opts = {};
      }
      this.walkDecls(function(decl) {
        if (opts.props && !opts.props.includes(decl.prop)) return;
        if (opts.fast && !decl.value.includes(opts.fast)) return;
        decl.value = decl.value.replace(pattern, callback);
      });
      this.markDirty();
      return this;
    };
    _proto.some = function some(condition) {
      return this.nodes.some(condition);
    };
    _proto.walk = function walk(callback) {
      return this.each(function(child, i22) {
        var result2;
        try {
          result2 = callback(child, i22);
        } catch (e22) {
          throw child.addToError(e22);
        }
        if (result2 !== false && child.walk) {
          result2 = child.walk(callback);
        }
        return result2;
      });
    };
    _proto.walkAtRules = function walkAtRules(name, callback) {
      if (!callback) {
        callback = name;
        return this.walk(function(child, i22) {
          if (child.type === "atrule") {
            return callback(child, i22);
          }
        });
      }
      if (_instanceof(name, RegExp)) {
        return this.walk(function(child, i22) {
          if (child.type === "atrule" && name.test(child.name)) {
            return callback(child, i22);
          }
        });
      }
      return this.walk(function(child, i22) {
        if (child.type === "atrule" && child.name === name) {
          return callback(child, i22);
        }
      });
    };
    _proto.walkComments = function walkComments(callback) {
      return this.walk(function(child, i22) {
        if (child.type === "comment") {
          return callback(child, i22);
        }
      });
    };
    _proto.walkDecls = function walkDecls(prop, callback) {
      if (!callback) {
        callback = prop;
        return this.walk(function(child, i22) {
          if (child.type === "decl") {
            return callback(child, i22);
          }
        });
      }
      if (_instanceof(prop, RegExp)) {
        return this.walk(function(child, i22) {
          if (child.type === "decl" && prop.test(child.prop)) {
            return callback(child, i22);
          }
        });
      }
      return this.walk(function(child, i22) {
        if (child.type === "decl" && child.prop === prop) {
          return callback(child, i22);
        }
      });
    };
    _proto.walkRules = function walkRules(selector, callback) {
      if (!callback) {
        callback = selector;
        return this.walk(function(child, i22) {
          if (child.type === "rule") {
            return callback(child, i22);
          }
        });
      }
      if (_instanceof(selector, RegExp)) {
        return this.walk(function(child, i22) {
          if (child.type === "rule" && selector.test(child.selector)) {
            return callback(child, i22);
          }
        });
      }
      return this.walk(function(child, i22) {
        if (child.type === "rule" && child.selector === selector) {
          return callback(child, i22);
        }
      });
    };
    _create_class(Container23, [
      {
        key: "first",
        get: function get() {
          if (!this.proxyOf.nodes) return void 0;
          return this.proxyOf.nodes[0];
        }
      },
      {
        key: "last",
        get: function get() {
          if (!this.proxyOf.nodes) return void 0;
          return this.proxyOf.nodes[this.proxyOf.nodes.length - 1];
        }
      }
    ]);
    return Container23;
  })(Node$1$2);
  Container$7$2.registerParse = function(dependant) {
    parse$4$2 = dependant;
  };
  Container$7$2.registerRule = function(dependant) {
    Rule$4$2 = dependant;
  };
  Container$7$2.registerAtRule = function(dependant) {
    AtRule$4$2 = dependant;
  };
  Container$7$2.registerRoot = function(dependant) {
    Root$6$2 = dependant;
  };
  var container$2 = Container$7$2;
  Container$7$2.default = Container$7$2;
  Container$7$2.rebuild = function(node2) {
    if (node2.type === "atrule") {
      Object.setPrototypeOf(node2, AtRule$4$2.prototype);
    } else if (node2.type === "rule") {
      Object.setPrototypeOf(node2, Rule$4$2.prototype);
    } else if (node2.type === "decl") {
      Object.setPrototypeOf(node2, Declaration$3$2.prototype);
    } else if (node2.type === "comment") {
      Object.setPrototypeOf(node2, Comment$3$2.prototype);
    } else if (node2.type === "root") {
      Object.setPrototypeOf(node2, Root$6$2.prototype);
    }
    node2[my$1$2] = true;
    if (node2.nodes) {
      node2.nodes.forEach(function(child) {
        Container$7$2.rebuild(child);
      });
    }
  };
  var Container$6$2 = container$2;
  var LazyResult$4$2;
  var Processor$3$2;
  var Document$3$2 = /* @__PURE__ */ (function(Container$6$22) {
    _inherits(Document23, Container$6$22);
    function Document23(defaults) {
      var _this;
      _this = Container$6$22.call(this, _extends({
        type: "document"
      }, defaults)) || this;
      if (!_this.nodes) {
        _this.nodes = [];
      }
      return _this;
    }
    var _proto = Document23.prototype;
    _proto.toResult = function toResult(opts) {
      if (opts === void 0) opts = {};
      var lazy = new LazyResult$4$2(new Processor$3$2(), this, opts);
      return lazy.stringify();
    };
    return Document23;
  })(Container$6$2);
  Document$3$2.registerLazyResult = function(dependant) {
    LazyResult$4$2 = dependant;
  };
  Document$3$2.registerProcessor = function(dependant) {
    Processor$3$2 = dependant;
  };
  var document$1$2 = Document$3$2;
  Document$3$2.default = Document$3$2;
  var printed$2 = {};
  var warnOnce$2$2 = function warnOnce2(message) {
    if (printed$2[message]) return;
    printed$2[message] = true;
    if (typeof console !== "undefined" && console.warn) {
      console.warn(message);
    }
  };
  var Warning$2$2 = /* @__PURE__ */ (function() {
    function Warning23(text, opts) {
      if (opts === void 0) opts = {};
      this.type = "warning";
      this.text = text;
      if (opts.node && opts.node.source) {
        var range = opts.node.rangeBy(opts);
        this.line = range.start.line;
        this.column = range.start.column;
        this.endLine = range.end.line;
        this.endColumn = range.end.column;
      }
      for (var opt in opts) this[opt] = opts[opt];
    }
    var _proto = Warning23.prototype;
    _proto.toString = function toString2() {
      if (this.node) {
        return this.node.error(this.text, {
          index: this.index,
          plugin: this.plugin,
          word: this.word
        }).message;
      }
      if (this.plugin) {
        return this.plugin + ": " + this.text;
      }
      return this.text;
    };
    return Warning23;
  })();
  var warning$2 = Warning$2$2;
  Warning$2$2.default = Warning$2$2;
  var Warning$1$2 = warning$2;
  var Result$3$2 = /* @__PURE__ */ (function() {
    function Result23(processor2, root2, opts) {
      this.processor = processor2;
      this.messages = [];
      this.root = root2;
      this.opts = opts;
      this.css = void 0;
      this.map = void 0;
    }
    var _proto = Result23.prototype;
    _proto.toString = function toString2() {
      return this.css;
    };
    _proto.warn = function warn(text, opts) {
      if (opts === void 0) opts = {};
      if (!opts.plugin) {
        if (this.lastPlugin && this.lastPlugin.postcssPlugin) {
          opts.plugin = this.lastPlugin.postcssPlugin;
        }
      }
      var warning2 = new Warning$1$2(text, opts);
      this.messages.push(warning2);
      return warning2;
    };
    _proto.warnings = function warnings() {
      return this.messages.filter(function(i22) {
        return i22.type === "warning";
      });
    };
    _create_class(Result23, [
      {
        key: "content",
        get: function get() {
          return this.css;
        }
      }
    ]);
    return Result23;
  })();
  var result$2 = Result$3$2;
  Result$3$2.default = Result$3$2;
  var SINGLE_QUOTE$2 = "'".charCodeAt(0);
  var DOUBLE_QUOTE$2 = '"'.charCodeAt(0);
  var BACKSLASH$2 = "\\".charCodeAt(0);
  var SLASH$2 = "/".charCodeAt(0);
  var NEWLINE$2 = "\n".charCodeAt(0);
  var SPACE$2 = " ".charCodeAt(0);
  var FEED$2 = "\f".charCodeAt(0);
  var TAB$2 = "	".charCodeAt(0);
  var CR$2 = "\r".charCodeAt(0);
  var OPEN_SQUARE$2 = "[".charCodeAt(0);
  var CLOSE_SQUARE$2 = "]".charCodeAt(0);
  var OPEN_PARENTHESES$2 = "(".charCodeAt(0);
  var CLOSE_PARENTHESES$2 = ")".charCodeAt(0);
  var OPEN_CURLY$2 = "{".charCodeAt(0);
  var CLOSE_CURLY$2 = "}".charCodeAt(0);
  var SEMICOLON$2 = ";".charCodeAt(0);
  var ASTERISK$2 = "*".charCodeAt(0);
  var COLON$2 = ":".charCodeAt(0);
  var AT$2 = "@".charCodeAt(0);
  var RE_AT_END$2 = /[\t\n\f\r "#'()/;[\\\]{}]/g;
  var RE_WORD_END$2 = /[\t\n\f\r !"#'():;@[\\\]{}]|\/(?=\*)/g;
  var RE_BAD_BRACKET$2 = /.[\r\n"'(/\\]/;
  var RE_HEX_ESCAPE$2 = /[\da-f]/i;
  var tokenize$2 = function tokenizer2(input2, options) {
    if (options === void 0) options = {};
    var css = input2.css.valueOf();
    var ignore = options.ignoreErrors;
    var code, next, quote, content, escape;
    var escaped, escapePos, prev, n22, currentToken;
    var length = css.length;
    var pos = 0;
    var buffer = [];
    var returned = [];
    function position() {
      return pos;
    }
    function unclosed(what) {
      throw input2.error("Unclosed " + what, pos);
    }
    function endOfFile() {
      return returned.length === 0 && pos >= length;
    }
    function nextToken(opts) {
      if (returned.length) return returned.pop();
      if (pos >= length) return;
      var ignoreUnclosed = opts ? opts.ignoreUnclosed : false;
      code = css.charCodeAt(pos);
      switch (code) {
        case NEWLINE$2:
        case SPACE$2:
        case TAB$2:
        case CR$2:
        case FEED$2: {
          next = pos;
          do {
            next += 1;
            code = css.charCodeAt(next);
          } while (code === SPACE$2 || code === NEWLINE$2 || code === TAB$2 || code === CR$2 || code === FEED$2);
          currentToken = [
            "space",
            css.slice(pos, next)
          ];
          pos = next - 1;
          break;
        }
        case OPEN_SQUARE$2:
        case CLOSE_SQUARE$2:
        case OPEN_CURLY$2:
        case CLOSE_CURLY$2:
        case COLON$2:
        case SEMICOLON$2:
        case CLOSE_PARENTHESES$2: {
          var controlChar = String.fromCharCode(code);
          currentToken = [
            controlChar,
            controlChar,
            pos
          ];
          break;
        }
        case OPEN_PARENTHESES$2: {
          prev = buffer.length ? buffer.pop()[1] : "";
          n22 = css.charCodeAt(pos + 1);
          if (prev === "url" && n22 !== SINGLE_QUOTE$2 && n22 !== DOUBLE_QUOTE$2 && n22 !== SPACE$2 && n22 !== NEWLINE$2 && n22 !== TAB$2 && n22 !== FEED$2 && n22 !== CR$2) {
            next = pos;
            do {
              escaped = false;
              next = css.indexOf(")", next + 1);
              if (next === -1) {
                if (ignore || ignoreUnclosed) {
                  next = pos;
                  break;
                } else {
                  unclosed("bracket");
                }
              }
              escapePos = next;
              while (css.charCodeAt(escapePos - 1) === BACKSLASH$2) {
                escapePos -= 1;
                escaped = !escaped;
              }
            } while (escaped);
            currentToken = [
              "brackets",
              css.slice(pos, next + 1),
              pos,
              next
            ];
            pos = next;
          } else {
            next = css.indexOf(")", pos + 1);
            content = css.slice(pos, next + 1);
            if (next === -1 || RE_BAD_BRACKET$2.test(content)) {
              currentToken = [
                "(",
                "(",
                pos
              ];
            } else {
              currentToken = [
                "brackets",
                content,
                pos,
                next
              ];
              pos = next;
            }
          }
          break;
        }
        case SINGLE_QUOTE$2:
        case DOUBLE_QUOTE$2: {
          quote = code === SINGLE_QUOTE$2 ? "'" : '"';
          next = pos;
          do {
            escaped = false;
            next = css.indexOf(quote, next + 1);
            if (next === -1) {
              if (ignore || ignoreUnclosed) {
                next = pos + 1;
                break;
              } else {
                unclosed("string");
              }
            }
            escapePos = next;
            while (css.charCodeAt(escapePos - 1) === BACKSLASH$2) {
              escapePos -= 1;
              escaped = !escaped;
            }
          } while (escaped);
          currentToken = [
            "string",
            css.slice(pos, next + 1),
            pos,
            next
          ];
          pos = next;
          break;
        }
        case AT$2: {
          RE_AT_END$2.lastIndex = pos + 1;
          RE_AT_END$2.test(css);
          if (RE_AT_END$2.lastIndex === 0) {
            next = css.length - 1;
          } else {
            next = RE_AT_END$2.lastIndex - 2;
          }
          currentToken = [
            "at-word",
            css.slice(pos, next + 1),
            pos,
            next
          ];
          pos = next;
          break;
        }
        case BACKSLASH$2: {
          next = pos;
          escape = true;
          while (css.charCodeAt(next + 1) === BACKSLASH$2) {
            next += 1;
            escape = !escape;
          }
          code = css.charCodeAt(next + 1);
          if (escape && code !== SLASH$2 && code !== SPACE$2 && code !== NEWLINE$2 && code !== TAB$2 && code !== CR$2 && code !== FEED$2) {
            next += 1;
            if (RE_HEX_ESCAPE$2.test(css.charAt(next))) {
              while (RE_HEX_ESCAPE$2.test(css.charAt(next + 1))) {
                next += 1;
              }
              if (css.charCodeAt(next + 1) === SPACE$2) {
                next += 1;
              }
            }
          }
          currentToken = [
            "word",
            css.slice(pos, next + 1),
            pos,
            next
          ];
          pos = next;
          break;
        }
        default: {
          if (code === SLASH$2 && css.charCodeAt(pos + 1) === ASTERISK$2) {
            next = css.indexOf("*/", pos + 2) + 1;
            if (next === 0) {
              if (ignore || ignoreUnclosed) {
                next = css.length;
              } else {
                unclosed("comment");
              }
            }
            currentToken = [
              "comment",
              css.slice(pos, next + 1),
              pos,
              next
            ];
            pos = next;
          } else {
            RE_WORD_END$2.lastIndex = pos + 1;
            RE_WORD_END$2.test(css);
            if (RE_WORD_END$2.lastIndex === 0) {
              next = css.length - 1;
            } else {
              next = RE_WORD_END$2.lastIndex - 2;
            }
            currentToken = [
              "word",
              css.slice(pos, next + 1),
              pos,
              next
            ];
            buffer.push(currentToken);
            pos = next;
          }
          break;
        }
      }
      pos++;
      return currentToken;
    }
    function back(token) {
      returned.push(token);
    }
    return {
      back,
      endOfFile,
      nextToken,
      position
    };
  };
  var Container$5$2 = container$2;
  var AtRule$3$2 = /* @__PURE__ */ (function(Container$5$22) {
    _inherits(AtRule23, Container$5$22);
    function AtRule23(defaults) {
      var _this;
      _this = Container$5$22.call(this, defaults) || this;
      _this.type = "atrule";
      return _this;
    }
    var _proto = AtRule23.prototype;
    _proto.append = function append() {
      for (var _len = arguments.length, children = new Array(_len), _key = 0; _key < _len; _key++) {
        children[_key] = arguments[_key];
      }
      var _Container$5$2_prototype_append;
      if (!this.proxyOf.nodes) this.nodes = [];
      return (_Container$5$2_prototype_append = Container$5$22.prototype.append).call.apply(_Container$5$2_prototype_append, [].concat([
        this
      ], children));
    };
    _proto.prepend = function prepend() {
      for (var _len = arguments.length, children = new Array(_len), _key = 0; _key < _len; _key++) {
        children[_key] = arguments[_key];
      }
      var _Container$5$2_prototype_prepend;
      if (!this.proxyOf.nodes) this.nodes = [];
      return (_Container$5$2_prototype_prepend = Container$5$22.prototype.prepend).call.apply(_Container$5$2_prototype_prepend, [].concat([
        this
      ], children));
    };
    return AtRule23;
  })(Container$5$2);
  var atRule$2 = AtRule$3$2;
  AtRule$3$2.default = AtRule$3$2;
  Container$5$2.registerAtRule(AtRule$3$2);
  var Container$4$2 = container$2;
  var LazyResult$3$2;
  var Processor$2$2;
  var Root$5$2 = /* @__PURE__ */ (function(Container$4$22) {
    _inherits(Root23, Container$4$22);
    function Root23(defaults) {
      var _this;
      _this = Container$4$22.call(this, defaults) || this;
      _this.type = "root";
      if (!_this.nodes) _this.nodes = [];
      return _this;
    }
    var _proto = Root23.prototype;
    _proto.normalize = function normalize(child, sample, type) {
      var nodes = Container$4$22.prototype.normalize.call(this, child);
      if (sample) {
        if (type === "prepend") {
          if (this.nodes.length > 1) {
            sample.raws.before = this.nodes[1].raws.before;
          } else {
            delete sample.raws.before;
          }
        } else if (this.first !== sample) {
          for (var _iterator = _create_for_of_iterator_helper_loose(nodes), _step; !(_step = _iterator()).done; ) {
            var node2 = _step.value;
            node2.raws.before = sample.raws.before;
          }
        }
      }
      return nodes;
    };
    _proto.removeChild = function removeChild(child, ignore) {
      var index2 = this.index(child);
      if (!ignore && index2 === 0 && this.nodes.length > 1) {
        this.nodes[1].raws.before = this.nodes[index2].raws.before;
      }
      return Container$4$22.prototype.removeChild.call(this, child);
    };
    _proto.toResult = function toResult(opts) {
      if (opts === void 0) opts = {};
      var lazy = new LazyResult$3$2(new Processor$2$2(), this, opts);
      return lazy.stringify();
    };
    return Root23;
  })(Container$4$2);
  Root$5$2.registerLazyResult = function(dependant) {
    LazyResult$3$2 = dependant;
  };
  Root$5$2.registerProcessor = function(dependant) {
    Processor$2$2 = dependant;
  };
  var root$2 = Root$5$2;
  Root$5$2.default = Root$5$2;
  Container$4$2.registerRoot(Root$5$2);
  var list$2$2 = {
    comma: function comma2(string) {
      return list$2$2.split(string, [
        ","
      ], true);
    },
    space: function space2(string) {
      var spaces = [
        " ",
        "\n",
        "	"
      ];
      return list$2$2.split(string, spaces);
    },
    split: function split2(string, separators, last) {
      var array = [];
      var current = "";
      var split4 = false;
      var func = 0;
      var inQuote = false;
      var prevQuote = "";
      var escape = false;
      for (var _iterator = _create_for_of_iterator_helper_loose(string), _step; !(_step = _iterator()).done; ) {
        var letter = _step.value;
        if (escape) {
          escape = false;
        } else if (letter === "\\") {
          escape = true;
        } else if (inQuote) {
          if (letter === prevQuote) {
            inQuote = false;
          }
        } else if (letter === '"' || letter === "'") {
          inQuote = true;
          prevQuote = letter;
        } else if (letter === "(") {
          func += 1;
        } else if (letter === ")") {
          if (func > 0) func -= 1;
        } else if (func === 0) {
          if (separators.includes(letter)) split4 = true;
        }
        if (split4) {
          if (current !== "") array.push(current.trim());
          current = "";
          split4 = false;
        } else {
          current += letter;
        }
      }
      if (last || current !== "") array.push(current.trim());
      return array;
    }
  };
  var list_1$2 = list$2$2;
  list$2$2.default = list$2$2;
  var Container$3$2 = container$2;
  var list$1$2 = list_1$2;
  var Rule$3$2 = /* @__PURE__ */ (function(Container$3$22) {
    _inherits(Rule23, Container$3$22);
    function Rule23(defaults) {
      var _this;
      _this = Container$3$22.call(this, defaults) || this;
      _this.type = "rule";
      if (!_this.nodes) _this.nodes = [];
      return _this;
    }
    _create_class(Rule23, [
      {
        key: "selectors",
        get: function get() {
          return list$1$2.comma(this.selector);
        },
        set: function set(values) {
          var match = this.selector ? this.selector.match(/,\s*/) : null;
          var sep2 = match ? match[0] : "," + this.raw("between", "beforeOpen");
          this.selector = values.join(sep2);
        }
      }
    ]);
    return Rule23;
  })(Container$3$2);
  var rule$2 = Rule$3$2;
  Rule$3$2.default = Rule$3$2;
  Container$3$2.registerRule(Rule$3$2);
  var Declaration$2$2 = declaration$2;
  var tokenizer22 = tokenize$2;
  var Comment$2$2 = comment$2;
  var AtRule$2$2 = atRule$2;
  var Root$4$2 = root$2;
  var Rule$2$2 = rule$2;
  var SAFE_COMMENT_NEIGHBOR$2 = {
    empty: true,
    space: true
  };
  function findLastWithPosition$2(tokens) {
    for (var i22 = tokens.length - 1; i22 >= 0; i22--) {
      var token = tokens[i22];
      var pos = token[3] || token[2];
      if (pos) return pos;
    }
  }
  var Parser$1$2 = /* @__PURE__ */ (function() {
    function Parser23(input2) {
      this.input = input2;
      this.root = new Root$4$2();
      this.current = this.root;
      this.spaces = "";
      this.semicolon = false;
      this.createTokenizer();
      this.root.source = {
        input: input2,
        start: {
          column: 1,
          line: 1,
          offset: 0
        }
      };
    }
    var _proto = Parser23.prototype;
    _proto.atrule = function atrule(token) {
      var node2 = new AtRule$2$2();
      node2.name = token[1].slice(1);
      if (node2.name === "") {
        this.unnamedAtrule(node2, token);
      }
      this.init(node2, token[2]);
      var type;
      var prev;
      var shift;
      var last = false;
      var open = false;
      var params = [];
      var brackets = [];
      while (!this.tokenizer.endOfFile()) {
        token = this.tokenizer.nextToken();
        type = token[0];
        if (type === "(" || type === "[") {
          brackets.push(type === "(" ? ")" : "]");
        } else if (type === "{" && brackets.length > 0) {
          brackets.push("}");
        } else if (type === brackets[brackets.length - 1]) {
          brackets.pop();
        }
        if (brackets.length === 0) {
          if (type === ";") {
            node2.source.end = this.getPosition(token[2]);
            node2.source.end.offset++;
            this.semicolon = true;
            break;
          } else if (type === "{") {
            open = true;
            break;
          } else if (type === "}") {
            if (params.length > 0) {
              shift = params.length - 1;
              prev = params[shift];
              while (prev && prev[0] === "space") {
                prev = params[--shift];
              }
              if (prev) {
                node2.source.end = this.getPosition(prev[3] || prev[2]);
                node2.source.end.offset++;
              }
            }
            this.end(token);
            break;
          } else {
            params.push(token);
          }
        } else {
          params.push(token);
        }
        if (this.tokenizer.endOfFile()) {
          last = true;
          break;
        }
      }
      node2.raws.between = this.spacesAndCommentsFromEnd(params);
      if (params.length) {
        node2.raws.afterName = this.spacesAndCommentsFromStart(params);
        this.raw(node2, "params", params);
        if (last) {
          token = params[params.length - 1];
          node2.source.end = this.getPosition(token[3] || token[2]);
          node2.source.end.offset++;
          this.spaces = node2.raws.between;
          node2.raws.between = "";
        }
      } else {
        node2.raws.afterName = "";
        node2.params = "";
      }
      if (open) {
        node2.nodes = [];
        this.current = node2;
      }
    };
    _proto.checkMissedSemicolon = function checkMissedSemicolon(tokens) {
      var colon = this.colon(tokens);
      if (colon === false) return;
      var founded = 0;
      var token;
      for (var j4 = colon - 1; j4 >= 0; j4--) {
        token = tokens[j4];
        if (token[0] !== "space") {
          founded += 1;
          if (founded === 2) break;
        }
      }
      throw this.input.error("Missed semicolon", token[0] === "word" ? token[3] + 1 : token[2]);
    };
    _proto.colon = function colon(tokens) {
      var brackets = 0;
      var token, type, prev;
      for (var _iterator = _create_for_of_iterator_helper_loose(tokens.entries()), _step; !(_step = _iterator()).done; ) {
        var _step_value = _step.value, i22 = _step_value[0], element = _step_value[1];
        token = element;
        type = token[0];
        if (type === "(") {
          brackets += 1;
        }
        if (type === ")") {
          brackets -= 1;
        }
        if (brackets === 0 && type === ":") {
          if (!prev) {
            this.doubleColon(token);
          } else if (prev[0] === "word" && prev[1] === "progid") {
            continue;
          } else {
            return i22;
          }
        }
        prev = token;
      }
      return false;
    };
    _proto.comment = function comment2(token) {
      var node2 = new Comment$2$2();
      this.init(node2, token[2]);
      node2.source.end = this.getPosition(token[3] || token[2]);
      node2.source.end.offset++;
      var text = token[1].slice(2, -2);
      if (/^\s*$/.test(text)) {
        node2.text = "";
        node2.raws.left = text;
        node2.raws.right = "";
      } else {
        var match = text.match(/^(\s*)([^]*\S)(\s*)$/);
        node2.text = match[2];
        node2.raws.left = match[1];
        node2.raws.right = match[3];
      }
    };
    _proto.createTokenizer = function createTokenizer() {
      this.tokenizer = tokenizer22(this.input);
    };
    _proto.decl = function decl(tokens, customProperty) {
      var node2 = new Declaration$2$2();
      this.init(node2, tokens[0][2]);
      var last = tokens[tokens.length - 1];
      if (last[0] === ";") {
        this.semicolon = true;
        tokens.pop();
      }
      node2.source.end = this.getPosition(last[3] || last[2] || findLastWithPosition$2(tokens));
      node2.source.end.offset++;
      while (tokens[0][0] !== "word") {
        if (tokens.length === 1) this.unknownWord(tokens);
        node2.raws.before += tokens.shift()[1];
      }
      node2.source.start = this.getPosition(tokens[0][2]);
      node2.prop = "";
      while (tokens.length) {
        var type = tokens[0][0];
        if (type === ":" || type === "space" || type === "comment") {
          break;
        }
        node2.prop += tokens.shift()[1];
      }
      node2.raws.between = "";
      var token;
      while (tokens.length) {
        token = tokens.shift();
        if (token[0] === ":") {
          node2.raws.between += token[1];
          break;
        } else {
          if (token[0] === "word" && /\w/.test(token[1])) {
            this.unknownWord([
              token
            ]);
          }
          node2.raws.between += token[1];
        }
      }
      if (node2.prop[0] === "_" || node2.prop[0] === "*") {
        node2.raws.before += node2.prop[0];
        node2.prop = node2.prop.slice(1);
      }
      var firstSpaces = [];
      var next;
      while (tokens.length) {
        next = tokens[0][0];
        if (next !== "space" && next !== "comment") break;
        firstSpaces.push(tokens.shift());
      }
      this.precheckMissedSemicolon(tokens);
      for (var i22 = tokens.length - 1; i22 >= 0; i22--) {
        token = tokens[i22];
        if (token[1].toLowerCase() === "!important") {
          node2.important = true;
          var string = this.stringFrom(tokens, i22);
          string = this.spacesFromEnd(tokens) + string;
          if (string !== " !important") node2.raws.important = string;
          break;
        } else if (token[1].toLowerCase() === "important") {
          var cache = tokens.slice(0);
          var str = "";
          for (var j4 = i22; j4 > 0; j4--) {
            var type1 = cache[j4][0];
            if (str.trim().indexOf("!") === 0 && type1 !== "space") {
              break;
            }
            str = cache.pop()[1] + str;
          }
          if (str.trim().indexOf("!") === 0) {
            node2.important = true;
            node2.raws.important = str;
            tokens = cache;
          }
        }
        if (token[0] !== "space" && token[0] !== "comment") {
          break;
        }
      }
      var hasWord = tokens.some(function(i23) {
        return i23[0] !== "space" && i23[0] !== "comment";
      });
      if (hasWord) {
        node2.raws.between += firstSpaces.map(function(i23) {
          return i23[1];
        }).join("");
        firstSpaces = [];
      }
      this.raw(node2, "value", firstSpaces.concat(tokens), customProperty);
      if (node2.value.includes(":") && !customProperty) {
        this.checkMissedSemicolon(tokens);
      }
    };
    _proto.doubleColon = function doubleColon(token) {
      throw this.input.error("Double colon", {
        offset: token[2]
      }, {
        offset: token[2] + token[1].length
      });
    };
    _proto.emptyRule = function emptyRule(token) {
      var node2 = new Rule$2$2();
      this.init(node2, token[2]);
      node2.selector = "";
      node2.raws.between = "";
      this.current = node2;
    };
    _proto.end = function end(token) {
      if (this.current.nodes && this.current.nodes.length) {
        this.current.raws.semicolon = this.semicolon;
      }
      this.semicolon = false;
      this.current.raws.after = (this.current.raws.after || "") + this.spaces;
      this.spaces = "";
      if (this.current.parent) {
        this.current.source.end = this.getPosition(token[2]);
        this.current.source.end.offset++;
        this.current = this.current.parent;
      } else {
        this.unexpectedClose(token);
      }
    };
    _proto.endFile = function endFile() {
      if (this.current.parent) this.unclosedBlock();
      if (this.current.nodes && this.current.nodes.length) {
        this.current.raws.semicolon = this.semicolon;
      }
      this.current.raws.after = (this.current.raws.after || "") + this.spaces;
      this.root.source.end = this.getPosition(this.tokenizer.position());
    };
    _proto.freeSemicolon = function freeSemicolon(token) {
      this.spaces += token[1];
      if (this.current.nodes) {
        var prev = this.current.nodes[this.current.nodes.length - 1];
        if (prev && prev.type === "rule" && !prev.raws.ownSemicolon) {
          prev.raws.ownSemicolon = this.spaces;
          this.spaces = "";
        }
      }
    };
    _proto.getPosition = function getPosition(offset) {
      var pos = this.input.fromOffset(offset);
      return {
        column: pos.col,
        line: pos.line,
        offset
      };
    };
    _proto.init = function init(node2, offset) {
      this.current.push(node2);
      node2.source = {
        input: this.input,
        start: this.getPosition(offset)
      };
      node2.raws.before = this.spaces;
      this.spaces = "";
      if (node2.type !== "comment") this.semicolon = false;
    };
    _proto.other = function other(start) {
      var end = false;
      var type = null;
      var colon = false;
      var bracket = null;
      var brackets = [];
      var customProperty = start[1].startsWith("--");
      var tokens = [];
      var token = start;
      while (token) {
        type = token[0];
        tokens.push(token);
        if (type === "(" || type === "[") {
          if (!bracket) bracket = token;
          brackets.push(type === "(" ? ")" : "]");
        } else if (customProperty && colon && type === "{") {
          if (!bracket) bracket = token;
          brackets.push("}");
        } else if (brackets.length === 0) {
          if (type === ";") {
            if (colon) {
              this.decl(tokens, customProperty);
              return;
            } else {
              break;
            }
          } else if (type === "{") {
            this.rule(tokens);
            return;
          } else if (type === "}") {
            this.tokenizer.back(tokens.pop());
            end = true;
            break;
          } else if (type === ":") {
            colon = true;
          }
        } else if (type === brackets[brackets.length - 1]) {
          brackets.pop();
          if (brackets.length === 0) bracket = null;
        }
        token = this.tokenizer.nextToken();
      }
      if (this.tokenizer.endOfFile()) end = true;
      if (brackets.length > 0) this.unclosedBracket(bracket);
      if (end && colon) {
        if (!customProperty) {
          while (tokens.length) {
            token = tokens[tokens.length - 1][0];
            if (token !== "space" && token !== "comment") break;
            this.tokenizer.back(tokens.pop());
          }
        }
        this.decl(tokens, customProperty);
      } else {
        this.unknownWord(tokens);
      }
    };
    _proto.parse = function parse3() {
      var token;
      while (!this.tokenizer.endOfFile()) {
        token = this.tokenizer.nextToken();
        switch (token[0]) {
          case "space":
            this.spaces += token[1];
            break;
          case ";":
            this.freeSemicolon(token);
            break;
          case "}":
            this.end(token);
            break;
          case "comment":
            this.comment(token);
            break;
          case "at-word":
            this.atrule(token);
            break;
          case "{":
            this.emptyRule(token);
            break;
          default:
            this.other(token);
            break;
        }
      }
      this.endFile();
    };
    _proto.precheckMissedSemicolon = function precheckMissedSemicolon() {
    };
    _proto.raw = function raw(node2, prop, tokens, customProperty) {
      var token, type;
      var length = tokens.length;
      var value = "";
      var clean = true;
      var next, prev;
      for (var i22 = 0; i22 < length; i22 += 1) {
        token = tokens[i22];
        type = token[0];
        if (type === "space" && i22 === length - 1 && !customProperty) {
          clean = false;
        } else if (type === "comment") {
          prev = tokens[i22 - 1] ? tokens[i22 - 1][0] : "empty";
          next = tokens[i22 + 1] ? tokens[i22 + 1][0] : "empty";
          if (!SAFE_COMMENT_NEIGHBOR$2[prev] && !SAFE_COMMENT_NEIGHBOR$2[next]) {
            if (value.slice(-1) === ",") {
              clean = false;
            } else {
              value += token[1];
            }
          } else {
            clean = false;
          }
        } else {
          value += token[1];
        }
      }
      if (!clean) {
        var raw2 = tokens.reduce(function(all, i23) {
          return all + i23[1];
        }, "");
        node2.raws[prop] = {
          raw: raw2,
          value
        };
      }
      node2[prop] = value;
    };
    _proto.rule = function rule2(tokens) {
      tokens.pop();
      var node2 = new Rule$2$2();
      this.init(node2, tokens[0][2]);
      node2.raws.between = this.spacesAndCommentsFromEnd(tokens);
      this.raw(node2, "selector", tokens);
      this.current = node2;
    };
    _proto.spacesAndCommentsFromEnd = function spacesAndCommentsFromEnd(tokens) {
      var lastTokenType;
      var spaces = "";
      while (tokens.length) {
        lastTokenType = tokens[tokens.length - 1][0];
        if (lastTokenType !== "space" && lastTokenType !== "comment") break;
        spaces = tokens.pop()[1] + spaces;
      }
      return spaces;
    };
    _proto.spacesAndCommentsFromStart = function spacesAndCommentsFromStart(tokens) {
      var next;
      var spaces = "";
      while (tokens.length) {
        next = tokens[0][0];
        if (next !== "space" && next !== "comment") break;
        spaces += tokens.shift()[1];
      }
      return spaces;
    };
    _proto.spacesFromEnd = function spacesFromEnd(tokens) {
      var lastTokenType;
      var spaces = "";
      while (tokens.length) {
        lastTokenType = tokens[tokens.length - 1][0];
        if (lastTokenType !== "space") break;
        spaces = tokens.pop()[1] + spaces;
      }
      return spaces;
    };
    _proto.stringFrom = function stringFrom(tokens, from) {
      var result2 = "";
      for (var i22 = from; i22 < tokens.length; i22++) {
        result2 += tokens[i22][1];
      }
      tokens.splice(from, tokens.length - from);
      return result2;
    };
    _proto.unclosedBlock = function unclosedBlock() {
      var pos = this.current.source.start;
      throw this.input.error("Unclosed block", pos.line, pos.column);
    };
    _proto.unclosedBracket = function unclosedBracket(bracket) {
      throw this.input.error("Unclosed bracket", {
        offset: bracket[2]
      }, {
        offset: bracket[2] + 1
      });
    };
    _proto.unexpectedClose = function unexpectedClose(token) {
      throw this.input.error("Unexpected }", {
        offset: token[2]
      }, {
        offset: token[2] + 1
      });
    };
    _proto.unknownWord = function unknownWord(tokens) {
      throw this.input.error("Unknown word", {
        offset: tokens[0][2]
      }, {
        offset: tokens[0][2] + tokens[0][1].length
      });
    };
    _proto.unnamedAtrule = function unnamedAtrule(node2, token) {
      throw this.input.error("At-rule without name", {
        offset: token[2]
      }, {
        offset: token[2] + token[1].length
      });
    };
    return Parser23;
  })();
  var parser$2 = Parser$1$2;
  var Container$2$2 = container$2;
  var Parser22 = parser$2;
  var Input$2$2 = input$2;
  function parse$3$2(css, opts) {
    var input2 = new Input$2$2(css, opts);
    var parser2 = new Parser22(input2);
    try {
      parser2.parse();
    } catch (e22) {
      if (true) {
        if (e22.name === "CssSyntaxError" && opts && opts.from) {
          if (/\.scss$/i.test(opts.from)) {
            e22.message += "\nYou tried to parse SCSS with the standard CSS parser; try again with the postcss-scss parser";
          } else if (/\.sass/i.test(opts.from)) {
            e22.message += "\nYou tried to parse Sass with the standard CSS parser; try again with the postcss-sass parser";
          } else if (/\.less$/i.test(opts.from)) {
            e22.message += "\nYou tried to parse Less with the standard CSS parser; try again with the postcss-less parser";
          }
        }
      }
      throw e22;
    }
    return parser2.root;
  }
  var parse_1$2 = parse$3$2;
  parse$3$2.default = parse$3$2;
  Container$2$2.registerParse(parse$3$2);
  var isClean$4 = symbols$2.isClean;
  var my$4 = symbols$2.my;
  var MapGenerator$1$2 = mapGenerator$2;
  var stringify$2$2 = stringify_1$2;
  var Container$1$2 = container$2;
  var Document$2$2 = document$1$2;
  var warnOnce$1$2 = warnOnce$2$2;
  var Result$2$2 = result$2;
  var parse$2$2 = parse_1$2;
  var Root$3$2 = root$2;
  var TYPE_TO_CLASS_NAME$2 = {
    atrule: "AtRule",
    comment: "Comment",
    decl: "Declaration",
    document: "Document",
    root: "Root",
    rule: "Rule"
  };
  var PLUGIN_PROPS$2 = {
    AtRule: true,
    AtRuleExit: true,
    Comment: true,
    CommentExit: true,
    Declaration: true,
    DeclarationExit: true,
    Document: true,
    DocumentExit: true,
    Once: true,
    OnceExit: true,
    postcssPlugin: true,
    prepare: true,
    Root: true,
    RootExit: true,
    Rule: true,
    RuleExit: true
  };
  var NOT_VISITORS$2 = {
    Once: true,
    postcssPlugin: true,
    prepare: true
  };
  var CHILDREN$2 = 0;
  function isPromise$2(obj) {
    return (typeof obj === "undefined" ? "undefined" : _type_of(obj)) === "object" && typeof obj.then === "function";
  }
  function getEvents$2(node2) {
    var key = false;
    var type = TYPE_TO_CLASS_NAME$2[node2.type];
    if (node2.type === "decl") {
      key = node2.prop.toLowerCase();
    } else if (node2.type === "atrule") {
      key = node2.name.toLowerCase();
    }
    if (key && node2.append) {
      return [
        type,
        type + "-" + key,
        CHILDREN$2,
        type + "Exit",
        type + "Exit-" + key
      ];
    } else if (key) {
      return [
        type,
        type + "-" + key,
        type + "Exit",
        type + "Exit-" + key
      ];
    } else if (node2.append) {
      return [
        type,
        CHILDREN$2,
        type + "Exit"
      ];
    } else {
      return [
        type,
        type + "Exit"
      ];
    }
  }
  function toStack$2(node2) {
    var events;
    if (node2.type === "document") {
      events = [
        "Document",
        CHILDREN$2,
        "DocumentExit"
      ];
    } else if (node2.type === "root") {
      events = [
        "Root",
        CHILDREN$2,
        "RootExit"
      ];
    } else {
      events = getEvents$2(node2);
    }
    return {
      eventIndex: 0,
      events,
      iterator: 0,
      node: node2,
      visitorIndex: 0,
      visitors: []
    };
  }
  function cleanMarks$2(node2) {
    node2[isClean$4] = false;
    if (node2.nodes) node2.nodes.forEach(function(i22) {
      return cleanMarks$2(i22);
    });
    return node2;
  }
  var postcss$2$2 = {};
  var LazyResult$2$2 = /* @__PURE__ */ (function() {
    function LazyResult23(processor2, css, opts) {
      var _this = this;
      this.stringified = false;
      this.processed = false;
      var root2;
      if ((typeof css === "undefined" ? "undefined" : _type_of(css)) === "object" && css !== null && (css.type === "root" || css.type === "document")) {
        root2 = cleanMarks$2(css);
      } else if (_instanceof(css, LazyResult23) || _instanceof(css, Result$2$2)) {
        root2 = cleanMarks$2(css.root);
        if (css.map) {
          if (typeof opts.map === "undefined") opts.map = {};
          if (!opts.map.inline) opts.map.inline = false;
          opts.map.prev = css.map;
        }
      } else {
        var parser2 = parse$2$2;
        if (opts.syntax) parser2 = opts.syntax.parse;
        if (opts.parser) parser2 = opts.parser;
        if (parser2.parse) parser2 = parser2.parse;
        try {
          root2 = parser2(css, opts);
        } catch (error) {
          this.processed = true;
          this.error = error;
        }
        if (root2 && !root2[my$4]) {
          Container$1$2.rebuild(root2);
        }
      }
      this.result = new Result$2$2(processor2, root2, opts);
      this.helpers = _extends({}, postcss$2$2, {
        postcss: postcss$2$2,
        result: this.result
      });
      this.plugins = this.processor.plugins.map(function(plugin22) {
        if ((typeof plugin22 === "undefined" ? "undefined" : _type_of(plugin22)) === "object" && plugin22.prepare) {
          return _extends({}, plugin22, plugin22.prepare(_this.result));
        } else {
          return plugin22;
        }
      });
    }
    var _proto = LazyResult23.prototype;
    _proto.async = function async() {
      if (this.error) return Promise.reject(this.error);
      if (this.processed) return Promise.resolve(this.result);
      if (!this.processing) {
        this.processing = this.runAsync();
      }
      return this.processing;
    };
    _proto.catch = function _catch(onRejected) {
      return this.async().catch(onRejected);
    };
    _proto.finally = function _finally(onFinally) {
      return this.async().then(onFinally, onFinally);
    };
    _proto.getAsyncError = function getAsyncError() {
      throw new Error("Use process(css).then(cb) to work with async plugins");
    };
    _proto.handleError = function handleError(error, node2) {
      var plugin22 = this.result.lastPlugin;
      try {
        if (node2) node2.addToError(error);
        this.error = error;
        if (error.name === "CssSyntaxError" && !error.plugin) {
          error.plugin = plugin22.postcssPlugin;
          error.setMessage();
        } else if (plugin22.postcssVersion) {
          if (true) {
            var pluginName = plugin22.postcssPlugin;
            var pluginVer = plugin22.postcssVersion;
            var runtimeVer = this.result.processor.version;
            var a22 = pluginVer.split(".");
            var b2 = runtimeVer.split(".");
            if (a22[0] !== b2[0] || parseInt(a22[1]) > parseInt(b2[1])) {
              console.error("Unknown error from PostCSS plugin. Your current PostCSS version is " + runtimeVer + ", but " + pluginName + " uses " + pluginVer + ". Perhaps this is the source of the error below.");
            }
          }
        }
      } catch (err) {
        if (console && console.error) console.error(err);
      }
      return error;
    };
    _proto.prepareVisitors = function prepareVisitors() {
      var _this = this;
      this.listeners = {};
      var add = function(plugin222, type, cb) {
        if (!_this.listeners[type]) _this.listeners[type] = [];
        _this.listeners[type].push([
          plugin222,
          cb
        ]);
      };
      for (var _iterator = _create_for_of_iterator_helper_loose(this.plugins), _step; !(_step = _iterator()).done; ) {
        var plugin22 = _step.value;
        if ((typeof plugin22 === "undefined" ? "undefined" : _type_of(plugin22)) === "object") {
          for (var event in plugin22) {
            if (!PLUGIN_PROPS$2[event] && /^[A-Z]/.test(event)) {
              throw new Error("Unknown event " + event + " in " + plugin22.postcssPlugin + ". Try to update PostCSS (" + this.processor.version + " now).");
            }
            if (!NOT_VISITORS$2[event]) {
              if (_type_of(plugin22[event]) === "object") {
                for (var filter in plugin22[event]) {
                  if (filter === "*") {
                    add(plugin22, event, plugin22[event][filter]);
                  } else {
                    add(plugin22, event + "-" + filter.toLowerCase(), plugin22[event][filter]);
                  }
                }
              } else if (typeof plugin22[event] === "function") {
                add(plugin22, event, plugin22[event]);
              }
            }
          }
        }
      }
      this.hasListener = Object.keys(this.listeners).length > 0;
    };
    _proto.runAsync = function runAsync() {
      var _this = this;
      return _async_to_generator(function() {
        var i22, plugin22, promise, error, root2, stack, promise1, e22, node2, _loop, _iterator, _step;
        return _ts_generator(this, function(_state) {
          switch (_state.label) {
            case 0:
              _this.plugin = 0;
              i22 = 0;
              _state.label = 1;
            case 1:
              if (!(i22 < _this.plugins.length)) return [
                3,
                6
              ];
              plugin22 = _this.plugins[i22];
              promise = _this.runOnRoot(plugin22);
              if (!isPromise$2(promise)) return [
                3,
                5
              ];
              _state.label = 2;
            case 2:
              _state.trys.push([
                2,
                4,
                ,
                5
              ]);
              return [
                4,
                promise
              ];
            case 3:
              _state.sent();
              return [
                3,
                5
              ];
            case 4:
              error = _state.sent();
              throw _this.handleError(error);
            case 5:
              i22++;
              return [
                3,
                1
              ];
            case 6:
              _this.prepareVisitors();
              if (!_this.hasListener) return [
                3,
                18
              ];
              root2 = _this.result.root;
              _state.label = 7;
            case 7:
              if (!!root2[isClean$4]) return [
                3,
                14
              ];
              root2[isClean$4] = true;
              stack = [
                toStack$2(root2)
              ];
              _state.label = 8;
            case 8:
              if (!(stack.length > 0)) return [
                3,
                13
              ];
              promise1 = _this.visitTick(stack);
              if (!isPromise$2(promise1)) return [
                3,
                12
              ];
              _state.label = 9;
            case 9:
              _state.trys.push([
                9,
                11,
                ,
                12
              ]);
              return [
                4,
                promise1
              ];
            case 10:
              _state.sent();
              return [
                3,
                12
              ];
            case 11:
              e22 = _state.sent();
              node2 = stack[stack.length - 1].node;
              throw _this.handleError(e22, node2);
            case 12:
              return [
                3,
                8
              ];
            case 13:
              return [
                3,
                7
              ];
            case 14:
              if (!_this.listeners.OnceExit) return [
                3,
                18
              ];
              _loop = function() {
                var _step_value, plugin222, visitor, roots, e23;
                return _ts_generator(this, function(_state2) {
                  switch (_state2.label) {
                    case 0:
                      _step_value = _step.value, plugin222 = _step_value[0], visitor = _step_value[1];
                      _this.result.lastPlugin = plugin222;
                      _state2.label = 1;
                    case 1:
                      _state2.trys.push([
                        1,
                        6,
                        ,
                        7
                      ]);
                      if (!(root2.type === "document")) return [
                        3,
                        3
                      ];
                      roots = root2.nodes.map(function(subRoot) {
                        return visitor(subRoot, _this.helpers);
                      });
                      return [
                        4,
                        Promise.all(roots)
                      ];
                    case 2:
                      _state2.sent();
                      return [
                        3,
                        5
                      ];
                    case 3:
                      return [
                        4,
                        visitor(root2, _this.helpers)
                      ];
                    case 4:
                      _state2.sent();
                      _state2.label = 5;
                    case 5:
                      return [
                        3,
                        7
                      ];
                    case 6:
                      e23 = _state2.sent();
                      throw _this.handleError(e23);
                    case 7:
                      return [
                        2
                      ];
                  }
                });
              };
              _iterator = _create_for_of_iterator_helper_loose(_this.listeners.OnceExit);
              _state.label = 15;
            case 15:
              if (!!(_step = _iterator()).done) return [
                3,
                18
              ];
              return [
                5,
                _ts_values(_loop())
              ];
            case 16:
              _state.sent();
              _state.label = 17;
            case 17:
              return [
                3,
                15
              ];
            case 18:
              _this.processed = true;
              return [
                2,
                _this.stringify()
              ];
          }
        });
      })();
    };
    _proto.runOnRoot = function runOnRoot(plugin22) {
      var _this = this;
      this.result.lastPlugin = plugin22;
      try {
        if ((typeof plugin22 === "undefined" ? "undefined" : _type_of(plugin22)) === "object" && plugin22.Once) {
          if (this.result.root.type === "document") {
            var roots = this.result.root.nodes.map(function(root2) {
              return plugin22.Once(root2, _this.helpers);
            });
            if (isPromise$2(roots[0])) {
              return Promise.all(roots);
            }
            return roots;
          }
          return plugin22.Once(this.result.root, this.helpers);
        } else if (typeof plugin22 === "function") {
          return plugin22(this.result.root, this.result);
        }
      } catch (error) {
        throw this.handleError(error);
      }
    };
    _proto.stringify = function stringify2() {
      if (this.error) throw this.error;
      if (this.stringified) return this.result;
      this.stringified = true;
      this.sync();
      var opts = this.result.opts;
      var str = stringify$2$2;
      if (opts.syntax) str = opts.syntax.stringify;
      if (opts.stringifier) str = opts.stringifier;
      if (str.stringify) str = str.stringify;
      var map = new MapGenerator$1$2(str, this.result.root, this.result.opts);
      var data = map.generate();
      this.result.css = data[0];
      this.result.map = data[1];
      return this.result;
    };
    _proto.sync = function sync() {
      if (this.error) throw this.error;
      if (this.processed) return this.result;
      this.processed = true;
      if (this.processing) {
        throw this.getAsyncError();
      }
      for (var _iterator = _create_for_of_iterator_helper_loose(this.plugins), _step; !(_step = _iterator()).done; ) {
        var plugin22 = _step.value;
        var promise = this.runOnRoot(plugin22);
        if (isPromise$2(promise)) {
          throw this.getAsyncError();
        }
      }
      this.prepareVisitors();
      if (this.hasListener) {
        var root2 = this.result.root;
        while (!root2[isClean$4]) {
          root2[isClean$4] = true;
          this.walkSync(root2);
        }
        if (this.listeners.OnceExit) {
          if (root2.type === "document") {
            for (var _iterator1 = _create_for_of_iterator_helper_loose(root2.nodes), _step1; !(_step1 = _iterator1()).done; ) {
              var subRoot = _step1.value;
              this.visitSync(this.listeners.OnceExit, subRoot);
            }
          } else {
            this.visitSync(this.listeners.OnceExit, root2);
          }
        }
      }
      return this.result;
    };
    _proto.then = function then(onFulfilled, onRejected) {
      if (true) {
        if (!("from" in this.opts)) {
          warnOnce$1$2("Without `from` option PostCSS could generate wrong source map and will not find Browserslist config. Set it to CSS file path or to `undefined` to prevent this warning.");
        }
      }
      return this.async().then(onFulfilled, onRejected);
    };
    _proto.toString = function toString2() {
      return this.css;
    };
    _proto.visitSync = function visitSync(visitors, node2) {
      for (var _iterator = _create_for_of_iterator_helper_loose(visitors), _step; !(_step = _iterator()).done; ) {
        var _step_value = _step.value, plugin22 = _step_value[0], visitor = _step_value[1];
        this.result.lastPlugin = plugin22;
        var promise = void 0;
        try {
          promise = visitor(node2, this.helpers);
        } catch (e22) {
          throw this.handleError(e22, node2.proxyOf);
        }
        if (node2.type !== "root" && node2.type !== "document" && !node2.parent) {
          return true;
        }
        if (isPromise$2(promise)) {
          throw this.getAsyncError();
        }
      }
    };
    _proto.visitTick = function visitTick(stack) {
      var visit2 = stack[stack.length - 1];
      var node2 = visit2.node, visitors = visit2.visitors;
      if (node2.type !== "root" && node2.type !== "document" && !node2.parent) {
        stack.pop();
        return;
      }
      if (visitors.length > 0 && visit2.visitorIndex < visitors.length) {
        var _visitors_visit2_visitorIndex = visitors[visit2.visitorIndex], plugin22 = _visitors_visit2_visitorIndex[0], visitor = _visitors_visit2_visitorIndex[1];
        visit2.visitorIndex += 1;
        if (visit2.visitorIndex === visitors.length) {
          visit2.visitors = [];
          visit2.visitorIndex = 0;
        }
        this.result.lastPlugin = plugin22;
        try {
          return visitor(node2.toProxy(), this.helpers);
        } catch (e22) {
          throw this.handleError(e22, node2);
        }
      }
      if (visit2.iterator !== 0) {
        var iterator = visit2.iterator;
        var child;
        while (child = node2.nodes[node2.indexes[iterator]]) {
          node2.indexes[iterator] += 1;
          if (!child[isClean$4]) {
            child[isClean$4] = true;
            stack.push(toStack$2(child));
            return;
          }
        }
        visit2.iterator = 0;
        delete node2.indexes[iterator];
      }
      var events = visit2.events;
      while (visit2.eventIndex < events.length) {
        var event = events[visit2.eventIndex];
        visit2.eventIndex += 1;
        if (event === CHILDREN$2) {
          if (node2.nodes && node2.nodes.length) {
            node2[isClean$4] = true;
            visit2.iterator = node2.getIterator();
          }
          return;
        } else if (this.listeners[event]) {
          visit2.visitors = this.listeners[event];
          return;
        }
      }
      stack.pop();
    };
    _proto.walkSync = function walkSync(node2) {
      var _this = this;
      node2[isClean$4] = true;
      var events = getEvents$2(node2);
      for (var _iterator = _create_for_of_iterator_helper_loose(events), _step; !(_step = _iterator()).done; ) {
        var event = _step.value;
        if (event === CHILDREN$2) {
          if (node2.nodes) {
            node2.each(function(child) {
              if (!child[isClean$4]) _this.walkSync(child);
            });
          }
        } else {
          var visitors = this.listeners[event];
          if (visitors) {
            if (this.visitSync(visitors, node2.toProxy())) return;
          }
        }
      }
    };
    _proto.warnings = function warnings() {
      return this.sync().warnings();
    };
    _create_class(LazyResult23, [
      {
        key: "content",
        get: function get() {
          return this.stringify().content;
        }
      },
      {
        key: "css",
        get: function get() {
          return this.stringify().css;
        }
      },
      {
        key: "map",
        get: function get() {
          return this.stringify().map;
        }
      },
      {
        key: "messages",
        get: function get() {
          return this.sync().messages;
        }
      },
      {
        key: "opts",
        get: function get() {
          return this.result.opts;
        }
      },
      {
        key: "processor",
        get: function get() {
          return this.result.processor;
        }
      },
      {
        key: "root",
        get: function get() {
          return this.sync().root;
        }
      },
      {
        key: Symbol.toStringTag,
        get: function get() {
          return "LazyResult";
        }
      }
    ]);
    return LazyResult23;
  })();
  LazyResult$2$2.registerPostcss = function(dependant) {
    postcss$2$2 = dependant;
  };
  var lazyResult$2 = LazyResult$2$2;
  LazyResult$2$2.default = LazyResult$2$2;
  Root$3$2.registerLazyResult(LazyResult$2$2);
  Document$2$2.registerLazyResult(LazyResult$2$2);
  var MapGenerator22 = mapGenerator$2;
  var stringify$1$2 = stringify_1$2;
  var warnOnce22 = warnOnce$2$2;
  var parse$1$2 = parse_1$2;
  var Result$1$2 = result$2;
  var NoWorkResult$1$2 = /* @__PURE__ */ (function() {
    function NoWorkResult23(processor2, css, opts) {
      css = css.toString();
      this.stringified = false;
      this._processor = processor2;
      this._css = css;
      this._opts = opts;
      this._map = void 0;
      var root2;
      var str = stringify$1$2;
      this.result = new Result$1$2(this._processor, root2, this._opts);
      this.result.css = css;
      var self2 = this;
      Object.defineProperty(this.result, "root", {
        get: function get() {
          return self2.root;
        }
      });
      var map = new MapGenerator22(str, root2, this._opts, css);
      if (map.isMap()) {
        var _map_generate = map.generate(), generatedCSS = _map_generate[0], generatedMap = _map_generate[1];
        if (generatedCSS) {
          this.result.css = generatedCSS;
        }
        if (generatedMap) {
          this.result.map = generatedMap;
        }
      } else {
        map.clearAnnotation();
        this.result.css = map.css;
      }
    }
    var _proto = NoWorkResult23.prototype;
    _proto.async = function async() {
      if (this.error) return Promise.reject(this.error);
      return Promise.resolve(this.result);
    };
    _proto.catch = function _catch(onRejected) {
      return this.async().catch(onRejected);
    };
    _proto.finally = function _finally(onFinally) {
      return this.async().then(onFinally, onFinally);
    };
    _proto.sync = function sync() {
      if (this.error) throw this.error;
      return this.result;
    };
    _proto.then = function then(onFulfilled, onRejected) {
      if (true) {
        if (!("from" in this._opts)) {
          warnOnce22("Without `from` option PostCSS could generate wrong source map and will not find Browserslist config. Set it to CSS file path or to `undefined` to prevent this warning.");
        }
      }
      return this.async().then(onFulfilled, onRejected);
    };
    _proto.toString = function toString2() {
      return this._css;
    };
    _proto.warnings = function warnings() {
      return [];
    };
    _create_class(NoWorkResult23, [
      {
        key: "content",
        get: function get() {
          return this.result.css;
        }
      },
      {
        key: "css",
        get: function get() {
          return this.result.css;
        }
      },
      {
        key: "map",
        get: function get() {
          return this.result.map;
        }
      },
      {
        key: "messages",
        get: function get() {
          return [];
        }
      },
      {
        key: "opts",
        get: function get() {
          return this.result.opts;
        }
      },
      {
        key: "processor",
        get: function get() {
          return this.result.processor;
        }
      },
      {
        key: "root",
        get: function get() {
          if (this._root) {
            return this._root;
          }
          var root2;
          var parser2 = parse$1$2;
          try {
            root2 = parser2(this._css, this._opts);
          } catch (error) {
            this.error = error;
          }
          if (this.error) {
            throw this.error;
          } else {
            this._root = root2;
            return root2;
          }
        }
      },
      {
        key: Symbol.toStringTag,
        get: function get() {
          return "NoWorkResult";
        }
      }
    ]);
    return NoWorkResult23;
  })();
  var noWorkResult$2 = NoWorkResult$1$2;
  NoWorkResult$1$2.default = NoWorkResult$1$2;
  var NoWorkResult22 = noWorkResult$2;
  var LazyResult$1$2 = lazyResult$2;
  var Document$1$2 = document$1$2;
  var Root$2$2 = root$2;
  var Processor$1$2 = /* @__PURE__ */ (function() {
    function Processor23(plugins) {
      if (plugins === void 0) plugins = [];
      this.version = "8.4.38";
      this.plugins = this.normalize(plugins);
    }
    var _proto = Processor23.prototype;
    _proto.normalize = function normalize(plugins) {
      var normalized = [];
      for (var _iterator = _create_for_of_iterator_helper_loose(plugins), _step; !(_step = _iterator()).done; ) {
        var i22 = _step.value;
        if (i22.postcss === true) {
          i22 = i22();
        } else if (i22.postcss) {
          i22 = i22.postcss;
        }
        if ((typeof i22 === "undefined" ? "undefined" : _type_of(i22)) === "object" && Array.isArray(i22.plugins)) {
          normalized = normalized.concat(i22.plugins);
        } else if ((typeof i22 === "undefined" ? "undefined" : _type_of(i22)) === "object" && i22.postcssPlugin) {
          normalized.push(i22);
        } else if (typeof i22 === "function") {
          normalized.push(i22);
        } else if ((typeof i22 === "undefined" ? "undefined" : _type_of(i22)) === "object" && (i22.parse || i22.stringify)) {
          if (true) {
            throw new Error("PostCSS syntaxes cannot be used as plugins. Instead, please use one of the syntax/parser/stringifier options as outlined in your PostCSS runner documentation.");
          }
        } else {
          throw new Error(i22 + " is not a PostCSS plugin");
        }
      }
      return normalized;
    };
    _proto.process = function process1(css, opts) {
      if (opts === void 0) opts = {};
      if (!this.plugins.length && !opts.parser && !opts.stringifier && !opts.syntax) {
        return new NoWorkResult22(this, css, opts);
      } else {
        return new LazyResult$1$2(this, css, opts);
      }
    };
    _proto.use = function use(plugin22) {
      this.plugins = this.plugins.concat(this.normalize([
        plugin22
      ]));
      return this;
    };
    return Processor23;
  })();
  var processor$2 = Processor$1$2;
  Processor$1$2.default = Processor$1$2;
  Root$2$2.registerProcessor(Processor$1$2);
  Document$1$2.registerProcessor(Processor$1$2);
  var Declaration$1$2 = declaration$2;
  var PreviousMap22 = previousMap$2;
  var Comment$1$2 = comment$2;
  var AtRule$1$2 = atRule$2;
  var Input$1$2 = input$2;
  var Root$1$2 = root$2;
  var Rule$1$2 = rule$2;
  function fromJSON$1$2(json, inputs) {
    if (Array.isArray(json)) return json.map(function(n22) {
      return fromJSON$1$2(n22);
    });
    var ownInputs = json.inputs, defaults = _object_without_properties_loose(json, [
      "inputs"
    ]);
    if (ownInputs) {
      inputs = [];
      for (var _iterator = _create_for_of_iterator_helper_loose(ownInputs), _step; !(_step = _iterator()).done; ) {
        var input2 = _step.value;
        var inputHydrated = _extends({}, input2, {
          __proto__: Input$1$2.prototype
        });
        if (inputHydrated.map) {
          inputHydrated.map = _extends({}, inputHydrated.map, {
            __proto__: PreviousMap22.prototype
          });
        }
        inputs.push(inputHydrated);
      }
    }
    if (defaults.nodes) {
      defaults.nodes = json.nodes.map(function(n22) {
        return fromJSON$1$2(n22, inputs);
      });
    }
    if (defaults.source) {
      var _defaults_source = defaults.source, inputId = _defaults_source.inputId, source = _object_without_properties_loose(_defaults_source, [
        "inputId"
      ]);
      defaults.source = source;
      if (inputId != null) {
        defaults.source.input = inputs[inputId];
      }
    }
    if (defaults.type === "root") {
      return new Root$1$2(defaults);
    } else if (defaults.type === "decl") {
      return new Declaration$1$2(defaults);
    } else if (defaults.type === "rule") {
      return new Rule$1$2(defaults);
    } else if (defaults.type === "comment") {
      return new Comment$1$2(defaults);
    } else if (defaults.type === "atrule") {
      return new AtRule$1$2(defaults);
    } else {
      throw new Error("Unknown node type: " + json.type);
    }
  }
  var fromJSON_1$2 = fromJSON$1$2;
  fromJSON$1$2.default = fromJSON$1$2;
  var CssSyntaxError22 = cssSyntaxError$2;
  var Declaration22 = declaration$2;
  var LazyResult22 = lazyResult$2;
  var Container22 = container$2;
  var Processor22 = processor$2;
  var stringify$6 = stringify_1$2;
  var fromJSON$3 = fromJSON_1$2;
  var Document222 = document$1$2;
  var Warning22 = warning$2;
  var Comment22 = comment$2;
  var AtRule22 = atRule$2;
  var Result22 = result$2;
  var Input22 = input$2;
  var parse$6 = parse_1$2;
  var list$4 = list_1$2;
  var Rule22 = rule$2;
  var Root22 = root$2;
  var Node22 = node$2;
  function postcss$4() {
    for (var _len = arguments.length, plugins = new Array(_len), _key = 0; _key < _len; _key++) {
      plugins[_key] = arguments[_key];
    }
    if (plugins.length === 1 && Array.isArray(plugins[0])) {
      plugins = plugins[0];
    }
    return new Processor22(plugins);
  }
  postcss$4.plugin = function plugin2(name, initializer) {
    var warningPrinted = false;
    function creator() {
      for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {
        args[_key] = arguments[_key];
      }
      if (console && console.warn && !warningPrinted) {
        warningPrinted = true;
        console.warn(name + ": postcss.plugin was deprecated. Migration guide:\nhttps://evilmartians.com/chronicles/postcss-8-plugin-migration");
        if (process.env.LANG && process.env.LANG.startsWith("cn")) {
          console.warn(name + ": \u91CC\u9762 postcss.plugin \u88AB\u5F03\u7528. \u8FC1\u79FB\u6307\u5357:\nhttps://www.w3ctech.com/topic/2226");
        }
      }
      var transformer = initializer.apply(void 0, [].concat(args));
      transformer.postcssPlugin = name;
      transformer.postcssVersion = new Processor22().version;
      return transformer;
    }
    var cache;
    Object.defineProperty(creator, "postcss", {
      get: function get() {
        if (!cache) cache = creator();
        return cache;
      }
    });
    creator.process = function(css, processOpts, pluginOpts) {
      return postcss$4([
        creator(pluginOpts)
      ]).process(css, processOpts);
    };
    return creator;
  };
  postcss$4.stringify = stringify$6;
  postcss$4.parse = parse$6;
  postcss$4.fromJSON = fromJSON$3;
  postcss$4.list = list$4;
  postcss$4.comment = function(defaults) {
    return new Comment22(defaults);
  };
  postcss$4.atRule = function(defaults) {
    return new AtRule22(defaults);
  };
  postcss$4.decl = function(defaults) {
    return new Declaration22(defaults);
  };
  postcss$4.rule = function(defaults) {
    return new Rule22(defaults);
  };
  postcss$4.root = function(defaults) {
    return new Root22(defaults);
  };
  postcss$4.document = function(defaults) {
    return new Document222(defaults);
  };
  postcss$4.CssSyntaxError = CssSyntaxError22;
  postcss$4.Declaration = Declaration22;
  postcss$4.Container = Container22;
  postcss$4.Processor = Processor22;
  postcss$4.Document = Document222;
  postcss$4.Comment = Comment22;
  postcss$4.Warning = Warning22;
  postcss$4.AtRule = AtRule22;
  postcss$4.Result = Result22;
  postcss$4.Input = Input22;
  postcss$4.Rule = Rule22;
  postcss$4.Root = Root22;
  postcss$4.Node = Node22;
  LazyResult22.registerPostcss(postcss$4);
  var postcss_1$2 = postcss$4;
  postcss$4.default = postcss$4;
  var postcss$1$2 = /* @__PURE__ */ getDefaultExportFromCjs$2(postcss_1$2);
  postcss$1$2.stringify;
  postcss$1$2.fromJSON;
  postcss$1$2.plugin;
  postcss$1$2.parse;
  postcss$1$2.list;
  postcss$1$2.document;
  postcss$1$2.comment;
  postcss$1$2.atRule;
  postcss$1$2.rule;
  postcss$1$2.decl;
  postcss$1$2.root;
  postcss$1$2.CssSyntaxError;
  postcss$1$2.Declaration;
  postcss$1$2.Container;
  postcss$1$2.Processor;
  postcss$1$2.Document;
  postcss$1$2.Comment;
  postcss$1$2.Warning;
  postcss$1$2.AtRule;
  postcss$1$2.Result;
  postcss$1$2.Input;
  postcss$1$2.Rule;
  postcss$1$2.Root;
  postcss$1$2.Node;
  var BaseRRNode = /* @__PURE__ */ (function() {
    function BaseRRNode2() {
      for (var _len = arguments.length, _args = new Array(_len), _key = 0; _key < _len; _key++) {
        _args[_key] = arguments[_key];
      }
      __publicField2(this, "parentElement", null);
      __publicField2(this, "parentNode", null);
      __publicField2(this, "ownerDocument");
      __publicField2(this, "firstChild", null);
      __publicField2(this, "lastChild", null);
      __publicField2(this, "previousSibling", null);
      __publicField2(this, "nextSibling", null);
      __publicField2(this, "ELEMENT_NODE", 1);
      __publicField2(this, "TEXT_NODE", 3);
      __publicField2(this, "nodeType");
      __publicField2(this, "nodeName");
      __publicField2(this, "RRNodeType");
    }
    var _proto = BaseRRNode2.prototype;
    _proto.contains = function contains2(node2) {
      if (!_instanceof(node2, BaseRRNode2)) return false;
      else if (node2.ownerDocument !== this.ownerDocument) return false;
      else if (node2 === this) return true;
      while (node2.parentNode) {
        if (node2.parentNode === this) return true;
        node2 = node2.parentNode;
      }
      return false;
    };
    _proto.appendChild = function appendChild(_newChild) {
      throw new Error("RRDomException: Failed to execute 'appendChild' on 'RRNode': This RRNode type does not support this method.");
    };
    _proto.insertBefore = function insertBefore(_newChild, _refChild) {
      throw new Error("RRDomException: Failed to execute 'insertBefore' on 'RRNode': This RRNode type does not support this method.");
    };
    _proto.removeChild = function removeChild(_node) {
      throw new Error("RRDomException: Failed to execute 'removeChild' on 'RRNode': This RRNode type does not support this method.");
    };
    _proto.toString = function toString2() {
      return "RRNode";
    };
    _create_class(BaseRRNode2, [
      {
        key: "childNodes",
        get: function get() {
          var childNodes2 = [];
          var childIterator = this.firstChild;
          while (childIterator) {
            childNodes2.push(childIterator);
            childIterator = childIterator.nextSibling;
          }
          return childNodes2;
        }
      }
    ]);
    return BaseRRNode2;
  })();
  var testableAccessors$2 = {
    Node: [
      "childNodes",
      "parentNode",
      "parentElement",
      "textContent"
    ],
    ShadowRoot: [
      "host",
      "styleSheets"
    ],
    Element: [
      "shadowRoot",
      "querySelector",
      "querySelectorAll"
    ],
    MutationObserver: []
  };
  var testableMethods$2 = {
    Node: [
      "contains",
      "getRootNode"
    ],
    ShadowRoot: [
      "getSelection"
    ],
    Element: [],
    MutationObserver: [
      "constructor"
    ]
  };
  var untaintedBasePrototype$2 = {};
  var isAngularZonePresent$2 = function() {
    return !!globalThis.Zone;
  };
  function getUntaintedPrototype$2(key) {
    if (untaintedBasePrototype$2[key]) return untaintedBasePrototype$2[key];
    var defaultObj = globalThis[key];
    var defaultPrototype = defaultObj.prototype;
    var accessorNames = key in testableAccessors$2 ? testableAccessors$2[key] : void 0;
    var isUntaintedAccessors = Boolean(accessorNames && // @ts-expect-error 2345
    accessorNames.every(function(accessor) {
      var _a2, _b;
      return Boolean((_b = (_a2 = Object.getOwnPropertyDescriptor(defaultPrototype, accessor)) == null ? void 0 : _a2.get) == null ? void 0 : _b.toString().includes("[native code]"));
    }));
    var methodNames = key in testableMethods$2 ? testableMethods$2[key] : void 0;
    var isUntaintedMethods = Boolean(methodNames && methodNames.every(
      // @ts-expect-error 2345
      function(method) {
        var _a2;
        return typeof defaultPrototype[method] === "function" && ((_a2 = defaultPrototype[method]) == null ? void 0 : _a2.toString().includes("[native code]"));
      }
    ));
    if (isUntaintedAccessors && isUntaintedMethods && !isAngularZonePresent$2()) {
      untaintedBasePrototype$2[key] = defaultObj.prototype;
      return defaultObj.prototype;
    }
    try {
      var iframeEl = document.createElement("iframe");
      document.body.appendChild(iframeEl);
      var win2 = iframeEl.contentWindow;
      if (!win2) return defaultObj.prototype;
      var untaintedObject = win2[key].prototype;
      document.body.removeChild(iframeEl);
      if (!untaintedObject) return defaultPrototype;
      return untaintedBasePrototype$2[key] = untaintedObject;
    } catch (e3) {
      return defaultPrototype;
    }
  }
  var untaintedAccessorCache$2 = {};
  function getUntaintedAccessor$2(key, instance, accessor) {
    var _a2;
    var cacheKey = key + "." + String(accessor);
    if (untaintedAccessorCache$2[cacheKey]) return untaintedAccessorCache$2[cacheKey].call(instance);
    var untaintedPrototype = getUntaintedPrototype$2(key);
    var untaintedAccessor = (_a2 = Object.getOwnPropertyDescriptor(untaintedPrototype, accessor)) == null ? void 0 : _a2.get;
    if (!untaintedAccessor) return instance[accessor];
    untaintedAccessorCache$2[cacheKey] = untaintedAccessor;
    return untaintedAccessor.call(instance);
  }
  var untaintedMethodCache$2 = {};
  function getUntaintedMethod$2(key, instance, method) {
    var cacheKey = key + "." + String(method);
    if (untaintedMethodCache$2[cacheKey]) return untaintedMethodCache$2[cacheKey].bind(instance);
    var untaintedPrototype = getUntaintedPrototype$2(key);
    var untaintedMethod = untaintedPrototype[method];
    if (typeof untaintedMethod !== "function") return instance[method];
    untaintedMethodCache$2[cacheKey] = untaintedMethod;
    return untaintedMethod.bind(instance);
  }
  function childNodes$2(n22) {
    return getUntaintedAccessor$2("Node", n22, "childNodes");
  }
  function parentNode$2(n22) {
    return getUntaintedAccessor$2("Node", n22, "parentNode");
  }
  function parentElement$2(n22) {
    return getUntaintedAccessor$2("Node", n22, "parentElement");
  }
  function textContent$2(n22) {
    return getUntaintedAccessor$2("Node", n22, "textContent");
  }
  function contains$2(n22, other) {
    return getUntaintedMethod$2("Node", n22, "contains")(other);
  }
  function getRootNode$2(n22) {
    return getUntaintedMethod$2("Node", n22, "getRootNode")();
  }
  function host$2(n22) {
    if (!n22 || !("host" in n22)) return null;
    return getUntaintedAccessor$2("ShadowRoot", n22, "host");
  }
  function styleSheets$2(n22) {
    return n22.styleSheets;
  }
  function shadowRoot$2(n22) {
    if (!n22 || !("shadowRoot" in n22)) return null;
    return getUntaintedAccessor$2("Element", n22, "shadowRoot");
  }
  function querySelector$2(n22, selectors) {
    return getUntaintedAccessor$2("Element", n22, "querySelector")(selectors);
  }
  function querySelectorAll$2(n22, selectors) {
    return getUntaintedAccessor$2("Element", n22, "querySelectorAll")(selectors);
  }
  function mutationObserverCtor$2() {
    return getUntaintedPrototype$2("MutationObserver").constructor;
  }
  function patch$2(source, name, replacement) {
    try {
      if (!(name in source)) {
        return function() {
        };
      }
      var original = source[name];
      var wrapped = replacement(original);
      if (typeof wrapped === "function") {
        wrapped.prototype = wrapped.prototype || {};
        Object.defineProperties(wrapped, {
          __rrweb_original__: {
            enumerable: false,
            value: original
          }
        });
      }
      source[name] = wrapped;
      return function() {
        source[name] = original;
      };
    } catch (e3) {
      return function() {
      };
    }
  }
  var index$2 = {
    childNodes: childNodes$2,
    parentNode: parentNode$2,
    parentElement: parentElement$2,
    textContent: textContent$2,
    contains: contains$2,
    getRootNode: getRootNode$2,
    host: host$2,
    styleSheets: styleSheets$2,
    shadowRoot: shadowRoot$2,
    querySelector: querySelector$2,
    querySelectorAll: querySelectorAll$2,
    mutationObserver: mutationObserverCtor$2,
    patch: patch$2
  };
  function on2(type, fn2, target) {
    if (target === void 0) target = document;
    var options = {
      capture: true,
      passive: true
    };
    target.addEventListener(type, fn2, options);
    return function() {
      return target.removeEventListener(type, fn2, options);
    };
  }
  var DEPARTED_MIRROR_ACCESS_WARNING = "Please stop import mirror directly. Instead of that,\r\nnow you can use replayer.getMirror() to access the mirror instance of a replayer,\r\nor you can use record.mirror to access the mirror instance during recording.";
  var _mirror = {
    map: {},
    getId: function getId() {
      console.error(DEPARTED_MIRROR_ACCESS_WARNING);
      return -1;
    },
    getNode: function getNode() {
      console.error(DEPARTED_MIRROR_ACCESS_WARNING);
      return null;
    },
    removeNodeFromMap: function removeNodeFromMap() {
      console.error(DEPARTED_MIRROR_ACCESS_WARNING);
    },
    has: function has() {
      console.error(DEPARTED_MIRROR_ACCESS_WARNING);
      return false;
    },
    reset: function reset() {
      console.error(DEPARTED_MIRROR_ACCESS_WARNING);
    }
  };
  if (typeof window !== "undefined" && window.Proxy && window.Reflect) {
    _mirror = new Proxy(_mirror, {
      get: function get(target, prop, receiver) {
        if (prop === "map") {
          console.error(DEPARTED_MIRROR_ACCESS_WARNING);
        }
        return Reflect.get(target, prop, receiver);
      }
    });
  }
  function throttle(func, wait, options) {
    if (options === void 0) options = {};
    var timeout = null;
    var previous = 0;
    return function() {
      for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {
        args[_key] = arguments[_key];
      }
      var now = Date.now();
      if (!previous && options.leading === false) {
        previous = now;
      }
      var remaining = wait - (now - previous);
      var context = this;
      if (remaining <= 0 || remaining > wait) {
        if (timeout) {
          clearTimeout(timeout);
          timeout = null;
        }
        previous = now;
        func.apply(context, args);
      } else if (!timeout && options.trailing !== false) {
        timeout = setTimeout(function() {
          previous = options.leading === false ? 0 : Date.now();
          timeout = null;
          func.apply(context, args);
        }, remaining);
      }
    };
  }
  function hookSetter(target, key, d3, isRevoked, win2) {
    if (win2 === void 0) win2 = window;
    var original = win2.Object.getOwnPropertyDescriptor(target, key);
    win2.Object.defineProperty(target, key, isRevoked ? d3 : {
      set: function set(value) {
        var _this = this;
        setTimeout(function() {
          d3.set.call(_this, value);
        }, 0);
        if (original && original.set) {
          original.set.call(this, value);
        }
      }
    });
    return function() {
      return hookSetter(target, key, original || {}, true);
    };
  }
  var nowTimestamp = Date.now;
  if (!/* @__PURE__ */ /[1-9][0-9]{12}/.test(Date.now().toString())) {
    nowTimestamp = function() {
      return /* @__PURE__ */ (/* @__PURE__ */ new Date()).getTime();
    };
  }
  function getWindowScroll(win2) {
    var _a2, _b, _c, _d;
    var doc = win2.document;
    return {
      left: doc.scrollingElement ? doc.scrollingElement.scrollLeft : win2.pageXOffset !== void 0 ? win2.pageXOffset : doc.documentElement.scrollLeft || (doc == null ? void 0 : doc.body) && ((_a2 = index$2.parentElement(doc.body)) == null ? void 0 : _a2.scrollLeft) || ((_b = doc == null ? void 0 : doc.body) == null ? void 0 : _b.scrollLeft) || 0,
      top: doc.scrollingElement ? doc.scrollingElement.scrollTop : win2.pageYOffset !== void 0 ? win2.pageYOffset : (doc == null ? void 0 : doc.documentElement.scrollTop) || (doc == null ? void 0 : doc.body) && ((_c = index$2.parentElement(doc.body)) == null ? void 0 : _c.scrollTop) || ((_d = doc == null ? void 0 : doc.body) == null ? void 0 : _d.scrollTop) || 0
    };
  }
  function getWindowHeight() {
    return window.innerHeight || document.documentElement && document.documentElement.clientHeight || document.body && document.body.clientHeight;
  }
  function getWindowWidth() {
    return window.innerWidth || document.documentElement && document.documentElement.clientWidth || document.body && document.body.clientWidth;
  }
  function closestElementOfNode(node2) {
    if (!node2) {
      return null;
    }
    var el = node2.nodeType === node2.ELEMENT_NODE ? node2 : index$2.parentElement(node2);
    return el;
  }
  function isBlocked(node2, blockClass, blockSelector, checkAncestors) {
    if (!node2) {
      return false;
    }
    var el = closestElementOfNode(node2);
    if (!el) {
      return false;
    }
    try {
      if (typeof blockClass === "string") {
        if (el.classList.contains(blockClass)) return true;
        if (checkAncestors && el.closest("." + blockClass) !== null) return true;
      } else {
        if (classMatchesRegex$1(el, blockClass, checkAncestors)) return true;
      }
    } catch (e22) {
    }
    if (blockSelector) {
      if (el.matches(blockSelector)) return true;
      if (checkAncestors && el.closest(blockSelector) !== null) return true;
    }
    return false;
  }
  function isSerialized(n22, mirror2) {
    return mirror2.getId(n22) !== -1;
  }
  function isIgnored(n22, mirror2, slimDOMOptions) {
    if (n22.tagName === "TITLE" && slimDOMOptions.headTitleMutations) {
      return true;
    }
    return mirror2.getId(n22) === IGNORED_NODE;
  }
  function isAncestorRemoved(target, mirror2) {
    if (isShadowRoot(target)) {
      return false;
    }
    var id = mirror2.getId(target);
    if (!mirror2.has(id)) {
      return true;
    }
    var parent = index$2.parentNode(target);
    if (parent && parent.nodeType === target.DOCUMENT_NODE) {
      return false;
    }
    if (!parent) {
      return true;
    }
    return isAncestorRemoved(parent, mirror2);
  }
  function legacy_isTouchEvent(event) {
    return Boolean(event.changedTouches);
  }
  function polyfill$1(win2) {
    if (win2 === void 0) win2 = window;
    if ("NodeList" in win2 && !win2.NodeList.prototype.forEach) {
      win2.NodeList.prototype.forEach = Array.prototype.forEach;
    }
    if ("DOMTokenList" in win2 && !win2.DOMTokenList.prototype.forEach) {
      win2.DOMTokenList.prototype.forEach = Array.prototype.forEach;
    }
  }
  function isSerializedIframe(n22, mirror2) {
    return Boolean(n22.nodeName === "IFRAME" && mirror2.getMeta(n22));
  }
  function isSerializedStylesheet(n22, mirror2) {
    return Boolean(n22.nodeName === "LINK" && n22.nodeType === n22.ELEMENT_NODE && n22.getAttribute && n22.getAttribute("rel") === "stylesheet" && mirror2.getMeta(n22));
  }
  function hasShadowRoot(n22) {
    if (!n22) return false;
    if (_instanceof(n22, BaseRRNode) && "shadowRoot" in n22) {
      return Boolean(n22.shadowRoot);
    }
    return Boolean(index$2.shadowRoot(n22));
  }
  var StyleSheetMirror = /* @__PURE__ */ (function() {
    function StyleSheetMirror2() {
      __publicField$1(this, "id", 1);
      __publicField$1(this, "styleIDMap", /* @__PURE__ */ new WeakMap());
      __publicField$1(this, "idStyleMap", /* @__PURE__ */ new Map());
    }
    var _proto = StyleSheetMirror2.prototype;
    _proto.getId = function getId2(stylesheet) {
      var _this_styleIDMap_get;
      return (_this_styleIDMap_get = this.styleIDMap.get(stylesheet)) != null ? _this_styleIDMap_get : -1;
    };
    _proto.has = function has2(stylesheet) {
      return this.styleIDMap.has(stylesheet);
    };
    _proto.add = function add(stylesheet, id) {
      if (this.has(stylesheet)) return this.getId(stylesheet);
      var newId;
      if (id === void 0) {
        newId = this.id++;
      } else newId = id;
      this.styleIDMap.set(stylesheet, newId);
      this.idStyleMap.set(newId, stylesheet);
      return newId;
    };
    _proto.getStyle = function getStyle(id) {
      return this.idStyleMap.get(id) || null;
    };
    _proto.reset = function reset2() {
      this.styleIDMap = /* @__PURE__ */ new WeakMap();
      this.idStyleMap = /* @__PURE__ */ new Map();
      this.id = 1;
    };
    _proto.generateId = function generateId() {
      return this.id++;
    };
    return StyleSheetMirror2;
  })();
  function getShadowHost(n22) {
    var _a2;
    var shadowHost = null;
    if ("getRootNode" in n22 && ((_a2 = index$2.getRootNode(n22)) == null ? void 0 : _a2.nodeType) === Node.DOCUMENT_FRAGMENT_NODE && index$2.host(index$2.getRootNode(n22))) shadowHost = index$2.host(index$2.getRootNode(n22));
    return shadowHost;
  }
  function getRootShadowHost(n22) {
    var rootShadowHost = n22;
    var shadowHost;
    while (shadowHost = getShadowHost(rootShadowHost)) rootShadowHost = shadowHost;
    return rootShadowHost;
  }
  function shadowHostInDom(n22) {
    var doc = n22.ownerDocument;
    if (!doc) return false;
    var shadowHost = getRootShadowHost(n22);
    return index$2.contains(doc, shadowHost);
  }
  function inDom(n22) {
    var doc = n22.ownerDocument;
    if (!doc) return false;
    return index$2.contains(doc, n22) || shadowHostInDom(n22);
  }
  var EventType = /* @__PURE__ */ (function(EventType2) {
    EventType2[EventType2["DomContentLoaded"] = 0] = "DomContentLoaded";
    EventType2[EventType2["Load"] = 1] = "Load";
    EventType2[EventType2["FullSnapshot"] = 2] = "FullSnapshot";
    EventType2[EventType2["IncrementalSnapshot"] = 3] = "IncrementalSnapshot";
    EventType2[EventType2["Meta"] = 4] = "Meta";
    EventType2[EventType2["Custom"] = 5] = "Custom";
    EventType2[EventType2["Plugin"] = 6] = "Plugin";
    return EventType2;
  })(EventType || {});
  var IncrementalSource = /* @__PURE__ */ (function(IncrementalSource2) {
    IncrementalSource2[IncrementalSource2["Mutation"] = 0] = "Mutation";
    IncrementalSource2[IncrementalSource2["MouseMove"] = 1] = "MouseMove";
    IncrementalSource2[IncrementalSource2["MouseInteraction"] = 2] = "MouseInteraction";
    IncrementalSource2[IncrementalSource2["Scroll"] = 3] = "Scroll";
    IncrementalSource2[IncrementalSource2["ViewportResize"] = 4] = "ViewportResize";
    IncrementalSource2[IncrementalSource2["Input"] = 5] = "Input";
    IncrementalSource2[IncrementalSource2["TouchMove"] = 6] = "TouchMove";
    IncrementalSource2[IncrementalSource2["MediaInteraction"] = 7] = "MediaInteraction";
    IncrementalSource2[IncrementalSource2["StyleSheetRule"] = 8] = "StyleSheetRule";
    IncrementalSource2[IncrementalSource2["CanvasMutation"] = 9] = "CanvasMutation";
    IncrementalSource2[IncrementalSource2["Font"] = 10] = "Font";
    IncrementalSource2[IncrementalSource2["Log"] = 11] = "Log";
    IncrementalSource2[IncrementalSource2["Drag"] = 12] = "Drag";
    IncrementalSource2[IncrementalSource2["StyleDeclaration"] = 13] = "StyleDeclaration";
    IncrementalSource2[IncrementalSource2["Selection"] = 14] = "Selection";
    IncrementalSource2[IncrementalSource2["AdoptedStyleSheet"] = 15] = "AdoptedStyleSheet";
    IncrementalSource2[IncrementalSource2["CustomElement"] = 16] = "CustomElement";
    return IncrementalSource2;
  })(IncrementalSource || {});
  var MouseInteractions = /* @__PURE__ */ (function(MouseInteractions2) {
    MouseInteractions2[MouseInteractions2["MouseUp"] = 0] = "MouseUp";
    MouseInteractions2[MouseInteractions2["MouseDown"] = 1] = "MouseDown";
    MouseInteractions2[MouseInteractions2["Click"] = 2] = "Click";
    MouseInteractions2[MouseInteractions2["ContextMenu"] = 3] = "ContextMenu";
    MouseInteractions2[MouseInteractions2["DblClick"] = 4] = "DblClick";
    MouseInteractions2[MouseInteractions2["Focus"] = 5] = "Focus";
    MouseInteractions2[MouseInteractions2["Blur"] = 6] = "Blur";
    MouseInteractions2[MouseInteractions2["TouchStart"] = 7] = "TouchStart";
    MouseInteractions2[MouseInteractions2["TouchMove_Departed"] = 8] = "TouchMove_Departed";
    MouseInteractions2[MouseInteractions2["TouchEnd"] = 9] = "TouchEnd";
    MouseInteractions2[MouseInteractions2["TouchCancel"] = 10] = "TouchCancel";
    return MouseInteractions2;
  })(MouseInteractions || {});
  var PointerTypes = /* @__PURE__ */ (function(PointerTypes2) {
    PointerTypes2[PointerTypes2["Mouse"] = 0] = "Mouse";
    PointerTypes2[PointerTypes2["Pen"] = 1] = "Pen";
    PointerTypes2[PointerTypes2["Touch"] = 2] = "Touch";
    return PointerTypes2;
  })(PointerTypes || {});
  var CanvasContext = /* @__PURE__ */ (function(CanvasContext2) {
    CanvasContext2[CanvasContext2["2D"] = 0] = "2D";
    CanvasContext2[CanvasContext2["WebGL"] = 1] = "WebGL";
    CanvasContext2[CanvasContext2["WebGL2"] = 2] = "WebGL2";
    return CanvasContext2;
  })(CanvasContext || {});
  var MediaInteractions = /* @__PURE__ */ (function(MediaInteractions2) {
    MediaInteractions2[MediaInteractions2["Play"] = 0] = "Play";
    MediaInteractions2[MediaInteractions2["Pause"] = 1] = "Pause";
    MediaInteractions2[MediaInteractions2["Seeked"] = 2] = "Seeked";
    MediaInteractions2[MediaInteractions2["VolumeChange"] = 3] = "VolumeChange";
    MediaInteractions2[MediaInteractions2["RateChange"] = 4] = "RateChange";
    return MediaInteractions2;
  })(MediaInteractions || {});
  var NodeType = /* @__PURE__ */ (function(NodeType2) {
    NodeType2[NodeType2["Document"] = 0] = "Document";
    NodeType2[NodeType2["DocumentType"] = 1] = "DocumentType";
    NodeType2[NodeType2["Element"] = 2] = "Element";
    NodeType2[NodeType2["Text"] = 3] = "Text";
    NodeType2[NodeType2["CDATA"] = 4] = "CDATA";
    NodeType2[NodeType2["Comment"] = 5] = "Comment";
    return NodeType2;
  })(NodeType || {});
  function isNodeInLinkedList(n22) {
    return "__ln" in n22;
  }
  var DoubleLinkedList = /* @__PURE__ */ (function() {
    function DoubleLinkedList2() {
      __publicField$1(this, "length", 0);
      __publicField$1(this, "head", null);
      __publicField$1(this, "tail", null);
    }
    var _proto = DoubleLinkedList2.prototype;
    _proto.get = function get(position) {
      if (position >= this.length) {
        throw new Error("Position outside of list range");
      }
      var current = this.head;
      for (var index2 = 0; index2 < position; index2++) {
        current = (current == null ? void 0 : current.next) || null;
      }
      return current;
    };
    _proto.addNode = function addNode(n22) {
      var node2 = {
        value: n22,
        previous: null,
        next: null
      };
      n22.__ln = node2;
      if (n22.previousSibling && isNodeInLinkedList(n22.previousSibling)) {
        var current = n22.previousSibling.__ln.next;
        node2.next = current;
        node2.previous = n22.previousSibling.__ln;
        n22.previousSibling.__ln.next = node2;
        if (current) {
          current.previous = node2;
        }
      } else if (n22.nextSibling && isNodeInLinkedList(n22.nextSibling) && n22.nextSibling.__ln.previous) {
        var current1 = n22.nextSibling.__ln.previous;
        node2.previous = current1;
        node2.next = n22.nextSibling.__ln;
        n22.nextSibling.__ln.previous = node2;
        if (current1) {
          current1.next = node2;
        }
      } else {
        if (this.head) {
          this.head.previous = node2;
        }
        node2.next = this.head;
        this.head = node2;
      }
      if (node2.next === null) {
        this.tail = node2;
      }
      this.length++;
    };
    _proto.removeNode = function removeNode(n22) {
      var current = n22.__ln;
      if (!this.head) {
        return;
      }
      if (!current.previous) {
        this.head = current.next;
        if (this.head) {
          this.head.previous = null;
        } else {
          this.tail = null;
        }
      } else {
        current.previous.next = current.next;
        if (current.next) {
          current.next.previous = current.previous;
        } else {
          this.tail = current.previous;
        }
      }
      if (n22.__ln) {
        delete n22.__ln;
      }
      this.length--;
    };
    return DoubleLinkedList2;
  })();
  var moveKey = function(id, parentId) {
    return id + "@" + parentId;
  };
  var MutationBuffer = /* @__PURE__ */ (function() {
    function MutationBuffer2() {
      var _this = this;
      __publicField$1(this, "frozen", false);
      __publicField$1(this, "locked", false);
      __publicField$1(this, "texts", []);
      __publicField$1(this, "attributes", []);
      __publicField$1(this, "attributeMap", /* @__PURE__ */ new WeakMap());
      __publicField$1(this, "removes", []);
      __publicField$1(this, "mapRemoves", []);
      __publicField$1(this, "movedMap", {});
      __publicField$1(this, "addedSet", /* @__PURE__ */ new Set());
      __publicField$1(this, "movedSet", /* @__PURE__ */ new Set());
      __publicField$1(this, "droppedSet", /* @__PURE__ */ new Set());
      __publicField$1(this, "removesSubTreeCache", /* @__PURE__ */ new Set());
      __publicField$1(this, "mutationCb");
      __publicField$1(this, "blockClass");
      __publicField$1(this, "blockSelector");
      __publicField$1(this, "maskTextClass");
      __publicField$1(this, "maskTextSelector");
      __publicField$1(this, "inlineStylesheet");
      __publicField$1(this, "maskInputOptions");
      __publicField$1(this, "maskTextFn");
      __publicField$1(this, "maskInputFn");
      __publicField$1(this, "keepIframeSrcFn");
      __publicField$1(this, "recordCanvas");
      __publicField$1(this, "inlineImages");
      __publicField$1(this, "slimDOMOptions");
      __publicField$1(this, "dataURLOptions");
      __publicField$1(this, "doc");
      __publicField$1(this, "mirror");
      __publicField$1(this, "iframeManager");
      __publicField$1(this, "stylesheetManager");
      __publicField$1(this, "shadowDomManager");
      __publicField$1(this, "canvasManager");
      __publicField$1(this, "processedNodeManager");
      __publicField$1(this, "unattachedDoc");
      __publicField$1(this, "processMutations", function(mutations) {
        mutations.forEach(_this.processMutation);
        _this.emit();
      });
      __publicField$1(this, "emit", function() {
        if (_this.frozen || _this.locked) {
          return;
        }
        var adds = [];
        var addedIds = /* @__PURE__ */ new Set();
        var addList = new DoubleLinkedList();
        var getNextId = function(n23) {
          var ns = n23;
          var nextId2 = IGNORED_NODE;
          while (nextId2 === IGNORED_NODE) {
            ns = ns && ns.nextSibling;
            nextId2 = ns && _this.mirror.getId(ns);
          }
          return nextId2;
        };
        var pushAdd = function(n23) {
          var parent2 = index$2.parentNode(n23);
          if (!parent2 || !inDom(n23)) {
            return;
          }
          var cssCaptured = false;
          if (n23.nodeType === Node.TEXT_NODE) {
            var parentTag = parent2.tagName;
            if (parentTag === "TEXTAREA") {
              return;
            } else if (parentTag === "STYLE" && _this.addedSet.has(parent2)) {
              cssCaptured = true;
            }
          }
          var parentId3 = isShadowRoot(parent2) ? _this.mirror.getId(getShadowHost(n23)) : _this.mirror.getId(parent2);
          var nextId2 = getNextId(n23);
          if (parentId3 === -1 || nextId2 === -1) {
            return addList.addNode(n23);
          }
          var sn2 = serializeNodeWithId(n23, {
            doc: _this.doc,
            mirror: _this.mirror,
            blockClass: _this.blockClass,
            blockSelector: _this.blockSelector,
            maskTextClass: _this.maskTextClass,
            maskTextSelector: _this.maskTextSelector,
            skipChild: true,
            newlyAddedElement: true,
            inlineStylesheet: _this.inlineStylesheet,
            maskInputOptions: _this.maskInputOptions,
            maskTextFn: _this.maskTextFn,
            maskInputFn: _this.maskInputFn,
            slimDOMOptions: _this.slimDOMOptions,
            dataURLOptions: _this.dataURLOptions,
            recordCanvas: _this.recordCanvas,
            inlineImages: _this.inlineImages,
            onSerialize: function(currentN) {
              if (isSerializedIframe(currentN, _this.mirror)) {
                _this.iframeManager.addIframe(currentN);
              }
              if (isSerializedStylesheet(currentN, _this.mirror)) {
                _this.stylesheetManager.trackLinkElement(currentN);
              }
              if (hasShadowRoot(n23)) {
                _this.shadowDomManager.addShadowRoot(index$2.shadowRoot(n23), _this.doc);
              }
            },
            onIframeLoad: function(iframe, childSn) {
              _this.iframeManager.attachIframe(iframe, childSn);
              _this.shadowDomManager.observeAttachShadow(iframe);
            },
            onStylesheetLoad: function(link, childSn) {
              _this.stylesheetManager.attachLinkElement(link, childSn);
            },
            cssCaptured
          });
          if (sn2) {
            adds.push({
              parentId: parentId3,
              nextId: nextId2,
              node: sn2
            });
            addedIds.add(sn2.id);
          }
        };
        while (_this.mapRemoves.length) {
          _this.mirror.removeNodeFromMap(_this.mapRemoves.shift());
        }
        for (var _iterator = _create_for_of_iterator_helper_loose(_this.movedSet), _step; !(_step = _iterator()).done; ) {
          var n22 = _step.value;
          if (isParentRemoved(_this.removesSubTreeCache, n22, _this.mirror) && !_this.movedSet.has(index$2.parentNode(n22))) {
            continue;
          }
          pushAdd(n22);
        }
        for (var _iterator1 = _create_for_of_iterator_helper_loose(_this.addedSet), _step1; !(_step1 = _iterator1()).done; ) {
          var n21 = _step1.value;
          if (!isAncestorInSet(_this.droppedSet, n21) && !isParentRemoved(_this.removesSubTreeCache, n21, _this.mirror)) {
            pushAdd(n21);
          } else if (isAncestorInSet(_this.movedSet, n21)) {
            pushAdd(n21);
          } else {
            _this.droppedSet.add(n21);
          }
        }
        var candidate = null;
        while (addList.length) {
          var node2 = null;
          if (candidate) {
            var parentId = _this.mirror.getId(index$2.parentNode(candidate.value));
            var nextId = getNextId(candidate.value);
            if (parentId !== -1 && nextId !== -1) {
              node2 = candidate;
            }
          }
          if (!node2) {
            var tailNode = addList.tail;
            while (tailNode) {
              var _node = tailNode;
              tailNode = tailNode.previous;
              if (_node) {
                var parentId1 = _this.mirror.getId(index$2.parentNode(_node.value));
                var nextId1 = getNextId(_node.value);
                if (nextId1 === -1) continue;
                else if (parentId1 !== -1) {
                  node2 = _node;
                  break;
                } else {
                  var unhandledNode = _node.value;
                  var parent = index$2.parentNode(unhandledNode);
                  if (parent && parent.nodeType === Node.DOCUMENT_FRAGMENT_NODE) {
                    var shadowHost = index$2.host(parent);
                    var parentId2 = _this.mirror.getId(shadowHost);
                    if (parentId2 !== -1) {
                      node2 = _node;
                      break;
                    }
                  }
                }
              }
            }
          }
          if (!node2) {
            while (addList.head) {
              addList.removeNode(addList.head.value);
            }
            break;
          }
          candidate = node2.previous;
          addList.removeNode(node2.value);
          pushAdd(node2.value);
        }
        var payload = {
          texts: _this.texts.map(function(text) {
            var n23 = text.node;
            var parent2 = index$2.parentNode(n23);
            if (parent2 && parent2.tagName === "TEXTAREA") {
              _this.genTextAreaValueMutation(parent2);
            }
            return {
              id: _this.mirror.getId(n23),
              value: text.value
            };
          }).filter(function(text) {
            return !addedIds.has(text.id);
          }).filter(function(text) {
            return _this.mirror.has(text.id);
          }),
          attributes: _this.attributes.map(function(attribute) {
            var attributes = attribute.attributes;
            if (typeof attributes.style === "string") {
              var diffAsStr = JSON.stringify(attribute.styleDiff);
              var unchangedAsStr = JSON.stringify(attribute._unchangedStyles);
              if (diffAsStr.length < attributes.style.length) {
                if ((diffAsStr + unchangedAsStr).split("var(").length === attributes.style.split("var(").length) {
                  attributes.style = attribute.styleDiff;
                }
              }
            }
            return {
              id: _this.mirror.getId(attribute.node),
              attributes
            };
          }).filter(function(attribute) {
            return !addedIds.has(attribute.id);
          }).filter(function(attribute) {
            return _this.mirror.has(attribute.id);
          }),
          removes: _this.removes,
          adds
        };
        if (!payload.texts.length && !payload.attributes.length && !payload.removes.length && !payload.adds.length) {
          return;
        }
        _this.texts = [];
        _this.attributes = [];
        _this.attributeMap = /* @__PURE__ */ new WeakMap();
        _this.removes = [];
        _this.addedSet = /* @__PURE__ */ new Set();
        _this.movedSet = /* @__PURE__ */ new Set();
        _this.droppedSet = /* @__PURE__ */ new Set();
        _this.removesSubTreeCache = /* @__PURE__ */ new Set();
        _this.movedMap = {};
        _this.mutationCb(payload);
      });
      __publicField$1(this, "genTextAreaValueMutation", function(textarea) {
        var item = _this.attributeMap.get(textarea);
        if (!item) {
          item = {
            node: textarea,
            attributes: {},
            styleDiff: {},
            _unchangedStyles: {}
          };
          _this.attributes.push(item);
          _this.attributeMap.set(textarea, item);
        }
        var value = Array.from(index$2.childNodes(textarea), function(cn2) {
          return index$2.textContent(cn2) || "";
        }).join("");
        item.attributes.value = maskInputValue({
          element: textarea,
          maskInputOptions: _this.maskInputOptions,
          tagName: textarea.tagName,
          type: getInputType(textarea),
          value,
          maskInputFn: _this.maskInputFn
        });
      });
      __publicField$1(this, "processMutation", function(m3) {
        if (isIgnored(m3.target, _this.mirror, _this.slimDOMOptions)) {
          return;
        }
        switch (m3.type) {
          case "characterData": {
            var value = index$2.textContent(m3.target);
            if (!isBlocked(m3.target, _this.blockClass, _this.blockSelector, false) && value !== m3.oldValue) {
              _this.texts.push({
                value: needMaskingText(m3.target, _this.maskTextClass, _this.maskTextSelector, true) && value ? _this.maskTextFn ? _this.maskTextFn(value, closestElementOfNode(m3.target)) : value.replace(/[\S]/g, "*") : value,
                node: m3.target
              });
            }
            break;
          }
          case "attributes": {
            var target = m3.target;
            var attributeName = m3.attributeName;
            var value1 = m3.target.getAttribute(attributeName);
            if (attributeName === "value") {
              var type = getInputType(target);
              value1 = maskInputValue({
                element: target,
                maskInputOptions: _this.maskInputOptions,
                tagName: target.tagName,
                type,
                value: value1,
                maskInputFn: _this.maskInputFn
              });
            }
            if (isBlocked(m3.target, _this.blockClass, _this.blockSelector, false) || value1 === m3.oldValue) {
              return;
            }
            var item = _this.attributeMap.get(m3.target);
            if (target.tagName === "IFRAME" && attributeName === "src" && !_this.keepIframeSrcFn(value1)) {
              if (!target.contentDocument) {
                attributeName = "rr_src";
              } else {
                return;
              }
            }
            if (!item) {
              item = {
                node: m3.target,
                attributes: {},
                styleDiff: {},
                _unchangedStyles: {}
              };
              _this.attributes.push(item);
              _this.attributeMap.set(m3.target, item);
            }
            if (attributeName === "type" && target.tagName === "INPUT" && (m3.oldValue || "").toLowerCase() === "password") {
              target.setAttribute("data-rr-is-password", "true");
            }
            if (!ignoreAttribute(target.tagName, attributeName)) {
              item.attributes[attributeName] = transformAttribute(_this.doc, toLowerCase(target.tagName), toLowerCase(attributeName), value1);
              if (attributeName === "style") {
                if (!_this.unattachedDoc) {
                  try {
                    _this.unattachedDoc = document.implementation.createHTMLDocument();
                  } catch (e22) {
                    _this.unattachedDoc = _this.doc;
                  }
                }
                var old = _this.unattachedDoc.createElement("span");
                if (m3.oldValue) {
                  old.setAttribute("style", m3.oldValue);
                }
                for (var _iterator = _create_for_of_iterator_helper_loose(Array.from(target.style)), _step; !(_step = _iterator()).done; ) {
                  var pname = _step.value;
                  var newValue = target.style.getPropertyValue(pname);
                  var newPriority = target.style.getPropertyPriority(pname);
                  if (newValue !== old.style.getPropertyValue(pname) || newPriority !== old.style.getPropertyPriority(pname)) {
                    if (newPriority === "") {
                      item.styleDiff[pname] = newValue;
                    } else {
                      item.styleDiff[pname] = [
                        newValue,
                        newPriority
                      ];
                    }
                  } else {
                    item._unchangedStyles[pname] = [
                      newValue,
                      newPriority
                    ];
                  }
                }
                for (var _iterator1 = _create_for_of_iterator_helper_loose(Array.from(old.style)), _step1; !(_step1 = _iterator1()).done; ) {
                  var pname1 = _step1.value;
                  if (target.style.getPropertyValue(pname1) === "") {
                    item.styleDiff[pname1] = false;
                  }
                }
              } else if (attributeName === "open" && target.tagName === "DIALOG") {
                if (target.matches("dialog:modal")) {
                  item.attributes["rr_open_mode"] = "modal";
                } else {
                  item.attributes["rr_open_mode"] = "non-modal";
                }
              }
            }
            break;
          }
          case "childList": {
            if (isBlocked(m3.target, _this.blockClass, _this.blockSelector, true)) return;
            if (m3.target.tagName === "TEXTAREA") {
              _this.genTextAreaValueMutation(m3.target);
              return;
            }
            m3.addedNodes.forEach(function(n22) {
              return _this.genAdds(n22, m3.target);
            });
            m3.removedNodes.forEach(function(n22) {
              var nodeId = _this.mirror.getId(n22);
              var parentId = isShadowRoot(m3.target) ? _this.mirror.getId(index$2.host(m3.target)) : _this.mirror.getId(m3.target);
              if (isBlocked(m3.target, _this.blockClass, _this.blockSelector, false) || isIgnored(n22, _this.mirror, _this.slimDOMOptions) || !isSerialized(n22, _this.mirror)) {
                return;
              }
              if (_this.addedSet.has(n22)) {
                deepDelete(_this.addedSet, n22);
                _this.droppedSet.add(n22);
              } else if (_this.addedSet.has(m3.target) && nodeId === -1) ;
              else if (isAncestorRemoved(m3.target, _this.mirror)) ;
              else if (_this.movedSet.has(n22) && _this.movedMap[moveKey(nodeId, parentId)]) {
                deepDelete(_this.movedSet, n22);
              } else {
                _this.removes.push({
                  parentId,
                  id: nodeId,
                  isShadow: isShadowRoot(m3.target) && isNativeShadowDom(m3.target) ? true : void 0
                });
                processRemoves(n22, _this.removesSubTreeCache);
              }
              _this.mapRemoves.push(n22);
            });
            break;
          }
        }
      });
      __publicField$1(this, "genAdds", function(n22, target) {
        if (_this.processedNodeManager.inOtherBuffer(n22, _this)) return;
        if (_this.addedSet.has(n22) || _this.movedSet.has(n22)) return;
        if (_this.mirror.hasNode(n22)) {
          if (isIgnored(n22, _this.mirror, _this.slimDOMOptions)) {
            return;
          }
          _this.movedSet.add(n22);
          var targetId = null;
          if (target && _this.mirror.hasNode(target)) {
            targetId = _this.mirror.getId(target);
          }
          if (targetId && targetId !== -1) {
            _this.movedMap[moveKey(_this.mirror.getId(n22), targetId)] = true;
          }
        } else {
          _this.addedSet.add(n22);
          _this.droppedSet.delete(n22);
        }
        if (!isBlocked(n22, _this.blockClass, _this.blockSelector, false)) {
          index$2.childNodes(n22).forEach(function(childN) {
            return _this.genAdds(childN);
          });
          if (hasShadowRoot(n22)) {
            index$2.childNodes(index$2.shadowRoot(n22)).forEach(function(childN) {
              _this.processedNodeManager.add(childN, _this);
              _this.genAdds(childN, n22);
            });
          }
        }
      });
    }
    var _proto = MutationBuffer2.prototype;
    _proto.init = function init(options) {
      var _this = this;
      [
        "mutationCb",
        "blockClass",
        "blockSelector",
        "maskTextClass",
        "maskTextSelector",
        "inlineStylesheet",
        "maskInputOptions",
        "maskTextFn",
        "maskInputFn",
        "keepIframeSrcFn",
        "recordCanvas",
        "inlineImages",
        "slimDOMOptions",
        "dataURLOptions",
        "doc",
        "mirror",
        "iframeManager",
        "stylesheetManager",
        "shadowDomManager",
        "canvasManager",
        "processedNodeManager"
      ].forEach(function(key) {
        _this[key] = options[key];
      });
    };
    _proto.freeze = function freeze() {
      this.frozen = true;
      this.canvasManager.freeze();
    };
    _proto.unfreeze = function unfreeze() {
      this.frozen = false;
      this.canvasManager.unfreeze();
      this.emit();
    };
    _proto.isFrozen = function isFrozen() {
      return this.frozen;
    };
    _proto.lock = function lock() {
      this.locked = true;
      this.canvasManager.lock();
    };
    _proto.unlock = function unlock() {
      this.locked = false;
      this.canvasManager.unlock();
      this.emit();
    };
    _proto.reset = function reset2() {
      this.shadowDomManager.reset();
      this.canvasManager.reset();
    };
    return MutationBuffer2;
  })();
  function deepDelete(addsSet, n22) {
    addsSet.delete(n22);
    index$2.childNodes(n22).forEach(function(childN) {
      return deepDelete(addsSet, childN);
    });
  }
  function processRemoves(n22, cache) {
    var queue = [
      n22
    ];
    while (queue.length) {
      var next = queue.pop();
      if (cache.has(next)) continue;
      cache.add(next);
      index$2.childNodes(next).forEach(function(n222) {
        return queue.push(n222);
      });
    }
    return;
  }
  function isParentRemoved(removes, n22, mirror2) {
    if (removes.size === 0) return false;
    return _isParentRemoved(removes, n22);
  }
  function _isParentRemoved(removes, n22, _mirror2) {
    var node2 = index$2.parentNode(n22);
    if (!node2) return false;
    return removes.has(node2);
  }
  function isAncestorInSet(set, n22) {
    if (set.size === 0) return false;
    return _isAncestorInSet(set, n22);
  }
  function _isAncestorInSet(set, n22) {
    var parent = index$2.parentNode(n22);
    if (!parent) {
      return false;
    }
    if (set.has(parent)) {
      return true;
    }
    return _isAncestorInSet(set, parent);
  }
  var errorHandler;
  function registerErrorHandler(handler) {
    errorHandler = handler;
  }
  function unregisterErrorHandler() {
    errorHandler = void 0;
  }
  var callbackWrapper = function(cb) {
    if (!errorHandler) {
      return cb;
    }
    var rrwebWrapped = function() {
      for (var _len = arguments.length, rest = new Array(_len), _key = 0; _key < _len; _key++) {
        rest[_key] = arguments[_key];
      }
      try {
        return cb.apply(void 0, [].concat(rest));
      } catch (error) {
        if (errorHandler && errorHandler(error) === true) {
          return;
        }
        throw error;
      }
    };
    return rrwebWrapped;
  };
  var mutationBuffers = [];
  function getEventTarget(event) {
    try {
      if ("composedPath" in event) {
        var path = event.composedPath();
        if (path.length) {
          return path[0];
        }
      } else if ("path" in event && event.path.length) {
        return event.path[0];
      }
    } catch (e3) {
    }
    return event && event.target;
  }
  function initMutationObserver(options, rootEl) {
    var mutationBuffer = new MutationBuffer();
    mutationBuffers.push(mutationBuffer);
    mutationBuffer.init(options);
    var observer = new (mutationObserverCtor$2())(callbackWrapper(mutationBuffer.processMutations.bind(mutationBuffer)));
    observer.observe(rootEl, {
      attributes: true,
      attributeOldValue: true,
      characterData: true,
      characterDataOldValue: true,
      childList: true,
      subtree: true
    });
    return observer;
  }
  function initMoveObserver(param) {
    var mousemoveCb = param.mousemoveCb, sampling = param.sampling, doc = param.doc, mirror2 = param.mirror;
    if (sampling.mousemove === false) {
      return function() {
      };
    }
    var threshold = typeof sampling.mousemove === "number" ? sampling.mousemove : 50;
    var callbackThreshold = typeof sampling.mousemoveCallback === "number" ? sampling.mousemoveCallback : 500;
    var positions = [];
    var timeBaseline;
    var wrappedCb = throttle(callbackWrapper(function(source) {
      var totalOffset = Date.now() - timeBaseline;
      mousemoveCb(positions.map(function(p3) {
        p3.timeOffset -= totalOffset;
        return p3;
      }), source);
      positions = [];
      timeBaseline = null;
    }), callbackThreshold);
    var updatePosition = callbackWrapper(throttle(callbackWrapper(function(evt) {
      var target = getEventTarget(evt);
      var _ref = legacy_isTouchEvent(evt) ? evt.changedTouches[0] : evt, clientX = _ref.clientX, clientY = _ref.clientY;
      if (!timeBaseline) {
        timeBaseline = nowTimestamp();
      }
      positions.push({
        x: clientX,
        y: clientY,
        id: mirror2.getId(target),
        timeOffset: nowTimestamp() - timeBaseline
      });
      wrappedCb(typeof DragEvent !== "undefined" && _instanceof(evt, DragEvent) ? IncrementalSource.Drag : _instanceof(evt, MouseEvent) ? IncrementalSource.MouseMove : IncrementalSource.TouchMove);
    }), threshold, {
      trailing: false
    }));
    var handlers = [
      on2("mousemove", updatePosition, doc),
      on2("touchmove", updatePosition, doc),
      on2("drag", updatePosition, doc)
    ];
    return callbackWrapper(function() {
      handlers.forEach(function(h3) {
        return h3();
      });
    });
  }
  function initMouseInteractionObserver(param) {
    var mouseInteractionCb = param.mouseInteractionCb, doc = param.doc, mirror2 = param.mirror, blockClass = param.blockClass, blockSelector = param.blockSelector, sampling = param.sampling;
    if (sampling.mouseInteraction === false) {
      return function() {
      };
    }
    var disableMap = sampling.mouseInteraction === true || sampling.mouseInteraction === void 0 ? {} : sampling.mouseInteraction;
    var handlers = [];
    var currentPointerType = null;
    var getHandler = function(eventKey) {
      return function(event) {
        var target = getEventTarget(event);
        if (isBlocked(target, blockClass, blockSelector, true)) {
          return;
        }
        var pointerType = null;
        var thisEventKey = eventKey;
        if ("pointerType" in event) {
          switch (event.pointerType) {
            case "mouse":
              pointerType = PointerTypes.Mouse;
              break;
            case "touch":
              pointerType = PointerTypes.Touch;
              break;
            case "pen":
              pointerType = PointerTypes.Pen;
              break;
          }
          if (pointerType === PointerTypes.Touch) {
            if (MouseInteractions[eventKey] === MouseInteractions.MouseDown) {
              thisEventKey = "TouchStart";
            } else if (MouseInteractions[eventKey] === MouseInteractions.MouseUp) {
              thisEventKey = "TouchEnd";
            }
          } else if (pointerType === PointerTypes.Pen) ;
        } else if (legacy_isTouchEvent(event)) {
          pointerType = PointerTypes.Touch;
        }
        if (pointerType !== null) {
          currentPointerType = pointerType;
          if (thisEventKey.startsWith("Touch") && pointerType === PointerTypes.Touch || thisEventKey.startsWith("Mouse") && pointerType === PointerTypes.Mouse) {
            pointerType = null;
          }
        } else if (MouseInteractions[eventKey] === MouseInteractions.Click) {
          pointerType = currentPointerType;
          currentPointerType = null;
        }
        var e22 = legacy_isTouchEvent(event) ? event.changedTouches[0] : event;
        if (!e22) {
          return;
        }
        var id = mirror2.getId(target);
        var clientX = e22.clientX, clientY = e22.clientY;
        callbackWrapper(mouseInteractionCb)(_extends({
          type: MouseInteractions[thisEventKey],
          id,
          x: clientX,
          y: clientY
        }, pointerType !== null && {
          pointerType
        }));
      };
    };
    Object.keys(MouseInteractions).filter(function(key) {
      return Number.isNaN(Number(key)) && !key.endsWith("_Departed") && disableMap[key] !== false;
    }).forEach(function(eventKey) {
      var eventName = toLowerCase(eventKey);
      var handler = getHandler(eventKey);
      if (window.PointerEvent) {
        switch (MouseInteractions[eventKey]) {
          case MouseInteractions.MouseDown:
          case MouseInteractions.MouseUp:
            eventName = eventName.replace("mouse", "pointer");
            break;
          case MouseInteractions.TouchStart:
          case MouseInteractions.TouchEnd:
            return;
        }
      }
      handlers.push(on2(eventName, handler, doc));
    });
    return callbackWrapper(function() {
      handlers.forEach(function(h3) {
        return h3();
      });
    });
  }
  function initScrollObserver(param) {
    var scrollCb = param.scrollCb, doc = param.doc, mirror2 = param.mirror, blockClass = param.blockClass, blockSelector = param.blockSelector, sampling = param.sampling;
    var updatePosition = callbackWrapper(throttle(callbackWrapper(function(evt) {
      var target = getEventTarget(evt);
      if (!target || isBlocked(target, blockClass, blockSelector, true)) {
        return;
      }
      var id = mirror2.getId(target);
      if (target === doc && doc.defaultView) {
        var scrollLeftTop = getWindowScroll(doc.defaultView);
        scrollCb({
          id,
          x: scrollLeftTop.left,
          y: scrollLeftTop.top
        });
      } else {
        scrollCb({
          id,
          x: target.scrollLeft,
          y: target.scrollTop
        });
      }
    }), sampling.scroll || 100));
    return on2("scroll", updatePosition, doc);
  }
  function initViewportResizeObserver(param, param1) {
    var viewportResizeCb = param.viewportResizeCb;
    var win2 = param1.win;
    var lastH = -1;
    var lastW = -1;
    var updateDimension = callbackWrapper(throttle(callbackWrapper(function() {
      var height = getWindowHeight();
      var width = getWindowWidth();
      if (lastH !== height || lastW !== width) {
        viewportResizeCb({
          width: Number(width),
          height: Number(height)
        });
        lastH = height;
        lastW = width;
      }
    }), 200));
    return on2("resize", updateDimension, win2);
  }
  var INPUT_TAGS = [
    "INPUT",
    "TEXTAREA",
    "SELECT"
  ];
  var lastInputValueMap = /* @__PURE__ */ new WeakMap();
  function initInputObserver(param) {
    var inputCb = param.inputCb, doc = param.doc, mirror2 = param.mirror, blockClass = param.blockClass, blockSelector = param.blockSelector, ignoreClass = param.ignoreClass, ignoreSelector = param.ignoreSelector, maskInputOptions = param.maskInputOptions, maskInputFn = param.maskInputFn, sampling = param.sampling, userTriggeredOnInput = param.userTriggeredOnInput;
    function eventHandler(event) {
      var target = getEventTarget(event);
      var userTriggered = event.isTrusted;
      var tagName = target && target.tagName;
      if (target && tagName === "OPTION") {
        target = index$2.parentElement(target);
      }
      if (!target || !tagName || INPUT_TAGS.indexOf(tagName) < 0 || isBlocked(target, blockClass, blockSelector, true)) {
        return;
      }
      if (target.classList.contains(ignoreClass) || ignoreSelector && target.matches(ignoreSelector)) {
        return;
      }
      var text = target.value;
      var isChecked = false;
      var type = getInputType(target) || "";
      if (type === "radio" || type === "checkbox") {
        isChecked = target.checked;
      } else if (maskInputOptions[tagName.toLowerCase()] || maskInputOptions[type]) {
        text = maskInputValue({
          element: target,
          maskInputOptions,
          tagName,
          type,
          value: text,
          maskInputFn
        });
      }
      cbWithDedup(target, userTriggeredOnInput ? {
        text,
        isChecked,
        userTriggered
      } : {
        text,
        isChecked
      });
      var name = target.name;
      if (type === "radio" && name && isChecked) {
        doc.querySelectorAll('input[type="radio"][name="' + name + '"]').forEach(function(el) {
          if (el !== target) {
            var text2 = el.value;
            cbWithDedup(el, userTriggeredOnInput ? {
              text: text2,
              isChecked: !isChecked,
              userTriggered: false
            } : {
              text: text2,
              isChecked: !isChecked
            });
          }
        });
      }
    }
    function cbWithDedup(target, v22) {
      var lastInputValue = lastInputValueMap.get(target);
      if (!lastInputValue || lastInputValue.text !== v22.text || lastInputValue.isChecked !== v22.isChecked) {
        lastInputValueMap.set(target, v22);
        var id = mirror2.getId(target);
        callbackWrapper(inputCb)(_extends({}, v22, {
          id
        }));
      }
    }
    var events = sampling.input === "last" ? [
      "change"
    ] : [
      "input",
      "change"
    ];
    var handlers = events.map(function(eventName) {
      return on2(eventName, callbackWrapper(eventHandler), doc);
    });
    var currentWindow = doc.defaultView;
    if (!currentWindow) {
      return function() {
        handlers.forEach(function(h3) {
          return h3();
        });
      };
    }
    var propertyDescriptor = currentWindow.Object.getOwnPropertyDescriptor(currentWindow.HTMLInputElement.prototype, "value");
    var hookProperties = [
      [
        currentWindow.HTMLInputElement.prototype,
        "value"
      ],
      [
        currentWindow.HTMLInputElement.prototype,
        "checked"
      ],
      [
        currentWindow.HTMLSelectElement.prototype,
        "value"
      ],
      [
        currentWindow.HTMLTextAreaElement.prototype,
        "value"
      ],
      // Some UI library use selectedIndex to set select value
      [
        currentWindow.HTMLSelectElement.prototype,
        "selectedIndex"
      ],
      [
        currentWindow.HTMLOptionElement.prototype,
        "selected"
      ]
    ];
    if (propertyDescriptor && propertyDescriptor.set) {
      var _handlers;
      (_handlers = handlers).push.apply(_handlers, [].concat(hookProperties.map(function(p3) {
        return hookSetter(p3[0], p3[1], {
          set: function set() {
            callbackWrapper(eventHandler)({
              target: this,
              isTrusted: false
            });
          }
        }, false, currentWindow);
      })));
    }
    return callbackWrapper(function() {
      handlers.forEach(function(h3) {
        return h3();
      });
    });
  }
  function getNestedCSSRulePositions(rule2) {
    var positions = [];
    function recurse(childRule, pos) {
      if (hasNestedCSSRule("CSSGroupingRule") && _instanceof(childRule.parentRule, CSSGroupingRule) || hasNestedCSSRule("CSSMediaRule") && _instanceof(childRule.parentRule, CSSMediaRule) || hasNestedCSSRule("CSSSupportsRule") && _instanceof(childRule.parentRule, CSSSupportsRule) || hasNestedCSSRule("CSSConditionRule") && _instanceof(childRule.parentRule, CSSConditionRule)) {
        var rules2 = Array.from(childRule.parentRule.cssRules);
        var index2 = rules2.indexOf(childRule);
        pos.unshift(index2);
      } else if (childRule.parentStyleSheet) {
        var rules21 = Array.from(childRule.parentStyleSheet.cssRules);
        var index21 = rules21.indexOf(childRule);
        pos.unshift(index21);
      }
      return pos;
    }
    return recurse(rule2, positions);
  }
  function getIdAndStyleId(sheet, mirror2, styleMirror) {
    var id, styleId;
    if (!sheet) return {};
    if (sheet.ownerNode) id = mirror2.getId(sheet.ownerNode);
    else styleId = styleMirror.getId(sheet);
    return {
      styleId,
      id
    };
  }
  function initStyleSheetObserver(param, param1) {
    var styleSheetRuleCb = param.styleSheetRuleCb, mirror2 = param.mirror, stylesheetManager = param.stylesheetManager;
    var win2 = param1.win;
    if (!win2.CSSStyleSheet || !win2.CSSStyleSheet.prototype) {
      return function() {
      };
    }
    var insertRule = win2.CSSStyleSheet.prototype.insertRule;
    win2.CSSStyleSheet.prototype.insertRule = new Proxy(insertRule, {
      apply: callbackWrapper(function(target, thisArg, argumentsList) {
        var rule2 = argumentsList[0], index2 = argumentsList[1];
        var _getIdAndStyleId = getIdAndStyleId(thisArg, mirror2, stylesheetManager.styleMirror), id = _getIdAndStyleId.id, styleId = _getIdAndStyleId.styleId;
        if (id && id !== -1 || styleId && styleId !== -1) {
          styleSheetRuleCb({
            id,
            styleId,
            adds: [
              {
                rule: rule2,
                index: index2
              }
            ]
          });
        }
        return target.apply(thisArg, argumentsList);
      })
    });
    win2.CSSStyleSheet.prototype.addRule = function(selector, styleBlock, index2) {
      if (index2 === void 0) index2 = this.cssRules.length;
      var rule2 = selector + " { " + styleBlock + " }";
      return win2.CSSStyleSheet.prototype.insertRule.apply(this, [
        rule2,
        index2
      ]);
    };
    var deleteRule = win2.CSSStyleSheet.prototype.deleteRule;
    win2.CSSStyleSheet.prototype.deleteRule = new Proxy(deleteRule, {
      apply: callbackWrapper(function(target, thisArg, argumentsList) {
        var index2 = argumentsList[0];
        var _getIdAndStyleId = getIdAndStyleId(thisArg, mirror2, stylesheetManager.styleMirror), id = _getIdAndStyleId.id, styleId = _getIdAndStyleId.styleId;
        if (id && id !== -1 || styleId && styleId !== -1) {
          styleSheetRuleCb({
            id,
            styleId,
            removes: [
              {
                index: index2
              }
            ]
          });
        }
        return target.apply(thisArg, argumentsList);
      })
    });
    win2.CSSStyleSheet.prototype.removeRule = function(index2) {
      return win2.CSSStyleSheet.prototype.deleteRule.apply(this, [
        index2
      ]);
    };
    var replace;
    if (win2.CSSStyleSheet.prototype.replace) {
      replace = win2.CSSStyleSheet.prototype.replace;
      win2.CSSStyleSheet.prototype.replace = new Proxy(replace, {
        apply: callbackWrapper(function(target, thisArg, argumentsList) {
          var text = argumentsList[0];
          var _getIdAndStyleId = getIdAndStyleId(thisArg, mirror2, stylesheetManager.styleMirror), id = _getIdAndStyleId.id, styleId = _getIdAndStyleId.styleId;
          if (id && id !== -1 || styleId && styleId !== -1) {
            styleSheetRuleCb({
              id,
              styleId,
              replace: text
            });
          }
          return target.apply(thisArg, argumentsList);
        })
      });
    }
    var replaceSync;
    if (win2.CSSStyleSheet.prototype.replaceSync) {
      replaceSync = win2.CSSStyleSheet.prototype.replaceSync;
      win2.CSSStyleSheet.prototype.replaceSync = new Proxy(replaceSync, {
        apply: callbackWrapper(function(target, thisArg, argumentsList) {
          var text = argumentsList[0];
          var _getIdAndStyleId = getIdAndStyleId(thisArg, mirror2, stylesheetManager.styleMirror), id = _getIdAndStyleId.id, styleId = _getIdAndStyleId.styleId;
          if (id && id !== -1 || styleId && styleId !== -1) {
            styleSheetRuleCb({
              id,
              styleId,
              replaceSync: text
            });
          }
          return target.apply(thisArg, argumentsList);
        })
      });
    }
    var supportedNestedCSSRuleTypes = {};
    if (canMonkeyPatchNestedCSSRule("CSSGroupingRule")) {
      supportedNestedCSSRuleTypes.CSSGroupingRule = win2.CSSGroupingRule;
    } else {
      if (canMonkeyPatchNestedCSSRule("CSSMediaRule")) {
        supportedNestedCSSRuleTypes.CSSMediaRule = win2.CSSMediaRule;
      }
      if (canMonkeyPatchNestedCSSRule("CSSConditionRule")) {
        supportedNestedCSSRuleTypes.CSSConditionRule = win2.CSSConditionRule;
      }
      if (canMonkeyPatchNestedCSSRule("CSSSupportsRule")) {
        supportedNestedCSSRuleTypes.CSSSupportsRule = win2.CSSSupportsRule;
      }
    }
    var unmodifiedFunctions = {};
    Object.entries(supportedNestedCSSRuleTypes).forEach(function(param2) {
      var typeKey = param2[0], type = param2[1];
      unmodifiedFunctions[typeKey] = {
        // eslint-disable-next-line @typescript-eslint/unbound-method
        insertRule: type.prototype.insertRule,
        // eslint-disable-next-line @typescript-eslint/unbound-method
        deleteRule: type.prototype.deleteRule
      };
      type.prototype.insertRule = new Proxy(unmodifiedFunctions[typeKey].insertRule, {
        apply: callbackWrapper(function(target, thisArg, argumentsList) {
          var rule2 = argumentsList[0], index2 = argumentsList[1];
          var _getIdAndStyleId = getIdAndStyleId(thisArg.parentStyleSheet, mirror2, stylesheetManager.styleMirror), id = _getIdAndStyleId.id, styleId = _getIdAndStyleId.styleId;
          if (id && id !== -1 || styleId && styleId !== -1) {
            styleSheetRuleCb({
              id,
              styleId,
              adds: [
                {
                  rule: rule2,
                  index: [].concat(getNestedCSSRulePositions(thisArg), [
                    index2 || 0
                  ])
                }
              ]
            });
          }
          return target.apply(thisArg, argumentsList);
        })
      });
      type.prototype.deleteRule = new Proxy(unmodifiedFunctions[typeKey].deleteRule, {
        apply: callbackWrapper(function(target, thisArg, argumentsList) {
          var index2 = argumentsList[0];
          var _getIdAndStyleId = getIdAndStyleId(thisArg.parentStyleSheet, mirror2, stylesheetManager.styleMirror), id = _getIdAndStyleId.id, styleId = _getIdAndStyleId.styleId;
          if (id && id !== -1 || styleId && styleId !== -1) {
            styleSheetRuleCb({
              id,
              styleId,
              removes: [
                {
                  index: [].concat(getNestedCSSRulePositions(thisArg), [
                    index2
                  ])
                }
              ]
            });
          }
          return target.apply(thisArg, argumentsList);
        })
      });
    });
    return callbackWrapper(function() {
      win2.CSSStyleSheet.prototype.insertRule = insertRule;
      win2.CSSStyleSheet.prototype.deleteRule = deleteRule;
      replace && (win2.CSSStyleSheet.prototype.replace = replace);
      replaceSync && (win2.CSSStyleSheet.prototype.replaceSync = replaceSync);
      Object.entries(supportedNestedCSSRuleTypes).forEach(function(param2) {
        var typeKey = param2[0], type = param2[1];
        type.prototype.insertRule = unmodifiedFunctions[typeKey].insertRule;
        type.prototype.deleteRule = unmodifiedFunctions[typeKey].deleteRule;
      });
    });
  }
  function initAdoptedStyleSheetObserver(param, host2) {
    var mirror2 = param.mirror, stylesheetManager = param.stylesheetManager;
    var _a2, _b, _c;
    var hostId = null;
    if (host2.nodeName === "#document") hostId = mirror2.getId(host2);
    else hostId = mirror2.getId(index$2.host(host2));
    var patchTarget = host2.nodeName === "#document" ? (_a2 = host2.defaultView) == null ? void 0 : _a2.Document : (_c = (_b = host2.ownerDocument) == null ? void 0 : _b.defaultView) == null ? void 0 : _c.ShadowRoot;
    var originalPropertyDescriptor = (patchTarget == null ? void 0 : patchTarget.prototype) ? Object.getOwnPropertyDescriptor(patchTarget == null ? void 0 : patchTarget.prototype, "adoptedStyleSheets") : void 0;
    if (hostId === null || hostId === -1 || !patchTarget || !originalPropertyDescriptor) return function() {
    };
    Object.defineProperty(host2, "adoptedStyleSheets", {
      configurable: originalPropertyDescriptor.configurable,
      enumerable: originalPropertyDescriptor.enumerable,
      get: function get() {
        var _a3;
        return (_a3 = originalPropertyDescriptor.get) == null ? void 0 : _a3.call(this);
      },
      set: function set(sheets) {
        var _a3;
        var result2 = (_a3 = originalPropertyDescriptor.set) == null ? void 0 : _a3.call(this, sheets);
        if (hostId !== null && hostId !== -1) {
          try {
            stylesheetManager.adoptStyleSheets(sheets, hostId);
          } catch (e22) {
          }
        }
        return result2;
      }
    });
    return callbackWrapper(function() {
      Object.defineProperty(host2, "adoptedStyleSheets", {
        configurable: originalPropertyDescriptor.configurable,
        enumerable: originalPropertyDescriptor.enumerable,
        // eslint-disable-next-line @typescript-eslint/unbound-method
        get: originalPropertyDescriptor.get,
        // eslint-disable-next-line @typescript-eslint/unbound-method
        set: originalPropertyDescriptor.set
      });
    });
  }
  function initStyleDeclarationObserver(param, param1) {
    var styleDeclarationCb = param.styleDeclarationCb, mirror2 = param.mirror, ignoreCSSAttributes = param.ignoreCSSAttributes, stylesheetManager = param.stylesheetManager;
    var win2 = param1.win;
    var setProperty = win2.CSSStyleDeclaration.prototype.setProperty;
    win2.CSSStyleDeclaration.prototype.setProperty = new Proxy(setProperty, {
      apply: callbackWrapper(function(target, thisArg, argumentsList) {
        var _a2;
        var property = argumentsList[0], value = argumentsList[1], priority = argumentsList[2];
        if (ignoreCSSAttributes.has(property)) {
          return setProperty.apply(thisArg, [
            property,
            value,
            priority
          ]);
        }
        var _getIdAndStyleId = getIdAndStyleId((_a2 = thisArg.parentRule) == null ? void 0 : _a2.parentStyleSheet, mirror2, stylesheetManager.styleMirror), id = _getIdAndStyleId.id, styleId = _getIdAndStyleId.styleId;
        if (id && id !== -1 || styleId && styleId !== -1) {
          styleDeclarationCb({
            id,
            styleId,
            set: {
              property,
              value,
              priority
            },
            // eslint-disable-next-line @typescript-eslint/no-non-null-assertion
            index: getNestedCSSRulePositions(thisArg.parentRule)
          });
        }
        return target.apply(thisArg, argumentsList);
      })
    });
    var removeProperty = win2.CSSStyleDeclaration.prototype.removeProperty;
    win2.CSSStyleDeclaration.prototype.removeProperty = new Proxy(removeProperty, {
      apply: callbackWrapper(function(target, thisArg, argumentsList) {
        var _a2;
        var property = argumentsList[0];
        if (ignoreCSSAttributes.has(property)) {
          return removeProperty.apply(thisArg, [
            property
          ]);
        }
        var _getIdAndStyleId = getIdAndStyleId((_a2 = thisArg.parentRule) == null ? void 0 : _a2.parentStyleSheet, mirror2, stylesheetManager.styleMirror), id = _getIdAndStyleId.id, styleId = _getIdAndStyleId.styleId;
        if (id && id !== -1 || styleId && styleId !== -1) {
          styleDeclarationCb({
            id,
            styleId,
            remove: {
              property
            },
            // eslint-disable-next-line @typescript-eslint/no-non-null-assertion
            index: getNestedCSSRulePositions(thisArg.parentRule)
          });
        }
        return target.apply(thisArg, argumentsList);
      })
    });
    return callbackWrapper(function() {
      win2.CSSStyleDeclaration.prototype.setProperty = setProperty;
      win2.CSSStyleDeclaration.prototype.removeProperty = removeProperty;
    });
  }
  function initMediaInteractionObserver(param) {
    var mediaInteractionCb = param.mediaInteractionCb, blockClass = param.blockClass, blockSelector = param.blockSelector, mirror2 = param.mirror, sampling = param.sampling, doc = param.doc;
    var handler = callbackWrapper(function(type) {
      return throttle(callbackWrapper(function(event) {
        var target = getEventTarget(event);
        if (!target || isBlocked(target, blockClass, blockSelector, true)) {
          return;
        }
        var currentTime = target.currentTime, volume = target.volume, muted = target.muted, playbackRate = target.playbackRate, loop = target.loop;
        mediaInteractionCb({
          type,
          id: mirror2.getId(target),
          currentTime,
          volume,
          muted,
          playbackRate,
          loop
        });
      }), sampling.media || 500);
    });
    var handlers = [
      on2("play", handler(MediaInteractions.Play), doc),
      on2("pause", handler(MediaInteractions.Pause), doc),
      on2("seeked", handler(MediaInteractions.Seeked), doc),
      on2("volumechange", handler(MediaInteractions.VolumeChange), doc),
      on2("ratechange", handler(MediaInteractions.RateChange), doc)
    ];
    return callbackWrapper(function() {
      handlers.forEach(function(h3) {
        return h3();
      });
    });
  }
  function initFontObserver(param) {
    var fontCb = param.fontCb, doc = param.doc;
    var win2 = doc.defaultView;
    if (!win2) {
      return function() {
      };
    }
    var handlers = [];
    var fontMap = /* @__PURE__ */ new WeakMap();
    var originalFontFace = win2.FontFace;
    win2.FontFace = function FontFace2(family, source, descriptors) {
      var fontFace = new originalFontFace(family, source, descriptors);
      fontMap.set(fontFace, {
        family,
        buffer: typeof source !== "string",
        descriptors,
        fontSource: typeof source === "string" ? source : JSON.stringify(Array.from(new Uint8Array(source)))
      });
      return fontFace;
    };
    var restoreHandler = patch$2(doc.fonts, "add", function(original) {
      return function(fontFace) {
        setTimeout(callbackWrapper(function() {
          var p3 = fontMap.get(fontFace);
          if (p3) {
            fontCb(p3);
            fontMap.delete(fontFace);
          }
        }), 0);
        return original.apply(this, [
          fontFace
        ]);
      };
    });
    handlers.push(function() {
      win2.FontFace = originalFontFace;
    });
    handlers.push(restoreHandler);
    return callbackWrapper(function() {
      handlers.forEach(function(h3) {
        return h3();
      });
    });
  }
  function initSelectionObserver(param) {
    var doc = param.doc, mirror2 = param.mirror, blockClass = param.blockClass, blockSelector = param.blockSelector, selectionCb = param.selectionCb;
    var collapsed = true;
    var updateSelection = callbackWrapper(function() {
      var selection = doc.getSelection();
      if (!selection || collapsed && (selection == null ? void 0 : selection.isCollapsed)) return;
      collapsed = selection.isCollapsed || false;
      var ranges = [];
      var count = selection.rangeCount || 0;
      for (var i22 = 0; i22 < count; i22++) {
        var range = selection.getRangeAt(i22);
        var startContainer = range.startContainer, startOffset = range.startOffset, endContainer = range.endContainer, endOffset = range.endOffset;
        var blocked = isBlocked(startContainer, blockClass, blockSelector, true) || isBlocked(endContainer, blockClass, blockSelector, true);
        if (blocked) continue;
        ranges.push({
          start: mirror2.getId(startContainer),
          startOffset,
          end: mirror2.getId(endContainer),
          endOffset
        });
      }
      selectionCb({
        ranges
      });
    });
    updateSelection();
    return on2("selectionchange", updateSelection);
  }
  function initCustomElementObserver(param) {
    var doc = param.doc, customElementCb = param.customElementCb;
    var win2 = doc.defaultView;
    if (!win2 || !win2.customElements) return function() {
    };
    var restoreHandler = patch$2(win2.customElements, "define", function(original) {
      return function(name, constructor, options) {
        try {
          customElementCb({
            define: {
              name
            }
          });
        } catch (e22) {
          console.warn("Custom element callback failed for " + name);
        }
        return original.apply(this, [
          name,
          constructor,
          options
        ]);
      };
    });
    return restoreHandler;
  }
  function mergeHooks(o22, hooks) {
    var mutationCb = o22.mutationCb, mousemoveCb = o22.mousemoveCb, mouseInteractionCb = o22.mouseInteractionCb, scrollCb = o22.scrollCb, viewportResizeCb = o22.viewportResizeCb, inputCb = o22.inputCb, mediaInteractionCb = o22.mediaInteractionCb, styleSheetRuleCb = o22.styleSheetRuleCb, styleDeclarationCb = o22.styleDeclarationCb, canvasMutationCb = o22.canvasMutationCb, fontCb = o22.fontCb, selectionCb = o22.selectionCb, customElementCb = o22.customElementCb;
    o22.mutationCb = function() {
      for (var _len = arguments.length, p3 = new Array(_len), _key = 0; _key < _len; _key++) {
        p3[_key] = arguments[_key];
      }
      if (hooks.mutation) {
        var _hooks;
        (_hooks = hooks).mutation.apply(_hooks, [].concat(p3));
      }
      mutationCb.apply(void 0, [].concat(p3));
    };
    o22.mousemoveCb = function() {
      for (var _len = arguments.length, p3 = new Array(_len), _key = 0; _key < _len; _key++) {
        p3[_key] = arguments[_key];
      }
      if (hooks.mousemove) {
        var _hooks;
        (_hooks = hooks).mousemove.apply(_hooks, [].concat(p3));
      }
      mousemoveCb.apply(void 0, [].concat(p3));
    };
    o22.mouseInteractionCb = function() {
      for (var _len = arguments.length, p3 = new Array(_len), _key = 0; _key < _len; _key++) {
        p3[_key] = arguments[_key];
      }
      if (hooks.mouseInteraction) {
        var _hooks;
        (_hooks = hooks).mouseInteraction.apply(_hooks, [].concat(p3));
      }
      mouseInteractionCb.apply(void 0, [].concat(p3));
    };
    o22.scrollCb = function() {
      for (var _len = arguments.length, p3 = new Array(_len), _key = 0; _key < _len; _key++) {
        p3[_key] = arguments[_key];
      }
      if (hooks.scroll) {
        var _hooks;
        (_hooks = hooks).scroll.apply(_hooks, [].concat(p3));
      }
      scrollCb.apply(void 0, [].concat(p3));
    };
    o22.viewportResizeCb = function() {
      for (var _len = arguments.length, p3 = new Array(_len), _key = 0; _key < _len; _key++) {
        p3[_key] = arguments[_key];
      }
      if (hooks.viewportResize) {
        var _hooks;
        (_hooks = hooks).viewportResize.apply(_hooks, [].concat(p3));
      }
      viewportResizeCb.apply(void 0, [].concat(p3));
    };
    o22.inputCb = function() {
      for (var _len = arguments.length, p3 = new Array(_len), _key = 0; _key < _len; _key++) {
        p3[_key] = arguments[_key];
      }
      if (hooks.input) {
        var _hooks;
        (_hooks = hooks).input.apply(_hooks, [].concat(p3));
      }
      inputCb.apply(void 0, [].concat(p3));
    };
    o22.mediaInteractionCb = function() {
      for (var _len = arguments.length, p3 = new Array(_len), _key = 0; _key < _len; _key++) {
        p3[_key] = arguments[_key];
      }
      if (hooks.mediaInteaction) {
        var _hooks;
        (_hooks = hooks).mediaInteaction.apply(_hooks, [].concat(p3));
      }
      mediaInteractionCb.apply(void 0, [].concat(p3));
    };
    o22.styleSheetRuleCb = function() {
      for (var _len = arguments.length, p3 = new Array(_len), _key = 0; _key < _len; _key++) {
        p3[_key] = arguments[_key];
      }
      if (hooks.styleSheetRule) {
        var _hooks;
        (_hooks = hooks).styleSheetRule.apply(_hooks, [].concat(p3));
      }
      styleSheetRuleCb.apply(void 0, [].concat(p3));
    };
    o22.styleDeclarationCb = function() {
      for (var _len = arguments.length, p3 = new Array(_len), _key = 0; _key < _len; _key++) {
        p3[_key] = arguments[_key];
      }
      if (hooks.styleDeclaration) {
        var _hooks;
        (_hooks = hooks).styleDeclaration.apply(_hooks, [].concat(p3));
      }
      styleDeclarationCb.apply(void 0, [].concat(p3));
    };
    o22.canvasMutationCb = function() {
      for (var _len = arguments.length, p3 = new Array(_len), _key = 0; _key < _len; _key++) {
        p3[_key] = arguments[_key];
      }
      if (hooks.canvasMutation) {
        var _hooks;
        (_hooks = hooks).canvasMutation.apply(_hooks, [].concat(p3));
      }
      canvasMutationCb.apply(void 0, [].concat(p3));
    };
    o22.fontCb = function() {
      for (var _len = arguments.length, p3 = new Array(_len), _key = 0; _key < _len; _key++) {
        p3[_key] = arguments[_key];
      }
      if (hooks.font) {
        var _hooks;
        (_hooks = hooks).font.apply(_hooks, [].concat(p3));
      }
      fontCb.apply(void 0, [].concat(p3));
    };
    o22.selectionCb = function() {
      for (var _len = arguments.length, p3 = new Array(_len), _key = 0; _key < _len; _key++) {
        p3[_key] = arguments[_key];
      }
      if (hooks.selection) {
        var _hooks;
        (_hooks = hooks).selection.apply(_hooks, [].concat(p3));
      }
      selectionCb.apply(void 0, [].concat(p3));
    };
    o22.customElementCb = function() {
      for (var _len = arguments.length, c22 = new Array(_len), _key = 0; _key < _len; _key++) {
        c22[_key] = arguments[_key];
      }
      if (hooks.customElement) {
        var _hooks;
        (_hooks = hooks).customElement.apply(_hooks, [].concat(c22));
      }
      customElementCb.apply(void 0, [].concat(c22));
    };
  }
  function initObservers(o22, hooks) {
    if (hooks === void 0) hooks = {};
    var currentWindow = o22.doc.defaultView;
    if (!currentWindow) {
      return function() {
      };
    }
    mergeHooks(o22, hooks);
    var mutationObserver;
    if (o22.recordDOM) {
      mutationObserver = initMutationObserver(o22, o22.doc);
    }
    var mousemoveHandler = initMoveObserver(o22);
    var mouseInteractionHandler = initMouseInteractionObserver(o22);
    var scrollHandler = initScrollObserver(o22);
    var viewportResizeHandler = initViewportResizeObserver(o22, {
      win: currentWindow
    });
    var inputHandler = initInputObserver(o22);
    var mediaInteractionHandler = initMediaInteractionObserver(o22);
    var styleSheetObserver = function() {
    };
    var adoptedStyleSheetObserver = function() {
    };
    var styleDeclarationObserver = function() {
    };
    var fontObserver = function() {
    };
    if (o22.recordDOM) {
      styleSheetObserver = initStyleSheetObserver(o22, {
        win: currentWindow
      });
      adoptedStyleSheetObserver = initAdoptedStyleSheetObserver(o22, o22.doc);
      styleDeclarationObserver = initStyleDeclarationObserver(o22, {
        win: currentWindow
      });
      if (o22.collectFonts) {
        fontObserver = initFontObserver(o22);
      }
    }
    var selectionObserver = initSelectionObserver(o22);
    var customElementObserver = initCustomElementObserver(o22);
    var pluginHandlers = [];
    for (var _iterator = _create_for_of_iterator_helper_loose(o22.plugins), _step; !(_step = _iterator()).done; ) {
      var plugin32 = _step.value;
      pluginHandlers.push(plugin32.observer(plugin32.callback, currentWindow, plugin32.options));
    }
    return callbackWrapper(function() {
      mutationBuffers.forEach(function(b2) {
        return b2.reset();
      });
      mutationObserver == null ? void 0 : mutationObserver.disconnect();
      mousemoveHandler();
      mouseInteractionHandler();
      scrollHandler();
      viewportResizeHandler();
      inputHandler();
      mediaInteractionHandler();
      styleSheetObserver();
      adoptedStyleSheetObserver();
      styleDeclarationObserver();
      fontObserver();
      selectionObserver();
      customElementObserver();
      pluginHandlers.forEach(function(h3) {
        return h3();
      });
    });
  }
  function hasNestedCSSRule(prop) {
    return typeof window[prop] !== "undefined";
  }
  function canMonkeyPatchNestedCSSRule(prop) {
    return Boolean(typeof window[prop] !== "undefined" && // Note: Generally, this check _shouldn't_ be necessary
    // However, in some scenarios (e.g. jsdom) this can sometimes fail, so we check for it here
    window[prop].prototype && "insertRule" in window[prop].prototype && "deleteRule" in window[prop].prototype);
  }
  var CrossOriginIframeMirror = /* @__PURE__ */ (function() {
    function CrossOriginIframeMirror2(generateIdFn) {
      __publicField$1(this, "iframeIdToRemoteIdMap", /* @__PURE__ */ new WeakMap());
      __publicField$1(this, "iframeRemoteIdToIdMap", /* @__PURE__ */ new WeakMap());
      this.generateIdFn = generateIdFn;
    }
    var _proto = CrossOriginIframeMirror2.prototype;
    _proto.getId = function getId2(iframe, remoteId, idToRemoteMap, remoteToIdMap) {
      var idToRemoteIdMap = idToRemoteMap || this.getIdToRemoteIdMap(iframe);
      var remoteIdToIdMap = remoteToIdMap || this.getRemoteIdToIdMap(iframe);
      var id = idToRemoteIdMap.get(remoteId);
      if (!id) {
        id = this.generateIdFn();
        idToRemoteIdMap.set(remoteId, id);
        remoteIdToIdMap.set(id, remoteId);
      }
      return id;
    };
    _proto.getIds = function getIds(iframe, remoteId) {
      var _this = this;
      var idToRemoteIdMap = this.getIdToRemoteIdMap(iframe);
      var remoteIdToIdMap = this.getRemoteIdToIdMap(iframe);
      return remoteId.map(function(id) {
        return _this.getId(iframe, id, idToRemoteIdMap, remoteIdToIdMap);
      });
    };
    _proto.getRemoteId = function getRemoteId(iframe, id, map) {
      var remoteIdToIdMap = map || this.getRemoteIdToIdMap(iframe);
      if (typeof id !== "number") return id;
      var remoteId = remoteIdToIdMap.get(id);
      if (!remoteId) return -1;
      return remoteId;
    };
    _proto.getRemoteIds = function getRemoteIds(iframe, ids) {
      var _this = this;
      var remoteIdToIdMap = this.getRemoteIdToIdMap(iframe);
      return ids.map(function(id) {
        return _this.getRemoteId(iframe, id, remoteIdToIdMap);
      });
    };
    _proto.reset = function reset2(iframe) {
      if (!iframe) {
        this.iframeIdToRemoteIdMap = /* @__PURE__ */ new WeakMap();
        this.iframeRemoteIdToIdMap = /* @__PURE__ */ new WeakMap();
        return;
      }
      this.iframeIdToRemoteIdMap.delete(iframe);
      this.iframeRemoteIdToIdMap.delete(iframe);
    };
    _proto.getIdToRemoteIdMap = function getIdToRemoteIdMap(iframe) {
      var idToRemoteIdMap = this.iframeIdToRemoteIdMap.get(iframe);
      if (!idToRemoteIdMap) {
        idToRemoteIdMap = /* @__PURE__ */ new Map();
        this.iframeIdToRemoteIdMap.set(iframe, idToRemoteIdMap);
      }
      return idToRemoteIdMap;
    };
    _proto.getRemoteIdToIdMap = function getRemoteIdToIdMap(iframe) {
      var remoteIdToIdMap = this.iframeRemoteIdToIdMap.get(iframe);
      if (!remoteIdToIdMap) {
        remoteIdToIdMap = /* @__PURE__ */ new Map();
        this.iframeRemoteIdToIdMap.set(iframe, remoteIdToIdMap);
      }
      return remoteIdToIdMap;
    };
    return CrossOriginIframeMirror2;
  })();
  var IframeManager = /* @__PURE__ */ (function() {
    function IframeManager2(options) {
      __publicField$1(this, "iframes", /* @__PURE__ */ new WeakMap());
      __publicField$1(this, "crossOriginIframeMap", /* @__PURE__ */ new WeakMap());
      __publicField$1(this, "crossOriginIframeMirror", new CrossOriginIframeMirror(genId));
      __publicField$1(this, "crossOriginIframeStyleMirror");
      __publicField$1(this, "crossOriginIframeRootIdMap", /* @__PURE__ */ new WeakMap());
      __publicField$1(this, "mirror");
      __publicField$1(this, "mutationCb");
      __publicField$1(this, "wrappedEmit");
      __publicField$1(this, "loadListener");
      __publicField$1(this, "stylesheetManager");
      __publicField$1(this, "recordCrossOriginIframes");
      this.mutationCb = options.mutationCb;
      this.wrappedEmit = options.wrappedEmit;
      this.stylesheetManager = options.stylesheetManager;
      this.recordCrossOriginIframes = options.recordCrossOriginIframes;
      this.crossOriginIframeStyleMirror = new CrossOriginIframeMirror(this.stylesheetManager.styleMirror.generateId.bind(this.stylesheetManager.styleMirror));
      this.mirror = options.mirror;
      if (this.recordCrossOriginIframes) {
        window.addEventListener("message", this.handleMessage.bind(this));
      }
    }
    var _proto = IframeManager2.prototype;
    _proto.addIframe = function addIframe(iframeEl) {
      this.iframes.set(iframeEl, true);
      if (iframeEl.contentWindow) this.crossOriginIframeMap.set(iframeEl.contentWindow, iframeEl);
    };
    _proto.addLoadListener = function addLoadListener(cb) {
      this.loadListener = cb;
    };
    _proto.attachIframe = function attachIframe(iframeEl, childSn) {
      var _a2, _b;
      this.mutationCb({
        adds: [
          {
            parentId: this.mirror.getId(iframeEl),
            nextId: null,
            node: childSn
          }
        ],
        removes: [],
        texts: [],
        attributes: [],
        isAttachIframe: true
      });
      if (this.recordCrossOriginIframes) (_a2 = iframeEl.contentWindow) == null ? void 0 : _a2.addEventListener("message", this.handleMessage.bind(this));
      (_b = this.loadListener) == null ? void 0 : _b.call(this, iframeEl);
      if (iframeEl.contentDocument && iframeEl.contentDocument.adoptedStyleSheets && iframeEl.contentDocument.adoptedStyleSheets.length > 0) this.stylesheetManager.adoptStyleSheets(iframeEl.contentDocument.adoptedStyleSheets, this.mirror.getId(iframeEl.contentDocument));
    };
    _proto.handleMessage = function handleMessage(message) {
      var crossOriginMessageEvent = message;
      if (crossOriginMessageEvent.data.type !== "rrweb" || // To filter out the rrweb messages which are forwarded by some sites.
      crossOriginMessageEvent.origin !== crossOriginMessageEvent.data.origin) return;
      var iframeSourceWindow = message.source;
      if (!iframeSourceWindow) return;
      var iframeEl = this.crossOriginIframeMap.get(message.source);
      if (!iframeEl) return;
      var transformedEvent = this.transformCrossOriginEvent(iframeEl, crossOriginMessageEvent.data.event);
      if (transformedEvent) this.wrappedEmit(transformedEvent, crossOriginMessageEvent.data.isCheckout);
    };
    _proto.transformCrossOriginEvent = function transformCrossOriginEvent(iframeEl, e22) {
      var _this = this;
      var _a2;
      switch (e22.type) {
        case EventType.FullSnapshot: {
          this.crossOriginIframeMirror.reset(iframeEl);
          this.crossOriginIframeStyleMirror.reset(iframeEl);
          this.replaceIdOnNode(e22.data.node, iframeEl);
          var rootId = e22.data.node.id;
          this.crossOriginIframeRootIdMap.set(iframeEl, rootId);
          this.patchRootIdOnNode(e22.data.node, rootId);
          return {
            timestamp: e22.timestamp,
            type: EventType.IncrementalSnapshot,
            data: {
              source: IncrementalSource.Mutation,
              adds: [
                {
                  parentId: this.mirror.getId(iframeEl),
                  nextId: null,
                  node: e22.data.node
                }
              ],
              removes: [],
              texts: [],
              attributes: [],
              isAttachIframe: true
            }
          };
        }
        case EventType.Meta:
        case EventType.Load:
        case EventType.DomContentLoaded: {
          return false;
        }
        case EventType.Plugin: {
          return e22;
        }
        case EventType.Custom: {
          this.replaceIds(e22.data.payload, iframeEl, [
            "id",
            "parentId",
            "previousId",
            "nextId"
          ]);
          return e22;
        }
        case EventType.IncrementalSnapshot: {
          switch (e22.data.source) {
            case IncrementalSource.Mutation: {
              e22.data.adds.forEach(function(n22) {
                _this.replaceIds(n22, iframeEl, [
                  "parentId",
                  "nextId",
                  "previousId"
                ]);
                _this.replaceIdOnNode(n22.node, iframeEl);
                var rootId2 = _this.crossOriginIframeRootIdMap.get(iframeEl);
                rootId2 && _this.patchRootIdOnNode(n22.node, rootId2);
              });
              e22.data.removes.forEach(function(n22) {
                _this.replaceIds(n22, iframeEl, [
                  "parentId",
                  "id"
                ]);
              });
              e22.data.attributes.forEach(function(n22) {
                _this.replaceIds(n22, iframeEl, [
                  "id"
                ]);
              });
              e22.data.texts.forEach(function(n22) {
                _this.replaceIds(n22, iframeEl, [
                  "id"
                ]);
              });
              return e22;
            }
            case IncrementalSource.Drag:
            case IncrementalSource.TouchMove:
            case IncrementalSource.MouseMove: {
              e22.data.positions.forEach(function(p3) {
                _this.replaceIds(p3, iframeEl, [
                  "id"
                ]);
              });
              return e22;
            }
            case IncrementalSource.ViewportResize: {
              return false;
            }
            case IncrementalSource.MediaInteraction:
            case IncrementalSource.MouseInteraction:
            case IncrementalSource.Scroll:
            case IncrementalSource.CanvasMutation:
            case IncrementalSource.Input: {
              this.replaceIds(e22.data, iframeEl, [
                "id"
              ]);
              return e22;
            }
            case IncrementalSource.StyleSheetRule:
            case IncrementalSource.StyleDeclaration: {
              this.replaceIds(e22.data, iframeEl, [
                "id"
              ]);
              this.replaceStyleIds(e22.data, iframeEl, [
                "styleId"
              ]);
              return e22;
            }
            case IncrementalSource.Font: {
              return e22;
            }
            case IncrementalSource.Selection: {
              e22.data.ranges.forEach(function(range) {
                _this.replaceIds(range, iframeEl, [
                  "start",
                  "end"
                ]);
              });
              return e22;
            }
            case IncrementalSource.AdoptedStyleSheet: {
              this.replaceIds(e22.data, iframeEl, [
                "id"
              ]);
              this.replaceStyleIds(e22.data, iframeEl, [
                "styleIds"
              ]);
              (_a2 = e22.data.styles) == null ? void 0 : _a2.forEach(function(style) {
                _this.replaceStyleIds(style, iframeEl, [
                  "styleId"
                ]);
              });
              return e22;
            }
          }
        }
      }
      return false;
    };
    _proto.replace = function replace(iframeMirror, obj, iframeEl, keys) {
      for (var _iterator = _create_for_of_iterator_helper_loose(keys), _step; !(_step = _iterator()).done; ) {
        var key = _step.value;
        if (!Array.isArray(obj[key]) && typeof obj[key] !== "number") continue;
        if (Array.isArray(obj[key])) {
          obj[key] = iframeMirror.getIds(iframeEl, obj[key]);
        } else {
          obj[key] = iframeMirror.getId(iframeEl, obj[key]);
        }
      }
      return obj;
    };
    _proto.replaceIds = function replaceIds(obj, iframeEl, keys) {
      return this.replace(this.crossOriginIframeMirror, obj, iframeEl, keys);
    };
    _proto.replaceStyleIds = function replaceStyleIds(obj, iframeEl, keys) {
      return this.replace(this.crossOriginIframeStyleMirror, obj, iframeEl, keys);
    };
    _proto.replaceIdOnNode = function replaceIdOnNode(node2, iframeEl) {
      var _this = this;
      this.replaceIds(node2, iframeEl, [
        "id",
        "rootId"
      ]);
      if ("childNodes" in node2) {
        node2.childNodes.forEach(function(child) {
          _this.replaceIdOnNode(child, iframeEl);
        });
      }
    };
    _proto.patchRootIdOnNode = function patchRootIdOnNode(node2, rootId) {
      var _this = this;
      if (node2.type !== NodeType.Document && !node2.rootId) node2.rootId = rootId;
      if ("childNodes" in node2) {
        node2.childNodes.forEach(function(child) {
          _this.patchRootIdOnNode(child, rootId);
        });
      }
    };
    return IframeManager2;
  })();
  var ShadowDomManager = /* @__PURE__ */ (function() {
    function ShadowDomManager2(options) {
      __publicField$1(this, "shadowDoms", /* @__PURE__ */ new WeakSet());
      __publicField$1(this, "mutationCb");
      __publicField$1(this, "scrollCb");
      __publicField$1(this, "bypassOptions");
      __publicField$1(this, "mirror");
      __publicField$1(this, "restoreHandlers", []);
      this.mutationCb = options.mutationCb;
      this.scrollCb = options.scrollCb;
      this.bypassOptions = options.bypassOptions;
      this.mirror = options.mirror;
      this.init();
    }
    var _proto = ShadowDomManager2.prototype;
    _proto.init = function init() {
      this.reset();
      this.patchAttachShadow(Element, document);
    };
    _proto.addShadowRoot = function addShadowRoot(shadowRoot2, doc) {
      var _this = this;
      if (!isNativeShadowDom(shadowRoot2)) return;
      if (this.shadowDoms.has(shadowRoot2)) return;
      this.shadowDoms.add(shadowRoot2);
      var observer = initMutationObserver(_extends({}, this.bypassOptions, {
        doc,
        mutationCb: this.mutationCb,
        mirror: this.mirror,
        shadowDomManager: this
      }), shadowRoot2);
      this.restoreHandlers.push(function() {
        return observer.disconnect();
      });
      this.restoreHandlers.push(initScrollObserver(_extends({}, this.bypassOptions, {
        scrollCb: this.scrollCb,
        // https://gist.github.com/praveenpuglia/0832da687ed5a5d7a0907046c9ef1813
        // scroll is not allowed to pass the boundary, so we need to listen the shadow document
        doc: shadowRoot2,
        mirror: this.mirror
      })));
      setTimeout(function() {
        if (shadowRoot2.adoptedStyleSheets && shadowRoot2.adoptedStyleSheets.length > 0) _this.bypassOptions.stylesheetManager.adoptStyleSheets(shadowRoot2.adoptedStyleSheets, _this.mirror.getId(index$2.host(shadowRoot2)));
        _this.restoreHandlers.push(initAdoptedStyleSheetObserver({
          mirror: _this.mirror,
          stylesheetManager: _this.bypassOptions.stylesheetManager
        }, shadowRoot2));
      }, 0);
    };
    _proto.observeAttachShadow = function observeAttachShadow(iframeElement) {
      if (!iframeElement.contentWindow || !iframeElement.contentDocument) return;
      this.patchAttachShadow(iframeElement.contentWindow.Element, iframeElement.contentDocument);
    };
    _proto.patchAttachShadow = function patchAttachShadow(element, doc) {
      var manager = this;
      this.restoreHandlers.push(patch$2(element.prototype, "attachShadow", function(original) {
        return function(option) {
          var sRoot = original.call(this, option);
          var shadowRootEl = index$2.shadowRoot(this);
          if (shadowRootEl && inDom(this)) manager.addShadowRoot(shadowRootEl, doc);
          return sRoot;
        };
      }));
    };
    _proto.reset = function reset2() {
      this.restoreHandlers.forEach(function(handler) {
        try {
          handler();
        } catch (e22) {
        }
      });
      this.restoreHandlers = [];
      this.shadowDoms = /* @__PURE__ */ new WeakSet();
    };
    return ShadowDomManager2;
  })();
  var chars = "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";
  var lookup = typeof Uint8Array === "undefined" ? [] : new Uint8Array(256);
  for (i$1 = 0; i$1 < chars.length; i$1++) {
    lookup[chars.charCodeAt(i$1)] = i$1;
  }
  var i$1;
  var encode = function encode2(arraybuffer) {
    var bytes = new Uint8Array(arraybuffer), i22, len = bytes.length, base64 = "";
    for (i22 = 0; i22 < len; i22 += 3) {
      base64 += chars[bytes[i22] >> 2];
      base64 += chars[(bytes[i22] & 3) << 4 | bytes[i22 + 1] >> 4];
      base64 += chars[(bytes[i22 + 1] & 15) << 2 | bytes[i22 + 2] >> 6];
      base64 += chars[bytes[i22 + 2] & 63];
    }
    if (len % 3 === 2) {
      base64 = base64.substring(0, base64.length - 1) + "=";
    } else if (len % 3 === 1) {
      base64 = base64.substring(0, base64.length - 2) + "==";
    }
    return base64;
  };
  var canvasVarMap = /* @__PURE__ */ new Map();
  function variableListFor$1(ctx, ctor) {
    var contextMap = canvasVarMap.get(ctx);
    if (!contextMap) {
      contextMap = /* @__PURE__ */ new Map();
      canvasVarMap.set(ctx, contextMap);
    }
    if (!contextMap.has(ctor)) {
      contextMap.set(ctor, []);
    }
    return contextMap.get(ctor);
  }
  var saveWebGLVar = function(value, win2, ctx) {
    if (!value || !(isInstanceOfWebGLObject(value, win2) || (typeof value === "undefined" ? "undefined" : _type_of(value)) === "object")) return;
    var name = value.constructor.name;
    var list2 = variableListFor$1(ctx, name);
    var index2 = list2.indexOf(value);
    if (index2 === -1) {
      index2 = list2.length;
      list2.push(value);
    }
    return index2;
  };
  function serializeArg(value, win2, ctx) {
    if (_instanceof(value, Array)) {
      return value.map(function(arg) {
        return serializeArg(arg, win2, ctx);
      });
    } else if (value === null) {
      return value;
    } else if (_instanceof(value, Float32Array) || _instanceof(value, Float64Array) || _instanceof(value, Int32Array) || _instanceof(value, Uint32Array) || _instanceof(value, Uint8Array) || _instanceof(value, Uint16Array) || _instanceof(value, Int16Array) || _instanceof(value, Int8Array) || _instanceof(value, Uint8ClampedArray)) {
      var name = value.constructor.name;
      return {
        rr_type: name,
        args: [
          Object.values(value)
        ]
      };
    } else if (
      // SharedArrayBuffer disabled on most browsers due to spectre.
      // More info: https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/SharedArrayBuffer/SharedArrayBuffer
      // value instanceof SharedArrayBuffer ||
      _instanceof(value, ArrayBuffer)
    ) {
      var name1 = value.constructor.name;
      var base64 = encode(value);
      return {
        rr_type: name1,
        base64
      };
    } else if (_instanceof(value, DataView)) {
      var name2 = value.constructor.name;
      return {
        rr_type: name2,
        args: [
          serializeArg(value.buffer, win2, ctx),
          value.byteOffset,
          value.byteLength
        ]
      };
    } else if (_instanceof(value, HTMLImageElement)) {
      var name3 = value.constructor.name;
      var src = value.src;
      return {
        rr_type: name3,
        src
      };
    } else if (_instanceof(value, HTMLCanvasElement)) {
      var name4 = "HTMLImageElement";
      var src1 = value.toDataURL();
      return {
        rr_type: name4,
        src: src1
      };
    } else if (_instanceof(value, ImageData)) {
      var name5 = value.constructor.name;
      return {
        rr_type: name5,
        args: [
          serializeArg(value.data, win2, ctx),
          value.width,
          value.height
        ]
      };
    } else if (isInstanceOfWebGLObject(value, win2) || (typeof value === "undefined" ? "undefined" : _type_of(value)) === "object") {
      var name6 = value.constructor.name;
      var index2 = saveWebGLVar(value, win2, ctx);
      return {
        rr_type: name6,
        index: index2
      };
    }
    return value;
  }
  var serializeArgs = function(args, win2, ctx) {
    return args.map(function(arg) {
      return serializeArg(arg, win2, ctx);
    });
  };
  var isInstanceOfWebGLObject = function(value, win2) {
    var webGLConstructorNames = [
      "WebGLActiveInfo",
      "WebGLBuffer",
      "WebGLFramebuffer",
      "WebGLProgram",
      "WebGLRenderbuffer",
      "WebGLShader",
      "WebGLShaderPrecisionFormat",
      "WebGLTexture",
      "WebGLUniformLocation",
      "WebGLVertexArrayObject",
      // In old Chrome versions, value won't be an instanceof WebGLVertexArrayObject.
      "WebGLVertexArrayObjectOES"
    ];
    var supportedWebGLConstructorNames = webGLConstructorNames.filter(function(name) {
      return typeof win2[name] === "function";
    });
    return Boolean(supportedWebGLConstructorNames.find(function(name) {
      return _instanceof(value, win2[name]);
    }));
  };
  function initCanvas2DMutationObserver(cb, win2, blockClass, blockSelector) {
    var _loop = function() {
      var prop = _step.value;
      try {
        if (typeof win2.CanvasRenderingContext2D.prototype[prop] !== "function") {
          return "continue";
        }
        var restoreHandler = patch$2(win2.CanvasRenderingContext2D.prototype, prop, function(original) {
          return function() {
            var _this = this;
            for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {
              args[_key] = arguments[_key];
            }
            if (!isBlocked(this.canvas, blockClass, blockSelector, true)) {
              setTimeout(function() {
                var recordArgs = serializeArgs(args, win2, _this);
                cb(_this.canvas, {
                  type: CanvasContext["2D"],
                  property: prop,
                  args: recordArgs
                });
              }, 0);
            }
            return original.apply(this, args);
          };
        });
        handlers.push(restoreHandler);
      } catch (e3) {
        var hookHandler = hookSetter(win2.CanvasRenderingContext2D.prototype, prop, {
          set: function set(v22) {
            cb(this.canvas, {
              type: CanvasContext["2D"],
              property: prop,
              args: [
                v22
              ],
              setter: true
            });
          }
        });
        handlers.push(hookHandler);
      }
    };
    var handlers = [];
    var props2D = Object.getOwnPropertyNames(win2.CanvasRenderingContext2D.prototype);
    for (var _iterator = _create_for_of_iterator_helper_loose(props2D), _step; !(_step = _iterator()).done; ) _loop();
    return function() {
      handlers.forEach(function(h3) {
        return h3();
      });
    };
  }
  function getNormalizedContextName(contextType) {
    return contextType === "experimental-webgl" ? "webgl" : contextType;
  }
  function initCanvasContextObserver(win2, blockClass, blockSelector, setPreserveDrawingBufferToTrue) {
    var handlers = [];
    try {
      var restoreHandler = patch$2(win2.HTMLCanvasElement.prototype, "getContext", function(original) {
        return function(contextType) {
          for (var _len = arguments.length, args = new Array(_len > 1 ? _len - 1 : 0), _key = 1; _key < _len; _key++) {
            args[_key - 1] = arguments[_key];
          }
          if (!isBlocked(this, blockClass, blockSelector, true)) {
            var ctxName = getNormalizedContextName(contextType);
            if (!("__context" in this)) this.__context = ctxName;
            if (setPreserveDrawingBufferToTrue && [
              "webgl",
              "webgl2"
            ].includes(ctxName)) {
              if (args[0] && _type_of(args[0]) === "object") {
                var contextAttributes = args[0];
                if (!contextAttributes.preserveDrawingBuffer) {
                  contextAttributes.preserveDrawingBuffer = true;
                }
              } else {
                args.splice(0, 1, {
                  preserveDrawingBuffer: true
                });
              }
            }
          }
          return original.apply(this, [].concat([
            contextType
          ], args));
        };
      });
      handlers.push(restoreHandler);
    } catch (e3) {
      console.error("failed to patch HTMLCanvasElement.prototype.getContext");
    }
    return function() {
      handlers.forEach(function(h3) {
        return h3();
      });
    };
  }
  function patchGLPrototype(prototype, type, cb, blockClass, blockSelector, win2) {
    var _loop = function() {
      var prop = _step.value;
      if (
        //prop.startsWith('get') ||  // e.g. getProgramParameter, but too risky
        [
          "isContextLost",
          "canvas",
          "drawingBufferWidth",
          "drawingBufferHeight"
        ].includes(prop)
      ) {
        return "continue";
      }
      try {
        if (typeof prototype[prop] !== "function") {
          return "continue";
        }
        var restoreHandler = patch$2(prototype, prop, function(original) {
          return function() {
            for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {
              args[_key] = arguments[_key];
            }
            var result2 = original.apply(this, args);
            saveWebGLVar(result2, win2, this);
            if ("tagName" in this.canvas && !isBlocked(this.canvas, blockClass, blockSelector, true)) {
              var recordArgs = serializeArgs(args, win2, this);
              var mutation = {
                type,
                property: prop,
                args: recordArgs
              };
              cb(this.canvas, mutation);
            }
            return result2;
          };
        });
        handlers.push(restoreHandler);
      } catch (e3) {
        var hookHandler = hookSetter(prototype, prop, {
          set: function set(v22) {
            cb(this.canvas, {
              type,
              property: prop,
              args: [
                v22
              ],
              setter: true
            });
          }
        });
        handlers.push(hookHandler);
      }
    };
    var handlers = [];
    var props = Object.getOwnPropertyNames(prototype);
    for (var _iterator = _create_for_of_iterator_helper_loose(props), _step; !(_step = _iterator()).done; ) _loop();
    return handlers;
  }
  function initCanvasWebGLMutationObserver(cb, win2, blockClass, blockSelector) {
    var _handlers;
    var handlers = [];
    (_handlers = handlers).push.apply(_handlers, [].concat(patchGLPrototype(win2.WebGLRenderingContext.prototype, CanvasContext.WebGL, cb, blockClass, blockSelector, win2)));
    if (typeof win2.WebGL2RenderingContext !== "undefined") {
      var _handlers1;
      (_handlers1 = handlers).push.apply(_handlers1, [].concat(patchGLPrototype(win2.WebGL2RenderingContext.prototype, CanvasContext.WebGL2, cb, blockClass, blockSelector, win2)));
    }
    return function() {
      handlers.forEach(function(h3) {
        return h3();
      });
    };
  }
  var encodedJs = "KGZ1bmN0aW9uKCkgewogICJ1c2Ugc3RyaWN0IjsKICB2YXIgY2hhcnMgPSAiQUJDREVGR0hJSktMTU5PUFFSU1RVVldYWVphYmNkZWZnaGlqa2xtbm9wcXJzdHV2d3h5ejAxMjM0NTY3ODkrLyI7CiAgdmFyIGxvb2t1cCA9IHR5cGVvZiBVaW50OEFycmF5ID09PSAidW5kZWZpbmVkIiA/IFtdIDogbmV3IFVpbnQ4QXJyYXkoMjU2KTsKICBmb3IgKHZhciBpID0gMDsgaSA8IGNoYXJzLmxlbmd0aDsgaSsrKSB7CiAgICBsb29rdXBbY2hhcnMuY2hhckNvZGVBdChpKV0gPSBpOwogIH0KICB2YXIgZW5jb2RlID0gZnVuY3Rpb24oYXJyYXlidWZmZXIpIHsKICAgIHZhciBieXRlcyA9IG5ldyBVaW50OEFycmF5KGFycmF5YnVmZmVyKSwgaTIsIGxlbiA9IGJ5dGVzLmxlbmd0aCwgYmFzZTY0ID0gIiI7CiAgICBmb3IgKGkyID0gMDsgaTIgPCBsZW47IGkyICs9IDMpIHsKICAgICAgYmFzZTY0ICs9IGNoYXJzW2J5dGVzW2kyXSA+PiAyXTsKICAgICAgYmFzZTY0ICs9IGNoYXJzWyhieXRlc1tpMl0gJiAzKSA8PCA0IHwgYnl0ZXNbaTIgKyAxXSA+PiA0XTsKICAgICAgYmFzZTY0ICs9IGNoYXJzWyhieXRlc1tpMiArIDFdICYgMTUpIDw8IDIgfCBieXRlc1tpMiArIDJdID4+IDZdOwogICAgICBiYXNlNjQgKz0gY2hhcnNbYnl0ZXNbaTIgKyAyXSAmIDYzXTsKICAgIH0KICAgIGlmIChsZW4gJSAzID09PSAyKSB7CiAgICAgIGJhc2U2NCA9IGJhc2U2NC5zdWJzdHJpbmcoMCwgYmFzZTY0Lmxlbmd0aCAtIDEpICsgIj0iOwogICAgfSBlbHNlIGlmIChsZW4gJSAzID09PSAxKSB7CiAgICAgIGJhc2U2NCA9IGJhc2U2NC5zdWJzdHJpbmcoMCwgYmFzZTY0Lmxlbmd0aCAtIDIpICsgIj09IjsKICAgIH0KICAgIHJldHVybiBiYXNlNjQ7CiAgfTsKICBjb25zdCBsYXN0QmxvYk1hcCA9IC8qIEBfX1BVUkVfXyAqLyBuZXcgTWFwKCk7CiAgY29uc3QgdHJhbnNwYXJlbnRCbG9iTWFwID0gLyogQF9fUFVSRV9fICovIG5ldyBNYXAoKTsKICBhc3luYyBmdW5jdGlvbiBnZXRUcmFuc3BhcmVudEJsb2JGb3Iod2lkdGgsIGhlaWdodCwgZGF0YVVSTE9wdGlvbnMpIHsKICAgIGNvbnN0IGlkID0gYCR7d2lkdGh9LSR7aGVpZ2h0fWA7CiAgICBpZiAoIk9mZnNjcmVlbkNhbnZhcyIgaW4gZ2xvYmFsVGhpcykgewogICAgICBpZiAodHJhbnNwYXJlbnRCbG9iTWFwLmhhcyhpZCkpIHJldHVybiB0cmFuc3BhcmVudEJsb2JNYXAuZ2V0KGlkKTsKICAgICAgY29uc3Qgb2Zmc2NyZWVuID0gbmV3IE9mZnNjcmVlbkNhbnZhcyh3aWR0aCwgaGVpZ2h0KTsKICAgICAgb2Zmc2NyZWVuLmdldENvbnRleHQoIjJkIik7CiAgICAgIGNvbnN0IGJsb2IgPSBhd2FpdCBvZmZzY3JlZW4uY29udmVydFRvQmxvYihkYXRhVVJMT3B0aW9ucyk7CiAgICAgIGNvbnN0IGFycmF5QnVmZmVyID0gYXdhaXQgYmxvYi5hcnJheUJ1ZmZlcigpOwogICAgICBjb25zdCBiYXNlNjQgPSBlbmNvZGUoYXJyYXlCdWZmZXIpOwogICAgICB0cmFuc3BhcmVudEJsb2JNYXAuc2V0KGlkLCBiYXNlNjQpOwogICAgICByZXR1cm4gYmFzZTY0OwogICAgfSBlbHNlIHsKICAgICAgcmV0dXJuICIiOwogICAgfQogIH0KICBjb25zdCB3b3JrZXIgPSBzZWxmOwogIHdvcmtlci5vbm1lc3NhZ2UgPSBhc3luYyBmdW5jdGlvbihlKSB7CiAgICBpZiAoIk9mZnNjcmVlbkNhbnZhcyIgaW4gZ2xvYmFsVGhpcykgewogICAgICBjb25zdCB7IGlkLCBiaXRtYXAsIHdpZHRoLCBoZWlnaHQsIGRhdGFVUkxPcHRpb25zIH0gPSBlLmRhdGE7CiAgICAgIGNvbnN0IHRyYW5zcGFyZW50QmFzZTY0ID0gZ2V0VHJhbnNwYXJlbnRCbG9iRm9yKAogICAgICAgIHdpZHRoLAogICAgICAgIGhlaWdodCwKICAgICAgICBkYXRhVVJMT3B0aW9ucwogICAgICApOwogICAgICBjb25zdCBvZmZzY3JlZW4gPSBuZXcgT2Zmc2NyZWVuQ2FudmFzKHdpZHRoLCBoZWlnaHQpOwogICAgICBjb25zdCBjdHggPSBvZmZzY3JlZW4uZ2V0Q29udGV4dCgiMmQiKTsKICAgICAgY3R4LmRyYXdJbWFnZShiaXRtYXAsIDAsIDApOwogICAgICBiaXRtYXAuY2xvc2UoKTsKICAgICAgY29uc3QgYmxvYiA9IGF3YWl0IG9mZnNjcmVlbi5jb252ZXJ0VG9CbG9iKGRhdGFVUkxPcHRpb25zKTsKICAgICAgY29uc3QgdHlwZSA9IGJsb2IudHlwZTsKICAgICAgY29uc3QgYXJyYXlCdWZmZXIgPSBhd2FpdCBibG9iLmFycmF5QnVmZmVyKCk7CiAgICAgIGNvbnN0IGJhc2U2NCA9IGVuY29kZShhcnJheUJ1ZmZlcik7CiAgICAgIGlmICghbGFzdEJsb2JNYXAuaGFzKGlkKSAmJiBhd2FpdCB0cmFuc3BhcmVudEJhc2U2NCA9PT0gYmFzZTY0KSB7CiAgICAgICAgbGFzdEJsb2JNYXAuc2V0KGlkLCBiYXNlNjQpOwogICAgICAgIHJldHVybiB3b3JrZXIucG9zdE1lc3NhZ2UoeyBpZCB9KTsKICAgICAgfQogICAgICBpZiAobGFzdEJsb2JNYXAuZ2V0KGlkKSA9PT0gYmFzZTY0KSByZXR1cm4gd29ya2VyLnBvc3RNZXNzYWdlKHsgaWQgfSk7CiAgICAgIHdvcmtlci5wb3N0TWVzc2FnZSh7CiAgICAgICAgaWQsCiAgICAgICAgdHlwZSwKICAgICAgICBiYXNlNjQsCiAgICAgICAgd2lkdGgsCiAgICAgICAgaGVpZ2h0CiAgICAgIH0pOwogICAgICBsYXN0QmxvYk1hcC5zZXQoaWQsIGJhc2U2NCk7CiAgICB9IGVsc2UgewogICAgICByZXR1cm4gd29ya2VyLnBvc3RNZXNzYWdlKHsgaWQ6IGUuZGF0YS5pZCB9KTsKICAgIH0KICB9Owp9KSgpOwovLyMgc291cmNlTWFwcGluZ1VSTD1pbWFnZS1iaXRtYXAtZGF0YS11cmwtd29ya2VyLUlKcEM3Z19iLmpzLm1hcAo=";
  var decodeBase64 = function(base64) {
    return Uint8Array.from(atob(base64), function(c22) {
      return c22.charCodeAt(0);
    });
  };
  var blob = typeof window !== "undefined" && window.Blob && new Blob([
    decodeBase64(encodedJs)
  ], {
    type: "text/javascript;charset=utf-8"
  });
  function WorkerWrapper(options) {
    var objURL;
    try {
      objURL = blob && (window.URL || window.webkitURL).createObjectURL(blob);
      if (!objURL) throw "";
      var worker = new Worker(objURL, {
        name: options == null ? void 0 : options.name
      });
      worker.addEventListener("error", function() {
        (window.URL || window.webkitURL).revokeObjectURL(objURL);
      });
      return worker;
    } catch (e22) {
      return new Worker("data:text/javascript;base64," + encodedJs, {
        name: options == null ? void 0 : options.name
      });
    } finally {
      objURL && (window.URL || window.webkitURL).revokeObjectURL(objURL);
    }
  }
  var CanvasManager = /* @__PURE__ */ (function() {
    function CanvasManager2(options) {
      var _this = this;
      __publicField$1(this, "pendingCanvasMutations", /* @__PURE__ */ new Map());
      __publicField$1(this, "rafStamps", {
        latestId: 0,
        invokeId: null
      });
      __publicField$1(this, "mirror");
      __publicField$1(this, "mutationCb");
      __publicField$1(this, "resetObservers");
      __publicField$1(this, "frozen", false);
      __publicField$1(this, "locked", false);
      __publicField$1(this, "processMutation", function(target, mutation) {
        var newFrame = _this.rafStamps.invokeId && _this.rafStamps.latestId !== _this.rafStamps.invokeId;
        if (newFrame || !_this.rafStamps.invokeId) _this.rafStamps.invokeId = _this.rafStamps.latestId;
        if (!_this.pendingCanvasMutations.has(target)) {
          _this.pendingCanvasMutations.set(target, []);
        }
        _this.pendingCanvasMutations.get(target).push(mutation);
      });
      var _options_sampling = options.sampling, sampling = _options_sampling === void 0 ? "all" : _options_sampling, win2 = options.win, blockClass = options.blockClass, blockSelector = options.blockSelector, recordCanvas = options.recordCanvas, dataURLOptions = options.dataURLOptions;
      this.mutationCb = options.mutationCb;
      this.mirror = options.mirror;
      if (recordCanvas && sampling === "all") this.initCanvasMutationObserver(win2, blockClass, blockSelector);
      if (recordCanvas && typeof sampling === "number") this.initCanvasFPSObserver(sampling, win2, blockClass, blockSelector, {
        dataURLOptions
      });
    }
    var _proto = CanvasManager2.prototype;
    _proto.reset = function reset2() {
      this.pendingCanvasMutations.clear();
      this.resetObservers && this.resetObservers();
    };
    _proto.freeze = function freeze() {
      this.frozen = true;
    };
    _proto.unfreeze = function unfreeze() {
      this.frozen = false;
    };
    _proto.lock = function lock() {
      this.locked = true;
    };
    _proto.unlock = function unlock() {
      this.locked = false;
    };
    _proto.initCanvasFPSObserver = function initCanvasFPSObserver(fps, win2, blockClass, blockSelector, options) {
      var _this = this;
      var canvasContextReset = initCanvasContextObserver(win2, blockClass, blockSelector, true);
      var snapshotInProgressMap = /* @__PURE__ */ new Map();
      var worker = new WorkerWrapper();
      worker.onmessage = function(e22) {
        var id = e22.data.id;
        snapshotInProgressMap.set(id, false);
        if (!("base64" in e22.data)) return;
        var _e2_data = e22.data, base64 = _e2_data.base64, type = _e2_data.type, width = _e2_data.width, height = _e2_data.height;
        _this.mutationCb({
          id,
          type: CanvasContext["2D"],
          commands: [
            {
              property: "clearRect",
              // wipe canvas
              args: [
                0,
                0,
                width,
                height
              ]
            },
            {
              property: "drawImage",
              // draws (semi-transparent) image
              args: [
                {
                  rr_type: "ImageBitmap",
                  args: [
                    {
                      rr_type: "Blob",
                      data: [
                        {
                          rr_type: "ArrayBuffer",
                          base64
                        }
                      ],
                      type
                    }
                  ]
                },
                0,
                0
              ]
            }
          ]
        });
      };
      var timeBetweenSnapshots = 1e3 / fps;
      var lastSnapshotTime = 0;
      var rafId;
      var getCanvas = function() {
        var matchedCanvas = [];
        win2.document.querySelectorAll("canvas").forEach(function(canvas) {
          if (!isBlocked(canvas, blockClass, blockSelector, true)) {
            matchedCanvas.push(canvas);
          }
        });
        return matchedCanvas;
      };
      var takeCanvasSnapshots = function(timestamp) {
        if (lastSnapshotTime && timestamp - lastSnapshotTime < timeBetweenSnapshots) {
          rafId = requestAnimationFrame(takeCanvasSnapshots);
          return;
        }
        lastSnapshotTime = timestamp;
        var _this1 = _this;
        getCanvas().forEach(/* @__PURE__ */ _async_to_generator(function(canvas) {
          var _a2, id, context, bitmap;
          return _ts_generator(this, function(_state) {
            switch (_state.label) {
              case 0:
                id = _this1.mirror.getId(canvas);
                if (snapshotInProgressMap.get(id)) return [
                  2
                ];
                if (canvas.width === 0 || canvas.height === 0) return [
                  2
                ];
                snapshotInProgressMap.set(id, true);
                if ([
                  "webgl",
                  "webgl2"
                ].includes(canvas.__context)) {
                  context = canvas.getContext(canvas.__context);
                  if (((_a2 = context == null ? void 0 : context.getContextAttributes()) == null ? void 0 : _a2.preserveDrawingBuffer) === false) {
                    context.clear(context.COLOR_BUFFER_BIT);
                  }
                }
                return [
                  4,
                  createImageBitmap(canvas)
                ];
              case 1:
                bitmap = _state.sent();
                worker.postMessage({
                  id,
                  bitmap,
                  width: canvas.width,
                  height: canvas.height,
                  dataURLOptions: options.dataURLOptions
                }, [
                  bitmap
                ]);
                return [
                  2
                ];
            }
          });
        }));
        rafId = requestAnimationFrame(takeCanvasSnapshots);
      };
      rafId = requestAnimationFrame(takeCanvasSnapshots);
      this.resetObservers = function() {
        canvasContextReset();
        cancelAnimationFrame(rafId);
      };
    };
    _proto.initCanvasMutationObserver = function initCanvasMutationObserver(win2, blockClass, blockSelector) {
      this.startRAFTimestamping();
      this.startPendingCanvasMutationFlusher();
      var canvasContextReset = initCanvasContextObserver(win2, blockClass, blockSelector, false);
      var canvas2DReset = initCanvas2DMutationObserver(this.processMutation.bind(this), win2, blockClass, blockSelector);
      var canvasWebGL1and2Reset = initCanvasWebGLMutationObserver(this.processMutation.bind(this), win2, blockClass, blockSelector);
      this.resetObservers = function() {
        canvasContextReset();
        canvas2DReset();
        canvasWebGL1and2Reset();
      };
    };
    _proto.startPendingCanvasMutationFlusher = function startPendingCanvasMutationFlusher() {
      var _this = this;
      requestAnimationFrame(function() {
        return _this.flushPendingCanvasMutations();
      });
    };
    _proto.startRAFTimestamping = function startRAFTimestamping() {
      var _this = this;
      var setLatestRAFTimestamp = function(timestamp) {
        _this.rafStamps.latestId = timestamp;
        requestAnimationFrame(setLatestRAFTimestamp);
      };
      requestAnimationFrame(setLatestRAFTimestamp);
    };
    _proto.flushPendingCanvasMutations = function flushPendingCanvasMutations() {
      var _this = this;
      this.pendingCanvasMutations.forEach(function(_values, canvas) {
        var id = _this.mirror.getId(canvas);
        _this.flushPendingCanvasMutationFor(canvas, id);
      });
      requestAnimationFrame(function() {
        return _this.flushPendingCanvasMutations();
      });
    };
    _proto.flushPendingCanvasMutationFor = function flushPendingCanvasMutationFor(canvas, id) {
      if (this.frozen || this.locked) {
        return;
      }
      var valuesWithType = this.pendingCanvasMutations.get(canvas);
      if (!valuesWithType || id === -1) return;
      var values = valuesWithType.map(function(value) {
        value.type;
        var rest = _object_without_properties_loose(value, [
          "type"
        ]);
        return rest;
      });
      var type = valuesWithType[0].type;
      this.mutationCb({
        id,
        type,
        commands: values
      });
      this.pendingCanvasMutations.delete(canvas);
    };
    return CanvasManager2;
  })();
  var StylesheetManager = /* @__PURE__ */ (function() {
    function StylesheetManager2(options) {
      __publicField$1(this, "trackedLinkElements", /* @__PURE__ */ new WeakSet());
      __publicField$1(this, "mutationCb");
      __publicField$1(this, "adoptedStyleSheetCb");
      __publicField$1(this, "styleMirror", new StyleSheetMirror());
      this.mutationCb = options.mutationCb;
      this.adoptedStyleSheetCb = options.adoptedStyleSheetCb;
    }
    var _proto = StylesheetManager2.prototype;
    _proto.attachLinkElement = function attachLinkElement(linkEl, childSn) {
      if ("_cssText" in childSn.attributes) this.mutationCb({
        adds: [],
        removes: [],
        texts: [],
        attributes: [
          {
            id: childSn.id,
            attributes: childSn.attributes
          }
        ]
      });
      this.trackLinkElement(linkEl);
    };
    _proto.trackLinkElement = function trackLinkElement(linkEl) {
      if (this.trackedLinkElements.has(linkEl)) return;
      this.trackedLinkElements.add(linkEl);
      this.trackStylesheetInLinkElement(linkEl);
    };
    _proto.adoptStyleSheets = function adoptStyleSheets(sheets, hostId) {
      var _this, _loop = function() {
        var sheet = _step.value;
        var styleId = void 0;
        if (!_this.styleMirror.has(sheet)) {
          styleId = _this.styleMirror.add(sheet);
          styles.push({
            styleId,
            rules: Array.from(sheet.rules || CSSRule, function(r22, index2) {
              return {
                rule: stringifyRule(r22, sheet.href),
                index: index2
              };
            })
          });
        } else styleId = _this.styleMirror.getId(sheet);
        adoptedStyleSheetData.styleIds.push(styleId);
      };
      if (sheets.length === 0) return;
      var adoptedStyleSheetData = {
        id: hostId,
        styleIds: []
      };
      var styles = [];
      for (var _iterator = _create_for_of_iterator_helper_loose(sheets), _step; !(_step = _iterator()).done; ) _this = this, _loop();
      if (styles.length > 0) adoptedStyleSheetData.styles = styles;
      this.adoptedStyleSheetCb(adoptedStyleSheetData);
    };
    _proto.reset = function reset2() {
      this.styleMirror.reset();
      this.trackedLinkElements = /* @__PURE__ */ new WeakSet();
    };
    _proto.trackStylesheetInLinkElement = function trackStylesheetInLinkElement(_linkEl) {
    };
    return StylesheetManager2;
  })();
  var ProcessedNodeManager = /* @__PURE__ */ (function() {
    function ProcessedNodeManager2() {
      __publicField$1(this, "nodeMap", /* @__PURE__ */ new WeakMap());
      __publicField$1(this, "active", false);
    }
    var _proto = ProcessedNodeManager2.prototype;
    _proto.inOtherBuffer = function inOtherBuffer(node2, thisBuffer) {
      var buffers = this.nodeMap.get(node2);
      return buffers && Array.from(buffers).some(function(buffer) {
        return buffer !== thisBuffer;
      });
    };
    _proto.add = function add(node2, buffer) {
      var _this = this;
      if (!this.active) {
        this.active = true;
        requestAnimationFrame(function() {
          _this.nodeMap = /* @__PURE__ */ new WeakMap();
          _this.active = false;
        });
      }
      this.nodeMap.set(node2, (this.nodeMap.get(node2) || /* @__PURE__ */ new Set()).add(buffer));
    };
    _proto.destroy = function destroy() {
    };
    return ProcessedNodeManager2;
  })();
  var wrappedEmit;
  var takeFullSnapshot$1;
  var canvasManager;
  var recording = false;
  try {
    if (Array.from([
      1
    ], function(x22) {
      return x22 * 2;
    })[0] !== 2) {
      cleanFrame = document.createElement("iframe");
      document.body.appendChild(cleanFrame);
      Array.from = ((_a = cleanFrame.contentWindow) == null ? void 0 : _a.Array.from) || Array.from;
      document.body.removeChild(cleanFrame);
    }
  } catch (err) {
    console.debug("Unable to override Array.from", err);
  }
  var cleanFrame;
  var mirror = createMirror$2();
  function record(options) {
    if (options === void 0) options = {};
    var emit = options.emit, checkoutEveryNms = options.checkoutEveryNms, checkoutEveryNth = options.checkoutEveryNth, _options_blockClass = options.blockClass, blockClass = _options_blockClass === void 0 ? "rr-block" : _options_blockClass, _options_blockSelector = options.blockSelector, blockSelector = _options_blockSelector === void 0 ? null : _options_blockSelector, _options_ignoreClass = options.ignoreClass, ignoreClass = _options_ignoreClass === void 0 ? "rr-ignore" : _options_ignoreClass, _options_ignoreSelector = options.ignoreSelector, ignoreSelector = _options_ignoreSelector === void 0 ? null : _options_ignoreSelector, _options_maskTextClass = options.maskTextClass, maskTextClass = _options_maskTextClass === void 0 ? "rr-mask" : _options_maskTextClass, _options_maskTextSelector = options.maskTextSelector, maskTextSelector = _options_maskTextSelector === void 0 ? null : _options_maskTextSelector, _options_inlineStylesheet = options.inlineStylesheet, inlineStylesheet = _options_inlineStylesheet === void 0 ? true : _options_inlineStylesheet, maskAllInputs = options.maskAllInputs, _maskInputOptions = options.maskInputOptions, _slimDOMOptions = options.slimDOMOptions, maskInputFn = options.maskInputFn, maskTextFn = options.maskTextFn, hooks = options.hooks, packFn = options.packFn, _options_sampling = options.sampling, sampling = _options_sampling === void 0 ? {} : _options_sampling, _options_dataURLOptions = options.dataURLOptions, dataURLOptions = _options_dataURLOptions === void 0 ? {} : _options_dataURLOptions, mousemoveWait = options.mousemoveWait, _options_recordDOM = options.recordDOM, recordDOM = _options_recordDOM === void 0 ? true : _options_recordDOM, _options_recordCanvas = options.recordCanvas, recordCanvas = _options_recordCanvas === void 0 ? false : _options_recordCanvas, _options_recordCrossOriginIframes = options.recordCrossOriginIframes, recordCrossOriginIframes = _options_recordCrossOriginIframes === void 0 ? false : _options_recordCrossOriginIframes, _options_recordAfter = options.recordAfter, recordAfter = _options_recordAfter === void 0 ? options.recordAfter === "DOMContentLoaded" ? options.recordAfter : "load" : _options_recordAfter, _options_userTriggeredOnInput = options.userTriggeredOnInput, userTriggeredOnInput = _options_userTriggeredOnInput === void 0 ? false : _options_userTriggeredOnInput, _options_collectFonts = options.collectFonts, collectFonts = _options_collectFonts === void 0 ? false : _options_collectFonts, _options_inlineImages = options.inlineImages, inlineImages = _options_inlineImages === void 0 ? false : _options_inlineImages, plugins = options.plugins, _options_keepIframeSrcFn = options.keepIframeSrcFn, keepIframeSrcFn = _options_keepIframeSrcFn === void 0 ? function() {
      return false;
    } : _options_keepIframeSrcFn, _options_ignoreCSSAttributes = options.ignoreCSSAttributes, ignoreCSSAttributes = _options_ignoreCSSAttributes === void 0 ? /* @__PURE__ */ new Set([]) : _options_ignoreCSSAttributes, errorHandler2 = options.errorHandler;
    registerErrorHandler(errorHandler2);
    var inEmittingFrame = recordCrossOriginIframes ? window.parent === window : true;
    var passEmitsToParent = false;
    if (!inEmittingFrame) {
      try {
        if (window.parent.document) {
          passEmitsToParent = false;
        }
      } catch (e22) {
        passEmitsToParent = true;
      }
    }
    if (inEmittingFrame && !emit) {
      throw new Error("emit function is required");
    }
    if (!inEmittingFrame && !passEmitsToParent) {
      return function() {
      };
    }
    if (mousemoveWait !== void 0 && sampling.mousemove === void 0) {
      sampling.mousemove = mousemoveWait;
    }
    mirror.reset();
    var maskInputOptions = maskAllInputs === true ? {
      color: true,
      date: true,
      "datetime-local": true,
      email: true,
      month: true,
      number: true,
      range: true,
      search: true,
      tel: true,
      text: true,
      time: true,
      url: true,
      week: true,
      textarea: true,
      select: true,
      password: true,
      hidden: true
    } : _maskInputOptions !== void 0 ? _maskInputOptions : {
      password: true
    };
    var slimDOMOptions = _slimDOMOptions === true || _slimDOMOptions === "all" ? {
      script: true,
      comment: true,
      headFavicon: true,
      headWhitespace: true,
      headMetaSocial: true,
      headMetaRobots: true,
      headMetaHttpEquiv: true,
      headMetaVerification: true,
      // the following are off for slimDOMOptions === true,
      // as they destroy some (hidden) info:
      headMetaAuthorship: _slimDOMOptions === "all",
      headMetaDescKeywords: _slimDOMOptions === "all",
      headTitleMutations: _slimDOMOptions === "all"
    } : _slimDOMOptions ? _slimDOMOptions : {};
    polyfill$1();
    var lastFullSnapshotEvent;
    var incrementalSnapshotCount = 0;
    var eventProcessor = function(e22) {
      for (var _iterator2 = _create_for_of_iterator_helper_loose(plugins || []), _step2; !(_step2 = _iterator2()).done; ) {
        var plugin33 = _step2.value;
        if (plugin33.eventProcessor) {
          e22 = plugin33.eventProcessor(e22);
        }
      }
      if (packFn && // Disable packing events which will be emitted to parent frames.
      !passEmitsToParent) {
        e22 = packFn(e22);
      }
      return e22;
    };
    wrappedEmit = function(r22, isCheckout) {
      var _a2;
      var e22 = r22;
      e22.timestamp = nowTimestamp();
      if (((_a2 = mutationBuffers[0]) == null ? void 0 : _a2.isFrozen()) && e22.type !== EventType.FullSnapshot && !(e22.type === EventType.IncrementalSnapshot && e22.data.source === IncrementalSource.Mutation)) {
        mutationBuffers.forEach(function(buf) {
          return buf.unfreeze();
        });
      }
      if (inEmittingFrame) {
        emit == null ? void 0 : emit(eventProcessor(e22), isCheckout);
      } else if (passEmitsToParent) {
        var message = {
          type: "rrweb",
          event: eventProcessor(e22),
          origin: window.location.origin,
          isCheckout
        };
        window.parent.postMessage(message, "*");
      }
      if (e22.type === EventType.FullSnapshot) {
        lastFullSnapshotEvent = e22;
        incrementalSnapshotCount = 0;
      } else if (e22.type === EventType.IncrementalSnapshot) {
        if (e22.data.source === IncrementalSource.Mutation && e22.data.isAttachIframe) {
          return;
        }
        incrementalSnapshotCount++;
        var exceedCount = checkoutEveryNth && incrementalSnapshotCount >= checkoutEveryNth;
        var exceedTime = checkoutEveryNms && e22.timestamp - lastFullSnapshotEvent.timestamp > checkoutEveryNms;
        if (exceedCount || exceedTime) {
          takeFullSnapshot$1(true);
        }
      }
    };
    var wrappedMutationEmit = function(m3) {
      wrappedEmit({
        type: EventType.IncrementalSnapshot,
        data: _extends({
          source: IncrementalSource.Mutation
        }, m3)
      });
    };
    var wrappedScrollEmit = function(p3) {
      return wrappedEmit({
        type: EventType.IncrementalSnapshot,
        data: _extends({
          source: IncrementalSource.Scroll
        }, p3)
      });
    };
    var wrappedCanvasMutationEmit = function(p3) {
      return wrappedEmit({
        type: EventType.IncrementalSnapshot,
        data: _extends({
          source: IncrementalSource.CanvasMutation
        }, p3)
      });
    };
    var wrappedAdoptedStyleSheetEmit = function(a22) {
      return wrappedEmit({
        type: EventType.IncrementalSnapshot,
        data: _extends({
          source: IncrementalSource.AdoptedStyleSheet
        }, a22)
      });
    };
    var stylesheetManager = new StylesheetManager({
      mutationCb: wrappedMutationEmit,
      adoptedStyleSheetCb: wrappedAdoptedStyleSheetEmit
    });
    var iframeManager = new IframeManager({
      mirror,
      mutationCb: wrappedMutationEmit,
      stylesheetManager,
      recordCrossOriginIframes,
      wrappedEmit
    });
    for (var _iterator = _create_for_of_iterator_helper_loose(plugins || []), _step; !(_step = _iterator()).done; ) {
      var plugin32 = _step.value;
      if (plugin32.getMirror) plugin32.getMirror({
        nodeMirror: mirror,
        crossOriginIframeMirror: iframeManager.crossOriginIframeMirror,
        crossOriginIframeStyleMirror: iframeManager.crossOriginIframeStyleMirror
      });
    }
    var processedNodeManager = new ProcessedNodeManager();
    canvasManager = new CanvasManager({
      recordCanvas,
      mutationCb: wrappedCanvasMutationEmit,
      win: window,
      blockClass,
      blockSelector,
      mirror,
      sampling: sampling.canvas,
      dataURLOptions
    });
    var shadowDomManager = new ShadowDomManager({
      mutationCb: wrappedMutationEmit,
      scrollCb: wrappedScrollEmit,
      bypassOptions: {
        blockClass,
        blockSelector,
        maskTextClass,
        maskTextSelector,
        inlineStylesheet,
        maskInputOptions,
        dataURLOptions,
        maskTextFn,
        maskInputFn,
        recordCanvas,
        inlineImages,
        sampling,
        slimDOMOptions,
        iframeManager,
        stylesheetManager,
        canvasManager,
        keepIframeSrcFn,
        processedNodeManager
      },
      mirror
    });
    takeFullSnapshot$1 = function(isCheckout) {
      if (isCheckout === void 0) isCheckout = false;
      if (!recordDOM) {
        return;
      }
      wrappedEmit({
        type: EventType.Meta,
        data: {
          href: window.location.href,
          width: getWindowWidth(),
          height: getWindowHeight()
        }
      }, isCheckout);
      stylesheetManager.reset();
      shadowDomManager.init();
      mutationBuffers.forEach(function(buf) {
        return buf.lock();
      });
      var node2 = snapshot(document, {
        mirror,
        blockClass,
        blockSelector,
        maskTextClass,
        maskTextSelector,
        inlineStylesheet,
        maskAllInputs: maskInputOptions,
        maskTextFn,
        maskInputFn,
        slimDOM: slimDOMOptions,
        dataURLOptions,
        recordCanvas,
        inlineImages,
        onSerialize: function(n22) {
          if (isSerializedIframe(n22, mirror)) {
            iframeManager.addIframe(n22);
          }
          if (isSerializedStylesheet(n22, mirror)) {
            stylesheetManager.trackLinkElement(n22);
          }
          if (hasShadowRoot(n22)) {
            shadowDomManager.addShadowRoot(index$2.shadowRoot(n22), document);
          }
        },
        onIframeLoad: function(iframe, childSn) {
          iframeManager.attachIframe(iframe, childSn);
          shadowDomManager.observeAttachShadow(iframe);
        },
        onStylesheetLoad: function(linkEl, childSn) {
          stylesheetManager.attachLinkElement(linkEl, childSn);
        },
        keepIframeSrcFn
      });
      if (!node2) {
        return console.warn("Failed to snapshot the document");
      }
      wrappedEmit({
        type: EventType.FullSnapshot,
        data: {
          node: node2,
          initialOffset: getWindowScroll(window)
        }
      }, isCheckout);
      mutationBuffers.forEach(function(buf) {
        return buf.unlock();
      });
      if (document.adoptedStyleSheets && document.adoptedStyleSheets.length > 0) stylesheetManager.adoptStyleSheets(document.adoptedStyleSheets, mirror.getId(document));
    };
    try {
      var handlers = [];
      var observe = function(doc) {
        var _a2;
        return callbackWrapper(initObservers)({
          mutationCb: wrappedMutationEmit,
          mousemoveCb: function(positions, source) {
            return wrappedEmit({
              type: EventType.IncrementalSnapshot,
              data: {
                source,
                positions
              }
            });
          },
          mouseInteractionCb: function(d3) {
            return wrappedEmit({
              type: EventType.IncrementalSnapshot,
              data: _extends({
                source: IncrementalSource.MouseInteraction
              }, d3)
            });
          },
          scrollCb: wrappedScrollEmit,
          viewportResizeCb: function(d3) {
            return wrappedEmit({
              type: EventType.IncrementalSnapshot,
              data: _extends({
                source: IncrementalSource.ViewportResize
              }, d3)
            });
          },
          inputCb: function(v22) {
            return wrappedEmit({
              type: EventType.IncrementalSnapshot,
              data: _extends({
                source: IncrementalSource.Input
              }, v22)
            });
          },
          mediaInteractionCb: function(p3) {
            return wrappedEmit({
              type: EventType.IncrementalSnapshot,
              data: _extends({
                source: IncrementalSource.MediaInteraction
              }, p3)
            });
          },
          styleSheetRuleCb: function(r22) {
            return wrappedEmit({
              type: EventType.IncrementalSnapshot,
              data: _extends({
                source: IncrementalSource.StyleSheetRule
              }, r22)
            });
          },
          styleDeclarationCb: function(r22) {
            return wrappedEmit({
              type: EventType.IncrementalSnapshot,
              data: _extends({
                source: IncrementalSource.StyleDeclaration
              }, r22)
            });
          },
          canvasMutationCb: wrappedCanvasMutationEmit,
          fontCb: function(p3) {
            return wrappedEmit({
              type: EventType.IncrementalSnapshot,
              data: _extends({
                source: IncrementalSource.Font
              }, p3)
            });
          },
          selectionCb: function(p3) {
            wrappedEmit({
              type: EventType.IncrementalSnapshot,
              data: _extends({
                source: IncrementalSource.Selection
              }, p3)
            });
          },
          customElementCb: function(c22) {
            wrappedEmit({
              type: EventType.IncrementalSnapshot,
              data: _extends({
                source: IncrementalSource.CustomElement
              }, c22)
            });
          },
          blockClass,
          ignoreClass,
          ignoreSelector,
          maskTextClass,
          maskTextSelector,
          maskInputOptions,
          inlineStylesheet,
          sampling,
          recordDOM,
          recordCanvas,
          inlineImages,
          userTriggeredOnInput,
          collectFonts,
          doc,
          maskInputFn,
          maskTextFn,
          keepIframeSrcFn,
          blockSelector,
          slimDOMOptions,
          dataURLOptions,
          mirror,
          iframeManager,
          stylesheetManager,
          shadowDomManager,
          processedNodeManager,
          canvasManager,
          ignoreCSSAttributes,
          plugins: ((_a2 = plugins == null ? void 0 : plugins.filter(function(p3) {
            return p3.observer;
          })) == null ? void 0 : _a2.map(function(p3) {
            return {
              observer: p3.observer,
              options: p3.options,
              callback: function(payload) {
                return wrappedEmit({
                  type: EventType.Plugin,
                  data: {
                    plugin: p3.name,
                    payload
                  }
                });
              }
            };
          })) || []
        }, hooks);
      };
      iframeManager.addLoadListener(function(iframeEl) {
        try {
          handlers.push(observe(iframeEl.contentDocument));
        } catch (error) {
          console.warn(error);
        }
      });
      var init = function() {
        takeFullSnapshot$1();
        handlers.push(observe(document));
        recording = true;
      };
      if (document.readyState === "interactive" || document.readyState === "complete") {
        init();
      } else {
        handlers.push(on2("DOMContentLoaded", function() {
          wrappedEmit({
            type: EventType.DomContentLoaded,
            data: {}
          });
          if (recordAfter === "DOMContentLoaded") init();
        }));
        handlers.push(on2("load", function() {
          wrappedEmit({
            type: EventType.Load,
            data: {}
          });
          if (recordAfter === "load") init();
        }, window));
      }
      return function() {
        handlers.forEach(function(handler) {
          try {
            handler();
          } catch (error) {
            var msg = String(error).toLowerCase();
            if (!msg.includes("cross-origin")) {
              console.warn(error);
            }
          }
        });
        processedNodeManager.destroy();
        recording = false;
        unregisterErrorHandler();
      };
    } catch (error) {
      console.warn(error);
    }
  }
  record.addCustomEvent = function(tag, payload) {
    if (!recording) {
      throw new Error("please add custom event after start recording");
    }
    wrappedEmit({
      type: EventType.Custom,
      data: {
        tag,
        payload
      }
    });
  };
  record.freezePage = function() {
    mutationBuffers.forEach(function(buf) {
      return buf.freeze();
    });
  };
  record.takeFullSnapshot = function(isCheckout) {
    if (!recording) {
      throw new Error("please take full snapshot after start recording");
    }
    takeFullSnapshot$1(isCheckout);
  };
  record.mirror = mirror;
  var n2;
  !(function(t22) {
    t22[t22.NotStarted = 0] = "NotStarted", t22[t22.Running = 1] = "Running", t22[t22.Stopped = 2] = "Stopped";
  })(n2 || (n2 = {}));
  record.addCustomEvent;
  record.freezePage;
  record.takeFullSnapshot;
  var testableAccessors = {
    Node: [
      "childNodes",
      "parentNode",
      "parentElement",
      "textContent"
    ],
    ShadowRoot: [
      "host",
      "styleSheets"
    ],
    Element: [
      "shadowRoot",
      "querySelector",
      "querySelectorAll"
    ],
    MutationObserver: []
  };
  var testableMethods = {
    Node: [
      "contains",
      "getRootNode"
    ],
    ShadowRoot: [
      "getSelection"
    ],
    Element: [],
    MutationObserver: [
      "constructor"
    ]
  };
  var untaintedBasePrototype = {};
  var isAngularZonePresent = function() {
    return !!globalThis.Zone;
  };
  function getUntaintedPrototype(key) {
    if (untaintedBasePrototype[key]) return untaintedBasePrototype[key];
    var defaultObj = globalThis[key];
    var defaultPrototype = defaultObj.prototype;
    var accessorNames = key in testableAccessors ? testableAccessors[key] : void 0;
    var isUntaintedAccessors = Boolean(accessorNames && // @ts-expect-error 2345
    accessorNames.every(function(accessor) {
      var _a2, _b;
      return Boolean((_b = (_a2 = Object.getOwnPropertyDescriptor(defaultPrototype, accessor)) == null ? void 0 : _a2.get) == null ? void 0 : _b.toString().includes("[native code]"));
    }));
    var methodNames = key in testableMethods ? testableMethods[key] : void 0;
    var isUntaintedMethods = Boolean(methodNames && methodNames.every(
      // @ts-expect-error 2345
      function(method) {
        var _a2;
        return typeof defaultPrototype[method] === "function" && ((_a2 = defaultPrototype[method]) == null ? void 0 : _a2.toString().includes("[native code]"));
      }
    ));
    if (isUntaintedAccessors && isUntaintedMethods && !isAngularZonePresent()) {
      untaintedBasePrototype[key] = defaultObj.prototype;
      return defaultObj.prototype;
    }
    try {
      var iframeEl = document.createElement("iframe");
      document.body.appendChild(iframeEl);
      var win2 = iframeEl.contentWindow;
      if (!win2) return defaultObj.prototype;
      var untaintedObject = win2[key].prototype;
      document.body.removeChild(iframeEl);
      if (!untaintedObject) return defaultPrototype;
      return untaintedBasePrototype[key] = untaintedObject;
    } catch (e3) {
      return defaultPrototype;
    }
  }
  var untaintedAccessorCache = {};
  function getUntaintedAccessor(key, instance, accessor) {
    var _a2;
    var cacheKey = key + "." + String(accessor);
    if (untaintedAccessorCache[cacheKey]) return untaintedAccessorCache[cacheKey].call(instance);
    var untaintedPrototype = getUntaintedPrototype(key);
    var untaintedAccessor = (_a2 = Object.getOwnPropertyDescriptor(untaintedPrototype, accessor)) == null ? void 0 : _a2.get;
    if (!untaintedAccessor) return instance[accessor];
    untaintedAccessorCache[cacheKey] = untaintedAccessor;
    return untaintedAccessor.call(instance);
  }
  var untaintedMethodCache = {};
  function getUntaintedMethod(key, instance, method) {
    var cacheKey = key + "." + String(method);
    if (untaintedMethodCache[cacheKey]) return untaintedMethodCache[cacheKey].bind(instance);
    var untaintedPrototype = getUntaintedPrototype(key);
    var untaintedMethod = untaintedPrototype[method];
    if (typeof untaintedMethod !== "function") return instance[method];
    untaintedMethodCache[cacheKey] = untaintedMethod;
    return untaintedMethod.bind(instance);
  }
  function childNodes(n3) {
    return getUntaintedAccessor("Node", n3, "childNodes");
  }
  function parentNode(n3) {
    return getUntaintedAccessor("Node", n3, "parentNode");
  }
  function parentElement(n3) {
    return getUntaintedAccessor("Node", n3, "parentElement");
  }
  function textContent(n3) {
    return getUntaintedAccessor("Node", n3, "textContent");
  }
  function contains(n3, other) {
    return getUntaintedMethod("Node", n3, "contains")(other);
  }
  function getRootNode(n3) {
    return getUntaintedMethod("Node", n3, "getRootNode")();
  }
  function host(n3) {
    if (!n3 || !("host" in n3)) return null;
    return getUntaintedAccessor("ShadowRoot", n3, "host");
  }
  function styleSheets(n3) {
    return n3.styleSheets;
  }
  function shadowRoot(n3) {
    if (!n3 || !("shadowRoot" in n3)) return null;
    return getUntaintedAccessor("Element", n3, "shadowRoot");
  }
  function querySelector(n3, selectors) {
    return getUntaintedAccessor("Element", n3, "querySelector")(selectors);
  }
  function querySelectorAll(n3, selectors) {
    return getUntaintedAccessor("Element", n3, "querySelectorAll")(selectors);
  }
  function mutationObserverCtor() {
    return getUntaintedPrototype("MutationObserver").constructor;
  }
  function patch$1(source, name, replacement) {
    try {
      if (!(name in source)) {
        return function() {
        };
      }
      var original = source[name];
      var wrapped = replacement(original);
      if (typeof wrapped === "function") {
        wrapped.prototype = wrapped.prototype || {};
        Object.defineProperties(wrapped, {
          __rrweb_original__: {
            enumerable: false,
            value: original
          }
        });
      }
      source[name] = wrapped;
      return function() {
        source[name] = original;
      };
    } catch (e3) {
      return function() {
      };
    }
  }
  var index = {
    childNodes,
    parentNode,
    parentElement,
    textContent,
    contains,
    getRootNode,
    host,
    styleSheets,
    shadowRoot,
    querySelector,
    querySelectorAll,
    mutationObserver: mutationObserverCtor,
    patch: patch$1
  };
  function classMatchesRegex(node2, regex, checkAncestors) {
    if (!node2) return false;
    if (node2.nodeType !== node2.ELEMENT_NODE) {
      return classMatchesRegex(index.parentNode(node2), regex);
    }
    for (var eIndex = node2.classList.length; eIndex--; ) {
      var className = node2.classList[eIndex];
      if (regex.test(className)) {
        return true;
      }
    }
    return classMatchesRegex(index.parentNode(node2), regex);
  }
  function getDefaultExportFromCjs(x22) {
    return x22 && x22.__esModule && Object.prototype.hasOwnProperty.call(x22, "default") ? x22["default"] : x22;
  }
  function getAugmentedNamespace(n3) {
    if (n3.__esModule) return n3;
    var f3 = n3.default;
    if (typeof f3 == "function") {
      var a3 = function a22() {
        if (_instanceof(this, a22)) {
          return Reflect.construct(f3, arguments, this.constructor);
        }
        return f3.apply(this, arguments);
      };
      a3.prototype = f3.prototype;
    } else a3 = {};
    Object.defineProperty(a3, "__esModule", {
      value: true
    });
    Object.keys(n3).forEach(function(k4) {
      var d3 = Object.getOwnPropertyDescriptor(n3, k4);
      Object.defineProperty(a3, k4, d3.get ? d3 : {
        enumerable: true,
        get: function get() {
          return n3[k4];
        }
      });
    });
    return a3;
  }
  var picocolors_browser = {
    exports: {}
  };
  var x4 = String;
  var create = function create2() {
    return {
      isColorSupported: false,
      reset: x4,
      bold: x4,
      dim: x4,
      italic: x4,
      underline: x4,
      inverse: x4,
      hidden: x4,
      strikethrough: x4,
      black: x4,
      red: x4,
      green: x4,
      yellow: x4,
      blue: x4,
      magenta: x4,
      cyan: x4,
      white: x4,
      gray: x4,
      bgBlack: x4,
      bgRed: x4,
      bgGreen: x4,
      bgYellow: x4,
      bgBlue: x4,
      bgMagenta: x4,
      bgCyan: x4,
      bgWhite: x4
    };
  };
  picocolors_browser.exports = create();
  picocolors_browser.exports.createColors = create;
  var picocolors_browserExports = picocolors_browser.exports;
  var __viteBrowserExternal = {};
  var __viteBrowserExternal$1 = /* @__PURE__ */ Object.freeze(/* @__PURE__ */ Object.defineProperty({
    __proto__: null,
    default: __viteBrowserExternal
  }, Symbol.toStringTag, {
    value: "Module"
  }));
  var require$$2 = /* @__PURE__ */ getAugmentedNamespace(__viteBrowserExternal$1);
  var pico = picocolors_browserExports;
  var terminalHighlight$1 = require$$2;
  var CssSyntaxError$3 = /* @__PURE__ */ (function(Error1) {
    _inherits(CssSyntaxError, Error1);
    function CssSyntaxError(message, line, column, source, file, plugin22) {
      var _this;
      _this = Error1.call(this, message) || this;
      _this.name = "CssSyntaxError";
      _this.reason = message;
      if (file) {
        _this.file = file;
      }
      if (source) {
        _this.source = source;
      }
      if (plugin22) {
        _this.plugin = plugin22;
      }
      if (typeof line !== "undefined" && typeof column !== "undefined") {
        if (typeof line === "number") {
          _this.line = line;
          _this.column = column;
        } else {
          _this.line = line.line;
          _this.column = line.column;
          _this.endLine = column.line;
          _this.endColumn = column.column;
        }
      }
      _this.setMessage();
      if (Error.captureStackTrace) {
        Error.captureStackTrace(_this, CssSyntaxError);
      }
      return _this;
    }
    var _proto = CssSyntaxError.prototype;
    _proto.setMessage = function setMessage() {
      this.message = this.plugin ? this.plugin + ": " : "";
      this.message += this.file ? this.file : "<css input>";
      if (typeof this.line !== "undefined") {
        this.message += ":" + this.line + ":" + this.column;
      }
      this.message += ": " + this.reason;
    };
    _proto.showSourceCode = function showSourceCode(color) {
      var _this = this;
      if (!this.source) return "";
      var css = this.source;
      if (color == null) color = pico.isColorSupported;
      if (terminalHighlight$1) {
        if (color) css = terminalHighlight$1(css);
      }
      var lines = css.split(/\r?\n/);
      var start = Math.max(this.line - 3, 0);
      var end = Math.min(this.line + 2, lines.length);
      var maxWidth = String(end).length;
      var mark, aside;
      if (color) {
        var _pico_createColors = pico.createColors(true), bold = _pico_createColors.bold, gray = _pico_createColors.gray, red = _pico_createColors.red;
        mark = function(text) {
          return bold(red(text));
        };
        aside = function(text) {
          return gray(text);
        };
      } else {
        mark = aside = function(str) {
          return str;
        };
      }
      return lines.slice(start, end).map(function(line, index2) {
        var number = start + 1 + index2;
        var gutter = " " + (" " + number).slice(-maxWidth) + " | ";
        if (number === _this.line) {
          var spacing = aside(gutter.replace(/\d/g, " ")) + line.slice(0, _this.column - 1).replace(/[^\t]/g, " ");
          return mark(">") + aside(gutter) + line + "\n " + spacing + mark("^");
        }
        return " " + aside(gutter) + line;
      }).join("\n");
    };
    _proto.toString = function toString2() {
      var code = this.showSourceCode();
      if (code) {
        code = "\n\n" + code + "\n";
      }
      return this.name + ": " + this.message + code;
    };
    return CssSyntaxError;
  })(_wrap_native_super(Error));
  var cssSyntaxError = CssSyntaxError$3;
  CssSyntaxError$3.default = CssSyntaxError$3;
  var symbols = {};
  symbols.isClean = /* @__PURE__ */ Symbol("isClean");
  symbols.my = /* @__PURE__ */ Symbol("my");
  var DEFAULT_RAW = {
    after: "\n",
    beforeClose: "\n",
    beforeComment: "\n",
    beforeDecl: "\n",
    beforeOpen: " ",
    beforeRule: "\n",
    colon: ": ",
    commentLeft: " ",
    commentRight: " ",
    emptyBody: "",
    indent: "    ",
    semicolon: false
  };
  function capitalize(str) {
    return str[0].toUpperCase() + str.slice(1);
  }
  var Stringifier$2 = /* @__PURE__ */ (function() {
    function Stringifier(builder) {
      this.builder = builder;
    }
    var _proto = Stringifier.prototype;
    _proto.atrule = function atrule(node2, semicolon) {
      var name = "@" + node2.name;
      var params = node2.params ? this.rawValue(node2, "params") : "";
      if (typeof node2.raws.afterName !== "undefined") {
        name += node2.raws.afterName;
      } else if (params) {
        name += " ";
      }
      if (node2.nodes) {
        this.block(node2, name + params);
      } else {
        var end = (node2.raws.between || "") + (semicolon ? ";" : "");
        this.builder(name + params + end, node2);
      }
    };
    _proto.beforeAfter = function beforeAfter(node2, detect) {
      var value;
      if (node2.type === "decl") {
        value = this.raw(node2, null, "beforeDecl");
      } else if (node2.type === "comment") {
        value = this.raw(node2, null, "beforeComment");
      } else if (detect === "before") {
        value = this.raw(node2, null, "beforeRule");
      } else {
        value = this.raw(node2, null, "beforeClose");
      }
      var buf = node2.parent;
      var depth = 0;
      while (buf && buf.type !== "root") {
        depth += 1;
        buf = buf.parent;
      }
      if (value.includes("\n")) {
        var indent = this.raw(node2, null, "indent");
        if (indent.length) {
          for (var step = 0; step < depth; step++) value += indent;
        }
      }
      return value;
    };
    _proto.block = function block(node2, start) {
      var between = this.raw(node2, "between", "beforeOpen");
      this.builder(start + between + "{", node2, "start");
      var after;
      if (node2.nodes && node2.nodes.length) {
        this.body(node2);
        after = this.raw(node2, "after");
      } else {
        after = this.raw(node2, "after", "emptyBody");
      }
      if (after) this.builder(after);
      this.builder("}", node2, "end");
    };
    _proto.body = function body(node2) {
      var last = node2.nodes.length - 1;
      while (last > 0) {
        if (node2.nodes[last].type !== "comment") break;
        last -= 1;
      }
      var semicolon = this.raw(node2, "semicolon");
      for (var i3 = 0; i3 < node2.nodes.length; i3++) {
        var child = node2.nodes[i3];
        var before = this.raw(child, "before");
        if (before) this.builder(before);
        this.stringify(child, last !== i3 || semicolon);
      }
    };
    _proto.comment = function comment2(node2) {
      var left = this.raw(node2, "left", "commentLeft");
      var right = this.raw(node2, "right", "commentRight");
      this.builder("/*" + left + node2.text + right + "*/", node2);
    };
    _proto.decl = function decl(node2, semicolon) {
      var between = this.raw(node2, "between", "colon");
      var string = node2.prop + between + this.rawValue(node2, "value");
      if (node2.important) {
        string += node2.raws.important || " !important";
      }
      if (semicolon) string += ";";
      this.builder(string, node2);
    };
    _proto.document = function document1(node2) {
      this.body(node2);
    };
    _proto.raw = function raw(node2, own, detect) {
      var value;
      if (!detect) detect = own;
      if (own) {
        value = node2.raws[own];
        if (typeof value !== "undefined") return value;
      }
      var parent = node2.parent;
      if (detect === "before") {
        if (!parent || parent.type === "root" && parent.first === node2) {
          return "";
        }
        if (parent && parent.type === "document") {
          return "";
        }
      }
      if (!parent) return DEFAULT_RAW[detect];
      var root2 = node2.root();
      if (!root2.rawCache) root2.rawCache = {};
      if (typeof root2.rawCache[detect] !== "undefined") {
        return root2.rawCache[detect];
      }
      if (detect === "before" || detect === "after") {
        return this.beforeAfter(node2, detect);
      } else {
        var method = "raw" + capitalize(detect);
        if (this[method]) {
          value = this[method](root2, node2);
        } else {
          root2.walk(function(i3) {
            value = i3.raws[own];
            if (typeof value !== "undefined") return false;
          });
        }
      }
      if (typeof value === "undefined") value = DEFAULT_RAW[detect];
      root2.rawCache[detect] = value;
      return value;
    };
    _proto.rawBeforeClose = function rawBeforeClose(root2) {
      var value;
      root2.walk(function(i3) {
        if (i3.nodes && i3.nodes.length > 0) {
          if (typeof i3.raws.after !== "undefined") {
            value = i3.raws.after;
            if (value.includes("\n")) {
              value = value.replace(/[^\n]+$/, "");
            }
            return false;
          }
        }
      });
      if (value) value = value.replace(/\S/g, "");
      return value;
    };
    _proto.rawBeforeComment = function rawBeforeComment(root2, node2) {
      var value;
      root2.walkComments(function(i3) {
        if (typeof i3.raws.before !== "undefined") {
          value = i3.raws.before;
          if (value.includes("\n")) {
            value = value.replace(/[^\n]+$/, "");
          }
          return false;
        }
      });
      if (typeof value === "undefined") {
        value = this.raw(node2, null, "beforeDecl");
      } else if (value) {
        value = value.replace(/\S/g, "");
      }
      return value;
    };
    _proto.rawBeforeDecl = function rawBeforeDecl(root2, node2) {
      var value;
      root2.walkDecls(function(i3) {
        if (typeof i3.raws.before !== "undefined") {
          value = i3.raws.before;
          if (value.includes("\n")) {
            value = value.replace(/[^\n]+$/, "");
          }
          return false;
        }
      });
      if (typeof value === "undefined") {
        value = this.raw(node2, null, "beforeRule");
      } else if (value) {
        value = value.replace(/\S/g, "");
      }
      return value;
    };
    _proto.rawBeforeOpen = function rawBeforeOpen(root2) {
      var value;
      root2.walk(function(i3) {
        if (i3.type !== "decl") {
          value = i3.raws.between;
          if (typeof value !== "undefined") return false;
        }
      });
      return value;
    };
    _proto.rawBeforeRule = function rawBeforeRule(root2) {
      var value;
      root2.walk(function(i3) {
        if (i3.nodes && (i3.parent !== root2 || root2.first !== i3)) {
          if (typeof i3.raws.before !== "undefined") {
            value = i3.raws.before;
            if (value.includes("\n")) {
              value = value.replace(/[^\n]+$/, "");
            }
            return false;
          }
        }
      });
      if (value) value = value.replace(/\S/g, "");
      return value;
    };
    _proto.rawColon = function rawColon(root2) {
      var value;
      root2.walkDecls(function(i3) {
        if (typeof i3.raws.between !== "undefined") {
          value = i3.raws.between.replace(/[^\s:]/g, "");
          return false;
        }
      });
      return value;
    };
    _proto.rawEmptyBody = function rawEmptyBody(root2) {
      var value;
      root2.walk(function(i3) {
        if (i3.nodes && i3.nodes.length === 0) {
          value = i3.raws.after;
          if (typeof value !== "undefined") return false;
        }
      });
      return value;
    };
    _proto.rawIndent = function rawIndent(root2) {
      if (root2.raws.indent) return root2.raws.indent;
      var value;
      root2.walk(function(i3) {
        var p3 = i3.parent;
        if (p3 && p3 !== root2 && p3.parent && p3.parent === root2) {
          if (typeof i3.raws.before !== "undefined") {
            var parts = i3.raws.before.split("\n");
            value = parts[parts.length - 1];
            value = value.replace(/\S/g, "");
            return false;
          }
        }
      });
      return value;
    };
    _proto.rawSemicolon = function rawSemicolon(root2) {
      var value;
      root2.walk(function(i3) {
        if (i3.nodes && i3.nodes.length && i3.last.type === "decl") {
          value = i3.raws.semicolon;
          if (typeof value !== "undefined") return false;
        }
      });
      return value;
    };
    _proto.rawValue = function rawValue(node2, prop) {
      var value = node2[prop];
      var raw = node2.raws[prop];
      if (raw && raw.value === value) {
        return raw.raw;
      }
      return value;
    };
    _proto.root = function root2(node2) {
      this.body(node2);
      if (node2.raws.after) this.builder(node2.raws.after);
    };
    _proto.rule = function rule2(node2) {
      this.block(node2, this.rawValue(node2, "selector"));
      if (node2.raws.ownSemicolon) {
        this.builder(node2.raws.ownSemicolon, node2, "end");
      }
    };
    _proto.stringify = function stringify2(node2, semicolon) {
      if (!this[node2.type]) {
        throw new Error("Unknown AST node type " + node2.type + ". Maybe you need to change PostCSS stringifier.");
      }
      this[node2.type](node2, semicolon);
    };
    return Stringifier;
  })();
  var stringifier = Stringifier$2;
  Stringifier$2.default = Stringifier$2;
  var Stringifier$1 = stringifier;
  function stringify$4(node2, builder) {
    var str = new Stringifier$1(builder);
    str.stringify(node2);
  }
  var stringify_1 = stringify$4;
  stringify$4.default = stringify$4;
  var isClean$2 = symbols.isClean;
  var my$2 = symbols.my;
  var CssSyntaxError$2 = cssSyntaxError;
  var Stringifier2 = stringifier;
  var stringify$3 = stringify_1;
  function cloneNode(obj, parent) {
    var cloned = new obj.constructor();
    for (var i3 in obj) {
      if (!Object.prototype.hasOwnProperty.call(obj, i3)) {
        continue;
      }
      if (i3 === "proxyCache") continue;
      var value = obj[i3];
      var type = typeof value === "undefined" ? "undefined" : _type_of(value);
      if (i3 === "parent" && type === "object") {
        if (parent) cloned[i3] = parent;
      } else if (i3 === "source") {
        cloned[i3] = value;
      } else if (Array.isArray(value)) {
        cloned[i3] = value.map(function(j4) {
          return cloneNode(j4, cloned);
        });
      } else {
        if (type === "object" && value !== null) value = cloneNode(value);
        cloned[i3] = value;
      }
    }
    return cloned;
  }
  var Node$4 = /* @__PURE__ */ (function() {
    function Node1(defaults) {
      if (defaults === void 0) defaults = {};
      this.raws = {};
      this[isClean$2] = false;
      this[my$2] = true;
      for (var name in defaults) {
        if (name === "nodes") {
          this.nodes = [];
          for (var _iterator = _create_for_of_iterator_helper_loose(defaults[name]), _step; !(_step = _iterator()).done; ) {
            var node2 = _step.value;
            if (typeof node2.clone === "function") {
              this.append(node2.clone());
            } else {
              this.append(node2);
            }
          }
        } else {
          this[name] = defaults[name];
        }
      }
    }
    var _proto = Node1.prototype;
    _proto.addToError = function addToError(error) {
      error.postcssNode = this;
      if (error.stack && this.source && /\n\s{4}at /.test(error.stack)) {
        var s3 = this.source;
        error.stack = error.stack.replace(/\n\s{4}at /, "$&" + s3.input.from + ":" + s3.start.line + ":" + s3.start.column + "$&");
      }
      return error;
    };
    _proto.after = function after(add) {
      this.parent.insertAfter(this, add);
      return this;
    };
    _proto.assign = function assign(overrides) {
      if (overrides === void 0) overrides = {};
      for (var name in overrides) {
        this[name] = overrides[name];
      }
      return this;
    };
    _proto.before = function before(add) {
      this.parent.insertBefore(this, add);
      return this;
    };
    _proto.cleanRaws = function cleanRaws(keepBetween) {
      delete this.raws.before;
      delete this.raws.after;
      if (!keepBetween) delete this.raws.between;
    };
    _proto.clone = function clone(overrides) {
      if (overrides === void 0) overrides = {};
      var cloned = cloneNode(this);
      for (var name in overrides) {
        cloned[name] = overrides[name];
      }
      return cloned;
    };
    _proto.cloneAfter = function cloneAfter(overrides) {
      if (overrides === void 0) overrides = {};
      var cloned = this.clone(overrides);
      this.parent.insertAfter(this, cloned);
      return cloned;
    };
    _proto.cloneBefore = function cloneBefore(overrides) {
      if (overrides === void 0) overrides = {};
      var cloned = this.clone(overrides);
      this.parent.insertBefore(this, cloned);
      return cloned;
    };
    _proto.error = function error(message, opts) {
      if (opts === void 0) opts = {};
      if (this.source) {
        var _this_rangeBy = this.rangeBy(opts), end = _this_rangeBy.end, start = _this_rangeBy.start;
        return this.source.input.error(message, {
          column: start.column,
          line: start.line
        }, {
          column: end.column,
          line: end.line
        }, opts);
      }
      return new CssSyntaxError$2(message);
    };
    _proto.getProxyProcessor = function getProxyProcessor() {
      return {
        get: function get(node2, prop) {
          if (prop === "proxyOf") {
            return node2;
          } else if (prop === "root") {
            return function() {
              return node2.root().toProxy();
            };
          } else {
            return node2[prop];
          }
        },
        set: function set(node2, prop, value) {
          if (node2[prop] === value) return true;
          node2[prop] = value;
          if (prop === "prop" || prop === "value" || prop === "name" || prop === "params" || prop === "important" || /* c8 ignore next */
          prop === "text") {
            node2.markDirty();
          }
          return true;
        }
      };
    };
    _proto.markDirty = function markDirty() {
      if (this[isClean$2]) {
        this[isClean$2] = false;
        var next = this;
        while (next = next.parent) {
          next[isClean$2] = false;
        }
      }
    };
    _proto.next = function next() {
      if (!this.parent) return void 0;
      var index2 = this.parent.index(this);
      return this.parent.nodes[index2 + 1];
    };
    _proto.positionBy = function positionBy(opts, stringRepresentation) {
      var pos = this.source.start;
      if (opts.index) {
        pos = this.positionInside(opts.index, stringRepresentation);
      } else if (opts.word) {
        stringRepresentation = this.toString();
        var index2 = stringRepresentation.indexOf(opts.word);
        if (index2 !== -1) pos = this.positionInside(index2, stringRepresentation);
      }
      return pos;
    };
    _proto.positionInside = function positionInside(index2, stringRepresentation) {
      var string = stringRepresentation || this.toString();
      var column = this.source.start.column;
      var line = this.source.start.line;
      for (var i3 = 0; i3 < index2; i3++) {
        if (string[i3] === "\n") {
          column = 1;
          line += 1;
        } else {
          column += 1;
        }
      }
      return {
        column,
        line
      };
    };
    _proto.prev = function prev() {
      if (!this.parent) return void 0;
      var index2 = this.parent.index(this);
      return this.parent.nodes[index2 - 1];
    };
    _proto.rangeBy = function rangeBy(opts) {
      var start = {
        column: this.source.start.column,
        line: this.source.start.line
      };
      var end = this.source.end ? {
        column: this.source.end.column + 1,
        line: this.source.end.line
      } : {
        column: start.column + 1,
        line: start.line
      };
      if (opts.word) {
        var stringRepresentation = this.toString();
        var index2 = stringRepresentation.indexOf(opts.word);
        if (index2 !== -1) {
          start = this.positionInside(index2, stringRepresentation);
          end = this.positionInside(index2 + opts.word.length, stringRepresentation);
        }
      } else {
        if (opts.start) {
          start = {
            column: opts.start.column,
            line: opts.start.line
          };
        } else if (opts.index) {
          start = this.positionInside(opts.index);
        }
        if (opts.end) {
          end = {
            column: opts.end.column,
            line: opts.end.line
          };
        } else if (typeof opts.endIndex === "number") {
          end = this.positionInside(opts.endIndex);
        } else if (opts.index) {
          end = this.positionInside(opts.index + 1);
        }
      }
      if (end.line < start.line || end.line === start.line && end.column <= start.column) {
        end = {
          column: start.column + 1,
          line: start.line
        };
      }
      return {
        end,
        start
      };
    };
    _proto.raw = function raw(prop, defaultType) {
      var str = new Stringifier2();
      return str.raw(this, prop, defaultType);
    };
    _proto.remove = function remove() {
      if (this.parent) {
        this.parent.removeChild(this);
      }
      this.parent = void 0;
      return this;
    };
    _proto.replaceWith = function replaceWith() {
      for (var _len = arguments.length, nodes = new Array(_len), _key = 0; _key < _len; _key++) {
        nodes[_key] = arguments[_key];
      }
      if (this.parent) {
        var bookmark = this;
        var foundSelf = false;
        for (var _iterator = _create_for_of_iterator_helper_loose(nodes), _step; !(_step = _iterator()).done; ) {
          var node2 = _step.value;
          if (node2 === this) {
            foundSelf = true;
          } else if (foundSelf) {
            this.parent.insertAfter(bookmark, node2);
            bookmark = node2;
          } else {
            this.parent.insertBefore(bookmark, node2);
          }
        }
        if (!foundSelf) {
          this.remove();
        }
      }
      return this;
    };
    _proto.root = function root2() {
      var result2 = this;
      while (result2.parent && result2.parent.type !== "document") {
        result2 = result2.parent;
      }
      return result2;
    };
    _proto.toJSON = function toJSON(_4, inputs) {
      var fixed = {};
      var emitInputs = inputs == null;
      inputs = inputs || /* @__PURE__ */ new Map();
      var inputsNextIndex = 0;
      for (var name in this) {
        if (!Object.prototype.hasOwnProperty.call(this, name)) {
          continue;
        }
        if (name === "parent" || name === "proxyCache") continue;
        var value = this[name];
        if (Array.isArray(value)) {
          fixed[name] = value.map(function(i3) {
            if ((typeof i3 === "undefined" ? "undefined" : _type_of(i3)) === "object" && i3.toJSON) {
              return i3.toJSON(null, inputs);
            } else {
              return i3;
            }
          });
        } else if ((typeof value === "undefined" ? "undefined" : _type_of(value)) === "object" && value.toJSON) {
          fixed[name] = value.toJSON(null, inputs);
        } else if (name === "source") {
          var inputId = inputs.get(value.input);
          if (inputId == null) {
            inputId = inputsNextIndex;
            inputs.set(value.input, inputsNextIndex);
            inputsNextIndex++;
          }
          fixed[name] = {
            end: value.end,
            inputId,
            start: value.start
          };
        } else {
          fixed[name] = value;
        }
      }
      if (emitInputs) {
        fixed.inputs = [].concat(inputs.keys()).map(function(input2) {
          return input2.toJSON();
        });
      }
      return fixed;
    };
    _proto.toProxy = function toProxy() {
      if (!this.proxyCache) {
        this.proxyCache = new Proxy(this, this.getProxyProcessor());
      }
      return this.proxyCache;
    };
    _proto.toString = function toString2(stringifier2) {
      if (stringifier2 === void 0) stringifier2 = stringify$3;
      if (stringifier2.stringify) stringifier2 = stringifier2.stringify;
      var result2 = "";
      stringifier2(this, function(i3) {
        result2 += i3;
      });
      return result2;
    };
    _proto.warn = function warn(result2, text, opts) {
      var data = {
        node: this
      };
      for (var i3 in opts) data[i3] = opts[i3];
      return result2.warn(text, data);
    };
    _create_class(Node1, [
      {
        key: "proxyOf",
        get: function get() {
          return this;
        }
      }
    ]);
    return Node1;
  })();
  var node = Node$4;
  Node$4.default = Node$4;
  var Node$3 = node;
  var Declaration$4 = /* @__PURE__ */ (function(Node$32) {
    _inherits(Declaration, Node$32);
    function Declaration(defaults) {
      var _this;
      if (defaults && typeof defaults.value !== "undefined" && typeof defaults.value !== "string") {
        defaults = _extends({}, defaults, {
          value: String(defaults.value)
        });
      }
      _this = Node$32.call(this, defaults) || this;
      _this.type = "decl";
      return _this;
    }
    _create_class(Declaration, [
      {
        key: "variable",
        get: function get() {
          return this.prop.startsWith("--") || this.prop[0] === "$";
        }
      }
    ]);
    return Declaration;
  })(Node$3);
  var declaration = Declaration$4;
  Declaration$4.default = Declaration$4;
  var urlAlphabet = "useandom-26T198340PX75pxJACKVERYMINDBUSHWOLF_GQZbfghjklqvwyzrict";
  var nanoid$1 = function(size) {
    if (size === void 0) size = 21;
    var id = "";
    var i3 = size;
    while (i3--) {
      id += urlAlphabet[Math.random() * 64 | 0];
    }
    return id;
  };
  var nonSecure = {
    nanoid: nanoid$1
  };
  var SourceMapConsumer$2 = require$$2.SourceMapConsumer;
  var SourceMapGenerator$2 = require$$2.SourceMapGenerator;
  var existsSync = require$$2.existsSync;
  var readFileSync = require$$2.readFileSync;
  var dirname$1 = require$$2.dirname;
  var join = require$$2.join;
  function fromBase64(str) {
    if (Buffer) {
      return Buffer.from(str, "base64").toString();
    } else {
      return window.atob(str);
    }
  }
  var PreviousMap$2 = /* @__PURE__ */ (function() {
    function PreviousMap(css, opts) {
      if (opts.map === false) return;
      this.loadAnnotation(css);
      this.inline = this.startWith(this.annotation, "data:");
      var prev = opts.map ? opts.map.prev : void 0;
      var text = this.loadMap(opts.from, prev);
      if (!this.mapFile && opts.from) {
        this.mapFile = opts.from;
      }
      if (this.mapFile) this.root = dirname$1(this.mapFile);
      if (text) this.text = text;
    }
    var _proto = PreviousMap.prototype;
    _proto.consumer = function consumer() {
      if (!this.consumerCache) {
        this.consumerCache = new SourceMapConsumer$2(this.text);
      }
      return this.consumerCache;
    };
    _proto.decodeInline = function decodeInline(text) {
      var baseCharsetUri = /^data:application\/json;charset=utf-?8;base64,/;
      var baseUri = /^data:application\/json;base64,/;
      var charsetUri = /^data:application\/json;charset=utf-?8,/;
      var uri = /^data:application\/json,/;
      if (charsetUri.test(text) || uri.test(text)) {
        return decodeURIComponent(text.substr(RegExp.lastMatch.length));
      }
      if (baseCharsetUri.test(text) || baseUri.test(text)) {
        return fromBase64(text.substr(RegExp.lastMatch.length));
      }
      var encoding = text.match(/data:application\/json;([^,]+),/)[1];
      throw new Error("Unsupported source map encoding " + encoding);
    };
    _proto.getAnnotationURL = function getAnnotationURL(sourceMapString) {
      return sourceMapString.replace(/^\/\*\s*# sourceMappingURL=/, "").trim();
    };
    _proto.isMap = function isMap(map) {
      if ((typeof map === "undefined" ? "undefined" : _type_of(map)) !== "object") return false;
      return typeof map.mappings === "string" || typeof map._mappings === "string" || Array.isArray(map.sections);
    };
    _proto.loadAnnotation = function loadAnnotation(css) {
      var comments = css.match(/\/\*\s*# sourceMappingURL=/gm);
      if (!comments) return;
      var start = css.lastIndexOf(comments.pop());
      var end = css.indexOf("*/", start);
      if (start > -1 && end > -1) {
        this.annotation = this.getAnnotationURL(css.substring(start, end));
      }
    };
    _proto.loadFile = function loadFile(path) {
      this.root = dirname$1(path);
      if (existsSync(path)) {
        this.mapFile = path;
        return readFileSync(path, "utf-8").toString().trim();
      }
    };
    _proto.loadMap = function loadMap(file, prev) {
      if (prev === false) return false;
      if (prev) {
        if (typeof prev === "string") {
          return prev;
        } else if (typeof prev === "function") {
          var prevPath = prev(file);
          if (prevPath) {
            var map = this.loadFile(prevPath);
            if (!map) {
              throw new Error("Unable to load previous source map: " + prevPath.toString());
            }
            return map;
          }
        } else if (_instanceof(prev, SourceMapConsumer$2)) {
          return SourceMapGenerator$2.fromSourceMap(prev).toString();
        } else if (_instanceof(prev, SourceMapGenerator$2)) {
          return prev.toString();
        } else if (this.isMap(prev)) {
          return JSON.stringify(prev);
        } else {
          throw new Error("Unsupported previous source map format: " + prev.toString());
        }
      } else if (this.inline) {
        return this.decodeInline(this.annotation);
      } else if (this.annotation) {
        var map1 = this.annotation;
        if (file) map1 = join(dirname$1(file), map1);
        return this.loadFile(map1);
      }
    };
    _proto.startWith = function startWith(string, start) {
      if (!string) return false;
      return string.substr(0, start.length) === start;
    };
    _proto.withContent = function withContent() {
      return !!(this.consumer().sourcesContent && this.consumer().sourcesContent.length > 0);
    };
    return PreviousMap;
  })();
  var previousMap = PreviousMap$2;
  PreviousMap$2.default = PreviousMap$2;
  var SourceMapConsumer$1 = require$$2.SourceMapConsumer;
  var SourceMapGenerator$1 = require$$2.SourceMapGenerator;
  var fileURLToPath = require$$2.fileURLToPath;
  var pathToFileURL$1 = require$$2.pathToFileURL;
  var isAbsolute = require$$2.isAbsolute;
  var resolve$1 = require$$2.resolve;
  var nanoid = nonSecure.nanoid;
  var terminalHighlight = require$$2;
  var CssSyntaxError$1 = cssSyntaxError;
  var PreviousMap$1 = previousMap;
  var fromOffsetCache = /* @__PURE__ */ Symbol("fromOffsetCache");
  var sourceMapAvailable$1 = Boolean(SourceMapConsumer$1 && SourceMapGenerator$1);
  var pathAvailable$1 = Boolean(resolve$1 && isAbsolute);
  var Input$4 = /* @__PURE__ */ (function() {
    function Input(css, opts) {
      if (opts === void 0) opts = {};
      if (css === null || typeof css === "undefined" || (typeof css === "undefined" ? "undefined" : _type_of(css)) === "object" && !css.toString) {
        throw new Error("PostCSS received " + css + " instead of CSS string");
      }
      this.css = css.toString();
      if (this.css[0] === "\uFEFF" || this.css[0] === "\uFFFE") {
        this.hasBOM = true;
        this.css = this.css.slice(1);
      } else {
        this.hasBOM = false;
      }
      if (opts.from) {
        if (!pathAvailable$1 || /^\w+:\/\//.test(opts.from) || isAbsolute(opts.from)) {
          this.file = opts.from;
        } else {
          this.file = resolve$1(opts.from);
        }
      }
      if (pathAvailable$1 && sourceMapAvailable$1) {
        var map = new PreviousMap$1(this.css, opts);
        if (map.text) {
          this.map = map;
          var file = map.consumer().file;
          if (!this.file && file) this.file = this.mapResolve(file);
        }
      }
      if (!this.file) {
        this.id = "<input css " + nanoid(6) + ">";
      }
      if (this.map) this.map.file = this.from;
    }
    var _proto = Input.prototype;
    _proto.error = function error(message, line, column, opts) {
      if (opts === void 0) opts = {};
      var result2, endLine, endColumn;
      if (line && (typeof line === "undefined" ? "undefined" : _type_of(line)) === "object") {
        var start = line;
        var end = column;
        if (typeof start.offset === "number") {
          var pos = this.fromOffset(start.offset);
          line = pos.line;
          column = pos.col;
        } else {
          line = start.line;
          column = start.column;
        }
        if (typeof end.offset === "number") {
          var pos1 = this.fromOffset(end.offset);
          endLine = pos1.line;
          endColumn = pos1.col;
        } else {
          endLine = end.line;
          endColumn = end.column;
        }
      } else if (!column) {
        var pos2 = this.fromOffset(line);
        line = pos2.line;
        column = pos2.col;
      }
      var origin = this.origin(line, column, endLine, endColumn);
      if (origin) {
        result2 = new CssSyntaxError$1(message, origin.endLine === void 0 ? origin.line : {
          column: origin.column,
          line: origin.line
        }, origin.endLine === void 0 ? origin.column : {
          column: origin.endColumn,
          line: origin.endLine
        }, origin.source, origin.file, opts.plugin);
      } else {
        result2 = new CssSyntaxError$1(message, endLine === void 0 ? line : {
          column,
          line
        }, endLine === void 0 ? column : {
          column: endColumn,
          line: endLine
        }, this.css, this.file, opts.plugin);
      }
      result2.input = {
        column,
        endColumn,
        endLine,
        line,
        source: this.css
      };
      if (this.file) {
        if (pathToFileURL$1) {
          result2.input.url = pathToFileURL$1(this.file).toString();
        }
        result2.input.file = this.file;
      }
      return result2;
    };
    _proto.fromOffset = function fromOffset(offset) {
      var lastLine, lineToIndex;
      if (!this[fromOffsetCache]) {
        var lines = this.css.split("\n");
        lineToIndex = new Array(lines.length);
        var prevIndex = 0;
        for (var i3 = 0, l3 = lines.length; i3 < l3; i3++) {
          lineToIndex[i3] = prevIndex;
          prevIndex += lines[i3].length + 1;
        }
        this[fromOffsetCache] = lineToIndex;
      } else {
        lineToIndex = this[fromOffsetCache];
      }
      lastLine = lineToIndex[lineToIndex.length - 1];
      var min = 0;
      if (offset >= lastLine) {
        min = lineToIndex.length - 1;
      } else {
        var max = lineToIndex.length - 2;
        var mid;
        while (min < max) {
          mid = min + (max - min >> 1);
          if (offset < lineToIndex[mid]) {
            max = mid - 1;
          } else if (offset >= lineToIndex[mid + 1]) {
            min = mid + 1;
          } else {
            min = mid;
            break;
          }
        }
      }
      return {
        col: offset - lineToIndex[min] + 1,
        line: min + 1
      };
    };
    _proto.mapResolve = function mapResolve(file) {
      if (/^\w+:\/\//.test(file)) {
        return file;
      }
      return resolve$1(this.map.consumer().sourceRoot || this.map.root || ".", file);
    };
    _proto.origin = function origin(line, column, endLine, endColumn) {
      if (!this.map) return false;
      var consumer = this.map.consumer();
      var from = consumer.originalPositionFor({
        column,
        line
      });
      if (!from.source) return false;
      var to;
      if (typeof endLine === "number") {
        to = consumer.originalPositionFor({
          column: endColumn,
          line: endLine
        });
      }
      var fromUrl;
      if (isAbsolute(from.source)) {
        fromUrl = pathToFileURL$1(from.source);
      } else {
        fromUrl = new URL(from.source, this.map.consumer().sourceRoot || pathToFileURL$1(this.map.mapFile));
      }
      var result2 = {
        column: from.column,
        endColumn: to && to.column,
        endLine: to && to.line,
        line: from.line,
        url: fromUrl.toString()
      };
      if (fromUrl.protocol === "file:") {
        if (fileURLToPath) {
          result2.file = fileURLToPath(fromUrl);
        } else {
          throw new Error("file: protocol is not available in this PostCSS build");
        }
      }
      var source = consumer.sourceContentFor(from.source);
      if (source) result2.source = source;
      return result2;
    };
    _proto.toJSON = function toJSON() {
      var json = {};
      for (var _i = 0, _iter = [
        "hasBOM",
        "css",
        "file",
        "id"
      ]; _i < _iter.length; _i++) {
        var name = _iter[_i];
        if (this[name] != null) {
          json[name] = this[name];
        }
      }
      if (this.map) {
        json.map = _extends({}, this.map);
        if (json.map.consumerCache) {
          json.map.consumerCache = void 0;
        }
      }
      return json;
    };
    _create_class(Input, [
      {
        key: "from",
        get: function get() {
          return this.file || this.id;
        }
      }
    ]);
    return Input;
  })();
  var input = Input$4;
  Input$4.default = Input$4;
  if (terminalHighlight && terminalHighlight.registerInput) {
    terminalHighlight.registerInput(Input$4);
  }
  var SourceMapConsumer = require$$2.SourceMapConsumer;
  var SourceMapGenerator = require$$2.SourceMapGenerator;
  var dirname = require$$2.dirname;
  var relative = require$$2.relative;
  var resolve$4 = require$$2.resolve;
  var sep = require$$2.sep;
  var pathToFileURL = require$$2.pathToFileURL;
  var Input$3 = input;
  var sourceMapAvailable = Boolean(SourceMapConsumer && SourceMapGenerator);
  var pathAvailable = Boolean(dirname && resolve$4 && relative && sep);
  var MapGenerator$2 = /* @__PURE__ */ (function() {
    function MapGenerator(stringify2, root2, opts, cssString) {
      this.stringify = stringify2;
      this.mapOpts = opts.map || {};
      this.root = root2;
      this.opts = opts;
      this.css = cssString;
      this.originalCSS = cssString;
      this.usesFileUrls = !this.mapOpts.from && this.mapOpts.absolute;
      this.memoizedFileURLs = /* @__PURE__ */ new Map();
      this.memoizedPaths = /* @__PURE__ */ new Map();
      this.memoizedURLs = /* @__PURE__ */ new Map();
    }
    var _proto = MapGenerator.prototype;
    _proto.addAnnotation = function addAnnotation() {
      var content;
      if (this.isInline()) {
        content = "data:application/json;base64," + this.toBase64(this.map.toString());
      } else if (typeof this.mapOpts.annotation === "string") {
        content = this.mapOpts.annotation;
      } else if (typeof this.mapOpts.annotation === "function") {
        content = this.mapOpts.annotation(this.opts.to, this.root);
      } else {
        content = this.outputFile() + ".map";
      }
      var eol = "\n";
      if (this.css.includes("\r\n")) eol = "\r\n";
      this.css += eol + "/*# sourceMappingURL=" + content + " */";
    };
    _proto.applyPrevMaps = function applyPrevMaps() {
      for (var _iterator = _create_for_of_iterator_helper_loose(this.previous()), _step; !(_step = _iterator()).done; ) {
        var prev = _step.value;
        var from = this.toUrl(this.path(prev.file));
        var root2 = prev.root || dirname(prev.file);
        var map = void 0;
        if (this.mapOpts.sourcesContent === false) {
          map = new SourceMapConsumer(prev.text);
          if (map.sourcesContent) {
            map.sourcesContent = null;
          }
        } else {
          map = prev.consumer();
        }
        this.map.applySourceMap(map, from, this.toUrl(this.path(root2)));
      }
    };
    _proto.clearAnnotation = function clearAnnotation() {
      if (this.mapOpts.annotation === false) return;
      if (this.root) {
        var node2;
        for (var i3 = this.root.nodes.length - 1; i3 >= 0; i3--) {
          node2 = this.root.nodes[i3];
          if (node2.type !== "comment") continue;
          if (node2.text.indexOf("# sourceMappingURL=") === 0) {
            this.root.removeChild(i3);
          }
        }
      } else if (this.css) {
        this.css = this.css.replace(/\n*?\/\*#[\S\s]*?\*\/$/gm, "");
      }
    };
    _proto.generate = function generate() {
      this.clearAnnotation();
      if (pathAvailable && sourceMapAvailable && this.isMap()) {
        return this.generateMap();
      } else {
        var result2 = "";
        this.stringify(this.root, function(i3) {
          result2 += i3;
        });
        return [
          result2
        ];
      }
    };
    _proto.generateMap = function generateMap() {
      if (this.root) {
        this.generateString();
      } else if (this.previous().length === 1) {
        var prev = this.previous()[0].consumer();
        prev.file = this.outputFile();
        this.map = SourceMapGenerator.fromSourceMap(prev, {
          ignoreInvalidMapping: true
        });
      } else {
        this.map = new SourceMapGenerator({
          file: this.outputFile(),
          ignoreInvalidMapping: true
        });
        this.map.addMapping({
          generated: {
            column: 0,
            line: 1
          },
          original: {
            column: 0,
            line: 1
          },
          source: this.opts.from ? this.toUrl(this.path(this.opts.from)) : "<no source>"
        });
      }
      if (this.isSourcesContent()) this.setSourcesContent();
      if (this.root && this.previous().length > 0) this.applyPrevMaps();
      if (this.isAnnotation()) this.addAnnotation();
      if (this.isInline()) {
        return [
          this.css
        ];
      } else {
        return [
          this.css,
          this.map
        ];
      }
    };
    _proto.generateString = function generateString() {
      var _this = this;
      this.css = "";
      this.map = new SourceMapGenerator({
        file: this.outputFile(),
        ignoreInvalidMapping: true
      });
      var line = 1;
      var column = 1;
      var noSource = "<no source>";
      var mapping = {
        generated: {
          column: 0,
          line: 0
        },
        original: {
          column: 0,
          line: 0
        },
        source: ""
      };
      var lines, last;
      this.stringify(this.root, function(str, node2, type) {
        _this.css += str;
        if (node2 && type !== "end") {
          mapping.generated.line = line;
          mapping.generated.column = column - 1;
          if (node2.source && node2.source.start) {
            mapping.source = _this.sourcePath(node2);
            mapping.original.line = node2.source.start.line;
            mapping.original.column = node2.source.start.column - 1;
            _this.map.addMapping(mapping);
          } else {
            mapping.source = noSource;
            mapping.original.line = 1;
            mapping.original.column = 0;
            _this.map.addMapping(mapping);
          }
        }
        lines = str.match(/\n/g);
        if (lines) {
          line += lines.length;
          last = str.lastIndexOf("\n");
          column = str.length - last;
        } else {
          column += str.length;
        }
        if (node2 && type !== "start") {
          var p3 = node2.parent || {
            raws: {}
          };
          var childless = node2.type === "decl" || node2.type === "atrule" && !node2.nodes;
          if (!childless || node2 !== p3.last || p3.raws.semicolon) {
            if (node2.source && node2.source.end) {
              mapping.source = _this.sourcePath(node2);
              mapping.original.line = node2.source.end.line;
              mapping.original.column = node2.source.end.column - 1;
              mapping.generated.line = line;
              mapping.generated.column = column - 2;
              _this.map.addMapping(mapping);
            } else {
              mapping.source = noSource;
              mapping.original.line = 1;
              mapping.original.column = 0;
              mapping.generated.line = line;
              mapping.generated.column = column - 1;
              _this.map.addMapping(mapping);
            }
          }
        }
      });
    };
    _proto.isAnnotation = function isAnnotation() {
      if (this.isInline()) {
        return true;
      }
      if (typeof this.mapOpts.annotation !== "undefined") {
        return this.mapOpts.annotation;
      }
      if (this.previous().length) {
        return this.previous().some(function(i3) {
          return i3.annotation;
        });
      }
      return true;
    };
    _proto.isInline = function isInline() {
      if (typeof this.mapOpts.inline !== "undefined") {
        return this.mapOpts.inline;
      }
      var annotation = this.mapOpts.annotation;
      if (typeof annotation !== "undefined" && annotation !== true) {
        return false;
      }
      if (this.previous().length) {
        return this.previous().some(function(i3) {
          return i3.inline;
        });
      }
      return true;
    };
    _proto.isMap = function isMap() {
      if (typeof this.opts.map !== "undefined") {
        return !!this.opts.map;
      }
      return this.previous().length > 0;
    };
    _proto.isSourcesContent = function isSourcesContent() {
      if (typeof this.mapOpts.sourcesContent !== "undefined") {
        return this.mapOpts.sourcesContent;
      }
      if (this.previous().length) {
        return this.previous().some(function(i3) {
          return i3.withContent();
        });
      }
      return true;
    };
    _proto.outputFile = function outputFile() {
      if (this.opts.to) {
        return this.path(this.opts.to);
      } else if (this.opts.from) {
        return this.path(this.opts.from);
      } else {
        return "to.css";
      }
    };
    _proto.path = function path(file) {
      if (this.mapOpts.absolute) return file;
      if (file.charCodeAt(0) === 60) return file;
      if (/^\w+:\/\//.test(file)) return file;
      var cached = this.memoizedPaths.get(file);
      if (cached) return cached;
      var from = this.opts.to ? dirname(this.opts.to) : ".";
      if (typeof this.mapOpts.annotation === "string") {
        from = dirname(resolve$4(from, this.mapOpts.annotation));
      }
      var path2 = relative(from, file);
      this.memoizedPaths.set(file, path2);
      return path2;
    };
    _proto.previous = function previous() {
      var _this = this;
      if (!this.previousMaps) {
        this.previousMaps = [];
        if (this.root) {
          this.root.walk(function(node2) {
            if (node2.source && node2.source.input.map) {
              var map = node2.source.input.map;
              if (!_this.previousMaps.includes(map)) {
                _this.previousMaps.push(map);
              }
            }
          });
        } else {
          var input2 = new Input$3(this.originalCSS, this.opts);
          if (input2.map) this.previousMaps.push(input2.map);
        }
      }
      return this.previousMaps;
    };
    _proto.setSourcesContent = function setSourcesContent() {
      var _this = this;
      var already = {};
      if (this.root) {
        this.root.walk(function(node2) {
          if (node2.source) {
            var from2 = node2.source.input.from;
            if (from2 && !already[from2]) {
              already[from2] = true;
              var fromUrl = _this.usesFileUrls ? _this.toFileUrl(from2) : _this.toUrl(_this.path(from2));
              _this.map.setSourceContent(fromUrl, node2.source.input.css);
            }
          }
        });
      } else if (this.css) {
        var from = this.opts.from ? this.toUrl(this.path(this.opts.from)) : "<no source>";
        this.map.setSourceContent(from, this.css);
      }
    };
    _proto.sourcePath = function sourcePath(node2) {
      if (this.mapOpts.from) {
        return this.toUrl(this.mapOpts.from);
      } else if (this.usesFileUrls) {
        return this.toFileUrl(node2.source.input.from);
      } else {
        return this.toUrl(this.path(node2.source.input.from));
      }
    };
    _proto.toBase64 = function toBase64(str) {
      if (Buffer) {
        return Buffer.from(str).toString("base64");
      } else {
        return window.btoa(unescape(encodeURIComponent(str)));
      }
    };
    _proto.toFileUrl = function toFileUrl(path) {
      var cached = this.memoizedFileURLs.get(path);
      if (cached) return cached;
      if (pathToFileURL) {
        var fileURL = pathToFileURL(path).toString();
        this.memoizedFileURLs.set(path, fileURL);
        return fileURL;
      } else {
        throw new Error("`map.absolute` option is not available in this PostCSS build");
      }
    };
    _proto.toUrl = function toUrl(path) {
      var cached = this.memoizedURLs.get(path);
      if (cached) return cached;
      if (sep === "\\") {
        path = path.replace(/\\/g, "/");
      }
      var url = encodeURI(path).replace(/[#?]/g, encodeURIComponent);
      this.memoizedURLs.set(path, url);
      return url;
    };
    return MapGenerator;
  })();
  var mapGenerator = MapGenerator$2;
  var Node$2 = node;
  var Comment$4 = /* @__PURE__ */ (function(Node$22) {
    _inherits(Comment, Node$22);
    function Comment(defaults) {
      var _this;
      _this = Node$22.call(this, defaults) || this;
      _this.type = "comment";
      return _this;
    }
    return Comment;
  })(Node$2);
  var comment = Comment$4;
  Comment$4.default = Comment$4;
  var isClean$1 = symbols.isClean;
  var my$1 = symbols.my;
  var Declaration$3 = declaration;
  var Comment$3 = comment;
  var Node$1 = node;
  var parse$4;
  var Rule$4;
  var AtRule$4;
  var Root$6;
  function cleanSource(nodes) {
    return nodes.map(function(i3) {
      if (i3.nodes) i3.nodes = cleanSource(i3.nodes);
      delete i3.source;
      return i3;
    });
  }
  function markDirtyUp(node2) {
    node2[isClean$1] = false;
    if (node2.proxyOf.nodes) {
      for (var _iterator = _create_for_of_iterator_helper_loose(node2.proxyOf.nodes), _step; !(_step = _iterator()).done; ) {
        var i3 = _step.value;
        markDirtyUp(i3);
      }
    }
  }
  var Container$7 = /* @__PURE__ */ (function(Node$12) {
    _inherits(Container, Node$12);
    function Container() {
      return Node$12.apply(this, arguments) || this;
    }
    var _proto = Container.prototype;
    _proto.append = function append() {
      for (var _len = arguments.length, children = new Array(_len), _key = 0; _key < _len; _key++) {
        children[_key] = arguments[_key];
      }
      for (var _iterator = _create_for_of_iterator_helper_loose(children), _step; !(_step = _iterator()).done; ) {
        var child = _step.value;
        var nodes = this.normalize(child, this.last);
        for (var _iterator1 = _create_for_of_iterator_helper_loose(nodes), _step1; !(_step1 = _iterator1()).done; ) {
          var node2 = _step1.value;
          this.proxyOf.nodes.push(node2);
        }
      }
      this.markDirty();
      return this;
    };
    _proto.cleanRaws = function cleanRaws(keepBetween) {
      Node$12.prototype.cleanRaws.call(this, keepBetween);
      if (this.nodes) {
        for (var _iterator = _create_for_of_iterator_helper_loose(this.nodes), _step; !(_step = _iterator()).done; ) {
          var node2 = _step.value;
          node2.cleanRaws(keepBetween);
        }
      }
    };
    _proto.each = function each(callback) {
      if (!this.proxyOf.nodes) return void 0;
      var iterator = this.getIterator();
      var index2, result2;
      while (this.indexes[iterator] < this.proxyOf.nodes.length) {
        index2 = this.indexes[iterator];
        result2 = callback(this.proxyOf.nodes[index2], index2);
        if (result2 === false) break;
        this.indexes[iterator] += 1;
      }
      delete this.indexes[iterator];
      return result2;
    };
    _proto.every = function every(condition) {
      return this.nodes.every(condition);
    };
    _proto.getIterator = function getIterator() {
      if (!this.lastEach) this.lastEach = 0;
      if (!this.indexes) this.indexes = {};
      this.lastEach += 1;
      var iterator = this.lastEach;
      this.indexes[iterator] = 0;
      return iterator;
    };
    _proto.getProxyProcessor = function getProxyProcessor() {
      return {
        get: function get(node2, prop) {
          if (prop === "proxyOf") {
            return node2;
          } else if (!node2[prop]) {
            return node2[prop];
          } else if (prop === "each" || typeof prop === "string" && prop.startsWith("walk")) {
            return function() {
              for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {
                args[_key] = arguments[_key];
              }
              var _node2;
              return (_node2 = node2)[prop].apply(_node2, [].concat(args.map(function(i3) {
                if (typeof i3 === "function") {
                  return function(child, index2) {
                    return i3(child.toProxy(), index2);
                  };
                } else {
                  return i3;
                }
              })));
            };
          } else if (prop === "every" || prop === "some") {
            return function(cb) {
              return node2[prop](function(child) {
                for (var _len = arguments.length, other = new Array(_len > 1 ? _len - 1 : 0), _key = 1; _key < _len; _key++) {
                  other[_key - 1] = arguments[_key];
                }
                return cb.apply(void 0, [].concat([
                  child.toProxy()
                ], other));
              });
            };
          } else if (prop === "root") {
            return function() {
              return node2.root().toProxy();
            };
          } else if (prop === "nodes") {
            return node2.nodes.map(function(i3) {
              return i3.toProxy();
            });
          } else if (prop === "first" || prop === "last") {
            return node2[prop].toProxy();
          } else {
            return node2[prop];
          }
        },
        set: function set(node2, prop, value) {
          if (node2[prop] === value) return true;
          node2[prop] = value;
          if (prop === "name" || prop === "params" || prop === "selector") {
            node2.markDirty();
          }
          return true;
        }
      };
    };
    _proto.index = function index2(child) {
      if (typeof child === "number") return child;
      if (child.proxyOf) child = child.proxyOf;
      return this.proxyOf.nodes.indexOf(child);
    };
    _proto.insertAfter = function insertAfter(exist, add) {
      var existIndex = this.index(exist);
      var nodes = this.normalize(add, this.proxyOf.nodes[existIndex]).reverse();
      existIndex = this.index(exist);
      for (var _iterator = _create_for_of_iterator_helper_loose(nodes), _step; !(_step = _iterator()).done; ) {
        var node2 = _step.value;
        this.proxyOf.nodes.splice(existIndex + 1, 0, node2);
      }
      var index2;
      for (var id in this.indexes) {
        index2 = this.indexes[id];
        if (existIndex < index2) {
          this.indexes[id] = index2 + nodes.length;
        }
      }
      this.markDirty();
      return this;
    };
    _proto.insertBefore = function insertBefore(exist, add) {
      var existIndex = this.index(exist);
      var type = existIndex === 0 ? "prepend" : false;
      var nodes = this.normalize(add, this.proxyOf.nodes[existIndex], type).reverse();
      existIndex = this.index(exist);
      for (var _iterator = _create_for_of_iterator_helper_loose(nodes), _step; !(_step = _iterator()).done; ) {
        var node2 = _step.value;
        this.proxyOf.nodes.splice(existIndex, 0, node2);
      }
      var index2;
      for (var id in this.indexes) {
        index2 = this.indexes[id];
        if (existIndex <= index2) {
          this.indexes[id] = index2 + nodes.length;
        }
      }
      this.markDirty();
      return this;
    };
    _proto.normalize = function normalize(nodes, sample) {
      var _this = this;
      if (typeof nodes === "string") {
        nodes = cleanSource(parse$4(nodes).nodes);
      } else if (typeof nodes === "undefined") {
        nodes = [];
      } else if (Array.isArray(nodes)) {
        nodes = nodes.slice(0);
        for (var _iterator = _create_for_of_iterator_helper_loose(nodes), _step; !(_step = _iterator()).done; ) {
          var i3 = _step.value;
          if (i3.parent) i3.parent.removeChild(i3, "ignore");
        }
      } else if (nodes.type === "root" && this.type !== "document") {
        nodes = nodes.nodes.slice(0);
        for (var _iterator1 = _create_for_of_iterator_helper_loose(nodes), _step1; !(_step1 = _iterator1()).done; ) {
          var i1 = _step1.value;
          if (i1.parent) i1.parent.removeChild(i1, "ignore");
        }
      } else if (nodes.type) {
        nodes = [
          nodes
        ];
      } else if (nodes.prop) {
        if (typeof nodes.value === "undefined") {
          throw new Error("Value field is missed in node creation");
        } else if (typeof nodes.value !== "string") {
          nodes.value = String(nodes.value);
        }
        nodes = [
          new Declaration$3(nodes)
        ];
      } else if (nodes.selector) {
        nodes = [
          new Rule$4(nodes)
        ];
      } else if (nodes.name) {
        nodes = [
          new AtRule$4(nodes)
        ];
      } else if (nodes.text) {
        nodes = [
          new Comment$3(nodes)
        ];
      } else {
        throw new Error("Unknown node type in node creation");
      }
      var processed = nodes.map(function(i4) {
        if (!i4[my$1]) Container.rebuild(i4);
        i4 = i4.proxyOf;
        if (i4.parent) i4.parent.removeChild(i4);
        if (i4[isClean$1]) markDirtyUp(i4);
        if (typeof i4.raws.before === "undefined") {
          if (sample && typeof sample.raws.before !== "undefined") {
            i4.raws.before = sample.raws.before.replace(/\S/g, "");
          }
        }
        i4.parent = _this.proxyOf;
        return i4;
      });
      return processed;
    };
    _proto.prepend = function prepend() {
      for (var _len = arguments.length, children = new Array(_len), _key = 0; _key < _len; _key++) {
        children[_key] = arguments[_key];
      }
      children = children.reverse();
      for (var _iterator = _create_for_of_iterator_helper_loose(children), _step; !(_step = _iterator()).done; ) {
        var child = _step.value;
        var nodes = this.normalize(child, this.first, "prepend").reverse();
        for (var _iterator1 = _create_for_of_iterator_helper_loose(nodes), _step1; !(_step1 = _iterator1()).done; ) {
          var node2 = _step1.value;
          this.proxyOf.nodes.unshift(node2);
        }
        for (var id in this.indexes) {
          this.indexes[id] = this.indexes[id] + nodes.length;
        }
      }
      this.markDirty();
      return this;
    };
    _proto.push = function push(child) {
      child.parent = this;
      this.proxyOf.nodes.push(child);
      return this;
    };
    _proto.removeAll = function removeAll() {
      for (var _iterator = _create_for_of_iterator_helper_loose(this.proxyOf.nodes), _step; !(_step = _iterator()).done; ) {
        var node2 = _step.value;
        node2.parent = void 0;
      }
      this.proxyOf.nodes = [];
      this.markDirty();
      return this;
    };
    _proto.removeChild = function removeChild(child) {
      child = this.index(child);
      this.proxyOf.nodes[child].parent = void 0;
      this.proxyOf.nodes.splice(child, 1);
      var index2;
      for (var id in this.indexes) {
        index2 = this.indexes[id];
        if (index2 >= child) {
          this.indexes[id] = index2 - 1;
        }
      }
      this.markDirty();
      return this;
    };
    _proto.replaceValues = function replaceValues(pattern, opts, callback) {
      if (!callback) {
        callback = opts;
        opts = {};
      }
      this.walkDecls(function(decl) {
        if (opts.props && !opts.props.includes(decl.prop)) return;
        if (opts.fast && !decl.value.includes(opts.fast)) return;
        decl.value = decl.value.replace(pattern, callback);
      });
      this.markDirty();
      return this;
    };
    _proto.some = function some(condition) {
      return this.nodes.some(condition);
    };
    _proto.walk = function walk(callback) {
      return this.each(function(child, i3) {
        var result2;
        try {
          result2 = callback(child, i3);
        } catch (e3) {
          throw child.addToError(e3);
        }
        if (result2 !== false && child.walk) {
          result2 = child.walk(callback);
        }
        return result2;
      });
    };
    _proto.walkAtRules = function walkAtRules(name, callback) {
      if (!callback) {
        callback = name;
        return this.walk(function(child, i3) {
          if (child.type === "atrule") {
            return callback(child, i3);
          }
        });
      }
      if (_instanceof(name, RegExp)) {
        return this.walk(function(child, i3) {
          if (child.type === "atrule" && name.test(child.name)) {
            return callback(child, i3);
          }
        });
      }
      return this.walk(function(child, i3) {
        if (child.type === "atrule" && child.name === name) {
          return callback(child, i3);
        }
      });
    };
    _proto.walkComments = function walkComments(callback) {
      return this.walk(function(child, i3) {
        if (child.type === "comment") {
          return callback(child, i3);
        }
      });
    };
    _proto.walkDecls = function walkDecls(prop, callback) {
      if (!callback) {
        callback = prop;
        return this.walk(function(child, i3) {
          if (child.type === "decl") {
            return callback(child, i3);
          }
        });
      }
      if (_instanceof(prop, RegExp)) {
        return this.walk(function(child, i3) {
          if (child.type === "decl" && prop.test(child.prop)) {
            return callback(child, i3);
          }
        });
      }
      return this.walk(function(child, i3) {
        if (child.type === "decl" && child.prop === prop) {
          return callback(child, i3);
        }
      });
    };
    _proto.walkRules = function walkRules(selector, callback) {
      if (!callback) {
        callback = selector;
        return this.walk(function(child, i3) {
          if (child.type === "rule") {
            return callback(child, i3);
          }
        });
      }
      if (_instanceof(selector, RegExp)) {
        return this.walk(function(child, i3) {
          if (child.type === "rule" && selector.test(child.selector)) {
            return callback(child, i3);
          }
        });
      }
      return this.walk(function(child, i3) {
        if (child.type === "rule" && child.selector === selector) {
          return callback(child, i3);
        }
      });
    };
    _create_class(Container, [
      {
        key: "first",
        get: function get() {
          if (!this.proxyOf.nodes) return void 0;
          return this.proxyOf.nodes[0];
        }
      },
      {
        key: "last",
        get: function get() {
          if (!this.proxyOf.nodes) return void 0;
          return this.proxyOf.nodes[this.proxyOf.nodes.length - 1];
        }
      }
    ]);
    return Container;
  })(Node$1);
  Container$7.registerParse = function(dependant) {
    parse$4 = dependant;
  };
  Container$7.registerRule = function(dependant) {
    Rule$4 = dependant;
  };
  Container$7.registerAtRule = function(dependant) {
    AtRule$4 = dependant;
  };
  Container$7.registerRoot = function(dependant) {
    Root$6 = dependant;
  };
  var container = Container$7;
  Container$7.default = Container$7;
  Container$7.rebuild = function(node2) {
    if (node2.type === "atrule") {
      Object.setPrototypeOf(node2, AtRule$4.prototype);
    } else if (node2.type === "rule") {
      Object.setPrototypeOf(node2, Rule$4.prototype);
    } else if (node2.type === "decl") {
      Object.setPrototypeOf(node2, Declaration$3.prototype);
    } else if (node2.type === "comment") {
      Object.setPrototypeOf(node2, Comment$3.prototype);
    } else if (node2.type === "root") {
      Object.setPrototypeOf(node2, Root$6.prototype);
    }
    node2[my$1] = true;
    if (node2.nodes) {
      node2.nodes.forEach(function(child) {
        Container$7.rebuild(child);
      });
    }
  };
  var Container$6 = container;
  var LazyResult$4;
  var Processor$3;
  var Document$3 = /* @__PURE__ */ (function(Container$62) {
    _inherits(Document, Container$62);
    function Document(defaults) {
      var _this;
      _this = Container$62.call(this, _extends({
        type: "document"
      }, defaults)) || this;
      if (!_this.nodes) {
        _this.nodes = [];
      }
      return _this;
    }
    var _proto = Document.prototype;
    _proto.toResult = function toResult(opts) {
      if (opts === void 0) opts = {};
      var lazy = new LazyResult$4(new Processor$3(), this, opts);
      return lazy.stringify();
    };
    return Document;
  })(Container$6);
  Document$3.registerLazyResult = function(dependant) {
    LazyResult$4 = dependant;
  };
  Document$3.registerProcessor = function(dependant) {
    Processor$3 = dependant;
  };
  var document$1$3 = Document$3;
  Document$3.default = Document$3;
  var printed = {};
  var warnOnce$2 = function warnOnce3(message) {
    if (printed[message]) return;
    printed[message] = true;
    if (typeof console !== "undefined" && console.warn) {
      console.warn(message);
    }
  };
  var Warning$2 = /* @__PURE__ */ (function() {
    function Warning(text, opts) {
      if (opts === void 0) opts = {};
      this.type = "warning";
      this.text = text;
      if (opts.node && opts.node.source) {
        var range = opts.node.rangeBy(opts);
        this.line = range.start.line;
        this.column = range.start.column;
        this.endLine = range.end.line;
        this.endColumn = range.end.column;
      }
      for (var opt in opts) this[opt] = opts[opt];
    }
    var _proto = Warning.prototype;
    _proto.toString = function toString2() {
      if (this.node) {
        return this.node.error(this.text, {
          index: this.index,
          plugin: this.plugin,
          word: this.word
        }).message;
      }
      if (this.plugin) {
        return this.plugin + ": " + this.text;
      }
      return this.text;
    };
    return Warning;
  })();
  var warning = Warning$2;
  Warning$2.default = Warning$2;
  var Warning$1 = warning;
  var Result$3 = /* @__PURE__ */ (function() {
    function Result(processor2, root2, opts) {
      this.processor = processor2;
      this.messages = [];
      this.root = root2;
      this.opts = opts;
      this.css = void 0;
      this.map = void 0;
    }
    var _proto = Result.prototype;
    _proto.toString = function toString2() {
      return this.css;
    };
    _proto.warn = function warn(text, opts) {
      if (opts === void 0) opts = {};
      if (!opts.plugin) {
        if (this.lastPlugin && this.lastPlugin.postcssPlugin) {
          opts.plugin = this.lastPlugin.postcssPlugin;
        }
      }
      var warning2 = new Warning$1(text, opts);
      this.messages.push(warning2);
      return warning2;
    };
    _proto.warnings = function warnings() {
      return this.messages.filter(function(i3) {
        return i3.type === "warning";
      });
    };
    _create_class(Result, [
      {
        key: "content",
        get: function get() {
          return this.css;
        }
      }
    ]);
    return Result;
  })();
  var result = Result$3;
  Result$3.default = Result$3;
  var SINGLE_QUOTE = "'".charCodeAt(0);
  var DOUBLE_QUOTE = '"'.charCodeAt(0);
  var BACKSLASH = "\\".charCodeAt(0);
  var SLASH = "/".charCodeAt(0);
  var NEWLINE = "\n".charCodeAt(0);
  var SPACE = " ".charCodeAt(0);
  var FEED = "\f".charCodeAt(0);
  var TAB = "	".charCodeAt(0);
  var CR = "\r".charCodeAt(0);
  var OPEN_SQUARE = "[".charCodeAt(0);
  var CLOSE_SQUARE = "]".charCodeAt(0);
  var OPEN_PARENTHESES = "(".charCodeAt(0);
  var CLOSE_PARENTHESES = ")".charCodeAt(0);
  var OPEN_CURLY = "{".charCodeAt(0);
  var CLOSE_CURLY = "}".charCodeAt(0);
  var SEMICOLON = ";".charCodeAt(0);
  var ASTERISK = "*".charCodeAt(0);
  var COLON = ":".charCodeAt(0);
  var AT = "@".charCodeAt(0);
  var RE_AT_END = /[\t\n\f\r "#'()/;[\\\]{}]/g;
  var RE_WORD_END = /[\t\n\f\r !"#'():;@[\\\]{}]|\/(?=\*)/g;
  var RE_BAD_BRACKET = /.[\r\n"'(/\\]/;
  var RE_HEX_ESCAPE = /[\da-f]/i;
  var tokenize = function tokenizer3(input2, options) {
    if (options === void 0) options = {};
    var css = input2.css.valueOf();
    var ignore = options.ignoreErrors;
    var code, next, quote, content, escape;
    var escaped, escapePos, prev, n3, currentToken;
    var length = css.length;
    var pos = 0;
    var buffer = [];
    var returned = [];
    function position() {
      return pos;
    }
    function unclosed(what) {
      throw input2.error("Unclosed " + what, pos);
    }
    function endOfFile() {
      return returned.length === 0 && pos >= length;
    }
    function nextToken(opts) {
      if (returned.length) return returned.pop();
      if (pos >= length) return;
      var ignoreUnclosed = opts ? opts.ignoreUnclosed : false;
      code = css.charCodeAt(pos);
      switch (code) {
        case NEWLINE:
        case SPACE:
        case TAB:
        case CR:
        case FEED: {
          next = pos;
          do {
            next += 1;
            code = css.charCodeAt(next);
          } while (code === SPACE || code === NEWLINE || code === TAB || code === CR || code === FEED);
          currentToken = [
            "space",
            css.slice(pos, next)
          ];
          pos = next - 1;
          break;
        }
        case OPEN_SQUARE:
        case CLOSE_SQUARE:
        case OPEN_CURLY:
        case CLOSE_CURLY:
        case COLON:
        case SEMICOLON:
        case CLOSE_PARENTHESES: {
          var controlChar = String.fromCharCode(code);
          currentToken = [
            controlChar,
            controlChar,
            pos
          ];
          break;
        }
        case OPEN_PARENTHESES: {
          prev = buffer.length ? buffer.pop()[1] : "";
          n3 = css.charCodeAt(pos + 1);
          if (prev === "url" && n3 !== SINGLE_QUOTE && n3 !== DOUBLE_QUOTE && n3 !== SPACE && n3 !== NEWLINE && n3 !== TAB && n3 !== FEED && n3 !== CR) {
            next = pos;
            do {
              escaped = false;
              next = css.indexOf(")", next + 1);
              if (next === -1) {
                if (ignore || ignoreUnclosed) {
                  next = pos;
                  break;
                } else {
                  unclosed("bracket");
                }
              }
              escapePos = next;
              while (css.charCodeAt(escapePos - 1) === BACKSLASH) {
                escapePos -= 1;
                escaped = !escaped;
              }
            } while (escaped);
            currentToken = [
              "brackets",
              css.slice(pos, next + 1),
              pos,
              next
            ];
            pos = next;
          } else {
            next = css.indexOf(")", pos + 1);
            content = css.slice(pos, next + 1);
            if (next === -1 || RE_BAD_BRACKET.test(content)) {
              currentToken = [
                "(",
                "(",
                pos
              ];
            } else {
              currentToken = [
                "brackets",
                content,
                pos,
                next
              ];
              pos = next;
            }
          }
          break;
        }
        case SINGLE_QUOTE:
        case DOUBLE_QUOTE: {
          quote = code === SINGLE_QUOTE ? "'" : '"';
          next = pos;
          do {
            escaped = false;
            next = css.indexOf(quote, next + 1);
            if (next === -1) {
              if (ignore || ignoreUnclosed) {
                next = pos + 1;
                break;
              } else {
                unclosed("string");
              }
            }
            escapePos = next;
            while (css.charCodeAt(escapePos - 1) === BACKSLASH) {
              escapePos -= 1;
              escaped = !escaped;
            }
          } while (escaped);
          currentToken = [
            "string",
            css.slice(pos, next + 1),
            pos,
            next
          ];
          pos = next;
          break;
        }
        case AT: {
          RE_AT_END.lastIndex = pos + 1;
          RE_AT_END.test(css);
          if (RE_AT_END.lastIndex === 0) {
            next = css.length - 1;
          } else {
            next = RE_AT_END.lastIndex - 2;
          }
          currentToken = [
            "at-word",
            css.slice(pos, next + 1),
            pos,
            next
          ];
          pos = next;
          break;
        }
        case BACKSLASH: {
          next = pos;
          escape = true;
          while (css.charCodeAt(next + 1) === BACKSLASH) {
            next += 1;
            escape = !escape;
          }
          code = css.charCodeAt(next + 1);
          if (escape && code !== SLASH && code !== SPACE && code !== NEWLINE && code !== TAB && code !== CR && code !== FEED) {
            next += 1;
            if (RE_HEX_ESCAPE.test(css.charAt(next))) {
              while (RE_HEX_ESCAPE.test(css.charAt(next + 1))) {
                next += 1;
              }
              if (css.charCodeAt(next + 1) === SPACE) {
                next += 1;
              }
            }
          }
          currentToken = [
            "word",
            css.slice(pos, next + 1),
            pos,
            next
          ];
          pos = next;
          break;
        }
        default: {
          if (code === SLASH && css.charCodeAt(pos + 1) === ASTERISK) {
            next = css.indexOf("*/", pos + 2) + 1;
            if (next === 0) {
              if (ignore || ignoreUnclosed) {
                next = css.length;
              } else {
                unclosed("comment");
              }
            }
            currentToken = [
              "comment",
              css.slice(pos, next + 1),
              pos,
              next
            ];
            pos = next;
          } else {
            RE_WORD_END.lastIndex = pos + 1;
            RE_WORD_END.test(css);
            if (RE_WORD_END.lastIndex === 0) {
              next = css.length - 1;
            } else {
              next = RE_WORD_END.lastIndex - 2;
            }
            currentToken = [
              "word",
              css.slice(pos, next + 1),
              pos,
              next
            ];
            buffer.push(currentToken);
            pos = next;
          }
          break;
        }
      }
      pos++;
      return currentToken;
    }
    function back(token) {
      returned.push(token);
    }
    return {
      back,
      endOfFile,
      nextToken,
      position
    };
  };
  var Container$5 = container;
  var AtRule$3 = /* @__PURE__ */ (function(Container$52) {
    _inherits(AtRule, Container$52);
    function AtRule(defaults) {
      var _this;
      _this = Container$52.call(this, defaults) || this;
      _this.type = "atrule";
      return _this;
    }
    var _proto = AtRule.prototype;
    _proto.append = function append() {
      for (var _len = arguments.length, children = new Array(_len), _key = 0; _key < _len; _key++) {
        children[_key] = arguments[_key];
      }
      var _Container$5_prototype_append;
      if (!this.proxyOf.nodes) this.nodes = [];
      return (_Container$5_prototype_append = Container$52.prototype.append).call.apply(_Container$5_prototype_append, [].concat([
        this
      ], children));
    };
    _proto.prepend = function prepend() {
      for (var _len = arguments.length, children = new Array(_len), _key = 0; _key < _len; _key++) {
        children[_key] = arguments[_key];
      }
      var _Container$5_prototype_prepend;
      if (!this.proxyOf.nodes) this.nodes = [];
      return (_Container$5_prototype_prepend = Container$52.prototype.prepend).call.apply(_Container$5_prototype_prepend, [].concat([
        this
      ], children));
    };
    return AtRule;
  })(Container$5);
  var atRule = AtRule$3;
  AtRule$3.default = AtRule$3;
  Container$5.registerAtRule(AtRule$3);
  var Container$4 = container;
  var LazyResult$3;
  var Processor$2;
  var Root$5 = /* @__PURE__ */ (function(Container$42) {
    _inherits(Root, Container$42);
    function Root(defaults) {
      var _this;
      _this = Container$42.call(this, defaults) || this;
      _this.type = "root";
      if (!_this.nodes) _this.nodes = [];
      return _this;
    }
    var _proto = Root.prototype;
    _proto.normalize = function normalize(child, sample, type) {
      var nodes = Container$42.prototype.normalize.call(this, child);
      if (sample) {
        if (type === "prepend") {
          if (this.nodes.length > 1) {
            sample.raws.before = this.nodes[1].raws.before;
          } else {
            delete sample.raws.before;
          }
        } else if (this.first !== sample) {
          for (var _iterator = _create_for_of_iterator_helper_loose(nodes), _step; !(_step = _iterator()).done; ) {
            var node2 = _step.value;
            node2.raws.before = sample.raws.before;
          }
        }
      }
      return nodes;
    };
    _proto.removeChild = function removeChild(child, ignore) {
      var index2 = this.index(child);
      if (!ignore && index2 === 0 && this.nodes.length > 1) {
        this.nodes[1].raws.before = this.nodes[index2].raws.before;
      }
      return Container$42.prototype.removeChild.call(this, child);
    };
    _proto.toResult = function toResult(opts) {
      if (opts === void 0) opts = {};
      var lazy = new LazyResult$3(new Processor$2(), this, opts);
      return lazy.stringify();
    };
    return Root;
  })(Container$4);
  Root$5.registerLazyResult = function(dependant) {
    LazyResult$3 = dependant;
  };
  Root$5.registerProcessor = function(dependant) {
    Processor$2 = dependant;
  };
  var root = Root$5;
  Root$5.default = Root$5;
  Container$4.registerRoot(Root$5);
  var list$2 = {
    comma: function comma3(string) {
      return list$2.split(string, [
        ","
      ], true);
    },
    space: function space3(string) {
      var spaces = [
        " ",
        "\n",
        "	"
      ];
      return list$2.split(string, spaces);
    },
    split: function split3(string, separators, last) {
      var array = [];
      var current = "";
      var split4 = false;
      var func = 0;
      var inQuote = false;
      var prevQuote = "";
      var escape = false;
      for (var _iterator = _create_for_of_iterator_helper_loose(string), _step; !(_step = _iterator()).done; ) {
        var letter = _step.value;
        if (escape) {
          escape = false;
        } else if (letter === "\\") {
          escape = true;
        } else if (inQuote) {
          if (letter === prevQuote) {
            inQuote = false;
          }
        } else if (letter === '"' || letter === "'") {
          inQuote = true;
          prevQuote = letter;
        } else if (letter === "(") {
          func += 1;
        } else if (letter === ")") {
          if (func > 0) func -= 1;
        } else if (func === 0) {
          if (separators.includes(letter)) split4 = true;
        }
        if (split4) {
          if (current !== "") array.push(current.trim());
          current = "";
          split4 = false;
        } else {
          current += letter;
        }
      }
      if (last || current !== "") array.push(current.trim());
      return array;
    }
  };
  var list_1 = list$2;
  list$2.default = list$2;
  var Container$3 = container;
  var list$1 = list_1;
  var Rule$3 = /* @__PURE__ */ (function(Container$32) {
    _inherits(Rule, Container$32);
    function Rule(defaults) {
      var _this;
      _this = Container$32.call(this, defaults) || this;
      _this.type = "rule";
      if (!_this.nodes) _this.nodes = [];
      return _this;
    }
    _create_class(Rule, [
      {
        key: "selectors",
        get: function get() {
          return list$1.comma(this.selector);
        },
        set: function set(values) {
          var match = this.selector ? this.selector.match(/,\s*/) : null;
          var sep2 = match ? match[0] : "," + this.raw("between", "beforeOpen");
          this.selector = values.join(sep2);
        }
      }
    ]);
    return Rule;
  })(Container$3);
  var rule = Rule$3;
  Rule$3.default = Rule$3;
  Container$3.registerRule(Rule$3);
  var Declaration$2 = declaration;
  var tokenizer23 = tokenize;
  var Comment$2 = comment;
  var AtRule$2 = atRule;
  var Root$4 = root;
  var Rule$2 = rule;
  var SAFE_COMMENT_NEIGHBOR = {
    empty: true,
    space: true
  };
  function findLastWithPosition(tokens) {
    for (var i3 = tokens.length - 1; i3 >= 0; i3--) {
      var token = tokens[i3];
      var pos = token[3] || token[2];
      if (pos) return pos;
    }
  }
  var Parser$1 = /* @__PURE__ */ (function() {
    function Parser(input2) {
      this.input = input2;
      this.root = new Root$4();
      this.current = this.root;
      this.spaces = "";
      this.semicolon = false;
      this.createTokenizer();
      this.root.source = {
        input: input2,
        start: {
          column: 1,
          line: 1,
          offset: 0
        }
      };
    }
    var _proto = Parser.prototype;
    _proto.atrule = function atrule(token) {
      var node2 = new AtRule$2();
      node2.name = token[1].slice(1);
      if (node2.name === "") {
        this.unnamedAtrule(node2, token);
      }
      this.init(node2, token[2]);
      var type;
      var prev;
      var shift;
      var last = false;
      var open = false;
      var params = [];
      var brackets = [];
      while (!this.tokenizer.endOfFile()) {
        token = this.tokenizer.nextToken();
        type = token[0];
        if (type === "(" || type === "[") {
          brackets.push(type === "(" ? ")" : "]");
        } else if (type === "{" && brackets.length > 0) {
          brackets.push("}");
        } else if (type === brackets[brackets.length - 1]) {
          brackets.pop();
        }
        if (brackets.length === 0) {
          if (type === ";") {
            node2.source.end = this.getPosition(token[2]);
            node2.source.end.offset++;
            this.semicolon = true;
            break;
          } else if (type === "{") {
            open = true;
            break;
          } else if (type === "}") {
            if (params.length > 0) {
              shift = params.length - 1;
              prev = params[shift];
              while (prev && prev[0] === "space") {
                prev = params[--shift];
              }
              if (prev) {
                node2.source.end = this.getPosition(prev[3] || prev[2]);
                node2.source.end.offset++;
              }
            }
            this.end(token);
            break;
          } else {
            params.push(token);
          }
        } else {
          params.push(token);
        }
        if (this.tokenizer.endOfFile()) {
          last = true;
          break;
        }
      }
      node2.raws.between = this.spacesAndCommentsFromEnd(params);
      if (params.length) {
        node2.raws.afterName = this.spacesAndCommentsFromStart(params);
        this.raw(node2, "params", params);
        if (last) {
          token = params[params.length - 1];
          node2.source.end = this.getPosition(token[3] || token[2]);
          node2.source.end.offset++;
          this.spaces = node2.raws.between;
          node2.raws.between = "";
        }
      } else {
        node2.raws.afterName = "";
        node2.params = "";
      }
      if (open) {
        node2.nodes = [];
        this.current = node2;
      }
    };
    _proto.checkMissedSemicolon = function checkMissedSemicolon(tokens) {
      var colon = this.colon(tokens);
      if (colon === false) return;
      var founded = 0;
      var token;
      for (var j4 = colon - 1; j4 >= 0; j4--) {
        token = tokens[j4];
        if (token[0] !== "space") {
          founded += 1;
          if (founded === 2) break;
        }
      }
      throw this.input.error("Missed semicolon", token[0] === "word" ? token[3] + 1 : token[2]);
    };
    _proto.colon = function colon(tokens) {
      var brackets = 0;
      var token, type, prev;
      for (var _iterator = _create_for_of_iterator_helper_loose(tokens.entries()), _step; !(_step = _iterator()).done; ) {
        var _step_value = _step.value, i3 = _step_value[0], element = _step_value[1];
        token = element;
        type = token[0];
        if (type === "(") {
          brackets += 1;
        }
        if (type === ")") {
          brackets -= 1;
        }
        if (brackets === 0 && type === ":") {
          if (!prev) {
            this.doubleColon(token);
          } else if (prev[0] === "word" && prev[1] === "progid") {
            continue;
          } else {
            return i3;
          }
        }
        prev = token;
      }
      return false;
    };
    _proto.comment = function comment2(token) {
      var node2 = new Comment$2();
      this.init(node2, token[2]);
      node2.source.end = this.getPosition(token[3] || token[2]);
      node2.source.end.offset++;
      var text = token[1].slice(2, -2);
      if (/^\s*$/.test(text)) {
        node2.text = "";
        node2.raws.left = text;
        node2.raws.right = "";
      } else {
        var match = text.match(/^(\s*)([^]*\S)(\s*)$/);
        node2.text = match[2];
        node2.raws.left = match[1];
        node2.raws.right = match[3];
      }
    };
    _proto.createTokenizer = function createTokenizer() {
      this.tokenizer = tokenizer23(this.input);
    };
    _proto.decl = function decl(tokens, customProperty) {
      var node2 = new Declaration$2();
      this.init(node2, tokens[0][2]);
      var last = tokens[tokens.length - 1];
      if (last[0] === ";") {
        this.semicolon = true;
        tokens.pop();
      }
      node2.source.end = this.getPosition(last[3] || last[2] || findLastWithPosition(tokens));
      node2.source.end.offset++;
      while (tokens[0][0] !== "word") {
        if (tokens.length === 1) this.unknownWord(tokens);
        node2.raws.before += tokens.shift()[1];
      }
      node2.source.start = this.getPosition(tokens[0][2]);
      node2.prop = "";
      while (tokens.length) {
        var type = tokens[0][0];
        if (type === ":" || type === "space" || type === "comment") {
          break;
        }
        node2.prop += tokens.shift()[1];
      }
      node2.raws.between = "";
      var token;
      while (tokens.length) {
        token = tokens.shift();
        if (token[0] === ":") {
          node2.raws.between += token[1];
          break;
        } else {
          if (token[0] === "word" && /\w/.test(token[1])) {
            this.unknownWord([
              token
            ]);
          }
          node2.raws.between += token[1];
        }
      }
      if (node2.prop[0] === "_" || node2.prop[0] === "*") {
        node2.raws.before += node2.prop[0];
        node2.prop = node2.prop.slice(1);
      }
      var firstSpaces = [];
      var next;
      while (tokens.length) {
        next = tokens[0][0];
        if (next !== "space" && next !== "comment") break;
        firstSpaces.push(tokens.shift());
      }
      this.precheckMissedSemicolon(tokens);
      for (var i3 = tokens.length - 1; i3 >= 0; i3--) {
        token = tokens[i3];
        if (token[1].toLowerCase() === "!important") {
          node2.important = true;
          var string = this.stringFrom(tokens, i3);
          string = this.spacesFromEnd(tokens) + string;
          if (string !== " !important") node2.raws.important = string;
          break;
        } else if (token[1].toLowerCase() === "important") {
          var cache = tokens.slice(0);
          var str = "";
          for (var j4 = i3; j4 > 0; j4--) {
            var type1 = cache[j4][0];
            if (str.trim().indexOf("!") === 0 && type1 !== "space") {
              break;
            }
            str = cache.pop()[1] + str;
          }
          if (str.trim().indexOf("!") === 0) {
            node2.important = true;
            node2.raws.important = str;
            tokens = cache;
          }
        }
        if (token[0] !== "space" && token[0] !== "comment") {
          break;
        }
      }
      var hasWord = tokens.some(function(i4) {
        return i4[0] !== "space" && i4[0] !== "comment";
      });
      if (hasWord) {
        node2.raws.between += firstSpaces.map(function(i4) {
          return i4[1];
        }).join("");
        firstSpaces = [];
      }
      this.raw(node2, "value", firstSpaces.concat(tokens), customProperty);
      if (node2.value.includes(":") && !customProperty) {
        this.checkMissedSemicolon(tokens);
      }
    };
    _proto.doubleColon = function doubleColon(token) {
      throw this.input.error("Double colon", {
        offset: token[2]
      }, {
        offset: token[2] + token[1].length
      });
    };
    _proto.emptyRule = function emptyRule(token) {
      var node2 = new Rule$2();
      this.init(node2, token[2]);
      node2.selector = "";
      node2.raws.between = "";
      this.current = node2;
    };
    _proto.end = function end(token) {
      if (this.current.nodes && this.current.nodes.length) {
        this.current.raws.semicolon = this.semicolon;
      }
      this.semicolon = false;
      this.current.raws.after = (this.current.raws.after || "") + this.spaces;
      this.spaces = "";
      if (this.current.parent) {
        this.current.source.end = this.getPosition(token[2]);
        this.current.source.end.offset++;
        this.current = this.current.parent;
      } else {
        this.unexpectedClose(token);
      }
    };
    _proto.endFile = function endFile() {
      if (this.current.parent) this.unclosedBlock();
      if (this.current.nodes && this.current.nodes.length) {
        this.current.raws.semicolon = this.semicolon;
      }
      this.current.raws.after = (this.current.raws.after || "") + this.spaces;
      this.root.source.end = this.getPosition(this.tokenizer.position());
    };
    _proto.freeSemicolon = function freeSemicolon(token) {
      this.spaces += token[1];
      if (this.current.nodes) {
        var prev = this.current.nodes[this.current.nodes.length - 1];
        if (prev && prev.type === "rule" && !prev.raws.ownSemicolon) {
          prev.raws.ownSemicolon = this.spaces;
          this.spaces = "";
        }
      }
    };
    _proto.getPosition = function getPosition(offset) {
      var pos = this.input.fromOffset(offset);
      return {
        column: pos.col,
        line: pos.line,
        offset
      };
    };
    _proto.init = function init(node2, offset) {
      this.current.push(node2);
      node2.source = {
        input: this.input,
        start: this.getPosition(offset)
      };
      node2.raws.before = this.spaces;
      this.spaces = "";
      if (node2.type !== "comment") this.semicolon = false;
    };
    _proto.other = function other(start) {
      var end = false;
      var type = null;
      var colon = false;
      var bracket = null;
      var brackets = [];
      var customProperty = start[1].startsWith("--");
      var tokens = [];
      var token = start;
      while (token) {
        type = token[0];
        tokens.push(token);
        if (type === "(" || type === "[") {
          if (!bracket) bracket = token;
          brackets.push(type === "(" ? ")" : "]");
        } else if (customProperty && colon && type === "{") {
          if (!bracket) bracket = token;
          brackets.push("}");
        } else if (brackets.length === 0) {
          if (type === ";") {
            if (colon) {
              this.decl(tokens, customProperty);
              return;
            } else {
              break;
            }
          } else if (type === "{") {
            this.rule(tokens);
            return;
          } else if (type === "}") {
            this.tokenizer.back(tokens.pop());
            end = true;
            break;
          } else if (type === ":") {
            colon = true;
          }
        } else if (type === brackets[brackets.length - 1]) {
          brackets.pop();
          if (brackets.length === 0) bracket = null;
        }
        token = this.tokenizer.nextToken();
      }
      if (this.tokenizer.endOfFile()) end = true;
      if (brackets.length > 0) this.unclosedBracket(bracket);
      if (end && colon) {
        if (!customProperty) {
          while (tokens.length) {
            token = tokens[tokens.length - 1][0];
            if (token !== "space" && token !== "comment") break;
            this.tokenizer.back(tokens.pop());
          }
        }
        this.decl(tokens, customProperty);
      } else {
        this.unknownWord(tokens);
      }
    };
    _proto.parse = function parse3() {
      var token;
      while (!this.tokenizer.endOfFile()) {
        token = this.tokenizer.nextToken();
        switch (token[0]) {
          case "space":
            this.spaces += token[1];
            break;
          case ";":
            this.freeSemicolon(token);
            break;
          case "}":
            this.end(token);
            break;
          case "comment":
            this.comment(token);
            break;
          case "at-word":
            this.atrule(token);
            break;
          case "{":
            this.emptyRule(token);
            break;
          default:
            this.other(token);
            break;
        }
      }
      this.endFile();
    };
    _proto.precheckMissedSemicolon = function precheckMissedSemicolon() {
    };
    _proto.raw = function raw(node2, prop, tokens, customProperty) {
      var token, type;
      var length = tokens.length;
      var value = "";
      var clean = true;
      var next, prev;
      for (var i3 = 0; i3 < length; i3 += 1) {
        token = tokens[i3];
        type = token[0];
        if (type === "space" && i3 === length - 1 && !customProperty) {
          clean = false;
        } else if (type === "comment") {
          prev = tokens[i3 - 1] ? tokens[i3 - 1][0] : "empty";
          next = tokens[i3 + 1] ? tokens[i3 + 1][0] : "empty";
          if (!SAFE_COMMENT_NEIGHBOR[prev] && !SAFE_COMMENT_NEIGHBOR[next]) {
            if (value.slice(-1) === ",") {
              clean = false;
            } else {
              value += token[1];
            }
          } else {
            clean = false;
          }
        } else {
          value += token[1];
        }
      }
      if (!clean) {
        var raw2 = tokens.reduce(function(all, i4) {
          return all + i4[1];
        }, "");
        node2.raws[prop] = {
          raw: raw2,
          value
        };
      }
      node2[prop] = value;
    };
    _proto.rule = function rule2(tokens) {
      tokens.pop();
      var node2 = new Rule$2();
      this.init(node2, tokens[0][2]);
      node2.raws.between = this.spacesAndCommentsFromEnd(tokens);
      this.raw(node2, "selector", tokens);
      this.current = node2;
    };
    _proto.spacesAndCommentsFromEnd = function spacesAndCommentsFromEnd(tokens) {
      var lastTokenType;
      var spaces = "";
      while (tokens.length) {
        lastTokenType = tokens[tokens.length - 1][0];
        if (lastTokenType !== "space" && lastTokenType !== "comment") break;
        spaces = tokens.pop()[1] + spaces;
      }
      return spaces;
    };
    _proto.spacesAndCommentsFromStart = function spacesAndCommentsFromStart(tokens) {
      var next;
      var spaces = "";
      while (tokens.length) {
        next = tokens[0][0];
        if (next !== "space" && next !== "comment") break;
        spaces += tokens.shift()[1];
      }
      return spaces;
    };
    _proto.spacesFromEnd = function spacesFromEnd(tokens) {
      var lastTokenType;
      var spaces = "";
      while (tokens.length) {
        lastTokenType = tokens[tokens.length - 1][0];
        if (lastTokenType !== "space") break;
        spaces = tokens.pop()[1] + spaces;
      }
      return spaces;
    };
    _proto.stringFrom = function stringFrom(tokens, from) {
      var result2 = "";
      for (var i3 = from; i3 < tokens.length; i3++) {
        result2 += tokens[i3][1];
      }
      tokens.splice(from, tokens.length - from);
      return result2;
    };
    _proto.unclosedBlock = function unclosedBlock() {
      var pos = this.current.source.start;
      throw this.input.error("Unclosed block", pos.line, pos.column);
    };
    _proto.unclosedBracket = function unclosedBracket(bracket) {
      throw this.input.error("Unclosed bracket", {
        offset: bracket[2]
      }, {
        offset: bracket[2] + 1
      });
    };
    _proto.unexpectedClose = function unexpectedClose(token) {
      throw this.input.error("Unexpected }", {
        offset: token[2]
      }, {
        offset: token[2] + 1
      });
    };
    _proto.unknownWord = function unknownWord(tokens) {
      throw this.input.error("Unknown word", {
        offset: tokens[0][2]
      }, {
        offset: tokens[0][2] + tokens[0][1].length
      });
    };
    _proto.unnamedAtrule = function unnamedAtrule(node2, token) {
      throw this.input.error("At-rule without name", {
        offset: token[2]
      }, {
        offset: token[2] + token[1].length
      });
    };
    return Parser;
  })();
  var parser = Parser$1;
  var Container$2 = container;
  var Parser2 = parser;
  var Input$2 = input;
  function parse$3(css, opts) {
    var input2 = new Input$2(css, opts);
    var parser2 = new Parser2(input2);
    try {
      parser2.parse();
    } catch (e3) {
      if (true) {
        if (e3.name === "CssSyntaxError" && opts && opts.from) {
          if (/\.scss$/i.test(opts.from)) {
            e3.message += "\nYou tried to parse SCSS with the standard CSS parser; try again with the postcss-scss parser";
          } else if (/\.sass/i.test(opts.from)) {
            e3.message += "\nYou tried to parse Sass with the standard CSS parser; try again with the postcss-sass parser";
          } else if (/\.less$/i.test(opts.from)) {
            e3.message += "\nYou tried to parse Less with the standard CSS parser; try again with the postcss-less parser";
          }
        }
      }
      throw e3;
    }
    return parser2.root;
  }
  var parse_1 = parse$3;
  parse$3.default = parse$3;
  Container$2.registerParse(parse$3);
  var isClean = symbols.isClean;
  var my = symbols.my;
  var MapGenerator$1 = mapGenerator;
  var stringify$2 = stringify_1;
  var Container$1 = container;
  var Document$2 = document$1$3;
  var warnOnce$1 = warnOnce$2;
  var Result$2 = result;
  var parse$2 = parse_1;
  var Root$3 = root;
  var TYPE_TO_CLASS_NAME = {
    atrule: "AtRule",
    comment: "Comment",
    decl: "Declaration",
    document: "Document",
    root: "Root",
    rule: "Rule"
  };
  var PLUGIN_PROPS = {
    AtRule: true,
    AtRuleExit: true,
    Comment: true,
    CommentExit: true,
    Declaration: true,
    DeclarationExit: true,
    Document: true,
    DocumentExit: true,
    Once: true,
    OnceExit: true,
    postcssPlugin: true,
    prepare: true,
    Root: true,
    RootExit: true,
    Rule: true,
    RuleExit: true
  };
  var NOT_VISITORS = {
    Once: true,
    postcssPlugin: true,
    prepare: true
  };
  var CHILDREN = 0;
  function isPromise(obj) {
    return (typeof obj === "undefined" ? "undefined" : _type_of(obj)) === "object" && typeof obj.then === "function";
  }
  function getEvents(node2) {
    var key = false;
    var type = TYPE_TO_CLASS_NAME[node2.type];
    if (node2.type === "decl") {
      key = node2.prop.toLowerCase();
    } else if (node2.type === "atrule") {
      key = node2.name.toLowerCase();
    }
    if (key && node2.append) {
      return [
        type,
        type + "-" + key,
        CHILDREN,
        type + "Exit",
        type + "Exit-" + key
      ];
    } else if (key) {
      return [
        type,
        type + "-" + key,
        type + "Exit",
        type + "Exit-" + key
      ];
    } else if (node2.append) {
      return [
        type,
        CHILDREN,
        type + "Exit"
      ];
    } else {
      return [
        type,
        type + "Exit"
      ];
    }
  }
  function toStack(node2) {
    var events;
    if (node2.type === "document") {
      events = [
        "Document",
        CHILDREN,
        "DocumentExit"
      ];
    } else if (node2.type === "root") {
      events = [
        "Root",
        CHILDREN,
        "RootExit"
      ];
    } else {
      events = getEvents(node2);
    }
    return {
      eventIndex: 0,
      events,
      iterator: 0,
      node: node2,
      visitorIndex: 0,
      visitors: []
    };
  }
  function cleanMarks(node2) {
    node2[isClean] = false;
    if (node2.nodes) node2.nodes.forEach(function(i3) {
      return cleanMarks(i3);
    });
    return node2;
  }
  var postcss$2 = {};
  var LazyResult$2 = /* @__PURE__ */ (function() {
    function LazyResult(processor2, css, opts) {
      var _this = this;
      this.stringified = false;
      this.processed = false;
      var root2;
      if ((typeof css === "undefined" ? "undefined" : _type_of(css)) === "object" && css !== null && (css.type === "root" || css.type === "document")) {
        root2 = cleanMarks(css);
      } else if (_instanceof(css, LazyResult) || _instanceof(css, Result$2)) {
        root2 = cleanMarks(css.root);
        if (css.map) {
          if (typeof opts.map === "undefined") opts.map = {};
          if (!opts.map.inline) opts.map.inline = false;
          opts.map.prev = css.map;
        }
      } else {
        var parser2 = parse$2;
        if (opts.syntax) parser2 = opts.syntax.parse;
        if (opts.parser) parser2 = opts.parser;
        if (parser2.parse) parser2 = parser2.parse;
        try {
          root2 = parser2(css, opts);
        } catch (error) {
          this.processed = true;
          this.error = error;
        }
        if (root2 && !root2[my]) {
          Container$1.rebuild(root2);
        }
      }
      this.result = new Result$2(processor2, root2, opts);
      this.helpers = _extends({}, postcss$2, {
        postcss: postcss$2,
        result: this.result
      });
      this.plugins = this.processor.plugins.map(function(plugin22) {
        if ((typeof plugin22 === "undefined" ? "undefined" : _type_of(plugin22)) === "object" && plugin22.prepare) {
          return _extends({}, plugin22, plugin22.prepare(_this.result));
        } else {
          return plugin22;
        }
      });
    }
    var _proto = LazyResult.prototype;
    _proto.async = function async() {
      if (this.error) return Promise.reject(this.error);
      if (this.processed) return Promise.resolve(this.result);
      if (!this.processing) {
        this.processing = this.runAsync();
      }
      return this.processing;
    };
    _proto.catch = function _catch(onRejected) {
      return this.async().catch(onRejected);
    };
    _proto.finally = function _finally(onFinally) {
      return this.async().then(onFinally, onFinally);
    };
    _proto.getAsyncError = function getAsyncError() {
      throw new Error("Use process(css).then(cb) to work with async plugins");
    };
    _proto.handleError = function handleError(error, node2) {
      var plugin22 = this.result.lastPlugin;
      try {
        if (node2) node2.addToError(error);
        this.error = error;
        if (error.name === "CssSyntaxError" && !error.plugin) {
          error.plugin = plugin22.postcssPlugin;
          error.setMessage();
        } else if (plugin22.postcssVersion) {
          if (true) {
            var pluginName = plugin22.postcssPlugin;
            var pluginVer = plugin22.postcssVersion;
            var runtimeVer = this.result.processor.version;
            var a3 = pluginVer.split(".");
            var b2 = runtimeVer.split(".");
            if (a3[0] !== b2[0] || parseInt(a3[1]) > parseInt(b2[1])) {
              console.error("Unknown error from PostCSS plugin. Your current PostCSS version is " + runtimeVer + ", but " + pluginName + " uses " + pluginVer + ". Perhaps this is the source of the error below.");
            }
          }
        }
      } catch (err) {
        if (console && console.error) console.error(err);
      }
      return error;
    };
    _proto.prepareVisitors = function prepareVisitors() {
      var _this = this;
      this.listeners = {};
      var add = function(plugin23, type, cb) {
        if (!_this.listeners[type]) _this.listeners[type] = [];
        _this.listeners[type].push([
          plugin23,
          cb
        ]);
      };
      for (var _iterator = _create_for_of_iterator_helper_loose(this.plugins), _step; !(_step = _iterator()).done; ) {
        var plugin22 = _step.value;
        if ((typeof plugin22 === "undefined" ? "undefined" : _type_of(plugin22)) === "object") {
          for (var event in plugin22) {
            if (!PLUGIN_PROPS[event] && /^[A-Z]/.test(event)) {
              throw new Error("Unknown event " + event + " in " + plugin22.postcssPlugin + ". Try to update PostCSS (" + this.processor.version + " now).");
            }
            if (!NOT_VISITORS[event]) {
              if (_type_of(plugin22[event]) === "object") {
                for (var filter in plugin22[event]) {
                  if (filter === "*") {
                    add(plugin22, event, plugin22[event][filter]);
                  } else {
                    add(plugin22, event + "-" + filter.toLowerCase(), plugin22[event][filter]);
                  }
                }
              } else if (typeof plugin22[event] === "function") {
                add(plugin22, event, plugin22[event]);
              }
            }
          }
        }
      }
      this.hasListener = Object.keys(this.listeners).length > 0;
    };
    _proto.runAsync = function runAsync() {
      var _this = this;
      return _async_to_generator(function() {
        var i3, plugin22, promise, error, root2, stack, promise1, e3, node2, _loop, _iterator, _step;
        return _ts_generator(this, function(_state) {
          switch (_state.label) {
            case 0:
              _this.plugin = 0;
              i3 = 0;
              _state.label = 1;
            case 1:
              if (!(i3 < _this.plugins.length)) return [
                3,
                6
              ];
              plugin22 = _this.plugins[i3];
              promise = _this.runOnRoot(plugin22);
              if (!isPromise(promise)) return [
                3,
                5
              ];
              _state.label = 2;
            case 2:
              _state.trys.push([
                2,
                4,
                ,
                5
              ]);
              return [
                4,
                promise
              ];
            case 3:
              _state.sent();
              return [
                3,
                5
              ];
            case 4:
              error = _state.sent();
              throw _this.handleError(error);
            case 5:
              i3++;
              return [
                3,
                1
              ];
            case 6:
              _this.prepareVisitors();
              if (!_this.hasListener) return [
                3,
                18
              ];
              root2 = _this.result.root;
              _state.label = 7;
            case 7:
              if (!!root2[isClean]) return [
                3,
                14
              ];
              root2[isClean] = true;
              stack = [
                toStack(root2)
              ];
              _state.label = 8;
            case 8:
              if (!(stack.length > 0)) return [
                3,
                13
              ];
              promise1 = _this.visitTick(stack);
              if (!isPromise(promise1)) return [
                3,
                12
              ];
              _state.label = 9;
            case 9:
              _state.trys.push([
                9,
                11,
                ,
                12
              ]);
              return [
                4,
                promise1
              ];
            case 10:
              _state.sent();
              return [
                3,
                12
              ];
            case 11:
              e3 = _state.sent();
              node2 = stack[stack.length - 1].node;
              throw _this.handleError(e3, node2);
            case 12:
              return [
                3,
                8
              ];
            case 13:
              return [
                3,
                7
              ];
            case 14:
              if (!_this.listeners.OnceExit) return [
                3,
                18
              ];
              _loop = function() {
                var _step_value, plugin23, visitor, roots, e4;
                return _ts_generator(this, function(_state2) {
                  switch (_state2.label) {
                    case 0:
                      _step_value = _step.value, plugin23 = _step_value[0], visitor = _step_value[1];
                      _this.result.lastPlugin = plugin23;
                      _state2.label = 1;
                    case 1:
                      _state2.trys.push([
                        1,
                        6,
                        ,
                        7
                      ]);
                      if (!(root2.type === "document")) return [
                        3,
                        3
                      ];
                      roots = root2.nodes.map(function(subRoot) {
                        return visitor(subRoot, _this.helpers);
                      });
                      return [
                        4,
                        Promise.all(roots)
                      ];
                    case 2:
                      _state2.sent();
                      return [
                        3,
                        5
                      ];
                    case 3:
                      return [
                        4,
                        visitor(root2, _this.helpers)
                      ];
                    case 4:
                      _state2.sent();
                      _state2.label = 5;
                    case 5:
                      return [
                        3,
                        7
                      ];
                    case 6:
                      e4 = _state2.sent();
                      throw _this.handleError(e4);
                    case 7:
                      return [
                        2
                      ];
                  }
                });
              };
              _iterator = _create_for_of_iterator_helper_loose(_this.listeners.OnceExit);
              _state.label = 15;
            case 15:
              if (!!(_step = _iterator()).done) return [
                3,
                18
              ];
              return [
                5,
                _ts_values(_loop())
              ];
            case 16:
              _state.sent();
              _state.label = 17;
            case 17:
              return [
                3,
                15
              ];
            case 18:
              _this.processed = true;
              return [
                2,
                _this.stringify()
              ];
          }
        });
      })();
    };
    _proto.runOnRoot = function runOnRoot(plugin22) {
      var _this = this;
      this.result.lastPlugin = plugin22;
      try {
        if ((typeof plugin22 === "undefined" ? "undefined" : _type_of(plugin22)) === "object" && plugin22.Once) {
          if (this.result.root.type === "document") {
            var roots = this.result.root.nodes.map(function(root2) {
              return plugin22.Once(root2, _this.helpers);
            });
            if (isPromise(roots[0])) {
              return Promise.all(roots);
            }
            return roots;
          }
          return plugin22.Once(this.result.root, this.helpers);
        } else if (typeof plugin22 === "function") {
          return plugin22(this.result.root, this.result);
        }
      } catch (error) {
        throw this.handleError(error);
      }
    };
    _proto.stringify = function stringify2() {
      if (this.error) throw this.error;
      if (this.stringified) return this.result;
      this.stringified = true;
      this.sync();
      var opts = this.result.opts;
      var str = stringify$2;
      if (opts.syntax) str = opts.syntax.stringify;
      if (opts.stringifier) str = opts.stringifier;
      if (str.stringify) str = str.stringify;
      var map = new MapGenerator$1(str, this.result.root, this.result.opts);
      var data = map.generate();
      this.result.css = data[0];
      this.result.map = data[1];
      return this.result;
    };
    _proto.sync = function sync() {
      if (this.error) throw this.error;
      if (this.processed) return this.result;
      this.processed = true;
      if (this.processing) {
        throw this.getAsyncError();
      }
      for (var _iterator = _create_for_of_iterator_helper_loose(this.plugins), _step; !(_step = _iterator()).done; ) {
        var plugin22 = _step.value;
        var promise = this.runOnRoot(plugin22);
        if (isPromise(promise)) {
          throw this.getAsyncError();
        }
      }
      this.prepareVisitors();
      if (this.hasListener) {
        var root2 = this.result.root;
        while (!root2[isClean]) {
          root2[isClean] = true;
          this.walkSync(root2);
        }
        if (this.listeners.OnceExit) {
          if (root2.type === "document") {
            for (var _iterator1 = _create_for_of_iterator_helper_loose(root2.nodes), _step1; !(_step1 = _iterator1()).done; ) {
              var subRoot = _step1.value;
              this.visitSync(this.listeners.OnceExit, subRoot);
            }
          } else {
            this.visitSync(this.listeners.OnceExit, root2);
          }
        }
      }
      return this.result;
    };
    _proto.then = function then(onFulfilled, onRejected) {
      if (true) {
        if (!("from" in this.opts)) {
          warnOnce$1("Without `from` option PostCSS could generate wrong source map and will not find Browserslist config. Set it to CSS file path or to `undefined` to prevent this warning.");
        }
      }
      return this.async().then(onFulfilled, onRejected);
    };
    _proto.toString = function toString2() {
      return this.css;
    };
    _proto.visitSync = function visitSync(visitors, node2) {
      for (var _iterator = _create_for_of_iterator_helper_loose(visitors), _step; !(_step = _iterator()).done; ) {
        var _step_value = _step.value, plugin22 = _step_value[0], visitor = _step_value[1];
        this.result.lastPlugin = plugin22;
        var promise = void 0;
        try {
          promise = visitor(node2, this.helpers);
        } catch (e3) {
          throw this.handleError(e3, node2.proxyOf);
        }
        if (node2.type !== "root" && node2.type !== "document" && !node2.parent) {
          return true;
        }
        if (isPromise(promise)) {
          throw this.getAsyncError();
        }
      }
    };
    _proto.visitTick = function visitTick(stack) {
      var visit2 = stack[stack.length - 1];
      var node2 = visit2.node, visitors = visit2.visitors;
      if (node2.type !== "root" && node2.type !== "document" && !node2.parent) {
        stack.pop();
        return;
      }
      if (visitors.length > 0 && visit2.visitorIndex < visitors.length) {
        var _visitors_visit2_visitorIndex = visitors[visit2.visitorIndex], plugin22 = _visitors_visit2_visitorIndex[0], visitor = _visitors_visit2_visitorIndex[1];
        visit2.visitorIndex += 1;
        if (visit2.visitorIndex === visitors.length) {
          visit2.visitors = [];
          visit2.visitorIndex = 0;
        }
        this.result.lastPlugin = plugin22;
        try {
          return visitor(node2.toProxy(), this.helpers);
        } catch (e3) {
          throw this.handleError(e3, node2);
        }
      }
      if (visit2.iterator !== 0) {
        var iterator = visit2.iterator;
        var child;
        while (child = node2.nodes[node2.indexes[iterator]]) {
          node2.indexes[iterator] += 1;
          if (!child[isClean]) {
            child[isClean] = true;
            stack.push(toStack(child));
            return;
          }
        }
        visit2.iterator = 0;
        delete node2.indexes[iterator];
      }
      var events = visit2.events;
      while (visit2.eventIndex < events.length) {
        var event = events[visit2.eventIndex];
        visit2.eventIndex += 1;
        if (event === CHILDREN) {
          if (node2.nodes && node2.nodes.length) {
            node2[isClean] = true;
            visit2.iterator = node2.getIterator();
          }
          return;
        } else if (this.listeners[event]) {
          visit2.visitors = this.listeners[event];
          return;
        }
      }
      stack.pop();
    };
    _proto.walkSync = function walkSync(node2) {
      var _this = this;
      node2[isClean] = true;
      var events = getEvents(node2);
      for (var _iterator = _create_for_of_iterator_helper_loose(events), _step; !(_step = _iterator()).done; ) {
        var event = _step.value;
        if (event === CHILDREN) {
          if (node2.nodes) {
            node2.each(function(child) {
              if (!child[isClean]) _this.walkSync(child);
            });
          }
        } else {
          var visitors = this.listeners[event];
          if (visitors) {
            if (this.visitSync(visitors, node2.toProxy())) return;
          }
        }
      }
    };
    _proto.warnings = function warnings() {
      return this.sync().warnings();
    };
    _create_class(LazyResult, [
      {
        key: "content",
        get: function get() {
          return this.stringify().content;
        }
      },
      {
        key: "css",
        get: function get() {
          return this.stringify().css;
        }
      },
      {
        key: "map",
        get: function get() {
          return this.stringify().map;
        }
      },
      {
        key: "messages",
        get: function get() {
          return this.sync().messages;
        }
      },
      {
        key: "opts",
        get: function get() {
          return this.result.opts;
        }
      },
      {
        key: "processor",
        get: function get() {
          return this.result.processor;
        }
      },
      {
        key: "root",
        get: function get() {
          return this.sync().root;
        }
      },
      {
        key: Symbol.toStringTag,
        get: function get() {
          return "LazyResult";
        }
      }
    ]);
    return LazyResult;
  })();
  LazyResult$2.registerPostcss = function(dependant) {
    postcss$2 = dependant;
  };
  var lazyResult = LazyResult$2;
  LazyResult$2.default = LazyResult$2;
  Root$3.registerLazyResult(LazyResult$2);
  Document$2.registerLazyResult(LazyResult$2);
  var MapGenerator2 = mapGenerator;
  var stringify$1 = stringify_1;
  var warnOnce23 = warnOnce$2;
  var parse$1 = parse_1;
  var Result$1 = result;
  var NoWorkResult$1 = /* @__PURE__ */ (function() {
    function NoWorkResult(processor2, css, opts) {
      css = css.toString();
      this.stringified = false;
      this._processor = processor2;
      this._css = css;
      this._opts = opts;
      this._map = void 0;
      var root2;
      var str = stringify$1;
      this.result = new Result$1(this._processor, root2, this._opts);
      this.result.css = css;
      var self2 = this;
      Object.defineProperty(this.result, "root", {
        get: function get() {
          return self2.root;
        }
      });
      var map = new MapGenerator2(str, root2, this._opts, css);
      if (map.isMap()) {
        var _map_generate = map.generate(), generatedCSS = _map_generate[0], generatedMap = _map_generate[1];
        if (generatedCSS) {
          this.result.css = generatedCSS;
        }
        if (generatedMap) {
          this.result.map = generatedMap;
        }
      } else {
        map.clearAnnotation();
        this.result.css = map.css;
      }
    }
    var _proto = NoWorkResult.prototype;
    _proto.async = function async() {
      if (this.error) return Promise.reject(this.error);
      return Promise.resolve(this.result);
    };
    _proto.catch = function _catch(onRejected) {
      return this.async().catch(onRejected);
    };
    _proto.finally = function _finally(onFinally) {
      return this.async().then(onFinally, onFinally);
    };
    _proto.sync = function sync() {
      if (this.error) throw this.error;
      return this.result;
    };
    _proto.then = function then(onFulfilled, onRejected) {
      if (true) {
        if (!("from" in this._opts)) {
          warnOnce23("Without `from` option PostCSS could generate wrong source map and will not find Browserslist config. Set it to CSS file path or to `undefined` to prevent this warning.");
        }
      }
      return this.async().then(onFulfilled, onRejected);
    };
    _proto.toString = function toString2() {
      return this._css;
    };
    _proto.warnings = function warnings() {
      return [];
    };
    _create_class(NoWorkResult, [
      {
        key: "content",
        get: function get() {
          return this.result.css;
        }
      },
      {
        key: "css",
        get: function get() {
          return this.result.css;
        }
      },
      {
        key: "map",
        get: function get() {
          return this.result.map;
        }
      },
      {
        key: "messages",
        get: function get() {
          return [];
        }
      },
      {
        key: "opts",
        get: function get() {
          return this.result.opts;
        }
      },
      {
        key: "processor",
        get: function get() {
          return this.result.processor;
        }
      },
      {
        key: "root",
        get: function get() {
          if (this._root) {
            return this._root;
          }
          var root2;
          var parser2 = parse$1;
          try {
            root2 = parser2(this._css, this._opts);
          } catch (error) {
            this.error = error;
          }
          if (this.error) {
            throw this.error;
          } else {
            this._root = root2;
            return root2;
          }
        }
      },
      {
        key: Symbol.toStringTag,
        get: function get() {
          return "NoWorkResult";
        }
      }
    ]);
    return NoWorkResult;
  })();
  var noWorkResult = NoWorkResult$1;
  NoWorkResult$1.default = NoWorkResult$1;
  var NoWorkResult2 = noWorkResult;
  var LazyResult$1 = lazyResult;
  var Document$1 = document$1$3;
  var Root$2 = root;
  var Processor$1 = /* @__PURE__ */ (function() {
    function Processor(plugins) {
      if (plugins === void 0) plugins = [];
      this.version = "8.4.38";
      this.plugins = this.normalize(plugins);
    }
    var _proto = Processor.prototype;
    _proto.normalize = function normalize(plugins) {
      var normalized = [];
      for (var _iterator = _create_for_of_iterator_helper_loose(plugins), _step; !(_step = _iterator()).done; ) {
        var i3 = _step.value;
        if (i3.postcss === true) {
          i3 = i3();
        } else if (i3.postcss) {
          i3 = i3.postcss;
        }
        if ((typeof i3 === "undefined" ? "undefined" : _type_of(i3)) === "object" && Array.isArray(i3.plugins)) {
          normalized = normalized.concat(i3.plugins);
        } else if ((typeof i3 === "undefined" ? "undefined" : _type_of(i3)) === "object" && i3.postcssPlugin) {
          normalized.push(i3);
        } else if (typeof i3 === "function") {
          normalized.push(i3);
        } else if ((typeof i3 === "undefined" ? "undefined" : _type_of(i3)) === "object" && (i3.parse || i3.stringify)) {
          if (true) {
            throw new Error("PostCSS syntaxes cannot be used as plugins. Instead, please use one of the syntax/parser/stringifier options as outlined in your PostCSS runner documentation.");
          }
        } else {
          throw new Error(i3 + " is not a PostCSS plugin");
        }
      }
      return normalized;
    };
    _proto.process = function process1(css, opts) {
      if (opts === void 0) opts = {};
      if (!this.plugins.length && !opts.parser && !opts.stringifier && !opts.syntax) {
        return new NoWorkResult2(this, css, opts);
      } else {
        return new LazyResult$1(this, css, opts);
      }
    };
    _proto.use = function use(plugin22) {
      this.plugins = this.plugins.concat(this.normalize([
        plugin22
      ]));
      return this;
    };
    return Processor;
  })();
  var processor = Processor$1;
  Processor$1.default = Processor$1;
  Root$2.registerProcessor(Processor$1);
  Document$1.registerProcessor(Processor$1);
  var Declaration$1 = declaration;
  var PreviousMap2 = previousMap;
  var Comment$1 = comment;
  var AtRule$1 = atRule;
  var Input$1 = input;
  var Root$1 = root;
  var Rule$1 = rule;
  function fromJSON$1(json, inputs) {
    if (Array.isArray(json)) return json.map(function(n3) {
      return fromJSON$1(n3);
    });
    var ownInputs = json.inputs, defaults = _object_without_properties_loose(json, [
      "inputs"
    ]);
    if (ownInputs) {
      inputs = [];
      for (var _iterator = _create_for_of_iterator_helper_loose(ownInputs), _step; !(_step = _iterator()).done; ) {
        var input2 = _step.value;
        var inputHydrated = _extends({}, input2, {
          __proto__: Input$1.prototype
        });
        if (inputHydrated.map) {
          inputHydrated.map = _extends({}, inputHydrated.map, {
            __proto__: PreviousMap2.prototype
          });
        }
        inputs.push(inputHydrated);
      }
    }
    if (defaults.nodes) {
      defaults.nodes = json.nodes.map(function(n3) {
        return fromJSON$1(n3, inputs);
      });
    }
    if (defaults.source) {
      var _defaults_source = defaults.source, inputId = _defaults_source.inputId, source = _object_without_properties_loose(_defaults_source, [
        "inputId"
      ]);
      defaults.source = source;
      if (inputId != null) {
        defaults.source.input = inputs[inputId];
      }
    }
    if (defaults.type === "root") {
      return new Root$1(defaults);
    } else if (defaults.type === "decl") {
      return new Declaration$1(defaults);
    } else if (defaults.type === "rule") {
      return new Rule$1(defaults);
    } else if (defaults.type === "comment") {
      return new Comment$1(defaults);
    } else if (defaults.type === "atrule") {
      return new AtRule$1(defaults);
    } else {
      throw new Error("Unknown node type: " + json.type);
    }
  }
  var fromJSON_1 = fromJSON$1;
  fromJSON$1.default = fromJSON$1;
  var CssSyntaxError2 = cssSyntaxError;
  var Declaration2 = declaration;
  var LazyResult2 = lazyResult;
  var Container2 = container;
  var Processor2 = processor;
  var stringify$5 = stringify_1;
  var fromJSON = fromJSON_1;
  var Document2 = document$1$3;
  var Warning2 = warning;
  var Comment2 = comment;
  var AtRule2 = atRule;
  var Result2 = result;
  var Input2 = input;
  var parse = parse_1;
  var list = list_1;
  var Rule2 = rule;
  var Root2 = root;
  var Node2 = node;
  function postcss() {
    for (var _len = arguments.length, plugins = new Array(_len), _key = 0; _key < _len; _key++) {
      plugins[_key] = arguments[_key];
    }
    if (plugins.length === 1 && Array.isArray(plugins[0])) {
      plugins = plugins[0];
    }
    return new Processor2(plugins);
  }
  postcss.plugin = function plugin3(name, initializer) {
    var warningPrinted = false;
    function creator() {
      for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {
        args[_key] = arguments[_key];
      }
      if (console && console.warn && !warningPrinted) {
        warningPrinted = true;
        console.warn(name + ": postcss.plugin was deprecated. Migration guide:\nhttps://evilmartians.com/chronicles/postcss-8-plugin-migration");
        if (process.env.LANG && process.env.LANG.startsWith("cn")) {
          console.warn(name + ": \u91CC\u9762 postcss.plugin \u88AB\u5F03\u7528. \u8FC1\u79FB\u6307\u5357:\nhttps://www.w3ctech.com/topic/2226");
        }
      }
      var transformer = initializer.apply(void 0, [].concat(args));
      transformer.postcssPlugin = name;
      transformer.postcssVersion = new Processor2().version;
      return transformer;
    }
    var cache;
    Object.defineProperty(creator, "postcss", {
      get: function get() {
        if (!cache) cache = creator();
        return cache;
      }
    });
    creator.process = function(css, processOpts, pluginOpts) {
      return postcss([
        creator(pluginOpts)
      ]).process(css, processOpts);
    };
    return creator;
  };
  postcss.stringify = stringify$5;
  postcss.parse = parse;
  postcss.fromJSON = fromJSON;
  postcss.list = list;
  postcss.comment = function(defaults) {
    return new Comment2(defaults);
  };
  postcss.atRule = function(defaults) {
    return new AtRule2(defaults);
  };
  postcss.decl = function(defaults) {
    return new Declaration2(defaults);
  };
  postcss.rule = function(defaults) {
    return new Rule2(defaults);
  };
  postcss.root = function(defaults) {
    return new Root2(defaults);
  };
  postcss.document = function(defaults) {
    return new Document2(defaults);
  };
  postcss.CssSyntaxError = CssSyntaxError2;
  postcss.Declaration = Declaration2;
  postcss.Container = Container2;
  postcss.Processor = Processor2;
  postcss.Document = Document2;
  postcss.Comment = Comment2;
  postcss.Warning = Warning2;
  postcss.AtRule = AtRule2;
  postcss.Result = Result2;
  postcss.Input = Input2;
  postcss.Rule = Rule2;
  postcss.Root = Root2;
  postcss.Node = Node2;
  LazyResult2.registerPostcss(postcss);
  var postcss_1 = postcss;
  postcss.default = postcss;
  var postcss$1 = /* @__PURE__ */ getDefaultExportFromCjs(postcss_1);
  postcss$1.stringify;
  postcss$1.fromJSON;
  postcss$1.plugin;
  postcss$1.parse;
  postcss$1.list;
  postcss$1.document;
  postcss$1.comment;
  postcss$1.atRule;
  postcss$1.rule;
  postcss$1.decl;
  postcss$1.root;
  postcss$1.CssSyntaxError;
  postcss$1.Declaration;
  postcss$1.Container;
  postcss$1.Processor;
  postcss$1.Document;
  postcss$1.Comment;
  postcss$1.Warning;
  postcss$1.AtRule;
  postcss$1.Result;
  postcss$1.Input;
  postcss$1.Rule;
  postcss$1.Root;
  postcss$1.Node;
  var __defProp = Object.defineProperty;
  var __defNormalProp = function(obj, key, value) {
    return key in obj ? __defProp(obj, key, {
      enumerable: true,
      configurable: true,
      writable: true,
      value
    }) : obj[key] = value;
  };
  var __publicField = function(obj, key, value) {
    return __defNormalProp(obj, (typeof key === "undefined" ? "undefined" : _type_of(key)) !== "symbol" ? key + "" : key, value);
  };
  function patch(source, name, replacement) {
    try {
      if (!(name in source)) {
        return function() {
        };
      }
      var original = source[name];
      var wrapped = replacement(original);
      if (typeof wrapped === "function") {
        wrapped.prototype = wrapped.prototype || {};
        Object.defineProperties(wrapped, {
          __rrweb_original__: {
            enumerable: false,
            value: original
          }
        });
      }
      source[name] = wrapped;
      return function() {
        source[name] = original;
      };
    } catch (e3) {
      return function() {
      };
    }
  }
  var StackFrame = /* @__PURE__ */ (function() {
    function StackFrame2(obj) {
      __publicField(this, "fileName");
      __publicField(this, "functionName");
      __publicField(this, "lineNumber");
      __publicField(this, "columnNumber");
      this.fileName = obj.fileName || "";
      this.functionName = obj.functionName || "";
      this.lineNumber = obj.lineNumber;
      this.columnNumber = obj.columnNumber;
    }
    var _proto = StackFrame2.prototype;
    _proto.toString = function toString2() {
      var lineNumber = this.lineNumber || "";
      var columnNumber = this.columnNumber || "";
      if (this.functionName) return this.functionName + " (" + this.fileName + ":" + lineNumber + ":" + columnNumber + ")";
      return this.fileName + ":" + lineNumber + ":" + columnNumber;
    };
    return StackFrame2;
  })();
  var FIREFOX_SAFARI_STACK_REGEXP = /(^|@)\S+:\d+/;
  var CHROME_IE_STACK_REGEXP = /^\s*at .*(\S+:\d+|\(native\))/m;
  var SAFARI_NATIVE_CODE_REGEXP = /^(eval@)?(\[native code])?$/;
  var ErrorStackParser = {
    /**
    * Given an Error object, extract the most information from it.
    */
    parse: function parse2(error) {
      if (!error) {
        return [];
      }
      if (
        // eslint-disable-next-line @typescript-eslint/ban-ts-comment
        // @ts-ignore
        typeof error.stacktrace !== "undefined" || // eslint-disable-next-line @typescript-eslint/ban-ts-comment
        // @ts-ignore
        typeof error["opera#sourceloc"] !== "undefined"
      ) {
        return this.parseOpera(error);
      } else if (error.stack && error.stack.match(CHROME_IE_STACK_REGEXP)) {
        return this.parseV8OrIE(error);
      } else if (error.stack) {
        return this.parseFFOrSafari(error);
      } else {
        console.warn("[console-record-plugin]: Failed to parse error object:", error);
        return [];
      }
    },
    // Separate line and column numbers from a string of the form: (URI:Line:Column)
    extractLocation: function extractLocation(urlLike) {
      if (urlLike.indexOf(":") === -1) {
        return [
          urlLike
        ];
      }
      var regExp = /(.+?)(?::(\d+))?(?::(\d+))?$/;
      var parts = regExp.exec(urlLike.replace(/[()]/g, ""));
      if (!parts) throw new Error("Cannot parse given url: " + urlLike);
      return [
        parts[1],
        parts[2] || void 0,
        parts[3] || void 0
      ];
    },
    parseV8OrIE: function parseV8OrIE(error) {
      var filtered = error.stack.split("\n").filter(function(line) {
        return !!line.match(CHROME_IE_STACK_REGEXP);
      }, this);
      return filtered.map(function(line) {
        if (line.indexOf("(eval ") > -1) {
          line = line.replace(/eval code/g, "eval").replace(/(\(eval at [^()]*)|(\),.*$)/g, "");
        }
        var sanitizedLine = line.replace(/^\s+/, "").replace(/\(eval code/g, "(");
        var location = sanitizedLine.match(/ (\((.+):(\d+):(\d+)\)$)/);
        sanitizedLine = location ? sanitizedLine.replace(location[0], "") : sanitizedLine;
        var tokens = sanitizedLine.split(/\s+/).slice(1);
        var locationParts = this.extractLocation(location ? location[1] : tokens.pop());
        var functionName = tokens.join(" ") || void 0;
        var fileName = [
          "eval",
          "<anonymous>"
        ].indexOf(locationParts[0]) > -1 ? void 0 : locationParts[0];
        return new StackFrame({
          functionName,
          fileName,
          lineNumber: locationParts[1],
          columnNumber: locationParts[2]
        });
      }, this);
    },
    parseFFOrSafari: function parseFFOrSafari(error) {
      var filtered = error.stack.split("\n").filter(function(line) {
        return !line.match(SAFARI_NATIVE_CODE_REGEXP);
      }, this);
      return filtered.map(function(line) {
        if (line.indexOf(" > eval") > -1) {
          line = line.replace(/ line (\d+)(?: > eval line \d+)* > eval:\d+:\d+/g, ":$1");
        }
        if (line.indexOf("@") === -1 && line.indexOf(":") === -1) {
          return new StackFrame({
            functionName: line
          });
        } else {
          var functionNameRegex = /((.*".+"[^@]*)?[^@]*)(?:@)/;
          var matches = line.match(functionNameRegex);
          var functionName = matches && matches[1] ? matches[1] : void 0;
          var locationParts = this.extractLocation(line.replace(functionNameRegex, ""));
          return new StackFrame({
            functionName,
            fileName: locationParts[0],
            lineNumber: locationParts[1],
            columnNumber: locationParts[2]
          });
        }
      }, this);
    },
    parseOpera: function parseOpera(e3) {
      if (!e3.stacktrace || e3.message.indexOf("\n") > -1 && e3.message.split("\n").length > e3.stacktrace.split("\n").length) {
        return this.parseOpera9(e3);
      } else if (!e3.stack) {
        return this.parseOpera10(e3);
      } else {
        return this.parseOpera11(e3);
      }
    },
    parseOpera9: function parseOpera9(e3) {
      var lineRE = /Line (\d+).*script (?:in )?(\S+)/i;
      var lines = e3.message.split("\n");
      var result2 = [];
      for (var i3 = 2, len = lines.length; i3 < len; i3 += 2) {
        var match = lineRE.exec(lines[i3]);
        if (match) {
          result2.push(new StackFrame({
            fileName: match[2],
            lineNumber: parseFloat(match[1])
          }));
        }
      }
      return result2;
    },
    parseOpera10: function parseOpera10(e3) {
      var lineRE = /Line (\d+).*script (?:in )?(\S+)(?:: In function (\S+))?$/i;
      var lines = e3.stacktrace.split("\n");
      var result2 = [];
      for (var i3 = 0, len = lines.length; i3 < len; i3 += 2) {
        var match = lineRE.exec(lines[i3]);
        if (match) {
          result2.push(new StackFrame({
            functionName: match[3] || void 0,
            fileName: match[2],
            lineNumber: parseFloat(match[1])
          }));
        }
      }
      return result2;
    },
    // Opera 10.65+ Error.stack very similar to FF/Safari
    parseOpera11: function parseOpera11(error) {
      var filtered = error.stack.split("\n").filter(function(line) {
        return !!line.match(FIREFOX_SAFARI_STACK_REGEXP) && !line.match(/^Error created at/);
      }, this);
      return filtered.map(function(line) {
        var tokens = line.split("@");
        var locationParts = this.extractLocation(tokens.pop());
        var functionCall = tokens.shift() || "";
        var functionName = functionCall.replace(/<anonymous function(: (\w+))?>/, "$2").replace(/\([^)]*\)/g, "") || void 0;
        return new StackFrame({
          functionName,
          fileName: locationParts[0],
          lineNumber: locationParts[1],
          columnNumber: locationParts[2]
        });
      }, this);
    }
  };
  function pathToSelector(node2) {
    if (!node2 || !node2.outerHTML) {
      return "";
    }
    var path = "";
    while (node2.parentElement) {
      var name = node2.localName;
      if (!name) {
        break;
      }
      name = name.toLowerCase();
      var parent = node2.parentElement;
      var domSiblings = [];
      if (parent.children && parent.children.length > 0) {
        for (var i3 = 0; i3 < parent.children.length; i3++) {
          var sibling = parent.children[i3];
          if (sibling.localName && sibling.localName.toLowerCase) {
            if (sibling.localName.toLowerCase() === name) {
              domSiblings.push(sibling);
            }
          }
        }
      }
      if (domSiblings.length > 1) {
        name += ":eq(" + domSiblings.indexOf(node2) + ")";
      }
      path = name + (path ? ">" + path : "");
      node2 = parent;
    }
    return path;
  }
  function isObject(obj) {
    return Object.prototype.toString.call(obj) === "[object Object]";
  }
  function isObjTooDeep(obj, limit) {
    if (limit === 0) {
      return true;
    }
    var keys = Object.keys(obj);
    for (var _iterator = _create_for_of_iterator_helper_loose(keys), _step; !(_step = _iterator()).done; ) {
      var key = _step.value;
      if (isObject(obj[key]) && isObjTooDeep(obj[key], limit - 1)) {
        return true;
      }
    }
    return false;
  }
  function stringify(obj, stringifyOptions) {
    var options = {
      numOfKeysLimit: 50,
      depthOfLimit: 4
    };
    Object.assign(options, stringifyOptions);
    var stack = [];
    var keys = [];
    return JSON.stringify(obj, function(key, value) {
      if (stack.length > 0) {
        var thisPos = stack.indexOf(this);
        ~thisPos ? stack.splice(thisPos + 1) : stack.push(this);
        ~thisPos ? keys.splice(thisPos, Infinity, key) : keys.push(key);
        if (~stack.indexOf(value)) {
          if (stack[0] === value) {
            value = "[Circular ~]";
          } else {
            value = "[Circular ~." + keys.slice(0, stack.indexOf(value)).join(".") + "]";
          }
        }
      } else {
        stack.push(value);
      }
      if (value === null) return value;
      if (value === void 0) return "undefined";
      if (shouldIgnore(value)) {
        return toString2(value);
      }
      if ((typeof value === "undefined" ? "undefined" : _type_of(value)) === "bigint") {
        return value.toString() + "n";
      }
      if (_instanceof(value, Event)) {
        var eventResult = {};
        for (var eventKey in value) {
          var eventValue = value[eventKey];
          if (Array.isArray(eventValue)) {
            eventResult[eventKey] = pathToSelector(eventValue.length ? eventValue[0] : null);
          } else {
            eventResult[eventKey] = eventValue;
          }
        }
        return eventResult;
      } else if (_instanceof(value, Node)) {
        if (_instanceof(value, HTMLElement)) {
          return value ? value.outerHTML : "";
        }
        return value.nodeName;
      } else if (_instanceof(value, Error)) {
        return value.stack ? value.stack + "\nEnd of stack for Error object" : value.name + ": " + value.message;
      }
      return value;
    });
    function shouldIgnore(_obj) {
      if (isObject(_obj) && Object.keys(_obj).length > options.numOfKeysLimit) {
        return true;
      }
      if (typeof _obj === "function") {
        return true;
      }
      if (isObject(_obj) && isObjTooDeep(_obj, options.depthOfLimit)) {
        return true;
      }
      return false;
    }
    function toString2(_obj) {
      var str = _obj.toString();
      if (options.stringLengthLimit && str.length > options.stringLengthLimit) {
        str = "" + str.slice(0, options.stringLengthLimit) + "...";
      }
      return str;
    }
  }
  var defaultLogOptions = {
    level: [
      "assert",
      "clear",
      "count",
      "countReset",
      "debug",
      "dir",
      "dirxml",
      "error",
      "group",
      "groupCollapsed",
      "groupEnd",
      "info",
      "log",
      "table",
      "time",
      "timeEnd",
      "timeLog",
      "trace",
      "warn"
    ],
    lengthThreshold: 1e3,
    logger: "console"
  };
  function initLogObserver(cb, win2, options) {
    var logOptions = options ? Object.assign({}, defaultLogOptions, options) : defaultLogOptions;
    var loggerType = logOptions.logger;
    if (!loggerType) {
      return function() {
      };
    }
    var logger2;
    if (typeof loggerType === "string") {
      logger2 = win2[loggerType];
    } else {
      logger2 = loggerType;
    }
    var logCount = 0;
    var inStack = false;
    var cancelHandlers = [];
    if (logOptions.level.includes("error")) {
      var errorHandler2 = function(event) {
        var message = event.message, error = event.error;
        var trace = ErrorStackParser.parse(error).map(function(stackFrame) {
          return stackFrame.toString();
        });
        var payload = [
          stringify(message, logOptions.stringifyOptions)
        ];
        cb({
          level: "error",
          trace,
          payload
        });
      };
      win2.addEventListener("error", errorHandler2);
      cancelHandlers.push(function() {
        win2.removeEventListener("error", errorHandler2);
      });
      var unhandledrejectionHandler = function(event) {
        var error;
        var payload;
        if (_instanceof(event.reason, Error)) {
          error = event.reason;
          payload = [
            stringify("Uncaught (in promise) " + error.name + ": " + error.message, logOptions.stringifyOptions)
          ];
        } else {
          error = new Error();
          payload = [
            stringify("Uncaught (in promise)", logOptions.stringifyOptions),
            stringify(event.reason, logOptions.stringifyOptions)
          ];
        }
        var trace = ErrorStackParser.parse(error).map(function(stackFrame) {
          return stackFrame.toString();
        });
        cb({
          level: "error",
          trace,
          payload
        });
      };
      win2.addEventListener("unhandledrejection", unhandledrejectionHandler);
      cancelHandlers.push(function() {
        win2.removeEventListener("unhandledrejection", unhandledrejectionHandler);
      });
    }
    for (var _iterator = _create_for_of_iterator_helper_loose(logOptions.level), _step; !(_step = _iterator()).done; ) {
      var levelType = _step.value;
      cancelHandlers.push(replace(logger2, levelType));
    }
    return function() {
      cancelHandlers.forEach(function(h3) {
        return h3();
      });
    };
    function replace(_logger, level) {
      var _this = this;
      if (!_logger[level]) {
        return function() {
        };
      }
      return patch(_logger, level, function(original) {
        var _this1 = _this;
        return function() {
          for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {
            args[_key] = arguments[_key];
          }
          original.apply(_this1, args);
          if (level === "assert" && !!args[0]) {
            return;
          }
          if (inStack) {
            return;
          }
          inStack = true;
          try {
            var trace = ErrorStackParser.parse(new Error()).map(function(stackFrame) {
              return stackFrame.toString();
            }).splice(1);
            var argsForPayload = level === "assert" ? args.slice(1) : args;
            var payload = argsForPayload.map(function(s3) {
              return stringify(s3, logOptions.stringifyOptions);
            });
            logCount++;
            if (logCount < logOptions.lengthThreshold) {
              cb({
                level,
                trace,
                payload
              });
            } else if (logCount === logOptions.lengthThreshold) {
              cb({
                level: "warn",
                trace: [],
                payload: [
                  stringify("The number of log records reached the threshold.")
                ]
              });
            }
          } catch (error) {
            original.apply(void 0, [].concat([
              "rrweb logger error:",
              error
            ], args));
          } finally {
            inStack = false;
          }
        };
      });
    }
  }
  var PLUGIN_NAME = "rrweb/console@1";
  var getRecordConsolePlugin = function(options) {
    return {
      name: PLUGIN_NAME,
      observer: initLogObserver,
      options
    };
  };
  var setImmediate = win["setImmediate"];
  var builtInProp;
  var cycle;
  var schedulingQueue;
  var ToString = Object.prototype.toString;
  var timer = typeof setImmediate !== "undefined" ? function timer2(fn2) {
    return setImmediate(fn2);
  } : setTimeout;
  try {
    Object.defineProperty({}, "x", {});
    builtInProp = function builtInProp2(obj, name, val, config) {
      return Object.defineProperty(obj, name, {
        value: val,
        writable: true,
        configurable: config !== false
      });
    };
  } catch (err) {
    builtInProp = function builtInProp2(obj, name, val) {
      obj[name] = val;
      return obj;
    };
  }
  schedulingQueue = /* @__PURE__ */ (function Queue() {
    var first, last, item;
    function Item(fn2, self2) {
      this.fn = fn2;
      this.self = self2;
      this.next = void 0;
    }
    return {
      add: function add(fn2, self2) {
        item = new Item(fn2, self2);
        if (last) {
          last.next = item;
        } else {
          first = item;
        }
        last = item;
        item = void 0;
      },
      drain: function drain() {
        var f3 = first;
        first = last = cycle = void 0;
        while (f3) {
          f3.fn.call(f3.self);
          f3 = f3.next;
        }
      }
    };
  })();
  function schedule(fn2, self2) {
    schedulingQueue.add(fn2, self2);
    if (!cycle) {
      cycle = timer(schedulingQueue.drain);
    }
  }
  function isThenable(o3) {
    var _then, oType = typeof o3;
    if (o3 !== null && (oType === "object" || oType === "function")) {
      _then = o3.then;
    }
    return typeof _then === "function" ? _then : false;
  }
  function notify() {
    for (var i3 = 0; i3 < this.chain.length; i3++) {
      notifyIsolated(
        this,
        this.state === 1 ? this.chain[i3].success : this.chain[i3].failure,
        this.chain[i3]
      );
    }
    this.chain.length = 0;
  }
  function notifyIsolated(self2, cb, chain) {
    var ret, _then;
    try {
      if (cb === false) {
        chain.reject(self2.msg);
      } else {
        if (cb === true) {
          ret = self2.msg;
        } else {
          ret = cb.call(void 0, self2.msg);
        }
        if (ret === chain.promise) {
          chain.reject(TypeError("Promise-chain cycle"));
        } else if (_then = isThenable(ret)) {
          _then.call(ret, chain.resolve, chain.reject);
        } else {
          chain.resolve(ret);
        }
      }
    } catch (err) {
      chain.reject(err);
    }
  }
  function resolve(msg) {
    var _then, self2 = this;
    if (self2.triggered) {
      return;
    }
    self2.triggered = true;
    if (self2.def) {
      self2 = self2.def;
    }
    try {
      if (_then = isThenable(msg)) {
        schedule(function() {
          var defWrapper = new MakeDefWrapper(self2);
          try {
            _then.call(
              msg,
              function $resolve$() {
                resolve.apply(defWrapper, arguments);
              },
              function $reject$() {
                reject.apply(defWrapper, arguments);
              }
            );
          } catch (err) {
            reject.call(defWrapper, err);
          }
        });
      } else {
        self2.msg = msg;
        self2.state = 1;
        if (self2.chain.length > 0) {
          schedule(notify, self2);
        }
      }
    } catch (err) {
      reject.call(new MakeDefWrapper(self2), err);
    }
  }
  function reject(msg) {
    var self2 = this;
    if (self2.triggered) {
      return;
    }
    self2.triggered = true;
    if (self2.def) {
      self2 = self2.def;
    }
    self2.msg = msg;
    self2.state = 2;
    if (self2.chain.length > 0) {
      schedule(notify, self2);
    }
  }
  function iteratePromises(Constructor, arr, resolver, rejecter) {
    for (var idx = 0; idx < arr.length; idx++) {
      (function IIFE(idx2) {
        Constructor.resolve(arr[idx2]).then(
          function $resolver$(msg) {
            resolver(idx2, msg);
          },
          rejecter
        );
      })(idx);
    }
  }
  function MakeDefWrapper(self2) {
    this.def = self2;
    this.triggered = false;
  }
  function MakeDef(self2) {
    this.promise = self2;
    this.state = 0;
    this.triggered = false;
    this.chain = [];
    this.msg = void 0;
  }
  function NpoPromise(executor) {
    if (typeof executor !== "function") {
      throw TypeError("Not a function");
    }
    if (this["__NPO__"] !== 0) {
      throw TypeError("Not a promise");
    }
    this["__NPO__"] = 1;
    var def = new MakeDef(this);
    this["then"] = function then(success, failure) {
      var o3 = {
        success: typeof success === "function" ? success : true,
        failure: typeof failure === "function" ? failure : false
      };
      o3.promise = new this.constructor(function extractChain(resolve2, reject2) {
        if (typeof resolve2 !== "function" || typeof reject2 !== "function") {
          throw TypeError("Not a function");
        }
        o3.resolve = resolve2;
        o3.reject = reject2;
      });
      def.chain.push(o3);
      if (def.state !== 0) {
        schedule(notify, def);
      }
      return o3.promise;
    };
    this["catch"] = function $catch$(failure) {
      return this.then(void 0, failure);
    };
    try {
      executor.call(
        void 0,
        function publicResolve(msg) {
          resolve.call(def, msg);
        },
        function publicReject(msg) {
          reject.call(def, msg);
        }
      );
    } catch (err) {
      reject.call(def, err);
    }
  }
  var PromisePrototype = builtInProp(
    {},
    "constructor",
    NpoPromise,
    /*configurable=*/
    false
  );
  NpoPromise.prototype = PromisePrototype;
  builtInProp(
    PromisePrototype,
    "__NPO__",
    0,
    /*configurable=*/
    false
  );
  builtInProp(NpoPromise, "resolve", function Promise$resolve(msg) {
    var Constructor = this;
    if (msg && typeof msg === "object" && msg["__NPO__"] === 1) {
      return msg;
    }
    return new Constructor(function executor(resolve2, reject2) {
      if (typeof resolve2 !== "function" || typeof reject2 !== "function") {
        throw TypeError("Not a function");
      }
      resolve2(msg);
    });
  });
  builtInProp(NpoPromise, "reject", function Promise$reject(msg) {
    return new this(function executor(resolve2, reject2) {
      if (typeof resolve2 !== "function" || typeof reject2 !== "function") {
        throw TypeError("Not a function");
      }
      reject2(msg);
    });
  });
  builtInProp(NpoPromise, "all", function Promise$all(arr) {
    var Constructor = this;
    if (ToString.call(arr) !== "[object Array]") {
      return Constructor.reject(TypeError("Not an array"));
    }
    if (arr.length === 0) {
      return Constructor.resolve([]);
    }
    return new Constructor(function executor(resolve2, reject2) {
      if (typeof resolve2 !== "function" || typeof reject2 !== "function") {
        throw TypeError("Not a function");
      }
      var len = arr.length, msgs = Array(len), count = 0;
      iteratePromises(Constructor, arr, function resolver(idx, msg) {
        msgs[idx] = msg;
        if (++count === len) {
          resolve2(msgs);
        }
      }, reject2);
    });
  });
  builtInProp(NpoPromise, "race", function Promise$race(arr) {
    var Constructor = this;
    if (ToString.call(arr) !== "[object Array]") {
      return Constructor.reject(TypeError("Not an array"));
    }
    return new Constructor(function executor(resolve2, reject2) {
      if (typeof resolve2 !== "function" || typeof reject2 !== "function") {
        throw TypeError("Not a function");
      }
      iteratePromises(Constructor, arr, function resolver(idx, msg) {
        resolve2(msg);
      }, reject2);
    });
  });
  var PromisePolyfill;
  if (typeof Promise !== "undefined" && Promise.toString().indexOf("[native code]") !== -1) {
    PromisePolyfill = Promise;
  } else {
    PromisePolyfill = NpoPromise;
  }
  var Config = {
    DEBUG: false,
    LIB_VERSION: "2.74.0"
  };
  var MAX_RECORDING_MS = 24 * 60 * 60 * 1e3;
  var MAX_VALUE_FOR_MIN_RECORDING_MS = 8 * 1e3;
  var ArrayProto = Array.prototype;
  var FuncProto = Function.prototype;
  var ObjProto = Object.prototype;
  var slice = ArrayProto.slice;
  var toString = ObjProto.toString;
  var hasOwnProperty = ObjProto.hasOwnProperty;
  var windowConsole = win.console;
  var navigator = win.navigator;
  var document$1 = win.document;
  var windowOpera = win.opera;
  var screen = win.screen;
  var userAgent = navigator.userAgent;
  var nativeBind = FuncProto.bind;
  var nativeForEach = ArrayProto.forEach;
  var nativeIndexOf = ArrayProto.indexOf;
  var nativeMap = ArrayProto.map;
  var nativeIsArray = Array.isArray;
  var breaker = {};
  var _3 = {
    trim: function(str) {
      return str.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g, "");
    }
  };
  var console$1 = {
    /** @type {function(...*)} */
    log: function() {
      if (Config.DEBUG && !_3.isUndefined(windowConsole) && windowConsole) {
        try {
          windowConsole.log.apply(windowConsole, arguments);
        } catch (err) {
          _3.each(arguments, function(arg) {
            windowConsole.log(arg);
          });
        }
      }
    },
    /** @type {function(...*)} */
    warn: function() {
      if (Config.DEBUG && !_3.isUndefined(windowConsole) && windowConsole) {
        var args = ["Mixpanel warning:"].concat(_3.toArray(arguments));
        try {
          windowConsole.warn.apply(windowConsole, args);
        } catch (err) {
          _3.each(args, function(arg) {
            windowConsole.warn(arg);
          });
        }
      }
    },
    /** @type {function(...*)} */
    error: function() {
      if (Config.DEBUG && !_3.isUndefined(windowConsole) && windowConsole) {
        var args = ["Mixpanel error:"].concat(_3.toArray(arguments));
        try {
          windowConsole.error.apply(windowConsole, args);
        } catch (err) {
          _3.each(args, function(arg) {
            windowConsole.error(arg);
          });
        }
      }
    },
    /** @type {function(...*)} */
    critical: function() {
      if (!_3.isUndefined(windowConsole) && windowConsole) {
        var args = ["Mixpanel error:"].concat(_3.toArray(arguments));
        try {
          windowConsole.error.apply(windowConsole, args);
        } catch (err) {
          _3.each(args, function(arg) {
            windowConsole.error(arg);
          });
        }
      }
    }
  };
  var log_func_with_prefix = function(func, prefix) {
    return function() {
      arguments[0] = "[" + prefix + "] " + arguments[0];
      return func.apply(console$1, arguments);
    };
  };
  var console_with_prefix = function(prefix) {
    return {
      log: log_func_with_prefix(console$1.log, prefix),
      error: log_func_with_prefix(console$1.error, prefix),
      critical: log_func_with_prefix(console$1.critical, prefix)
    };
  };
  var safewrap = function(f3) {
    return function() {
      try {
        return f3.apply(this, arguments);
      } catch (e3) {
        console$1.critical("Implementation error. Please turn on debug and contact support@mixpanel.com.");
        if (Config.DEBUG) {
          console$1.critical(e3);
        }
      }
    };
  };
  var safewrapClass = function(klass) {
    var proto = klass.prototype;
    for (var func in proto) {
      if (typeof proto[func] === "function") {
        proto[func] = safewrap(proto[func]);
      }
    }
  };
  _3.bind = function(func, context) {
    var args, bound;
    if (nativeBind && func.bind === nativeBind) {
      return nativeBind.apply(func, slice.call(arguments, 1));
    }
    if (!_3.isFunction(func)) {
      throw new TypeError();
    }
    args = slice.call(arguments, 2);
    bound = function() {
      if (!(this instanceof bound)) {
        return func.apply(context, args.concat(slice.call(arguments)));
      }
      var ctor = {};
      ctor.prototype = func.prototype;
      var self2 = new ctor();
      ctor.prototype = null;
      var result2 = func.apply(self2, args.concat(slice.call(arguments)));
      if (Object(result2) === result2) {
        return result2;
      }
      return self2;
    };
    return bound;
  };
  _3.each = function(obj, iterator, context) {
    if (obj === null || obj === void 0) {
      return;
    }
    if (nativeForEach && obj.forEach === nativeForEach) {
      obj.forEach(iterator, context);
    } else if (obj.length === +obj.length) {
      for (var i3 = 0, l3 = obj.length; i3 < l3; i3++) {
        if (i3 in obj && iterator.call(context, obj[i3], i3, obj) === breaker) {
          return;
        }
      }
    } else {
      for (var key in obj) {
        if (hasOwnProperty.call(obj, key)) {
          if (iterator.call(context, obj[key], key, obj) === breaker) {
            return;
          }
        }
      }
    }
  };
  _3.extend = function(obj) {
    _3.each(slice.call(arguments, 1), function(source) {
      for (var prop in source) {
        if (source[prop] !== void 0) {
          obj[prop] = source[prop];
        }
      }
    });
    return obj;
  };
  _3.isArray = nativeIsArray || function(obj) {
    return toString.call(obj) === "[object Array]";
  };
  _3.isFunction = function(f3) {
    try {
      return /^\s*\bfunction\b/.test(f3);
    } catch (x5) {
      return false;
    }
  };
  _3.isArguments = function(obj) {
    return !!(obj && hasOwnProperty.call(obj, "callee"));
  };
  _3.toArray = function(iterable) {
    if (!iterable) {
      return [];
    }
    if (iterable.toArray) {
      return iterable.toArray();
    }
    if (_3.isArray(iterable)) {
      return slice.call(iterable);
    }
    if (_3.isArguments(iterable)) {
      return slice.call(iterable);
    }
    return _3.values(iterable);
  };
  _3.map = function(arr, callback, context) {
    if (nativeMap && arr.map === nativeMap) {
      return arr.map(callback, context);
    } else {
      var results = [];
      _3.each(arr, function(item) {
        results.push(callback.call(context, item));
      });
      return results;
    }
  };
  _3.keys = function(obj) {
    var results = [];
    if (obj === null) {
      return results;
    }
    _3.each(obj, function(value, key) {
      results[results.length] = key;
    });
    return results;
  };
  _3.values = function(obj) {
    var results = [];
    if (obj === null) {
      return results;
    }
    _3.each(obj, function(value) {
      results[results.length] = value;
    });
    return results;
  };
  _3.include = function(obj, target) {
    var found = false;
    if (obj === null) {
      return found;
    }
    if (nativeIndexOf && obj.indexOf === nativeIndexOf) {
      return obj.indexOf(target) != -1;
    }
    _3.each(obj, function(value) {
      if (found || (found = value === target)) {
        return breaker;
      }
    });
    return found;
  };
  _3.includes = function(str, needle) {
    return str.indexOf(needle) !== -1;
  };
  _3.inherit = function(subclass, superclass) {
    subclass.prototype = new superclass();
    subclass.prototype.constructor = subclass;
    subclass.superclass = superclass.prototype;
    return subclass;
  };
  _3.isObject = function(obj) {
    return obj === Object(obj) && !_3.isArray(obj);
  };
  _3.isEmptyObject = function(obj) {
    if (_3.isObject(obj)) {
      for (var key in obj) {
        if (hasOwnProperty.call(obj, key)) {
          return false;
        }
      }
      return true;
    }
    return false;
  };
  _3.isUndefined = function(obj) {
    return obj === void 0;
  };
  _3.isString = function(obj) {
    return toString.call(obj) == "[object String]";
  };
  _3.isDate = function(obj) {
    return toString.call(obj) == "[object Date]";
  };
  _3.isNumber = function(obj) {
    return toString.call(obj) == "[object Number]";
  };
  _3.isElement = function(obj) {
    return !!(obj && obj.nodeType === 1);
  };
  _3.encodeDates = function(obj) {
    _3.each(obj, function(v3, k4) {
      if (_3.isDate(v3)) {
        obj[k4] = _3.formatDate(v3);
      } else if (_3.isObject(v3)) {
        obj[k4] = _3.encodeDates(v3);
      }
    });
    return obj;
  };
  _3.timestamp = function() {
    Date.now = Date.now || function() {
      return +/* @__PURE__ */ new Date();
    };
    return Date.now();
  };
  _3.formatDate = function(d3) {
    function pad(n3) {
      return n3 < 10 ? "0" + n3 : n3;
    }
    return d3.getUTCFullYear() + "-" + pad(d3.getUTCMonth() + 1) + "-" + pad(d3.getUTCDate()) + "T" + pad(d3.getUTCHours()) + ":" + pad(d3.getUTCMinutes()) + ":" + pad(d3.getUTCSeconds());
  };
  _3.strip_empty_properties = function(p3) {
    var ret = {};
    _3.each(p3, function(v3, k4) {
      if (_3.isString(v3) && v3.length > 0) {
        ret[k4] = v3;
      }
    });
    return ret;
  };
  _3.truncate = function(obj, length) {
    var ret;
    if (typeof obj === "string") {
      ret = obj.slice(0, length);
    } else if (_3.isArray(obj)) {
      ret = [];
      _3.each(obj, function(val) {
        ret.push(_3.truncate(val, length));
      });
    } else if (_3.isObject(obj)) {
      ret = {};
      _3.each(obj, function(val, key) {
        ret[key] = _3.truncate(val, length);
      });
    } else {
      ret = obj;
    }
    return ret;
  };
  _3.JSONEncode = /* @__PURE__ */ (function() {
    return function(mixed_val) {
      var value = mixed_val;
      var quote = function(string) {
        var escapable = /[\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g;
        var meta = {
          // table of character substitutions
          "\b": "\\b",
          "	": "\\t",
          "\n": "\\n",
          "\f": "\\f",
          "\r": "\\r",
          '"': '\\"',
          "\\": "\\\\"
        };
        escapable.lastIndex = 0;
        return escapable.test(string) ? '"' + string.replace(escapable, function(a3) {
          var c3 = meta[a3];
          return typeof c3 === "string" ? c3 : "\\u" + ("0000" + a3.charCodeAt(0).toString(16)).slice(-4);
        }) + '"' : '"' + string + '"';
      };
      var str = function(key, holder) {
        var gap = "";
        var indent = "    ";
        var i3 = 0;
        var k4 = "";
        var v3 = "";
        var length = 0;
        var mind = gap;
        var partial = [];
        var value2 = holder[key];
        if (value2 && typeof value2 === "object" && typeof value2.toJSON === "function") {
          value2 = value2.toJSON(key);
        }
        switch (typeof value2) {
          case "string":
            return quote(value2);
          case "number":
            return isFinite(value2) ? String(value2) : "null";
          case "boolean":
          case "null":
            return String(value2);
          case "object":
            if (!value2) {
              return "null";
            }
            gap += indent;
            partial = [];
            if (toString.apply(value2) === "[object Array]") {
              length = value2.length;
              for (i3 = 0; i3 < length; i3 += 1) {
                partial[i3] = str(i3, value2) || "null";
              }
              v3 = partial.length === 0 ? "[]" : gap ? "[\n" + gap + partial.join(",\n" + gap) + "\n" + mind + "]" : "[" + partial.join(",") + "]";
              gap = mind;
              return v3;
            }
            for (k4 in value2) {
              if (hasOwnProperty.call(value2, k4)) {
                v3 = str(k4, value2);
                if (v3) {
                  partial.push(quote(k4) + (gap ? ": " : ":") + v3);
                }
              }
            }
            v3 = partial.length === 0 ? "{}" : gap ? "{" + partial.join(",") + mind + "}" : "{" + partial.join(",") + "}";
            gap = mind;
            return v3;
        }
      };
      return str("", {
        "": value
      });
    };
  })();
  _3.JSONDecode = (function() {
    var at, ch, escapee = {
      '"': '"',
      "\\": "\\",
      "/": "/",
      "b": "\b",
      "f": "\f",
      "n": "\n",
      "r": "\r",
      "t": "	"
    }, text, error = function(m3) {
      var e3 = new SyntaxError(m3);
      e3.at = at;
      e3.text = text;
      throw e3;
    }, next = function(c3) {
      if (c3 && c3 !== ch) {
        error("Expected '" + c3 + "' instead of '" + ch + "'");
      }
      ch = text.charAt(at);
      at += 1;
      return ch;
    }, number = function() {
      var number2, string2 = "";
      if (ch === "-") {
        string2 = "-";
        next("-");
      }
      while (ch >= "0" && ch <= "9") {
        string2 += ch;
        next();
      }
      if (ch === ".") {
        string2 += ".";
        while (next() && ch >= "0" && ch <= "9") {
          string2 += ch;
        }
      }
      if (ch === "e" || ch === "E") {
        string2 += ch;
        next();
        if (ch === "-" || ch === "+") {
          string2 += ch;
          next();
        }
        while (ch >= "0" && ch <= "9") {
          string2 += ch;
          next();
        }
      }
      number2 = +string2;
      if (!isFinite(number2)) {
        error("Bad number");
      } else {
        return number2;
      }
    }, string = function() {
      var hex, i3, string2 = "", uffff;
      if (ch === '"') {
        while (next()) {
          if (ch === '"') {
            next();
            return string2;
          }
          if (ch === "\\") {
            next();
            if (ch === "u") {
              uffff = 0;
              for (i3 = 0; i3 < 4; i3 += 1) {
                hex = parseInt(next(), 16);
                if (!isFinite(hex)) {
                  break;
                }
                uffff = uffff * 16 + hex;
              }
              string2 += String.fromCharCode(uffff);
            } else if (typeof escapee[ch] === "string") {
              string2 += escapee[ch];
            } else {
              break;
            }
          } else {
            string2 += ch;
          }
        }
      }
      error("Bad string");
    }, white = function() {
      while (ch && ch <= " ") {
        next();
      }
    }, word = function() {
      switch (ch) {
        case "t":
          next("t");
          next("r");
          next("u");
          next("e");
          return true;
        case "f":
          next("f");
          next("a");
          next("l");
          next("s");
          next("e");
          return false;
        case "n":
          next("n");
          next("u");
          next("l");
          next("l");
          return null;
      }
      error('Unexpected "' + ch + '"');
    }, value, array = function() {
      var array2 = [];
      if (ch === "[") {
        next("[");
        white();
        if (ch === "]") {
          next("]");
          return array2;
        }
        while (ch) {
          array2.push(value());
          white();
          if (ch === "]") {
            next("]");
            return array2;
          }
          next(",");
          white();
        }
      }
      error("Bad array");
    }, object = function() {
      var key, object2 = {};
      if (ch === "{") {
        next("{");
        white();
        if (ch === "}") {
          next("}");
          return object2;
        }
        while (ch) {
          key = string();
          white();
          next(":");
          if (Object.hasOwnProperty.call(object2, key)) {
            error('Duplicate key "' + key + '"');
          }
          object2[key] = value();
          white();
          if (ch === "}") {
            next("}");
            return object2;
          }
          next(",");
          white();
        }
      }
      error("Bad object");
    };
    value = function() {
      white();
      switch (ch) {
        case "{":
          return object();
        case "[":
          return array();
        case '"':
          return string();
        case "-":
          return number();
        default:
          return ch >= "0" && ch <= "9" ? number() : word();
      }
    };
    return function(source) {
      var result2;
      text = source;
      at = 0;
      ch = " ";
      result2 = value();
      white();
      if (ch) {
        error("Syntax error");
      }
      return result2;
    };
  })();
  _3.base64Encode = function(data) {
    var b64 = "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";
    var o1, o22, o3, h1, h22, h3, h4, bits, i3 = 0, ac = 0, enc = "", tmp_arr = [];
    if (!data) {
      return data;
    }
    data = _3.utf8Encode(data);
    do {
      o1 = data.charCodeAt(i3++);
      o22 = data.charCodeAt(i3++);
      o3 = data.charCodeAt(i3++);
      bits = o1 << 16 | o22 << 8 | o3;
      h1 = bits >> 18 & 63;
      h22 = bits >> 12 & 63;
      h3 = bits >> 6 & 63;
      h4 = bits & 63;
      tmp_arr[ac++] = b64.charAt(h1) + b64.charAt(h22) + b64.charAt(h3) + b64.charAt(h4);
    } while (i3 < data.length);
    enc = tmp_arr.join("");
    switch (data.length % 3) {
      case 1:
        enc = enc.slice(0, -2) + "==";
        break;
      case 2:
        enc = enc.slice(0, -1) + "=";
        break;
    }
    return enc;
  };
  _3.utf8Encode = function(string) {
    string = (string + "").replace(/\r\n/g, "\n").replace(/\r/g, "\n");
    var utftext = "", start, end;
    var stringl = 0, n3;
    start = end = 0;
    stringl = string.length;
    for (n3 = 0; n3 < stringl; n3++) {
      var c1 = string.charCodeAt(n3);
      var enc = null;
      if (c1 < 128) {
        end++;
      } else if (c1 > 127 && c1 < 2048) {
        enc = String.fromCharCode(c1 >> 6 | 192, c1 & 63 | 128);
      } else {
        enc = String.fromCharCode(c1 >> 12 | 224, c1 >> 6 & 63 | 128, c1 & 63 | 128);
      }
      if (enc !== null) {
        if (end > start) {
          utftext += string.substring(start, end);
        }
        utftext += enc;
        start = end = n3 + 1;
      }
    }
    if (end > start) {
      utftext += string.substring(start, string.length);
    }
    return utftext;
  };
  _3.UUID = function() {
    try {
      return win["crypto"]["randomUUID"]();
    } catch (err) {
      var uuid = new Array(36);
      for (var i3 = 0; i3 < 36; i3++) {
        uuid[i3] = Math.floor(Math.random() * 16);
      }
      uuid[14] = 4;
      uuid[19] = uuid[19] &= -5;
      uuid[19] = uuid[19] |= 1 << 3;
      uuid[8] = uuid[13] = uuid[18] = uuid[23] = "-";
      return _3.map(uuid, function(x5) {
        return x5.toString(16);
      }).join("");
    }
  };
  var BLOCKED_UA_STRS = [
    "ahrefsbot",
    "ahrefssiteaudit",
    "amazonbot",
    "baiduspider",
    "bingbot",
    "bingpreview",
    "chrome-lighthouse",
    "facebookexternal",
    "petalbot",
    "pinterest",
    "screaming frog",
    "yahoo! slurp",
    "yandex",
    // a whole bunch of goog-specific crawlers
    // https://developers.google.com/search/docs/advanced/crawling/overview-google-crawlers
    "adsbot-google",
    "apis-google",
    "duplexweb-google",
    "feedfetcher-google",
    "google favicon",
    "google web preview",
    "google-read-aloud",
    "googlebot",
    "googleweblight",
    "mediapartners-google",
    "storebot-google"
  ];
  _3.isBlockedUA = function(ua) {
    var i3;
    ua = ua.toLowerCase();
    for (i3 = 0; i3 < BLOCKED_UA_STRS.length; i3++) {
      if (ua.indexOf(BLOCKED_UA_STRS[i3]) !== -1) {
        return true;
      }
    }
    return false;
  };
  _3.HTTPBuildQuery = function(formdata, arg_separator) {
    var use_val, use_key, tmp_arr = [];
    if (_3.isUndefined(arg_separator)) {
      arg_separator = "&";
    }
    _3.each(formdata, function(val, key) {
      use_val = encodeURIComponent(val.toString());
      use_key = encodeURIComponent(key);
      tmp_arr[tmp_arr.length] = use_key + "=" + use_val;
    });
    return tmp_arr.join(arg_separator);
  };
  _3.getQueryParam = function(url, param) {
    param = param.replace(/[[]/g, "\\[").replace(/[\]]/g, "\\]");
    var regexS = "[\\?&]" + param + "=([^&#]*)", regex = new RegExp(regexS), results = regex.exec(url);
    if (results === null || results && typeof results[1] !== "string" && results[1].length) {
      return "";
    } else {
      var result2 = results[1];
      try {
        result2 = decodeURIComponent(result2);
      } catch (err) {
        console$1.error("Skipping decoding for malformed query param: " + result2);
      }
      return result2.replace(/\+/g, " ");
    }
  };
  _3.cookie = {
    get: function(name) {
      var nameEQ = name + "=";
      var ca = document$1.cookie.split(";");
      for (var i3 = 0; i3 < ca.length; i3++) {
        var c3 = ca[i3];
        while (c3.charAt(0) == " ") {
          c3 = c3.substring(1, c3.length);
        }
        if (c3.indexOf(nameEQ) === 0) {
          return decodeURIComponent(c3.substring(nameEQ.length, c3.length));
        }
      }
      return null;
    },
    parse: function(name) {
      var cookie;
      try {
        cookie = _3.JSONDecode(_3.cookie.get(name)) || {};
      } catch (err) {
      }
      return cookie;
    },
    set_seconds: function(name, value, seconds, is_cross_subdomain, is_secure, is_cross_site, domain_override) {
      var cdomain = "", expires = "", secure = "";
      if (domain_override) {
        cdomain = "; domain=" + domain_override;
      } else if (is_cross_subdomain) {
        var domain = extract_domain(document$1.location.hostname);
        cdomain = domain ? "; domain=." + domain : "";
      }
      if (seconds) {
        var date = /* @__PURE__ */ new Date();
        date.setTime(date.getTime() + seconds * 1e3);
        expires = "; expires=" + date.toGMTString();
      }
      if (is_cross_site) {
        is_secure = true;
        secure = "; SameSite=None";
      }
      if (is_secure) {
        secure += "; secure";
      }
      document$1.cookie = name + "=" + encodeURIComponent(value) + expires + "; path=/" + cdomain + secure;
    },
    set: function(name, value, days, is_cross_subdomain, is_secure, is_cross_site, domain_override) {
      var cdomain = "", expires = "", secure = "";
      if (domain_override) {
        cdomain = "; domain=" + domain_override;
      } else if (is_cross_subdomain) {
        var domain = extract_domain(document$1.location.hostname);
        cdomain = domain ? "; domain=." + domain : "";
      }
      if (days) {
        var date = /* @__PURE__ */ new Date();
        date.setTime(date.getTime() + days * 24 * 60 * 60 * 1e3);
        expires = "; expires=" + date.toGMTString();
      }
      if (is_cross_site) {
        is_secure = true;
        secure = "; SameSite=None";
      }
      if (is_secure) {
        secure += "; secure";
      }
      var new_cookie_val = name + "=" + encodeURIComponent(value) + expires + "; path=/" + cdomain + secure;
      document$1.cookie = new_cookie_val;
      return new_cookie_val;
    },
    remove: function(name, is_cross_subdomain, domain_override) {
      _3.cookie.set(name, "", -1, is_cross_subdomain, false, false, domain_override);
    }
  };
  var _testStorageSupported = function(storage) {
    var supported = true;
    try {
      var key = "__mplss_" + cheap_guid(8), val = "xyz";
      storage.setItem(key, val);
      if (storage.getItem(key) !== val) {
        supported = false;
      }
      storage.removeItem(key);
    } catch (err) {
      supported = false;
    }
    return supported;
  };
  var _localStorageSupported = null;
  var localStorageSupported = function(storage, forceCheck) {
    if (_localStorageSupported !== null && !forceCheck) {
      return _localStorageSupported;
    }
    return _localStorageSupported = _testStorageSupported(storage || win.localStorage);
  };
  var _sessionStorageSupported = null;
  var sessionStorageSupported = function(storage, forceCheck) {
    if (_sessionStorageSupported !== null && !forceCheck) {
      return _sessionStorageSupported;
    }
    return _sessionStorageSupported = _testStorageSupported(storage || win.sessionStorage);
  };
  function _storageWrapper(storage, name, is_supported_fn) {
    var log_error = function(msg) {
      console$1.error(name + " error: " + msg);
    };
    return {
      is_supported: function(forceCheck) {
        var supported = is_supported_fn(storage, forceCheck);
        if (!supported) {
          console$1.error(name + " unsupported");
        }
        return supported;
      },
      error: log_error,
      get: function(key) {
        try {
          return storage.getItem(key);
        } catch (err) {
          log_error(err);
        }
        return null;
      },
      parse: function(key) {
        try {
          return _3.JSONDecode(storage.getItem(key)) || {};
        } catch (err) {
        }
        return null;
      },
      set: function(key, value) {
        try {
          storage.setItem(key, value);
        } catch (err) {
          log_error(err);
        }
      },
      remove: function(key) {
        try {
          storage.removeItem(key);
        } catch (err) {
          log_error(err);
        }
      }
    };
  }
  var windowLocalStorage = null;
  var windowSessionStorage = null;
  try {
    windowLocalStorage = win.localStorage;
    windowSessionStorage = win.sessionStorage;
  } catch (_err) {
  }
  _3.localStorage = _storageWrapper(windowLocalStorage, "localStorage", localStorageSupported);
  _3.sessionStorage = _storageWrapper(windowSessionStorage, "sessionStorage", sessionStorageSupported);
  _3.register_event = (function() {
    var register_event = function(element, type, handler, oldSchool, useCapture) {
      if (!element) {
        console$1.error("No valid element provided to register_event");
        return;
      }
      if (element.addEventListener && !oldSchool) {
        element.addEventListener(type, handler, !!useCapture);
      } else {
        var ontype = "on" + type;
        var old_handler = element[ontype];
        element[ontype] = makeHandler(element, handler, old_handler);
      }
    };
    function makeHandler(element, new_handler, old_handlers) {
      var handler = function(event) {
        event = event || fixEvent(win.event);
        if (!event) {
          return void 0;
        }
        var ret = true;
        var old_result, new_result;
        if (_3.isFunction(old_handlers)) {
          old_result = old_handlers(event);
        }
        new_result = new_handler.call(element, event);
        if (false === old_result || false === new_result) {
          ret = false;
        }
        return ret;
      };
      return handler;
    }
    function fixEvent(event) {
      if (event) {
        event.preventDefault = fixEvent.preventDefault;
        event.stopPropagation = fixEvent.stopPropagation;
      }
      return event;
    }
    fixEvent.preventDefault = function() {
      this.returnValue = false;
    };
    fixEvent.stopPropagation = function() {
      this.cancelBubble = true;
    };
    return register_event;
  })();
  var TOKEN_MATCH_REGEX = new RegExp('^(\\w*)\\[(\\w+)([=~\\|\\^\\$\\*]?)=?"?([^\\]"]*)"?\\]$');
  _3.dom_query = /* @__PURE__ */ (function() {
    function getAllChildren(e3) {
      return e3.all ? e3.all : e3.getElementsByTagName("*");
    }
    var bad_whitespace = /[\t\r\n]/g;
    function hasClass(elem, selector) {
      var className = " " + selector + " ";
      return (" " + elem.className + " ").replace(bad_whitespace, " ").indexOf(className) >= 0;
    }
    function getElementsBySelector(selector) {
      if (!document$1.getElementsByTagName) {
        return [];
      }
      var tokens = selector.split(" ");
      var token, bits, tagName, found, foundCount, i3, j4, k4, elements, currentContextIndex;
      var currentContext = [document$1];
      for (i3 = 0; i3 < tokens.length; i3++) {
        token = tokens[i3].replace(/^\s+/, "").replace(/\s+$/, "");
        if (token.indexOf("#") > -1) {
          bits = token.split("#");
          tagName = bits[0];
          var id = bits[1];
          var element = document$1.getElementById(id);
          if (!element || tagName && element.nodeName.toLowerCase() != tagName) {
            return [];
          }
          currentContext = [element];
          continue;
        }
        if (token.indexOf(".") > -1) {
          bits = token.split(".");
          tagName = bits[0];
          var className = bits[1];
          if (!tagName) {
            tagName = "*";
          }
          found = [];
          foundCount = 0;
          for (j4 = 0; j4 < currentContext.length; j4++) {
            if (tagName == "*") {
              elements = getAllChildren(currentContext[j4]);
            } else {
              elements = currentContext[j4].getElementsByTagName(tagName);
            }
            for (k4 = 0; k4 < elements.length; k4++) {
              found[foundCount++] = elements[k4];
            }
          }
          currentContext = [];
          currentContextIndex = 0;
          for (j4 = 0; j4 < found.length; j4++) {
            if (found[j4].className && _3.isString(found[j4].className) && // some SVG elements have classNames which are not strings
            hasClass(found[j4], className)) {
              currentContext[currentContextIndex++] = found[j4];
            }
          }
          continue;
        }
        var token_match = token.match(TOKEN_MATCH_REGEX);
        if (token_match) {
          tagName = token_match[1];
          var attrName = token_match[2];
          var attrOperator = token_match[3];
          var attrValue = token_match[4];
          if (!tagName) {
            tagName = "*";
          }
          found = [];
          foundCount = 0;
          for (j4 = 0; j4 < currentContext.length; j4++) {
            if (tagName == "*") {
              elements = getAllChildren(currentContext[j4]);
            } else {
              elements = currentContext[j4].getElementsByTagName(tagName);
            }
            for (k4 = 0; k4 < elements.length; k4++) {
              found[foundCount++] = elements[k4];
            }
          }
          currentContext = [];
          currentContextIndex = 0;
          var checkFunction;
          switch (attrOperator) {
            case "=":
              checkFunction = function(e3) {
                return e3.getAttribute(attrName) == attrValue;
              };
              break;
            case "~":
              checkFunction = function(e3) {
                return e3.getAttribute(attrName).match(new RegExp("\\b" + attrValue + "\\b"));
              };
              break;
            case "|":
              checkFunction = function(e3) {
                return e3.getAttribute(attrName).match(new RegExp("^" + attrValue + "-?"));
              };
              break;
            case "^":
              checkFunction = function(e3) {
                return e3.getAttribute(attrName).indexOf(attrValue) === 0;
              };
              break;
            case "$":
              checkFunction = function(e3) {
                return e3.getAttribute(attrName).lastIndexOf(attrValue) == e3.getAttribute(attrName).length - attrValue.length;
              };
              break;
            case "*":
              checkFunction = function(e3) {
                return e3.getAttribute(attrName).indexOf(attrValue) > -1;
              };
              break;
            default:
              checkFunction = function(e3) {
                return e3.getAttribute(attrName);
              };
          }
          currentContext = [];
          currentContextIndex = 0;
          for (j4 = 0; j4 < found.length; j4++) {
            if (checkFunction(found[j4])) {
              currentContext[currentContextIndex++] = found[j4];
            }
          }
          continue;
        }
        tagName = token;
        found = [];
        foundCount = 0;
        for (j4 = 0; j4 < currentContext.length; j4++) {
          elements = currentContext[j4].getElementsByTagName(tagName);
          for (k4 = 0; k4 < elements.length; k4++) {
            found[foundCount++] = elements[k4];
          }
        }
        currentContext = found;
      }
      return currentContext;
    }
    return function(query) {
      if (_3.isElement(query)) {
        return [query];
      } else if (_3.isObject(query) && !_3.isUndefined(query.length)) {
        return query;
      } else {
        return getElementsBySelector.call(this, query);
      }
    };
  })();
  var CAMPAIGN_KEYWORDS = ["utm_source", "utm_medium", "utm_campaign", "utm_content", "utm_term", "utm_id", "utm_source_platform", "utm_campaign_id", "utm_creative_format", "utm_marketing_tactic"];
  var CLICK_IDS = ["dclid", "fbclid", "gclid", "ko_click_id", "li_fat_id", "msclkid", "sccid", "ttclid", "twclid", "wbraid"];
  _3.info = {
    campaignParams: function(default_value) {
      var kw = "", params = {};
      _3.each(CAMPAIGN_KEYWORDS, function(kwkey) {
        kw = _3.getQueryParam(document$1.URL, kwkey);
        if (kw.length) {
          params[kwkey] = kw;
        } else if (default_value !== void 0) {
          params[kwkey] = default_value;
        }
      });
      return params;
    },
    clickParams: function() {
      var id = "", params = {};
      _3.each(CLICK_IDS, function(idkey) {
        id = _3.getQueryParam(document$1.URL, idkey);
        if (id.length) {
          params[idkey] = id;
        }
      });
      return params;
    },
    marketingParams: function() {
      return _3.extend(_3.info.campaignParams(), _3.info.clickParams());
    },
    searchEngine: function(referrer) {
      if (referrer.search("https?://(.*)google.([^/?]*)") === 0) {
        return "google";
      } else if (referrer.search("https?://(.*)bing.com") === 0) {
        return "bing";
      } else if (referrer.search("https?://(.*)yahoo.com") === 0) {
        return "yahoo";
      } else if (referrer.search("https?://(.*)duckduckgo.com") === 0) {
        return "duckduckgo";
      } else {
        return null;
      }
    },
    searchInfo: function(referrer) {
      var search = _3.info.searchEngine(referrer), param = search != "yahoo" ? "q" : "p", ret = {};
      if (search !== null) {
        ret["$search_engine"] = search;
        var keyword = _3.getQueryParam(referrer, param);
        if (keyword.length) {
          ret["mp_keyword"] = keyword;
        }
      }
      return ret;
    },
    /**
     * This function detects which browser is running this script.
     * The order of the checks are important since many user agents
     * include key words used in later checks.
     */
    browser: function(user_agent, vendor, opera) {
      vendor = vendor || "";
      if (opera || _3.includes(user_agent, " OPR/")) {
        if (_3.includes(user_agent, "Mini")) {
          return "Opera Mini";
        }
        return "Opera";
      } else if (/(BlackBerry|PlayBook|BB10)/i.test(user_agent)) {
        return "BlackBerry";
      } else if (_3.includes(user_agent, "IEMobile") || _3.includes(user_agent, "WPDesktop")) {
        return "Internet Explorer Mobile";
      } else if (_3.includes(user_agent, "SamsungBrowser/")) {
        return "Samsung Internet";
      } else if (_3.includes(user_agent, "Edge") || _3.includes(user_agent, "Edg/")) {
        return "Microsoft Edge";
      } else if (_3.includes(user_agent, "FBIOS")) {
        return "Facebook Mobile";
      } else if (_3.includes(user_agent, "Whale/")) {
        return "Whale Browser";
      } else if (_3.includes(user_agent, "Chrome")) {
        return "Chrome";
      } else if (_3.includes(user_agent, "CriOS")) {
        return "Chrome iOS";
      } else if (_3.includes(user_agent, "UCWEB") || _3.includes(user_agent, "UCBrowser")) {
        return "UC Browser";
      } else if (_3.includes(user_agent, "FxiOS")) {
        return "Firefox iOS";
      } else if (_3.includes(vendor, "Apple")) {
        if (_3.includes(user_agent, "Mobile")) {
          return "Mobile Safari";
        }
        return "Safari";
      } else if (_3.includes(user_agent, "Android")) {
        return "Android Mobile";
      } else if (_3.includes(user_agent, "Konqueror")) {
        return "Konqueror";
      } else if (_3.includes(user_agent, "Firefox")) {
        return "Firefox";
      } else if (_3.includes(user_agent, "MSIE") || _3.includes(user_agent, "Trident/")) {
        return "Internet Explorer";
      } else if (_3.includes(user_agent, "Gecko")) {
        return "Mozilla";
      } else {
        return "";
      }
    },
    /**
     * This function detects which browser version is running this script,
     * parsing major and minor version (e.g., 42.1). User agent strings from:
     * http://www.useragentstring.com/pages/useragentstring.php
     */
    browserVersion: function(userAgent2, vendor, opera) {
      var browser = _3.info.browser(userAgent2, vendor, opera);
      var versionRegexs = {
        "Internet Explorer Mobile": /rv:(\d+(\.\d+)?)/,
        "Microsoft Edge": /Edge?\/(\d+(\.\d+)?)/,
        "Chrome": /Chrome\/(\d+(\.\d+)?)/,
        "Chrome iOS": /CriOS\/(\d+(\.\d+)?)/,
        "UC Browser": /(UCBrowser|UCWEB)\/(\d+(\.\d+)?)/,
        "Safari": /Version\/(\d+(\.\d+)?)/,
        "Mobile Safari": /Version\/(\d+(\.\d+)?)/,
        "Opera": /(Opera|OPR)\/(\d+(\.\d+)?)/,
        "Firefox": /Firefox\/(\d+(\.\d+)?)/,
        "Firefox iOS": /FxiOS\/(\d+(\.\d+)?)/,
        "Konqueror": /Konqueror:(\d+(\.\d+)?)/,
        "BlackBerry": /BlackBerry (\d+(\.\d+)?)/,
        "Android Mobile": /android\s(\d+(\.\d+)?)/,
        "Samsung Internet": /SamsungBrowser\/(\d+(\.\d+)?)/,
        "Internet Explorer": /(rv:|MSIE )(\d+(\.\d+)?)/,
        "Mozilla": /rv:(\d+(\.\d+)?)/,
        "Whale Browser": /Whale\/(\d+(\.\d+)?)/
      };
      var regex = versionRegexs[browser];
      if (regex === void 0) {
        return null;
      }
      var matches = userAgent2.match(regex);
      if (!matches) {
        return null;
      }
      return parseFloat(matches[matches.length - 2]);
    },
    os: function() {
      var a3 = userAgent;
      if (/Windows/i.test(a3)) {
        if (/Phone/.test(a3) || /WPDesktop/.test(a3)) {
          return "Windows Phone";
        }
        return "Windows";
      } else if (/(iPhone|iPad|iPod)/.test(a3)) {
        return "iOS";
      } else if (/Android/.test(a3)) {
        return "Android";
      } else if (/(BlackBerry|PlayBook|BB10)/i.test(a3)) {
        return "BlackBerry";
      } else if (/Mac/i.test(a3)) {
        return "Mac OS X";
      } else if (/Linux/.test(a3)) {
        return "Linux";
      } else if (/CrOS/.test(a3)) {
        return "Chrome OS";
      } else {
        return "";
      }
    },
    device: function(user_agent) {
      if (/Windows Phone/i.test(user_agent) || /WPDesktop/.test(user_agent)) {
        return "Windows Phone";
      } else if (/iPad/.test(user_agent)) {
        return "iPad";
      } else if (/iPod/.test(user_agent)) {
        return "iPod Touch";
      } else if (/iPhone/.test(user_agent)) {
        return "iPhone";
      } else if (/(BlackBerry|PlayBook|BB10)/i.test(user_agent)) {
        return "BlackBerry";
      } else if (/Android/.test(user_agent)) {
        return "Android";
      } else {
        return "";
      }
    },
    referringDomain: function(referrer) {
      var split4 = referrer.split("/");
      if (split4.length >= 3) {
        return split4[2];
      }
      return "";
    },
    currentUrl: function() {
      return win.location.href;
    },
    properties: function(extra_props) {
      if (typeof extra_props !== "object") {
        extra_props = {};
      }
      return _3.extend(_3.strip_empty_properties({
        "$os": _3.info.os(),
        "$browser": _3.info.browser(userAgent, navigator.vendor, windowOpera),
        "$referrer": document$1.referrer,
        "$referring_domain": _3.info.referringDomain(document$1.referrer),
        "$device": _3.info.device(userAgent)
      }), {
        "$current_url": _3.info.currentUrl(),
        "$browser_version": _3.info.browserVersion(userAgent, navigator.vendor, windowOpera),
        "$screen_height": screen.height,
        "$screen_width": screen.width,
        "mp_lib": "web",
        "$lib_version": Config.LIB_VERSION,
        "$insert_id": cheap_guid(),
        "time": _3.timestamp() / 1e3
        // epoch time in seconds
      }, _3.strip_empty_properties(extra_props));
    },
    people_properties: function() {
      return _3.extend(_3.strip_empty_properties({
        "$os": _3.info.os(),
        "$browser": _3.info.browser(userAgent, navigator.vendor, windowOpera)
      }), {
        "$browser_version": _3.info.browserVersion(userAgent, navigator.vendor, windowOpera)
      });
    },
    mpPageViewProperties: function() {
      return _3.strip_empty_properties({
        "current_page_title": document$1.title,
        "current_domain": win.location.hostname,
        "current_url_path": win.location.pathname,
        "current_url_protocol": win.location.protocol,
        "current_url_search": win.location.search
      });
    }
  };
  var batchedThrottle = function(fn2, waitMs) {
    var timeoutPromise = null;
    var throttledItems = [];
    return function(item) {
      var self2 = this;
      throttledItems.push(item);
      if (!timeoutPromise) {
        timeoutPromise = new PromisePolyfill(function(resolve2) {
          setTimeout(function() {
            var returnValue = fn2.apply(self2, [throttledItems]);
            timeoutPromise = null;
            throttledItems = [];
            resolve2(returnValue);
          }, waitMs);
        });
      }
      return timeoutPromise;
    };
  };
  var cheap_guid = function(maxlen) {
    var guid = Math.random().toString(36).substring(2, 10) + Math.random().toString(36).substring(2, 10);
    return maxlen ? guid.substring(0, maxlen) : guid;
  };
  var generateTraceparent = function() {
    var traceID = _3.UUID().replace(/-/g, "");
    var parentID = _3.UUID().replace(/-/g, "").substring(0, 16);
    var traceFlags = "01";
    return "00-" + traceID + "-" + parentID + "-" + traceFlags;
  };
  var SIMPLE_DOMAIN_MATCH_REGEX = /[a-z0-9][a-z0-9-]*\.[a-z]+$/i;
  var DOMAIN_MATCH_REGEX = /[a-z0-9][a-z0-9-]+\.[a-z.]{2,6}$/i;
  var extract_domain = function(hostname) {
    var domain_regex = DOMAIN_MATCH_REGEX;
    var parts = hostname.split(".");
    var tld = parts[parts.length - 1];
    if (tld.length > 4 || tld === "com" || tld === "org") {
      domain_regex = SIMPLE_DOMAIN_MATCH_REGEX;
    }
    var matches = hostname.match(domain_regex);
    return matches ? matches[0] : "";
  };
  var isOnline = function() {
    var onLine = win.navigator["onLine"];
    return _3.isUndefined(onLine) || onLine;
  };
  var NOOP_FUNC = function() {
  };
  var JSONStringify = null;
  var JSONParse = null;
  if (typeof JSON !== "undefined") {
    JSONStringify = JSON.stringify;
    JSONParse = JSON.parse;
  }
  JSONStringify = JSONStringify || _3.JSONEncode;
  JSONParse = JSONParse || _3.JSONDecode;
  var canUseCompressionStream = function(userAgent2, vendor, opera) {
    if (!win.CompressionStream) {
      return false;
    }
    var browser = _3.info.browser(userAgent2, vendor, opera);
    var version = _3.info.browserVersion(userAgent2, vendor, opera);
    if (browser === "Safari" || browser === "Mobile Safari") {
      if (version >= 16.4 && version < 16.6) {
        return false;
      }
    }
    return true;
  };
  _3["info"] = _3.info;
  _3["info"]["browser"] = _3.info.browser;
  _3["info"]["browserVersion"] = _3.info.browserVersion;
  _3["info"]["device"] = _3.info.device;
  _3["info"]["properties"] = _3.info.properties;
  _3["isBlockedUA"] = _3.isBlockedUA;
  _3["isEmptyObject"] = _3.isEmptyObject;
  _3["isObject"] = _3.isObject;
  _3["JSONDecode"] = _3.JSONDecode;
  _3["JSONEncode"] = _3.JSONEncode;
  _3["toArray"] = _3.toArray;
  _3["NPO"] = NpoPromise;
  var MIXPANEL_DB_NAME = "mixpanelBrowserDb";
  var RECORDING_EVENTS_STORE_NAME = "mixpanelRecordingEvents";
  var RECORDING_REGISTRY_STORE_NAME = "mixpanelRecordingRegistry";
  var DB_VERSION = 1;
  var OBJECT_STORES = [RECORDING_EVENTS_STORE_NAME, RECORDING_REGISTRY_STORE_NAME];
  var IDBStorageWrapper = function(storeName) {
    this.dbPromise = null;
    this.storeName = storeName;
  };
  IDBStorageWrapper.prototype._openDb = function() {
    return new PromisePolyfill(function(resolve2, reject2) {
      var openRequest = win.indexedDB.open(MIXPANEL_DB_NAME, DB_VERSION);
      openRequest["onerror"] = function() {
        reject2(openRequest.error);
      };
      openRequest["onsuccess"] = function() {
        resolve2(openRequest.result);
      };
      openRequest["onupgradeneeded"] = function(ev) {
        var db = ev.target.result;
        OBJECT_STORES.forEach(function(storeName) {
          db.createObjectStore(storeName);
        });
      };
    });
  };
  IDBStorageWrapper.prototype.init = function() {
    if (!win.indexedDB) {
      return PromisePolyfill.reject("indexedDB is not supported in this browser");
    }
    if (!this.dbPromise) {
      this.dbPromise = this._openDb();
    }
    return this.dbPromise.then(function(dbOrError) {
      if (dbOrError instanceof win["IDBDatabase"]) {
        return PromisePolyfill.resolve();
      } else {
        return PromisePolyfill.reject(dbOrError);
      }
    });
  };
  IDBStorageWrapper.prototype.isInitialized = function() {
    return !!this.dbPromise;
  };
  IDBStorageWrapper.prototype.makeTransaction = function(mode, storeCb) {
    var storeName = this.storeName;
    var doTransaction = function(db) {
      return new PromisePolyfill(function(resolve2, reject2) {
        var transaction = db.transaction(storeName, mode);
        transaction.oncomplete = function() {
          resolve2(transaction);
        };
        transaction.onabort = transaction.onerror = function() {
          reject2(transaction.error);
        };
        storeCb(transaction.objectStore(storeName));
      });
    };
    return this.dbPromise.then(doTransaction).catch(function(err) {
      if (err && err["name"] === "InvalidStateError") {
        this.dbPromise = this._openDb();
        return this.dbPromise.then(doTransaction);
      } else {
        return PromisePolyfill.reject(err);
      }
    }.bind(this));
  };
  IDBStorageWrapper.prototype.setItem = function(key, value) {
    return this.makeTransaction("readwrite", function(objectStore) {
      objectStore.put(value, key);
    });
  };
  IDBStorageWrapper.prototype.getItem = function(key) {
    var req;
    return this.makeTransaction("readonly", function(objectStore) {
      req = objectStore.get(key);
    }).then(function() {
      return req.result;
    });
  };
  IDBStorageWrapper.prototype.removeItem = function(key) {
    return this.makeTransaction("readwrite", function(objectStore) {
      objectStore.delete(key);
    });
  };
  IDBStorageWrapper.prototype.getAll = function() {
    var req;
    return this.makeTransaction("readonly", function(objectStore) {
      req = objectStore.getAll();
    }).then(function() {
      return req.result;
    });
  };
  var GDPR_DEFAULT_PERSISTENCE_PREFIX = "__mp_opt_in_out_";
  function optIn(token, options) {
    _optInOut(true, token, options);
  }
  function optOut(token, options) {
    _optInOut(false, token, options);
  }
  function hasOptedIn(token, options) {
    return _getStorageValue(token, options) === "1";
  }
  function hasOptedOut(token, options) {
    if (_hasDoNotTrackFlagOn(options)) {
      console$1.warn('This browser has "Do Not Track" enabled. This will prevent the Mixpanel SDK from sending any data. To ignore the "Do Not Track" browser setting, initialize the Mixpanel instance with the config "ignore_dnt: true"');
      return true;
    }
    var optedOut = _getStorageValue(token, options) === "0";
    if (optedOut) {
      console$1.warn("You are opted out of Mixpanel tracking. This will prevent the Mixpanel SDK from sending any data.");
    }
    return optedOut;
  }
  function addOptOutCheckMixpanelLib(method) {
    return _addOptOutCheck(method, function(name) {
      return this.get_config(name);
    });
  }
  function addOptOutCheckMixpanelPeople(method) {
    return _addOptOutCheck(method, function(name) {
      return this._get_config(name);
    });
  }
  function addOptOutCheckMixpanelGroup(method) {
    return _addOptOutCheck(method, function(name) {
      return this._get_config(name);
    });
  }
  function clearOptInOut(token, options) {
    options = options || {};
    _getStorage(options).remove(
      _getStorageKey(token, options),
      !!options.crossSubdomainCookie,
      options.cookieDomain
    );
  }
  function _getStorage(options) {
    options = options || {};
    return options.persistenceType === "localStorage" ? _3.localStorage : _3.cookie;
  }
  function _getStorageKey(token, options) {
    options = options || {};
    return (options.persistencePrefix || GDPR_DEFAULT_PERSISTENCE_PREFIX) + token;
  }
  function _getStorageValue(token, options) {
    return _getStorage(options).get(_getStorageKey(token, options));
  }
  function _hasDoNotTrackFlagOn(options) {
    if (options && options.ignoreDnt) {
      return false;
    }
    var win$1 = options && options.window || win;
    var nav = win$1["navigator"] || {};
    var hasDntOn = false;
    _3.each([
      nav["doNotTrack"],
      // standard
      nav["msDoNotTrack"],
      win$1["doNotTrack"]
    ], function(dntValue) {
      if (_3.includes([true, 1, "1", "yes"], dntValue)) {
        hasDntOn = true;
      }
    });
    return hasDntOn;
  }
  function _optInOut(optValue, token, options) {
    if (!_3.isString(token) || !token.length) {
      console$1.error("gdpr." + (optValue ? "optIn" : "optOut") + " called with an invalid token");
      return;
    }
    options = options || {};
    _getStorage(options).set(
      _getStorageKey(token, options),
      optValue ? 1 : 0,
      _3.isNumber(options.cookieExpiration) ? options.cookieExpiration : null,
      !!options.crossSubdomainCookie,
      !!options.secureCookie,
      !!options.crossSiteCookie,
      options.cookieDomain
    );
    if (options.track && optValue) {
      options.track(options.trackEventName || "$opt_in", options.trackProperties, {
        "send_immediately": true
      });
    }
  }
  function _addOptOutCheck(method, getConfigValue) {
    return function() {
      var optedOut = false;
      try {
        var token = getConfigValue.call(this, "token");
        var ignoreDnt = getConfigValue.call(this, "ignore_dnt");
        var persistenceType = getConfigValue.call(this, "opt_out_tracking_persistence_type");
        var persistencePrefix = getConfigValue.call(this, "opt_out_tracking_cookie_prefix");
        var win2 = getConfigValue.call(this, "window");
        if (token) {
          optedOut = hasOptedOut(token, {
            ignoreDnt,
            persistenceType,
            persistencePrefix,
            window: win2
          });
        }
      } catch (err) {
        console$1.error("Unexpected error when checking tracking opt-out status: " + err);
      }
      if (!optedOut) {
        return method.apply(this, arguments);
      }
      var callback = arguments[arguments.length - 1];
      if (typeof callback === "function") {
        callback(0);
      }
      return;
    };
  }
  var logger$6 = console_with_prefix("lock");
  var SharedLock = function(key, options) {
    options = options || {};
    this.storageKey = key;
    this.storage = options.storage || win.localStorage;
    this.pollIntervalMS = options.pollIntervalMS || 100;
    this.timeoutMS = options.timeoutMS || 2e3;
    this.promiseImpl = options.promiseImpl || PromisePolyfill;
  };
  SharedLock.prototype.withLock = function(lockedCB, pid) {
    var Promise2 = this.promiseImpl;
    return new Promise2(_3.bind(function(resolve2, reject2) {
      var i3 = pid || (/* @__PURE__ */ new Date()).getTime() + "|" + Math.random();
      var startTime = (/* @__PURE__ */ new Date()).getTime();
      var key = this.storageKey;
      var pollIntervalMS = this.pollIntervalMS;
      var timeoutMS = this.timeoutMS;
      var storage = this.storage;
      var keyX = key + ":X";
      var keyY = key + ":Y";
      var keyZ = key + ":Z";
      var delay = function(cb) {
        if ((/* @__PURE__ */ new Date()).getTime() - startTime > timeoutMS) {
          logger$6.error("Timeout waiting for mutex on " + key + "; clearing lock. [" + i3 + "]");
          storage.removeItem(keyZ);
          storage.removeItem(keyY);
          loop();
          return;
        }
        setTimeout(function() {
          try {
            cb();
          } catch (err) {
            reject2(err);
          }
        }, pollIntervalMS * (Math.random() + 0.1));
      };
      var waitFor = function(predicate, cb) {
        if (predicate()) {
          cb();
        } else {
          delay(function() {
            waitFor(predicate, cb);
          });
        }
      };
      var getSetY = function() {
        var valY = storage.getItem(keyY);
        if (valY && valY !== i3) {
          return false;
        } else {
          storage.setItem(keyY, i3);
          if (storage.getItem(keyY) === i3) {
            return true;
          } else {
            if (!localStorageSupported(storage, true)) {
              reject2(new Error("localStorage support dropped while acquiring lock"));
            }
            return false;
          }
        }
      };
      var loop = function() {
        storage.setItem(keyX, i3);
        waitFor(getSetY, function() {
          if (storage.getItem(keyX) === i3) {
            criticalSection();
            return;
          }
          delay(function() {
            if (storage.getItem(keyY) !== i3) {
              loop();
              return;
            }
            waitFor(function() {
              return !storage.getItem(keyZ);
            }, criticalSection);
          });
        });
      };
      var criticalSection = function() {
        storage.setItem(keyZ, "1");
        var removeLock = function() {
          storage.removeItem(keyZ);
          if (storage.getItem(keyY) === i3) {
            storage.removeItem(keyY);
          }
          if (storage.getItem(keyX) === i3) {
            storage.removeItem(keyX);
          }
        };
        lockedCB().then(function(ret) {
          removeLock();
          resolve2(ret);
        }).catch(function(err) {
          removeLock();
          reject2(err);
        });
      };
      try {
        if (localStorageSupported(storage, true)) {
          loop();
        } else {
          throw new Error("localStorage support check failed");
        }
      } catch (err) {
        reject2(err);
      }
    }, this));
  };
  var LocalStorageWrapper = function(storageOverride) {
    this.storage = storageOverride || win.localStorage;
  };
  LocalStorageWrapper.prototype.init = function() {
    return PromisePolyfill.resolve();
  };
  LocalStorageWrapper.prototype.isInitialized = function() {
    return true;
  };
  LocalStorageWrapper.prototype.setItem = function(key, value) {
    return new PromisePolyfill(_3.bind(function(resolve2, reject2) {
      try {
        this.storage.setItem(key, JSONStringify(value));
      } catch (e3) {
        reject2(e3);
      }
      resolve2();
    }, this));
  };
  LocalStorageWrapper.prototype.getItem = function(key) {
    return new PromisePolyfill(_3.bind(function(resolve2, reject2) {
      var item;
      try {
        item = JSONParse(this.storage.getItem(key));
      } catch (e3) {
        reject2(e3);
      }
      resolve2(item);
    }, this));
  };
  LocalStorageWrapper.prototype.removeItem = function(key) {
    return new PromisePolyfill(_3.bind(function(resolve2, reject2) {
      try {
        this.storage.removeItem(key);
      } catch (e3) {
        reject2(e3);
      }
      resolve2();
    }, this));
  };
  var logger$5 = console_with_prefix("batch");
  var RequestQueue = function(storageKey, options) {
    options = options || {};
    this.storageKey = storageKey;
    this.usePersistence = options.usePersistence;
    if (this.usePersistence) {
      this.queueStorage = options.queueStorage || new LocalStorageWrapper();
      this.lock = new SharedLock(storageKey, {
        storage: options.sharedLockStorage || win.localStorage,
        timeoutMS: options.sharedLockTimeoutMS
      });
    }
    this.reportError = options.errorReporter || _3.bind(logger$5.error, logger$5);
    this.pid = options.pid || null;
    this.memQueue = [];
    this.initialized = false;
    if (options.enqueueThrottleMs) {
      this.enqueuePersisted = batchedThrottle(_3.bind(this._enqueuePersisted, this), options.enqueueThrottleMs);
    } else {
      this.enqueuePersisted = _3.bind(function(queueEntry) {
        return this._enqueuePersisted([queueEntry]);
      }, this);
    }
  };
  RequestQueue.prototype.ensureInit = function() {
    if (this.initialized || !this.usePersistence) {
      return PromisePolyfill.resolve();
    }
    return this.queueStorage.init().then(_3.bind(function() {
      this.initialized = true;
    }, this)).catch(_3.bind(function(err) {
      this.reportError("Error initializing queue persistence. Disabling persistence", err);
      this.initialized = true;
      this.usePersistence = false;
    }, this));
  };
  RequestQueue.prototype.enqueue = function(item, flushInterval) {
    var queueEntry = {
      "id": cheap_guid(),
      "flushAfter": (/* @__PURE__ */ new Date()).getTime() + flushInterval * 2,
      "payload": item
    };
    if (!this.usePersistence) {
      this.memQueue.push(queueEntry);
      return PromisePolyfill.resolve(true);
    } else {
      return this.enqueuePersisted(queueEntry);
    }
  };
  RequestQueue.prototype._enqueuePersisted = function(queueEntries) {
    var enqueueItem = _3.bind(function() {
      return this.ensureInit().then(_3.bind(function() {
        return this.readFromStorage();
      }, this)).then(_3.bind(function(storedQueue) {
        return this.saveToStorage(storedQueue.concat(queueEntries));
      }, this)).then(_3.bind(function(succeeded) {
        if (succeeded) {
          this.memQueue = this.memQueue.concat(queueEntries);
        }
        return succeeded;
      }, this)).catch(_3.bind(function(err) {
        this.reportError("Error enqueueing items", err, queueEntries);
        return false;
      }, this));
    }, this);
    return this.lock.withLock(enqueueItem, this.pid).catch(_3.bind(function(err) {
      this.reportError("Error acquiring storage lock", err);
      return false;
    }, this));
  };
  RequestQueue.prototype.fillBatch = function(batchSize) {
    var batch = this.memQueue.slice(0, batchSize);
    if (this.usePersistence && batch.length < batchSize) {
      return this.ensureInit().then(_3.bind(function() {
        return this.readFromStorage();
      }, this)).then(_3.bind(function(storedQueue) {
        if (storedQueue.length) {
          var idsInBatch = {};
          _3.each(batch, function(item2) {
            idsInBatch[item2["id"]] = true;
          });
          for (var i3 = 0; i3 < storedQueue.length; i3++) {
            var item = storedQueue[i3];
            if ((/* @__PURE__ */ new Date()).getTime() > item["flushAfter"] && !idsInBatch[item["id"]]) {
              item.orphaned = true;
              batch.push(item);
              if (batch.length >= batchSize) {
                break;
              }
            }
          }
        }
        return batch;
      }, this));
    } else {
      return PromisePolyfill.resolve(batch);
    }
  };
  var filterOutIDsAndInvalid = function(items, idSet) {
    var filteredItems = [];
    _3.each(items, function(item) {
      if (item["id"] && !idSet[item["id"]]) {
        filteredItems.push(item);
      }
    });
    return filteredItems;
  };
  RequestQueue.prototype.removeItemsByID = function(ids) {
    var idSet = {};
    _3.each(ids, function(id) {
      idSet[id] = true;
    });
    this.memQueue = filterOutIDsAndInvalid(this.memQueue, idSet);
    if (!this.usePersistence) {
      return PromisePolyfill.resolve(true);
    } else {
      var removeFromStorage = _3.bind(function() {
        return this.ensureInit().then(_3.bind(function() {
          return this.readFromStorage();
        }, this)).then(_3.bind(function(storedQueue) {
          storedQueue = filterOutIDsAndInvalid(storedQueue, idSet);
          return this.saveToStorage(storedQueue);
        }, this)).then(_3.bind(function() {
          return this.readFromStorage();
        }, this)).then(_3.bind(function(storedQueue) {
          for (var i3 = 0; i3 < storedQueue.length; i3++) {
            var item = storedQueue[i3];
            if (item["id"] && !!idSet[item["id"]]) {
              throw new Error("Item not removed from storage");
            }
          }
          return true;
        }, this)).catch(_3.bind(function(err) {
          this.reportError("Error removing items", err, ids);
          return false;
        }, this));
      }, this);
      return this.lock.withLock(removeFromStorage, this.pid).catch(_3.bind(function(err) {
        this.reportError("Error acquiring storage lock", err);
        if (!localStorageSupported(this.lock.storage, true)) {
          return removeFromStorage().then(_3.bind(function(success) {
            if (!success) {
              return this.queueStorage.removeItem(this.storageKey).then(function() {
                return success;
              });
            }
            return success;
          }, this)).catch(_3.bind(function(err2) {
            this.reportError("Error clearing queue", err2);
            return false;
          }, this));
        } else {
          return false;
        }
      }, this));
    }
  };
  var updatePayloads = function(existingItems, itemsToUpdate) {
    var newItems = [];
    _3.each(existingItems, function(item) {
      var id = item["id"];
      if (id in itemsToUpdate) {
        var newPayload = itemsToUpdate[id];
        if (newPayload !== null) {
          item["payload"] = newPayload;
          newItems.push(item);
        }
      } else {
        newItems.push(item);
      }
    });
    return newItems;
  };
  RequestQueue.prototype.updatePayloads = function(itemsToUpdate) {
    this.memQueue = updatePayloads(this.memQueue, itemsToUpdate);
    if (!this.usePersistence) {
      return PromisePolyfill.resolve(true);
    } else {
      return this.lock.withLock(_3.bind(function lockAcquired() {
        return this.ensureInit().then(_3.bind(function() {
          return this.readFromStorage();
        }, this)).then(_3.bind(function(storedQueue) {
          storedQueue = updatePayloads(storedQueue, itemsToUpdate);
          return this.saveToStorage(storedQueue);
        }, this)).catch(_3.bind(function(err) {
          this.reportError("Error updating items", itemsToUpdate, err);
          return false;
        }, this));
      }, this), this.pid).catch(_3.bind(function(err) {
        this.reportError("Error acquiring storage lock", err);
        return false;
      }, this));
    }
  };
  RequestQueue.prototype.readFromStorage = function() {
    return this.ensureInit().then(_3.bind(function() {
      return this.queueStorage.getItem(this.storageKey);
    }, this)).then(_3.bind(function(storageEntry) {
      if (storageEntry) {
        if (!_3.isArray(storageEntry)) {
          this.reportError("Invalid storage entry:", storageEntry);
          storageEntry = null;
        }
      }
      return storageEntry || [];
    }, this)).catch(_3.bind(function(err) {
      this.reportError("Error retrieving queue", err);
      return [];
    }, this));
  };
  RequestQueue.prototype.saveToStorage = function(queue) {
    return this.ensureInit().then(_3.bind(function() {
      return this.queueStorage.setItem(this.storageKey, queue);
    }, this)).then(function() {
      return true;
    }).catch(_3.bind(function(err) {
      this.reportError("Error saving queue", err);
      return false;
    }, this));
  };
  RequestQueue.prototype.clear = function() {
    this.memQueue = [];
    if (this.usePersistence) {
      return this.ensureInit().then(_3.bind(function() {
        return this.queueStorage.removeItem(this.storageKey);
      }, this));
    } else {
      return PromisePolyfill.resolve();
    }
  };
  var MAX_RETRY_INTERVAL_MS = 10 * 60 * 1e3;
  var logger$4 = console_with_prefix("batch");
  var RequestBatcher = function(storageKey, options) {
    this.errorReporter = options.errorReporter;
    this.queue = new RequestQueue(storageKey, {
      errorReporter: _3.bind(this.reportError, this),
      queueStorage: options.queueStorage,
      sharedLockStorage: options.sharedLockStorage,
      sharedLockTimeoutMS: options.sharedLockTimeoutMS,
      usePersistence: options.usePersistence,
      enqueueThrottleMs: options.enqueueThrottleMs
    });
    this.libConfig = options.libConfig;
    this.sendRequest = options.sendRequestFunc;
    this.beforeSendHook = options.beforeSendHook;
    this.stopAllBatching = options.stopAllBatchingFunc;
    this.batchSize = this.libConfig["batch_size"];
    this.flushInterval = this.libConfig["batch_flush_interval_ms"];
    this.stopped = !this.libConfig["batch_autostart"];
    this.consecutiveRemovalFailures = 0;
    this.itemIdsSentSuccessfully = {};
    this.flushOnlyOnInterval = options.flushOnlyOnInterval || false;
    this._flushPromise = null;
  };
  RequestBatcher.prototype.enqueue = function(item) {
    return this.queue.enqueue(item, this.flushInterval);
  };
  RequestBatcher.prototype.start = function() {
    this.stopped = false;
    this.consecutiveRemovalFailures = 0;
    return this.flush();
  };
  RequestBatcher.prototype.stop = function() {
    this.stopped = true;
    if (this.timeoutID) {
      clearTimeout(this.timeoutID);
      this.timeoutID = null;
    }
  };
  RequestBatcher.prototype.clear = function() {
    return this.queue.clear();
  };
  RequestBatcher.prototype.resetBatchSize = function() {
    this.batchSize = this.libConfig["batch_size"];
  };
  RequestBatcher.prototype.resetFlush = function() {
    this.scheduleFlush(this.libConfig["batch_flush_interval_ms"]);
  };
  RequestBatcher.prototype.scheduleFlush = function(flushMS) {
    this.flushInterval = flushMS;
    if (!this.stopped) {
      this.timeoutID = setTimeout(_3.bind(function() {
        if (!this.stopped) {
          this._flushPromise = this.flush();
        }
      }, this), this.flushInterval);
    }
  };
  RequestBatcher.prototype.sendRequestPromise = function(data, options) {
    return new PromisePolyfill(_3.bind(function(resolve2) {
      this.sendRequest(data, options, resolve2);
    }, this));
  };
  RequestBatcher.prototype.flush = function(options) {
    if (this.requestInProgress) {
      logger$4.log("Flush: Request already in progress");
      return PromisePolyfill.resolve();
    }
    this.requestInProgress = true;
    options = options || {};
    var timeoutMS = this.libConfig["batch_request_timeout_ms"];
    var startTime = (/* @__PURE__ */ new Date()).getTime();
    var currentBatchSize = this.batchSize;
    return this.queue.fillBatch(currentBatchSize).then(_3.bind(function(batch) {
      var attemptSecondaryFlush = batch.length === currentBatchSize;
      var dataForRequest = [];
      var transformedItems = {};
      _3.each(batch, function(item) {
        var payload = item["payload"];
        if (this.beforeSendHook && !item.orphaned) {
          payload = this.beforeSendHook(payload);
        }
        if (payload) {
          if (payload["event"] && payload["properties"]) {
            payload["properties"] = _3.extend(
              {},
              payload["properties"],
              { "mp_sent_by_lib_version": Config.LIB_VERSION }
            );
          }
          var addPayload = true;
          var itemId = item["id"];
          if (itemId) {
            if ((this.itemIdsSentSuccessfully[itemId] || 0) > 5) {
              this.reportError("[dupe] item ID sent too many times, not sending", {
                item,
                batchSize: batch.length,
                timesSent: this.itemIdsSentSuccessfully[itemId]
              });
              addPayload = false;
            }
          } else {
            this.reportError("[dupe] found item with no ID", { item });
          }
          if (addPayload) {
            dataForRequest.push(payload);
          }
        }
        transformedItems[item["id"]] = payload;
      }, this);
      if (dataForRequest.length < 1) {
        this.requestInProgress = false;
        this.resetFlush();
        return PromisePolyfill.resolve();
      }
      var removeItemsFromQueue = _3.bind(function() {
        return this.queue.removeItemsByID(
          _3.map(batch, function(item) {
            return item["id"];
          })
        ).then(_3.bind(function(succeeded) {
          _3.each(batch, _3.bind(function(item) {
            var itemId = item["id"];
            if (itemId) {
              this.itemIdsSentSuccessfully[itemId] = this.itemIdsSentSuccessfully[itemId] || 0;
              this.itemIdsSentSuccessfully[itemId]++;
              if (this.itemIdsSentSuccessfully[itemId] > 5) {
                this.reportError("[dupe] item ID sent too many times", {
                  item,
                  batchSize: batch.length,
                  timesSent: this.itemIdsSentSuccessfully[itemId]
                });
              }
            } else {
              this.reportError("[dupe] found item with no ID while removing", { item });
            }
          }, this));
          if (succeeded) {
            this.consecutiveRemovalFailures = 0;
            if (this.flushOnlyOnInterval && !attemptSecondaryFlush) {
              this.resetFlush();
              return PromisePolyfill.resolve();
            } else {
              return this.flush();
            }
          } else {
            if (++this.consecutiveRemovalFailures > 5) {
              this.reportError("Too many queue failures; disabling batching system.");
              this.stopAllBatching();
            } else {
              this.resetFlush();
            }
            return PromisePolyfill.resolve();
          }
        }, this));
      }, this);
      var batchSendCallback = _3.bind(function(res) {
        this.requestInProgress = false;
        try {
          if (options.unloading) {
            return this.queue.updatePayloads(transformedItems);
          } else if (_3.isObject(res) && res.error === "timeout" && (/* @__PURE__ */ new Date()).getTime() - startTime >= timeoutMS) {
            this.reportError("Network timeout; retrying");
            return this.flush();
          } else if (_3.isObject(res) && (res.httpStatusCode >= 500 || res.httpStatusCode === 429 || res.httpStatusCode <= 0 && !isOnline() || res.error === "timeout")) {
            var retryMS = this.flushInterval * 2;
            if (res.retryAfter) {
              retryMS = parseInt(res.retryAfter, 10) * 1e3 || retryMS;
            }
            retryMS = Math.min(MAX_RETRY_INTERVAL_MS, retryMS);
            this.reportError("Error; retry in " + retryMS + " ms");
            this.scheduleFlush(retryMS);
            return PromisePolyfill.resolve();
          } else if (_3.isObject(res) && res.httpStatusCode === 413) {
            if (batch.length > 1) {
              var halvedBatchSize = Math.max(1, Math.floor(currentBatchSize / 2));
              this.batchSize = Math.min(this.batchSize, halvedBatchSize, batch.length - 1);
              this.reportError("413 response; reducing batch size to " + this.batchSize);
              this.resetFlush();
              return PromisePolyfill.resolve();
            } else {
              this.reportError("Single-event request too large; dropping", batch);
              this.resetBatchSize();
              return removeItemsFromQueue();
            }
          } else {
            return removeItemsFromQueue();
          }
        } catch (err) {
          this.reportError("Error handling API response", err);
          this.resetFlush();
        }
      }, this);
      var requestOptions = {
        method: "POST",
        verbose: true,
        ignore_json_errors: true,
        // eslint-disable-line camelcase
        timeout_ms: timeoutMS
        // eslint-disable-line camelcase
      };
      if (options.unloading) {
        requestOptions.transport = "sendBeacon";
      }
      logger$4.log("MIXPANEL REQUEST:", dataForRequest);
      return this.sendRequestPromise(dataForRequest, requestOptions).then(batchSendCallback);
    }, this)).catch(_3.bind(function(err) {
      this.reportError("Error flushing request queue", err);
      this.resetFlush();
    }, this));
  };
  RequestBatcher.prototype.reportError = function(msg, err) {
    logger$4.error.apply(logger$4.error, arguments);
    if (this.errorReporter) {
      try {
        if (!(err instanceof Error)) {
          err = new Error(msg);
        }
        this.errorReporter(msg, err);
      } catch (err2) {
        logger$4.error(err2);
      }
    }
  };
  var isRecordingExpired = function(serializedRecording) {
    var now = Date.now();
    return !serializedRecording || now > serializedRecording["maxExpires"] || now > serializedRecording["idleExpires"];
  };
  var RECORD_ENQUEUE_THROTTLE_MS = 250;
  var EV_CHANGE = "change";
  var EV_CLICK = "click";
  var EV_HASHCHANGE = "hashchange";
  var EV_INPUT = "input";
  var EV_LOAD = "load";
  var EV_MP_LOCATION_CHANGE = "mp_locationchange";
  var EV_POPSTATE = "popstate";
  var EV_SCROLLEND = "scrollend";
  var EV_SCROLL = "scroll";
  var EV_SELECT = "select";
  var EV_SUBMIT = "submit";
  var EV_TOGGLE = "toggle";
  var EV_VISIBILITYCHANGE = "visibilitychange";
  var CLICK_EVENT_PROPS = [
    "clientX",
    "clientY",
    "offsetX",
    "offsetY",
    "pageX",
    "pageY",
    "screenX",
    "screenY",
    "x",
    "y"
  ];
  var OPT_IN_CLASSES = ["mp-include"];
  var OPT_OUT_CLASSES = ["mp-no-track"];
  var SENSITIVE_DATA_CLASSES = OPT_OUT_CLASSES.concat(["mp-sensitive"]);
  var TRACKED_ATTRS = [
    "aria-label",
    "aria-labelledby",
    "aria-describedby",
    "href",
    "name",
    "role",
    "title",
    "type"
  ];
  var INTERACTIVE_ARIA_ROLES = {
    "button": true,
    "checkbox": true,
    "combobox": true,
    "grid": true,
    "link": true,
    "listbox": true,
    "menu": true,
    "menubar": true,
    "menuitem": true,
    "menuitemcheckbox": true,
    "menuitemradio": true,
    "navigation": true,
    "option": true,
    "radio": true,
    "radiogroup": true,
    "searchbox": true,
    "slider": true,
    "spinbutton": true,
    "switch": true,
    "tab": true,
    "tablist": true,
    "textbox": true,
    "tree": true,
    "treegrid": true,
    "treeitem": true
  };
  var ALWAYS_NON_INTERACTIVE_TAGS = {
    // Document metadata
    "base": true,
    "head": true,
    "html": true,
    "link": true,
    "meta": true,
    "script": true,
    "style": true,
    "title": true,
    // Text formatting
    "br": true,
    "hr": true,
    "wbr": true,
    // Other
    "noscript": true,
    "picture": true,
    "source": true,
    "template": true,
    "track": true
  };
  var TEXT_CONTAINER_TAGS = {
    "article": true,
    "div": true,
    "h1": true,
    "h2": true,
    "h3": true,
    "h4": true,
    "h5": true,
    "h6": true,
    "p": true,
    "section": true,
    "span": true
  };
  var EVENT_HANDLER_ATTRIBUTES = [
    "onclick",
    "onmousedown",
    "onmouseup",
    "onpointerdown",
    "onpointerup",
    "ontouchend",
    "ontouchstart"
  ];
  var MAX_DEPTH = 5;
  var logger$3 = console_with_prefix("autocapture");
  function getClasses(el) {
    var classes = {};
    var classList = getClassName(el).split(" ");
    for (var i3 = 0; i3 < classList.length; i3++) {
      var cls = classList[i3];
      if (cls) {
        classes[cls] = true;
      }
    }
    return classes;
  }
  function getClassName(el) {
    switch (typeof el.className) {
      case "string":
        return el.className;
      case "object":
        return el.className.baseVal || el.getAttribute("class") || "";
      default:
        return "";
    }
  }
  function getPreviousElementSibling(el) {
    if (el.previousElementSibling) {
      return el.previousElementSibling;
    } else {
      do {
        el = el.previousSibling;
      } while (el && !isElementNode(el));
      return el;
    }
  }
  function getPropertiesFromElement(el, ev, blockAttrsSet, extraAttrs, allowElementCallback, allowSelectors) {
    var props = {
      "$classes": getClassName(el).split(" "),
      "$tag_name": el.tagName.toLowerCase()
    };
    var elId = el.id;
    if (elId) {
      props["$id"] = elId;
    }
    if (shouldTrackElementDetails(el, ev, allowElementCallback, allowSelectors)) {
      _3.each(TRACKED_ATTRS.concat(extraAttrs), function(attr) {
        if (el.hasAttribute(attr) && !blockAttrsSet[attr]) {
          var attrVal = el.getAttribute(attr);
          if (shouldTrackValue(attrVal)) {
            props["$attr-" + attr] = attrVal;
          }
        }
      });
    }
    var nthChild = 1;
    var nthOfType = 1;
    var currentElem = el;
    while (currentElem = getPreviousElementSibling(currentElem)) {
      nthChild++;
      if (currentElem.tagName === el.tagName) {
        nthOfType++;
      }
    }
    props["$nth_child"] = nthChild;
    props["$nth_of_type"] = nthOfType;
    return props;
  }
  function getPropsForDOMEvent(ev, config) {
    var allowElementCallback = config.allowElementCallback;
    var allowSelectors = config.allowSelectors || [];
    var blockAttrs = config.blockAttrs || [];
    var blockElementCallback = config.blockElementCallback;
    var blockSelectors = config.blockSelectors || [];
    var captureTextContent = config.captureTextContent || false;
    var captureExtraAttrs = config.captureExtraAttrs || [];
    var capturedForHeatMap = config.capturedForHeatMap || false;
    var blockAttrsSet = {};
    _3.each(blockAttrs, function(attr) {
      blockAttrsSet[attr] = true;
    });
    var props = null;
    var target = typeof ev.target === "undefined" ? ev.srcElement : ev.target;
    if (isTextNode(target)) {
      target = target.parentNode;
    }
    if (shouldTrackDomEvent(target, ev) && isElementAllowed(target, ev, allowElementCallback, allowSelectors) && !isElementBlocked(target, ev, blockElementCallback, blockSelectors)) {
      var targetElementList = [target];
      var curEl = target;
      while (curEl.parentNode && !isTag(curEl, "body")) {
        targetElementList.push(curEl.parentNode);
        curEl = curEl.parentNode;
      }
      var elementsJson = [];
      var href, explicitNoTrack = false;
      _3.each(targetElementList, function(el) {
        var shouldTrackDetails = shouldTrackElementDetails(el, ev, allowElementCallback, allowSelectors);
        if (!blockAttrsSet["href"] && el.tagName.toLowerCase() === "a") {
          href = el.getAttribute("href");
          href = shouldTrackDetails && shouldTrackValue(href) && href;
        }
        if (isElementBlocked(el, ev, blockElementCallback, blockSelectors)) {
          explicitNoTrack = true;
        }
        elementsJson.push(getPropertiesFromElement(el, ev, blockAttrsSet, captureExtraAttrs, allowElementCallback, allowSelectors));
      }, this);
      if (!explicitNoTrack) {
        var docElement = document$1["documentElement"];
        props = {
          "$event_type": ev.type,
          "$host": win.location.host,
          "$pathname": win.location.pathname,
          "$elements": elementsJson,
          "$el_attr__href": href,
          "$viewportHeight": Math.max(docElement["clientHeight"], win["innerHeight"] || 0),
          "$viewportWidth": Math.max(docElement["clientWidth"], win["innerWidth"] || 0),
          "$pageHeight": document$1["body"]["offsetHeight"] || 0,
          "$pageWidth": document$1["body"]["offsetWidth"] || 0
        };
        _3.each(captureExtraAttrs, function(attr) {
          if (!blockAttrsSet[attr] && target.hasAttribute(attr)) {
            var attrVal = target.getAttribute(attr);
            if (shouldTrackValue(attrVal)) {
              props["$el_attr__" + attr] = attrVal;
            }
          }
        });
        if (captureTextContent) {
          elementText = getSafeText(target, ev, allowElementCallback, allowSelectors);
          if (elementText && elementText.length) {
            props["$el_text"] = elementText;
          }
        }
        if (ev.type === EV_CLICK) {
          _3.each(CLICK_EVENT_PROPS, function(prop) {
            if (prop in ev) {
              props["$" + prop] = ev[prop];
            }
          });
          if (capturedForHeatMap) {
            props["$captured_for_heatmap"] = true;
          }
          target = guessRealClickTarget(ev);
        }
        if (captureTextContent) {
          var elementText = getSafeText(target, ev, allowElementCallback, allowSelectors);
          if (elementText && elementText.length) {
            props["$el_text"] = elementText;
          }
        }
        if (target) {
          if (!isElementAllowed(target, ev, allowElementCallback, allowSelectors) || isElementBlocked(target, ev, blockElementCallback, blockSelectors)) {
            return null;
          }
          var targetProps = getPropertiesFromElement(target, ev, blockAttrsSet, captureExtraAttrs, allowElementCallback, allowSelectors);
          props["$target"] = targetProps;
          props["$el_classes"] = targetProps["$classes"];
          _3.extend(props, _3.strip_empty_properties({
            "$el_id": targetProps["$id"],
            "$el_tag_name": targetProps["$tag_name"]
          }));
        }
      }
    }
    return props;
  }
  function getSafeText(el, ev, allowElementCallback, allowSelectors) {
    var elText = "";
    if (shouldTrackElementDetails(el, ev, allowElementCallback, allowSelectors) && el.childNodes && el.childNodes.length) {
      _3.each(el.childNodes, function(child) {
        if (isTextNode(child) && child.textContent) {
          elText += _3.trim(child.textContent).split(/(\s+)/).filter(shouldTrackValue).join("").replace(/[\r\n]/g, " ").replace(/[ ]+/g, " ").substring(0, 255);
        }
      });
    }
    return _3.trim(elText);
  }
  function guessRealClickTarget(ev) {
    var target = ev.target;
    var composedPath = ev["composedPath"]();
    for (var i3 = 0; i3 < composedPath.length; i3++) {
      var node2 = composedPath[i3];
      if (isTag(node2, "a") || isTag(node2, "button") || isTag(node2, "input") || isTag(node2, "select") || node2.getAttribute && node2.getAttribute("role") === "button") {
        target = node2;
        break;
      }
      if (node2 === target) {
        break;
      }
    }
    return target;
  }
  function isElementAllowed(el, ev, allowElementCallback, allowSelectors) {
    if (allowElementCallback) {
      try {
        if (!allowElementCallback(el, ev)) {
          return false;
        }
      } catch (err) {
        logger$3.critical("Error while checking element in allowElementCallback", err);
        return false;
      }
    }
    if (!allowSelectors.length) {
      return true;
    }
    for (var i3 = 0; i3 < allowSelectors.length; i3++) {
      var sel = allowSelectors[i3];
      try {
        if (el["matches"](sel)) {
          return true;
        }
      } catch (err) {
        logger$3.critical("Error while checking selector: " + sel, err);
      }
    }
    return false;
  }
  function isElementBlocked(el, ev, blockElementCallback, blockSelectors) {
    var i3;
    if (blockElementCallback) {
      try {
        if (blockElementCallback(el, ev)) {
          return true;
        }
      } catch (err) {
        logger$3.critical("Error while checking element in blockElementCallback", err);
        return true;
      }
    }
    if (blockSelectors && blockSelectors.length) {
      for (i3 = 0; i3 < blockSelectors.length; i3++) {
        var sel = blockSelectors[i3];
        try {
          if (el["matches"](sel)) {
            return true;
          }
        } catch (err) {
          logger$3.critical("Error while checking selector: " + sel, err);
        }
      }
    }
    var classes = getClasses(el);
    for (i3 = 0; i3 < OPT_OUT_CLASSES.length; i3++) {
      if (classes[OPT_OUT_CLASSES[i3]]) {
        return true;
      }
    }
    return false;
  }
  function isElementNode(node2) {
    return node2 && node2.nodeType === 1;
  }
  function isTag(el, tag) {
    return el && el.tagName && el.tagName.toLowerCase() === tag.toLowerCase();
  }
  function isTextNode(node2) {
    return node2 && node2.nodeType === 3;
  }
  function minDOMApisSupported() {
    try {
      var testEl = document$1.createElement("div");
      return !!testEl["matches"];
    } catch (err) {
      return false;
    }
  }
  function weakSetSupported() {
    return typeof WeakSet !== "undefined";
  }
  function shouldTrackDomEvent(el, ev) {
    if (!el || isTag(el, "html") || !isElementNode(el)) {
      return false;
    }
    var tag = el.tagName.toLowerCase();
    switch (tag) {
      case "form":
        return ev.type === EV_SUBMIT;
      case "input":
        if (["button", "submit"].indexOf(el.getAttribute("type")) === -1) {
          return ev.type === EV_CHANGE;
        } else {
          return ev.type === EV_CLICK;
        }
      case "select":
      case "textarea":
        return ev.type === EV_CHANGE;
      default:
        return ev.type === EV_CLICK;
    }
  }
  function elementLooksSensitive(el) {
    var name = (el.name || el.id || "").toString().toLowerCase();
    if (typeof name === "string") {
      var sensitiveNameRegex = /^cc|cardnum|ccnum|creditcard|csc|cvc|cvv|exp|pass|pwd|routing|seccode|securitycode|securitynum|socialsec|socsec|ssn/i;
      if (sensitiveNameRegex.test(name.replace(/[^a-zA-Z0-9]/g, ""))) {
        return true;
      }
    }
    return false;
  }
  function shouldTrackElementDetails(el, ev, allowElementCallback, allowSelectors) {
    var i3;
    if (!isElementAllowed(el, ev, allowElementCallback, allowSelectors)) {
      return false;
    }
    for (var curEl = el; curEl.parentNode && !isTag(curEl, "body"); curEl = curEl.parentNode) {
      var classes = getClasses(curEl);
      for (i3 = 0; i3 < SENSITIVE_DATA_CLASSES.length; i3++) {
        if (classes[SENSITIVE_DATA_CLASSES[i3]]) {
          return false;
        }
      }
    }
    var elClasses = getClasses(el);
    for (i3 = 0; i3 < OPT_IN_CLASSES.length; i3++) {
      if (elClasses[OPT_IN_CLASSES[i3]]) {
        return true;
      }
    }
    if (isTag(el, "input") || isTag(el, "select") || isTag(el, "textarea") || el.getAttribute("contenteditable") === "true") {
      return false;
    }
    var type = el.type || "";
    if (typeof type === "string") {
      switch (type.toLowerCase()) {
        case "hidden":
          return false;
        case "password":
          return false;
      }
    }
    if (elementLooksSensitive(el)) {
      return false;
    }
    return true;
  }
  function shouldTrackValue(value) {
    if (value === null || _3.isUndefined(value)) {
      return false;
    }
    if (typeof value === "string") {
      value = _3.trim(value);
      var ccRegex = /^(?:(4[0-9]{12}(?:[0-9]{3})?)|(5[1-5][0-9]{14})|(6(?:011|5[0-9]{2})[0-9]{12})|(3[47][0-9]{13})|(3(?:0[0-5]|[68][0-9])[0-9]{11})|((?:2131|1800|35[0-9]{3})[0-9]{11}))$/;
      if (ccRegex.test((value || "").replace(/[- ]/g, ""))) {
        return false;
      }
      var ssnRegex = /(^\d{3}-?\d{2}-?\d{4}$)/;
      if (ssnRegex.test(value)) {
        return false;
      }
    }
    return true;
  }
  function getPolyfillScrollEndFunction(originalFunction) {
    var supportsScrollEnd = "onscrollend" in win;
    var polyfillFunction = safewrap(originalFunction);
    var polyfillEvent = EV_SCROLLEND;
    if (!supportsScrollEnd) {
      var scrollTimer = null;
      var scrollDelayMs = 100;
      polyfillFunction = safewrap(function() {
        clearTimeout(scrollTimer);
        scrollTimer = setTimeout(originalFunction, scrollDelayMs);
      });
      polyfillEvent = EV_SCROLL;
    }
    return {
      listener: polyfillFunction,
      eventType: polyfillEvent
    };
  }
  function hasInlineEventHandlers(element) {
    for (var i3 = 0; i3 < EVENT_HANDLER_ATTRIBUTES.length; i3++) {
      if (element.hasAttribute(EVENT_HANDLER_ATTRIBUTES[i3])) {
        return true;
      }
    }
    return false;
  }
  function hasInteractiveAriaRole(element) {
    var role = element.getAttribute("role");
    if (!role) return false;
    var primaryRole = role.trim().split(/\s+/)[0].toLowerCase();
    return INTERACTIVE_ARIA_ROLES[primaryRole];
  }
  function hasAnyInteractivityIndicators(element) {
    var tagName = element.tagName.toLowerCase();
    if (tagName === "button" || tagName === "input" || tagName === "select" || tagName === "textarea" || tagName === "details" || tagName === "dialog") {
      return true;
    }
    if (element.isContentEditable) {
      return true;
    }
    if (element.onclick || element.onmousedown || element.onmouseup || element.ontouchstart || element.ontouchend) {
      return true;
    }
    if (hasInlineEventHandlers(element)) {
      return true;
    }
    if (hasInteractiveAriaRole(element)) {
      return true;
    }
    if (tagName === "a" && element.hasAttribute("href")) {
      return true;
    }
    if (element.hasAttribute("tabindex")) {
      return true;
    }
    return false;
  }
  function isDefinitelyNonInteractive(element) {
    if (!element || !element.tagName) {
      return true;
    }
    var tagName = element.tagName.toLowerCase();
    if (ALWAYS_NON_INTERACTIVE_TAGS[tagName]) {
      return true;
    }
    if (hasAnyInteractivityIndicators(element)) {
      return false;
    }
    var parent = element.parentElement;
    var depth = 0;
    while (parent && depth < MAX_DEPTH) {
      if (hasAnyInteractivityIndicators(parent)) {
        return false;
      }
      if (parent.getRootNode && parent.getRootNode() !== document$1) {
        var root2 = parent.getRootNode();
        if (root2.host && hasAnyInteractivityIndicators(root2.host)) {
          return false;
        }
      }
      parent = parent.parentElement;
      depth++;
    }
    if (TEXT_CONTAINER_TAGS[tagName]) {
      return true;
    }
    return false;
  }
  function getClickEventComposedPath(event) {
    if ("composedPath" in event) {
      return event["composedPath"]();
    }
    return [];
  }
  function getClickEventTargetElement(event) {
    var path = getClickEventComposedPath(event);
    if (path && path.length > 0) {
      return path[0];
    }
    return event["target"] || event["srcElement"];
  }
  var COMMON_MASK_CLASSES_SELECTOR = ".mp-mask, .fs-mask, .amp-mask, .rr-mask, .ph-mask";
  var RRWEB_PASSWORD_ATTRIBUTE = "data-rr-is-password";
  var ALWAYS_MASKED_INPUT_TYPES = ["password", "email", "tel", "hidden"];
  function normalizeSelectors(selector) {
    if (!selector) {
      return [];
    }
    if (Array.isArray(selector)) {
      return selector;
    }
    return [selector];
  }
  function getPrivacyConfig(mixpanelInstance) {
    var privacyConfig = {
      input: {
        maskingSelector: "",
        unmaskingSelector: "",
        maskAll: true
      },
      text: {
        maskingSelector: "",
        unmaskingSelector: "",
        maskAll: true
      }
    };
    var maskInputSelector = mixpanelInstance.get_config("record_mask_input_selector");
    var unmaskInputSelector = mixpanelInstance.get_config("record_unmask_input_selector");
    var maskAllInputs = mixpanelInstance.get_config("record_mask_all_inputs");
    privacyConfig.input.maskingSelector = normalizeSelectors(maskInputSelector).join(",");
    privacyConfig.input.unmaskingSelector = normalizeSelectors(unmaskInputSelector).join(",");
    if (maskAllInputs !== void 0) {
      privacyConfig.input.maskAll = maskAllInputs;
    }
    var maskTextSelector = mixpanelInstance.get_config("record_mask_text_selector");
    var unmaskTextSelector = mixpanelInstance.get_config("record_unmask_text_selector");
    var maskAllText = mixpanelInstance.get_config("record_mask_all_text");
    var legacyMaskTextClass = mixpanelInstance.get_config("record_mask_text_class");
    var textMaskingSelectors = normalizeSelectors(maskTextSelector);
    if (legacyMaskTextClass) {
      if (legacyMaskTextClass instanceof RegExp) {
        privacyConfig.text._legacyClassRegex = legacyMaskTextClass;
      } else {
        var classSelector = "." + legacyMaskTextClass;
        if (textMaskingSelectors.indexOf(classSelector) === -1) {
          textMaskingSelectors.push(classSelector);
        }
      }
    }
    privacyConfig.text.maskingSelector = textMaskingSelectors.join(",");
    privacyConfig.text.unmaskingSelector = normalizeSelectors(unmaskTextSelector).join(",");
    if (maskAllText === void 0 && maskTextSelector !== void 0) {
      privacyConfig.text.maskAll = false;
    } else if (maskAllText !== void 0) {
      privacyConfig.text.maskAll = maskAllText;
    }
    return privacyConfig;
  }
  function elementMatchesSelector(element, selector) {
    if (!selector) {
      return false;
    }
    return !!element.closest(selector);
  }
  function shouldMaskInput(element, privacyConfig) {
    var inputType = (element.getAttribute("type") || "").toLowerCase();
    if (ALWAYS_MASKED_INPUT_TYPES.indexOf(inputType) !== -1) {
      return true;
    }
    var autocomplete = (element.getAttribute("autocomplete") || "").toLowerCase();
    if (autocomplete && autocomplete !== "" && autocomplete !== "off") {
      return true;
    }
    if (element.hasAttribute(RRWEB_PASSWORD_ATTRIBUTE)) {
      return true;
    }
    if (elementLooksSensitive(element)) {
      return true;
    }
    if (privacyConfig.input.maskAll) {
      if (elementMatchesSelector(element, privacyConfig.input.unmaskingSelector)) {
        return false;
      }
      return true;
    } else {
      if (elementMatchesSelector(element, privacyConfig.input.maskingSelector)) {
        return true;
      }
      if (elementMatchesSelector(element, COMMON_MASK_CLASSES_SELECTOR)) {
        return true;
      }
      return false;
    }
  }
  function shouldMaskText(element, privacyConfig) {
    if (!element) {
      return false;
    }
    if (privacyConfig.text._legacyClassRegex) {
      if (classMatchesRegex(element, privacyConfig.text._legacyClassRegex)) {
        return true;
      }
    }
    if (privacyConfig.text.maskAll) {
      if (elementMatchesSelector(element, privacyConfig.text.unmaskingSelector)) {
        return false;
      }
      return true;
    } else {
      if (elementMatchesSelector(element, privacyConfig.text.maskingSelector)) {
        return true;
      }
      if (elementMatchesSelector(element, COMMON_MASK_CLASSES_SELECTOR)) {
        return true;
      }
      return false;
    }
  }
  var logger$2 = console_with_prefix("recorder");
  var CompressionStream = win["CompressionStream"];
  var RECORDER_BATCHER_LIB_CONFIG = {
    "batch_size": 1e3,
    "batch_flush_interval_ms": 10 * 1e3,
    "batch_request_timeout_ms": 90 * 1e3,
    "batch_autostart": true
  };
  var ACTIVE_SOURCES = /* @__PURE__ */ new Set([
    IncrementalSource.MouseMove,
    IncrementalSource.MouseInteraction,
    IncrementalSource.Scroll,
    IncrementalSource.ViewportResize,
    IncrementalSource.Input,
    IncrementalSource.TouchMove,
    IncrementalSource.MediaInteraction,
    IncrementalSource.Drag,
    IncrementalSource.Selection
  ]);
  function isUserEvent(ev) {
    return ev.type === EventType.IncrementalSnapshot && ACTIVE_SOURCES.has(ev.data.source);
  }
  var SessionRecording = function(options) {
    this._mixpanel = options.mixpanelInstance;
    this._onIdleTimeout = options.onIdleTimeout || NOOP_FUNC;
    this._onMaxLengthReached = options.onMaxLengthReached || NOOP_FUNC;
    this._onBatchSent = options.onBatchSent || NOOP_FUNC;
    this._rrwebRecord = options.rrwebRecord || null;
    this._stopRecording = null;
    this.replayId = options.replayId;
    this.batchStartUrl = options.batchStartUrl || null;
    this.replayStartUrl = options.replayStartUrl || null;
    this.idleExpires = options.idleExpires || null;
    this.maxExpires = options.maxExpires || null;
    this.replayStartTime = options.replayStartTime || null;
    this.lastEventTimestamp = options.lastEventTimestamp || null;
    this.seqNo = options.seqNo || 0;
    this.idleTimeoutId = null;
    this.maxTimeoutId = null;
    this.recordMaxMs = MAX_RECORDING_MS;
    this.recordMinMs = 0;
    var usePersistence = localStorageSupported(options.sharedLockStorage, true) && !this.getConfig("disable_persistence");
    this.batcherKey = "__mprec_" + this.getConfig("name") + "_" + this.getConfig("token") + "_" + this.replayId;
    this.queueStorage = new IDBStorageWrapper(RECORDING_EVENTS_STORE_NAME);
    this.batcher = new RequestBatcher(this.batcherKey, {
      errorReporter: this.reportError.bind(this),
      flushOnlyOnInterval: true,
      libConfig: RECORDER_BATCHER_LIB_CONFIG,
      sendRequestFunc: this.flushEventsWithOptOut.bind(this),
      queueStorage: this.queueStorage,
      sharedLockStorage: options.sharedLockStorage,
      usePersistence,
      stopAllBatchingFunc: this.stopRecording.bind(this),
      // increased throttle and shared lock timeout because recording events are very high frequency.
      // this will minimize the amount of lock contention between enqueued events.
      // for session recordings there is a lock for each tab anyway, so there's no risk of deadlock between tabs.
      enqueueThrottleMs: RECORD_ENQUEUE_THROTTLE_MS,
      sharedLockTimeoutMS: 10 * 1e3
    });
  };
  SessionRecording.prototype.getUserIdInfo = function() {
    if (this.finalFlushUserIdInfo) {
      return this.finalFlushUserIdInfo;
    }
    var userIdInfo = {
      "distinct_id": String(this._mixpanel.get_distinct_id())
    };
    var deviceId = this._mixpanel.get_property("$device_id");
    if (deviceId) {
      userIdInfo["$device_id"] = deviceId;
    }
    var userId = this._mixpanel.get_property("$user_id");
    if (userId) {
      userIdInfo["$user_id"] = userId;
    }
    return userIdInfo;
  };
  SessionRecording.prototype.unloadPersistedData = function() {
    this.batcher.stop();
    return this.queueStorage.init().catch(function() {
      this.reportError("Error initializing IndexedDB storage for unloading persisted data.");
    }.bind(this)).then(function() {
      if (this.getDurationMs() < this._getRecordMinMs()) {
        return this.queueStorage.removeItem(this.batcherKey);
      }
      return this.batcher.flush().then(function() {
        return this.queueStorage.removeItem(this.batcherKey);
      }.bind(this));
    }.bind(this));
  };
  SessionRecording.prototype.getConfig = function(configVar) {
    return this._mixpanel.get_config(configVar);
  };
  SessionRecording.prototype.get_config = function(configVar) {
    return this.getConfig(configVar);
  };
  SessionRecording.prototype.startRecording = function(shouldStopBatcher) {
    if (this._rrwebRecord === null) {
      this.reportError("rrweb record function not provided. ");
      return;
    }
    if (this._stopRecording !== null) {
      logger$2.log("Recording already in progress, skipping startRecording.");
      return;
    }
    this.recordMaxMs = this.getConfig("record_max_ms");
    if (this.recordMaxMs > MAX_RECORDING_MS) {
      this.recordMaxMs = MAX_RECORDING_MS;
      logger$2.critical("record_max_ms cannot be greater than " + MAX_RECORDING_MS + "ms. Capping value.");
    }
    if (!this.maxExpires) {
      this.maxExpires = (/* @__PURE__ */ new Date()).getTime() + this.recordMaxMs;
    }
    this.recordMinMs = this._getRecordMinMs();
    if (!this.replayStartTime) {
      this.replayStartTime = (/* @__PURE__ */ new Date()).getTime();
      this.batchStartUrl = _3.info.currentUrl();
      this.replayStartUrl = _3.info.currentUrl();
    }
    if (shouldStopBatcher || this.recordMinMs > 0) {
      this.batcher.stop();
    } else {
      this.batcher.start();
    }
    var resetIdleTimeout = function() {
      clearTimeout(this.idleTimeoutId);
      var idleTimeoutMs = this.getConfig("record_idle_timeout_ms");
      this.idleTimeoutId = setTimeout(this._onIdleTimeout, idleTimeoutMs);
      this.idleExpires = (/* @__PURE__ */ new Date()).getTime() + idleTimeoutMs;
    }.bind(this);
    resetIdleTimeout();
    var blockSelector = this.getConfig("record_block_selector");
    if (blockSelector === "" || blockSelector === null) {
      blockSelector = void 0;
    }
    var privacyConfig = getPrivacyConfig(this._mixpanel);
    try {
      this._stopRecording = this._rrwebRecord({
        "emit": function(ev) {
          if (this.idleExpires && this.idleExpires < ev.timestamp) {
            this._onIdleTimeout();
            return;
          }
          if (isUserEvent(ev)) {
            if (this.batcher.stopped && (/* @__PURE__ */ new Date()).getTime() - this.replayStartTime >= this.recordMinMs) {
              this.batcher.start();
            }
            resetIdleTimeout();
          }
          this.__enqueuePromise = this.batcher.enqueue(ev);
          if (this.lastEventTimestamp === null || ev.timestamp > this.lastEventTimestamp) {
            this.lastEventTimestamp = ev.timestamp;
          }
        }.bind(this),
        "blockClass": this.getConfig("record_block_class"),
        "blockSelector": blockSelector,
        "collectFonts": this.getConfig("record_collect_fonts"),
        "dataURLOptions": {
          // canvas image options (https://developer.mozilla.org/en-US/docs/Web/API/HTMLCanvasElement/toDataURL)
          "type": "image/webp",
          "quality": 0.6
        },
        // mask all inputs and text by default, unmasking is applied via callbacks maskInputFn and maskTextFn
        "maskAllInputs": true,
        "maskTextSelector": "*",
        "maskInputFn": this._getMaskFn(shouldMaskInput, privacyConfig),
        "maskTextFn": this._getMaskFn(shouldMaskText, privacyConfig),
        "recordCanvas": this.getConfig("record_canvas"),
        "sampling": {
          "canvas": 15
        },
        "plugins": this.getConfig("record_console") ? [
          getRecordConsolePlugin({
            stringifyOptions: {
              stringLengthLimit: 1e3,
              numOfKeysLimit: 50,
              depthOfLimit: 2
            }
          })
        ] : []
      });
    } catch (err) {
      this.reportError("Unexpected error when starting rrweb recording.", err);
    }
    if (typeof this._stopRecording !== "function") {
      this.reportError("rrweb failed to start, skipping this recording.");
      this._stopRecording = null;
      this.stopRecording();
      return;
    }
    var maxTimeoutMs = this.maxExpires - (/* @__PURE__ */ new Date()).getTime();
    this.maxTimeoutId = setTimeout(this._onMaxLengthReached.bind(this), maxTimeoutMs);
  };
  SessionRecording.prototype.stopRecording = function(skipFlush) {
    this.finalFlushUserIdInfo = this.getUserIdInfo();
    if (!this.isRrwebStopped()) {
      try {
        this._stopRecording();
      } catch (err) {
        this.reportError("Error with rrweb stopRecording", err);
      }
      this._stopRecording = null;
    }
    var flushPromise;
    if (this.batcher.stopped) {
      flushPromise = this.batcher.clear();
    } else if (!skipFlush) {
      flushPromise = this.batcher.flush();
    }
    this.batcher.stop();
    clearTimeout(this.idleTimeoutId);
    clearTimeout(this.maxTimeoutId);
    return flushPromise;
  };
  SessionRecording.prototype.isRrwebStopped = function() {
    return this._stopRecording === null;
  };
  SessionRecording.prototype.flushEventsWithOptOut = function(data, options, cb) {
    var onOptOut = function(code) {
      if (code === 0) {
        this.stopRecording();
        cb({ error: "Tracking has been opted out, stopping recording." });
      }
    }.bind(this);
    this._flushEvents(data, options, cb, onOptOut);
  };
  SessionRecording.prototype.serialize = function() {
    var tabId;
    try {
      tabId = this._mixpanel.get_tab_id();
    } catch (e3) {
      this.reportError("Error getting tab ID for serialization ", e3);
      tabId = null;
    }
    return {
      "replayId": this.replayId,
      "seqNo": this.seqNo,
      "replayStartTime": this.replayStartTime,
      "batchStartUrl": this.batchStartUrl,
      "replayStartUrl": this.replayStartUrl,
      "lastEventTimestamp": this.lastEventTimestamp,
      "idleExpires": this.idleExpires,
      "maxExpires": this.maxExpires,
      "tabId": tabId
    };
  };
  SessionRecording.deserialize = function(serializedRecording, options) {
    var recording2 = new SessionRecording(_3.extend({}, options, {
      replayId: serializedRecording["replayId"],
      batchStartUrl: serializedRecording["batchStartUrl"],
      replayStartUrl: serializedRecording["replayStartUrl"],
      idleExpires: serializedRecording["idleExpires"],
      maxExpires: serializedRecording["maxExpires"],
      replayStartTime: serializedRecording["replayStartTime"],
      lastEventTimestamp: serializedRecording["lastEventTimestamp"],
      seqNo: serializedRecording["seqNo"],
      sharedLockStorage: options.sharedLockStorage
    }));
    return recording2;
  };
  SessionRecording.prototype._sendRequest = function(currentReplayId, reqParams, reqBody, callback) {
    var onSuccess = function(response, responseBody) {
      if (response.status === 200 && this.replayId === currentReplayId) {
        this.seqNo++;
        this.batchStartUrl = _3.info.currentUrl();
      }
      this._onBatchSent();
      callback({
        status: 0,
        httpStatusCode: response.status,
        responseBody,
        retryAfter: response.headers.get("Retry-After")
      });
    }.bind(this);
    var apiHost = this._mixpanel.get_api_host && this._mixpanel.get_api_host("record") || this.getConfig("api_host");
    win["fetch"](apiHost + "/" + this.getConfig("api_routes")["record"] + "?" + new URLSearchParams(reqParams), {
      "method": "POST",
      "headers": {
        "Authorization": "Basic " + btoa(this.getConfig("token") + ":"),
        "Content-Type": "application/octet-stream"
      },
      "body": reqBody
    }).then(function(response) {
      response.json().then(function(responseBody) {
        onSuccess(response, responseBody);
      }).catch(function(error) {
        callback({ error });
      });
    }).catch(function(error) {
      callback({ error, httpStatusCode: 0 });
    });
  };
  SessionRecording.prototype._flushEvents = addOptOutCheckMixpanelLib(function(data, options, callback) {
    var numEvents = data.length;
    if (numEvents > 0) {
      var replayId = this.replayId;
      var batchStartTime = Infinity;
      var batchEndTime = -Infinity;
      var hasFullSnapshot = false;
      for (var i3 = 0; i3 < numEvents; i3++) {
        batchStartTime = Math.min(batchStartTime, data[i3].timestamp);
        batchEndTime = Math.max(batchEndTime, data[i3].timestamp);
        if (data[i3].type === EventType.FullSnapshot) {
          hasFullSnapshot = true;
        }
      }
      if (this.seqNo === 0) {
        if (!hasFullSnapshot) {
          callback({ error: "First batch does not contain a full snapshot. Aborting recording." });
          this.stopRecording(true);
          return;
        }
        this.replayStartTime = batchStartTime;
      } else if (!this.replayStartTime) {
        this.reportError("Replay start time not set but seqNo is not 0. Using current batch start time as a fallback.");
        this.replayStartTime = batchStartTime;
      }
      var replayLengthMs = batchEndTime - this.replayStartTime;
      var reqParams = {
        "$current_url": this.batchStartUrl,
        "$lib_version": Config.LIB_VERSION,
        "batch_start_time": batchStartTime / 1e3,
        "mp_lib": "web",
        "replay_id": replayId,
        "replay_length_ms": replayLengthMs,
        "replay_start_time": this.replayStartTime / 1e3,
        "replay_start_url": this.replayStartUrl,
        "seq": this.seqNo
      };
      var eventsJson = JSON.stringify(data);
      Object.assign(reqParams, this.getUserIdInfo());
      if (canUseCompressionStream(userAgent, navigator.vendor, windowOpera)) {
        var jsonStream = new Blob([eventsJson], { type: "application/json" }).stream();
        var gzipStream = jsonStream.pipeThrough(new CompressionStream("gzip"));
        new Response(gzipStream).blob().then(function(compressedBlob) {
          reqParams["format"] = "gzip";
          this._sendRequest(replayId, reqParams, compressedBlob, callback);
        }.bind(this));
      } else {
        reqParams["format"] = "body";
        this._sendRequest(replayId, reqParams, eventsJson, callback);
      }
    }
  });
  SessionRecording.prototype.reportError = function(msg, err) {
    logger$2.error.apply(logger$2.error, arguments);
    try {
      if (!err && !(msg instanceof Error)) {
        msg = new Error(msg);
      }
      this.getConfig("error_reporter")(msg, err);
    } catch (err2) {
      logger$2.error(err2);
    }
  };
  SessionRecording.prototype.getDurationMs = function() {
    if (this.replayStartTime === null) {
      return 0;
    }
    if (this.lastEventTimestamp === null) {
      return (/* @__PURE__ */ new Date()).getTime() - this.replayStartTime;
    }
    return this.lastEventTimestamp - this.replayStartTime;
  };
  SessionRecording.prototype._getRecordMinMs = function() {
    var configValue = this.getConfig("record_min_ms");
    if (configValue > MAX_VALUE_FOR_MIN_RECORDING_MS) {
      logger$2.critical("record_min_ms cannot be greater than " + MAX_VALUE_FOR_MIN_RECORDING_MS + "ms. Capping value.");
      return MAX_VALUE_FOR_MIN_RECORDING_MS;
    }
    return configValue;
  };
  SessionRecording.prototype._getMaskFn = function(shouldMaskFn, privacyConfig) {
    return function(text, element) {
      if (!text.trim().length) {
        return "";
      }
      var shouldMask = true;
      try {
        shouldMask = shouldMaskFn(element, privacyConfig);
      } catch (err) {
        this.reportError("Error checking if text should be masked, defaulting to masked", err);
      }
      if (shouldMask) {
        var textLength = Math.min(text.length, 1e4);
        return "*".repeat(textLength);
      } else {
        return text;
      }
    }.bind(this);
  };
  var RecordingRegistry = function(options) {
    this.idb = new IDBStorageWrapper(RECORDING_REGISTRY_STORE_NAME);
    this.errorReporter = options.errorReporter;
    this.mixpanelInstance = options.mixpanelInstance;
    this.sharedLockStorage = options.sharedLockStorage;
  };
  RecordingRegistry.prototype.isPersistenceEnabled = function() {
    return !this.mixpanelInstance.get_config("disable_persistence");
  };
  RecordingRegistry.prototype.handleError = function(err) {
    this.errorReporter("IndexedDB error: ", err);
  };
  RecordingRegistry.prototype.setActiveRecording = function(serializedRecording) {
    if (!this.isPersistenceEnabled()) {
      return PromisePolyfill.resolve();
    }
    var tabId = serializedRecording["tabId"];
    if (!tabId) {
      console.warn("No tab ID is set, cannot persist recording metadata.");
      return PromisePolyfill.resolve();
    }
    return this.idb.init().then(function() {
      return this.idb.setItem(tabId, serializedRecording);
    }.bind(this)).catch(this.handleError.bind(this));
  };
  RecordingRegistry.prototype.getActiveRecording = function() {
    if (!this.isPersistenceEnabled()) {
      return PromisePolyfill.resolve(null);
    }
    return this.idb.init().then(function() {
      return this.idb.getItem(this.mixpanelInstance.get_tab_id());
    }.bind(this)).then(function(serializedRecording) {
      return isRecordingExpired(serializedRecording) ? null : serializedRecording;
    }.bind(this)).catch(this.handleError.bind(this));
  };
  RecordingRegistry.prototype.clearActiveRecording = function() {
    if (this.isPersistenceEnabled()) {
      return this.markActiveRecordingExpired();
    } else {
      return this.deleteActiveRecording();
    }
  };
  RecordingRegistry.prototype.markActiveRecordingExpired = function() {
    return this.getActiveRecording().then(function(serializedRecording) {
      if (serializedRecording) {
        serializedRecording["maxExpires"] = 0;
        return this.setActiveRecording(serializedRecording);
      }
    }.bind(this)).catch(this.handleError.bind(this));
  };
  RecordingRegistry.prototype.deleteActiveRecording = function() {
    if (this.idb.isInitialized()) {
      return this.idb.removeItem(this.mixpanelInstance.get_tab_id()).catch(this.handleError.bind(this));
    } else {
      return PromisePolyfill.resolve();
    }
  };
  RecordingRegistry.prototype.flushInactiveRecordings = function() {
    if (!this.isPersistenceEnabled()) {
      return PromisePolyfill.resolve([]);
    }
    return this.idb.init().then(function() {
      return this.idb.getAll();
    }.bind(this)).then(function(serializedRecordings) {
      var unloadPromises = serializedRecordings.filter(function(serializedRecording) {
        return isRecordingExpired(serializedRecording);
      }).map(function(serializedRecording) {
        var sessionRecording = SessionRecording.deserialize(serializedRecording, {
          mixpanelInstance: this.mixpanelInstance,
          sharedLockStorage: this.sharedLockStorage
        });
        return sessionRecording.unloadPersistedData().then(function() {
          return this.idb.removeItem(serializedRecording["tabId"]);
        }.bind(this)).catch(this.handleError.bind(this));
      }.bind(this));
      return PromisePolyfill.all(unloadPromises);
    }.bind(this)).catch(this.handleError.bind(this));
  };
  var logger$1 = console_with_prefix("recorder");
  var MixpanelRecorder = function(mixpanelInstance, rrwebRecord, sharedLockStorage) {
    this.mixpanelInstance = mixpanelInstance;
    this.rrwebRecord = rrwebRecord || record;
    this.sharedLockStorage = sharedLockStorage;
    this.recordingRegistry = new RecordingRegistry({
      mixpanelInstance: this.mixpanelInstance,
      errorReporter: logger$1.error,
      sharedLockStorage
    });
    this._flushInactivePromise = this.recordingRegistry.flushInactiveRecordings();
    this.activeRecording = null;
    this.stopRecordingInProgress = false;
  };
  MixpanelRecorder.prototype.startRecording = function(options) {
    options = options || {};
    if (this.activeRecording && !this.activeRecording.isRrwebStopped()) {
      logger$1.log("Recording already in progress, skipping startRecording.");
      return;
    }
    var onIdleTimeout = function() {
      logger$1.log("Idle timeout reached, restarting recording.");
      this.resetRecording();
    }.bind(this);
    var onMaxLengthReached = function() {
      logger$1.log("Max recording length reached, stopping recording.");
      this.resetRecording();
    }.bind(this);
    var onBatchSent = function() {
      this.recordingRegistry.setActiveRecording(this.activeRecording.serialize());
      this["__flushPromise"] = this.activeRecording.batcher._flushPromise;
    }.bind(this);
    var sessionRecordingOptions = {
      mixpanelInstance: this.mixpanelInstance,
      onBatchSent,
      onIdleTimeout,
      onMaxLengthReached,
      replayId: _3.UUID(),
      rrwebRecord: this.rrwebRecord,
      sharedLockStorage: this.sharedLockStorage
    };
    if (options.activeSerializedRecording) {
      this.activeRecording = SessionRecording.deserialize(options.activeSerializedRecording, sessionRecordingOptions);
    } else {
      this.activeRecording = new SessionRecording(sessionRecordingOptions);
    }
    this.activeRecording.startRecording(options.shouldStopBatcher);
    return this.recordingRegistry.setActiveRecording(this.activeRecording.serialize());
  };
  MixpanelRecorder.prototype.stopRecording = function() {
    this.stopRecordingInProgress = true;
    return this._stopCurrentRecording(false, true).then(function() {
      return this.recordingRegistry.clearActiveRecording();
    }.bind(this)).then(function() {
      this.stopRecordingInProgress = false;
    }.bind(this));
  };
  MixpanelRecorder.prototype.pauseRecording = function() {
    return this._stopCurrentRecording(false);
  };
  MixpanelRecorder.prototype._stopCurrentRecording = function(skipFlush, disableActiveRecording) {
    if (this.activeRecording) {
      var stopRecordingPromise = this.activeRecording.stopRecording(skipFlush);
      if (disableActiveRecording) {
        this.activeRecording = null;
      }
      return stopRecordingPromise;
    }
    return PromisePolyfill.resolve();
  };
  MixpanelRecorder.prototype.resumeRecording = function(startNewIfInactive) {
    if (this.activeRecording && this.activeRecording.isRrwebStopped()) {
      this.activeRecording.startRecording(false);
      return PromisePolyfill.resolve(null);
    }
    return this.recordingRegistry.getActiveRecording().then(function(activeSerializedRecording) {
      if (activeSerializedRecording && !this.stopRecordingInProgress) {
        return this.startRecording({ activeSerializedRecording });
      } else if (startNewIfInactive) {
        return this.startRecording({ shouldStopBatcher: false });
      } else {
        logger$1.log("No resumable recording found.");
        return null;
      }
    }.bind(this));
  };
  MixpanelRecorder.prototype.resetRecording = function() {
    this.stopRecording();
    this.startRecording({ shouldStopBatcher: true });
  };
  MixpanelRecorder.prototype.getActiveReplayId = function() {
    if (this.activeRecording && !this.activeRecording.isRrwebStopped()) {
      return this.activeRecording.replayId;
    } else {
      return null;
    }
  };
  Object.defineProperty(MixpanelRecorder.prototype, "replayId", {
    get: function() {
      return this.getActiveReplayId();
    }
  });
  win["__mp_recorder"] = MixpanelRecorder;
  var DEFAULT_RAGE_CLICK_THRESHOLD_PX = 30;
  var DEFAULT_RAGE_CLICK_TIMEOUT_MS = 1e3;
  var DEFAULT_RAGE_CLICK_CLICK_COUNT = 4;
  var DEFAULT_RAGE_CLICK_INTERACTIVE_ELEMENTS_ONLY = false;
  function RageClickTracker() {
    this.clicks = [];
  }
  RageClickTracker.prototype.isRageClick = function(event, options) {
    options = options || {};
    var thresholdPx = options["threshold_px"] || DEFAULT_RAGE_CLICK_THRESHOLD_PX;
    var timeoutMs = options["timeout_ms"] || DEFAULT_RAGE_CLICK_TIMEOUT_MS;
    var clickCount = options["click_count"] || DEFAULT_RAGE_CLICK_CLICK_COUNT;
    var interactiveElementsOnly = options["interactive_elements_only"] || DEFAULT_RAGE_CLICK_INTERACTIVE_ELEMENTS_ONLY;
    if (interactiveElementsOnly) {
      var target = getClickEventTargetElement(event);
      if (!target || isDefinitelyNonInteractive(target)) {
        return false;
      }
    }
    var timestamp = Date.now();
    var x5 = event["pageX"], y3 = event["pageY"];
    var lastClick = this.clicks[this.clicks.length - 1];
    if (lastClick && timestamp - lastClick.timestamp < timeoutMs && Math.sqrt(Math.pow(x5 - lastClick.x, 2) + Math.pow(y3 - lastClick.y, 2)) < thresholdPx) {
      this.clicks.push({ x: x5, y: y3, timestamp });
      if (this.clicks.length >= clickCount) {
        this.clicks = [];
        return true;
      }
    } else {
      this.clicks = [{ x: x5, y: y3, timestamp }];
    }
    return false;
  };
  function ShadowDOMObserver(changeCallback, observerConfig) {
    this.changeCallback = changeCallback || function() {
    };
    this.observerConfig = observerConfig;
    this.observedShadowRoots = null;
    this.shadowObservers = [];
  }
  ShadowDOMObserver.prototype.getEventTarget = function(event) {
    if (!this.observedShadowRoots) {
      return;
    }
    return getClickEventTargetElement(event);
  };
  ShadowDOMObserver.prototype.observeFromEvent = function(event) {
    if (!this.observedShadowRoots) {
      return;
    }
    var path = getClickEventComposedPath(event);
    for (var i3 = 0; i3 < path.length; i3++) {
      var element = path[i3];
      if (element && element.shadowRoot) {
        this.observeShadowRoot(element.shadowRoot);
      }
    }
  };
  ShadowDOMObserver.prototype.observeShadowRoot = function(shadowRoot2) {
    if (!this.observedShadowRoots || this.observedShadowRoots.has(shadowRoot2)) {
      return;
    }
    var self2 = this;
    try {
      this.observedShadowRoots.add(shadowRoot2);
      var observer = new window.MutationObserver(function() {
        self2.changeCallback();
      });
      observer.observe(shadowRoot2, this.observerConfig);
      this.shadowObservers.push(observer);
    } catch (e3) {
      logger$3.critical("Error while observing shadow root", e3);
    }
  };
  ShadowDOMObserver.prototype.start = function() {
    if (this.observedShadowRoots) {
      return;
    }
    if (!weakSetSupported()) {
      logger$3.critical("Shadow DOM observation unavailable: WeakSet not supported");
      return;
    }
    this.observedShadowRoots = /* @__PURE__ */ new WeakSet();
  };
  ShadowDOMObserver.prototype.stop = function() {
    if (!this.observedShadowRoots) {
      return;
    }
    for (var i3 = 0; i3 < this.shadowObservers.length; i3++) {
      try {
        this.shadowObservers[i3].disconnect();
      } catch (e3) {
        logger$3.critical("Error while disconnecting shadow DOM observer", e3);
      }
    }
    this.shadowObservers = [];
    this.observedShadowRoots = null;
  };
  var DEFAULT_DEAD_CLICK_TIMEOUT_MS = 500;
  var INTERACTION_EVENTS = [EV_CHANGE, EV_INPUT, EV_SUBMIT, EV_SELECT, EV_TOGGLE];
  var LAYOUT_EVENTS = [EV_SCROLLEND];
  var NAVIGATION_EVENTS = [EV_HASHCHANGE];
  var MUTATION_OBSERVER_CONFIG = {
    characterData: true,
    childList: true,
    subtree: true,
    attributes: true,
    attributeFilter: ["style", "class", "hidden", "checked", "selected", "value", "display", "visibility"]
  };
  function DeadClickTracker(onDeadClickCallback) {
    this.eventListeners = [];
    this.mutationObserver = null;
    this.shadowDOMObserver = null;
    this.isTracking = false;
    this.lastChangeEventTimestamp = 0;
    this.pendingClicks = [];
    this.onDeadClickCallback = onDeadClickCallback;
    this.processingActive = false;
    this.processingTimeout = null;
  }
  DeadClickTracker.prototype.addClick = function(event) {
    var element = this.shadowDOMObserver && this.shadowDOMObserver.getEventTarget(event);
    if (!element) {
      element = event["target"] || event["srcElement"];
    }
    if (!element || isDefinitelyNonInteractive(element)) {
      return false;
    }
    if (this.shadowDOMObserver) {
      this.shadowDOMObserver.observeFromEvent(event);
    }
    this.pendingClicks.push({
      element,
      event,
      timestamp: Date.now()
    });
    return true;
  };
  DeadClickTracker.prototype.trackClick = function(event, config) {
    if (!this.isTracking) {
      return false;
    }
    var added = this.addClick(event);
    if (added) {
      this.triggerProcessing(config);
    }
    return added;
  };
  DeadClickTracker.prototype.getDeadClicks = function(config) {
    if (this.pendingClicks.length === 0) {
      return [];
    }
    var timeoutMs = config["timeout_ms"];
    var now = Date.now();
    var clicksToEvaluate = this.pendingClicks.slice();
    this.pendingClicks = [];
    var deadClicks = [];
    for (var i3 = 0; i3 < clicksToEvaluate.length; i3++) {
      var click = clicksToEvaluate[i3];
      if (now - click.timestamp >= timeoutMs) {
        if (!this.hasChangesAfter(click.timestamp)) {
          deadClicks.push(click);
        }
      } else {
        this.pendingClicks.push(click);
      }
    }
    return deadClicks;
  };
  DeadClickTracker.prototype.hasChangesAfter = function(timestamp) {
    return this.lastChangeEventTimestamp >= timestamp - 100;
  };
  DeadClickTracker.prototype.recordChangeEvent = function() {
    this.lastChangeEventTimestamp = Date.now();
  };
  DeadClickTracker.prototype.triggerProcessing = function(config) {
    if (this.processingActive) {
      return;
    }
    this.processingActive = true;
    this.processRecursively(config);
  };
  DeadClickTracker.prototype.processRecursively = function(config) {
    if (!this.isTracking || !this.onDeadClickCallback) {
      this.processingActive = false;
      return;
    }
    var timeoutMs = config["timeout_ms"];
    var self2 = this;
    this.processingTimeout = setTimeout(function() {
      if (!self2.processingActive) {
        return;
      }
      var deadClicks = self2.getDeadClicks(config);
      for (var i3 = 0; i3 < deadClicks.length; i3++) {
        self2.onDeadClickCallback(deadClicks[i3].event);
      }
      if (self2.pendingClicks.length > 0) {
        self2.processRecursively(config);
      } else {
        self2.processingActive = false;
      }
    }, timeoutMs);
  };
  DeadClickTracker.prototype.startTracking = function() {
    if (this.isTracking) {
      return;
    }
    this.isTracking = true;
    var self2 = this;
    INTERACTION_EVENTS.forEach(function(event) {
      var handler = function() {
        self2.recordChangeEvent();
      };
      document.addEventListener(event, handler, { capture: true, passive: true });
      self2.eventListeners.push({ target: document, event, handler, options: { capture: true, passive: true } });
    });
    NAVIGATION_EVENTS.forEach(function(event) {
      var handler = function() {
        self2.recordChangeEvent();
      };
      window.addEventListener(event, handler);
      self2.eventListeners.push({ target: window, event, handler });
    });
    LAYOUT_EVENTS.forEach(function(event) {
      var handler = function() {
        self2.recordChangeEvent();
      };
      window.addEventListener(event, handler, { passive: true });
      self2.eventListeners.push({ target: window, event, handler, options: { passive: true } });
    });
    var selectionHandler = function() {
      self2.recordChangeEvent();
    };
    document.addEventListener("selectionchange", selectionHandler);
    self2.eventListeners.push({ target: document, event: "selectionchange", handler: selectionHandler });
    if (window.MutationObserver) {
      try {
        this.mutationObserver = new window.MutationObserver(function() {
          self2.recordChangeEvent();
        });
        this.mutationObserver.observe(document.body || document.documentElement, MUTATION_OBSERVER_CONFIG);
      } catch (e3) {
        logger$3.critical("Error while setting up mutation observer", e3);
      }
    }
    if (window.customElements) {
      try {
        this.shadowDOMObserver = new ShadowDOMObserver(
          function() {
            self2.recordChangeEvent();
          },
          MUTATION_OBSERVER_CONFIG
        );
        this.shadowDOMObserver.start();
      } catch (e3) {
        logger$3.critical("Error while setting up shadow DOM observer", e3);
        this.shadowDOMObserver = null;
      }
    }
  };
  DeadClickTracker.prototype.stopTracking = function() {
    if (!this.isTracking) {
      return;
    }
    this.isTracking = false;
    this.pendingClicks = [];
    this.lastChangeEventTimestamp = 0;
    this.processingActive = false;
    if (this.processingTimeout) {
      clearTimeout(this.processingTimeout);
      this.processingTimeout = null;
    }
    for (var i3 = 0; i3 < this.eventListeners.length; i3++) {
      var listener = this.eventListeners[i3];
      try {
        listener.target.removeEventListener(listener.event, listener.handler, listener.options);
      } catch (e3) {
        logger$3.critical("Error while removing event listener", e3);
      }
    }
    this.eventListeners = [];
    if (this.mutationObserver) {
      try {
        this.mutationObserver.disconnect();
      } catch (e3) {
        logger$3.critical("Error while disconnecting mutation observer", e3);
      }
      this.mutationObserver = null;
    }
    if (this.shadowDOMObserver) {
      try {
        this.shadowDOMObserver.stop();
      } catch (e3) {
        logger$3.critical("Error while stopping shadow DOM observer", e3);
      }
      this.shadowDOMObserver = null;
    }
  };
  var AUTOCAPTURE_CONFIG_KEY = "autocapture";
  var LEGACY_PAGEVIEW_CONFIG_KEY = "track_pageview";
  var PAGEVIEW_OPTION_FULL_URL = "full-url";
  var PAGEVIEW_OPTION_URL_WITH_PATH_AND_QUERY_STRING = "url-with-path-and-query-string";
  var PAGEVIEW_OPTION_URL_WITH_PATH = "url-with-path";
  var CONFIG_ALLOW_ELEMENT_CALLBACK = "allow_element_callback";
  var CONFIG_ALLOW_SELECTORS = "allow_selectors";
  var CONFIG_ALLOW_URL_REGEXES = "allow_url_regexes";
  var CONFIG_BLOCK_ATTRS = "block_attrs";
  var CONFIG_BLOCK_ELEMENT_CALLBACK = "block_element_callback";
  var CONFIG_BLOCK_SELECTORS = "block_selectors";
  var CONFIG_BLOCK_URL_REGEXES = "block_url_regexes";
  var CONFIG_CAPTURE_EXTRA_ATTRS = "capture_extra_attrs";
  var CONFIG_CAPTURE_TEXT_CONTENT = "capture_text_content";
  var CONFIG_SCROLL_CAPTURE_ALL = "scroll_capture_all";
  var CONFIG_SCROLL_CHECKPOINTS = "scroll_depth_percent_checkpoints";
  var CONFIG_TRACK_CLICK = "click";
  var CONFIG_TRACK_DEAD_CLICK = "dead_click";
  var CONFIG_TRACK_INPUT = "input";
  var CONFIG_TRACK_PAGEVIEW = "pageview";
  var CONFIG_TRACK_RAGE_CLICK = "rage_click";
  var CONFIG_TRACK_SCROLL = "scroll";
  var CONFIG_TRACK_PAGE_LEAVE = "page_leave";
  var CONFIG_TRACK_SUBMIT = "submit";
  var CONFIG_DEFAULTS$1 = {};
  CONFIG_DEFAULTS$1[CONFIG_ALLOW_SELECTORS] = [];
  CONFIG_DEFAULTS$1[CONFIG_ALLOW_URL_REGEXES] = [];
  CONFIG_DEFAULTS$1[CONFIG_BLOCK_ATTRS] = [];
  CONFIG_DEFAULTS$1[CONFIG_BLOCK_ELEMENT_CALLBACK] = null;
  CONFIG_DEFAULTS$1[CONFIG_BLOCK_SELECTORS] = [];
  CONFIG_DEFAULTS$1[CONFIG_BLOCK_URL_REGEXES] = [];
  CONFIG_DEFAULTS$1[CONFIG_CAPTURE_EXTRA_ATTRS] = [];
  CONFIG_DEFAULTS$1[CONFIG_CAPTURE_TEXT_CONTENT] = false;
  CONFIG_DEFAULTS$1[CONFIG_SCROLL_CAPTURE_ALL] = false;
  CONFIG_DEFAULTS$1[CONFIG_SCROLL_CHECKPOINTS] = [25, 50, 75, 100];
  CONFIG_DEFAULTS$1[CONFIG_TRACK_CLICK] = true;
  CONFIG_DEFAULTS$1[CONFIG_TRACK_DEAD_CLICK] = true;
  CONFIG_DEFAULTS$1[CONFIG_TRACK_INPUT] = true;
  CONFIG_DEFAULTS$1[CONFIG_TRACK_PAGEVIEW] = PAGEVIEW_OPTION_FULL_URL;
  CONFIG_DEFAULTS$1[CONFIG_TRACK_RAGE_CLICK] = true;
  CONFIG_DEFAULTS$1[CONFIG_TRACK_SCROLL] = true;
  CONFIG_DEFAULTS$1[CONFIG_TRACK_PAGE_LEAVE] = false;
  CONFIG_DEFAULTS$1[CONFIG_TRACK_SUBMIT] = true;
  var DEFAULT_PROPS = {
    "$mp_autocapture": true
  };
  var MP_EV_CLICK = "$mp_click";
  var MP_EV_DEAD_CLICK = "$mp_dead_click";
  var MP_EV_INPUT = "$mp_input_change";
  var MP_EV_RAGE_CLICK = "$mp_rage_click";
  var MP_EV_SCROLL = "$mp_scroll";
  var MP_EV_SUBMIT = "$mp_submit";
  var MP_EV_PAGE_LEAVE = "$mp_page_leave";
  var Autocapture = function(mp) {
    this.mp = mp;
    this.maxScrollViewDepth = 0;
    this.hasTrackedScrollSession = false;
    this.previousScrollHeight = 0;
  };
  Autocapture.prototype.init = function() {
    if (!minDOMApisSupported()) {
      logger$3.critical("Autocapture unavailable: missing required DOM APIs");
      return;
    }
    this.initPageListeners();
    this.initPageviewTracking();
    this.initClickTracking();
    this.initDeadClickTracking();
    this.initInputTracking();
    this.initScrollTracking();
    this.initSubmitTracking();
    this.initRageClickTracking();
    this.initPageLeaveTracking();
  };
  Autocapture.prototype.getFullConfig = function() {
    var autocaptureConfig = this.mp.get_config(AUTOCAPTURE_CONFIG_KEY);
    if (!autocaptureConfig) {
      return {};
    } else if (_3.isObject(autocaptureConfig)) {
      return _3.extend({}, CONFIG_DEFAULTS$1, autocaptureConfig);
    } else {
      return CONFIG_DEFAULTS$1;
    }
  };
  Autocapture.prototype.getConfig = function(key) {
    return this.getFullConfig()[key];
  };
  Autocapture.prototype.currentUrlBlocked = function() {
    var i3;
    var currentUrl = _3.info.currentUrl();
    var allowUrlRegexes = this.getConfig(CONFIG_ALLOW_URL_REGEXES) || [];
    if (allowUrlRegexes.length) {
      var allowed = false;
      for (i3 = 0; i3 < allowUrlRegexes.length; i3++) {
        var allowRegex = allowUrlRegexes[i3];
        try {
          if (currentUrl.match(allowRegex)) {
            allowed = true;
            break;
          }
        } catch (err) {
          logger$3.critical("Error while checking block URL regex: " + allowRegex, err);
          return true;
        }
      }
      if (!allowed) {
        return true;
      }
    }
    var blockUrlRegexes = this.getConfig(CONFIG_BLOCK_URL_REGEXES) || [];
    if (!blockUrlRegexes || !blockUrlRegexes.length) {
      return false;
    }
    for (i3 = 0; i3 < blockUrlRegexes.length; i3++) {
      try {
        if (currentUrl.match(blockUrlRegexes[i3])) {
          return true;
        }
      } catch (err) {
        logger$3.critical("Error while checking block URL regex: " + blockUrlRegexes[i3], err);
        return true;
      }
    }
    return false;
  };
  Autocapture.prototype.pageviewTrackingConfig = function() {
    if (this.mp.get_config(AUTOCAPTURE_CONFIG_KEY)) {
      return this.getConfig(CONFIG_TRACK_PAGEVIEW);
    } else {
      return this.mp.get_config(LEGACY_PAGEVIEW_CONFIG_KEY);
    }
  };
  Autocapture.prototype.trackDomEvent = function(ev, mpEventName) {
    if (this.currentUrlBlocked()) {
      return;
    }
    var isCapturedForHeatMap = this.mp.is_recording_heatmap_data() && (mpEventName === MP_EV_CLICK && !this.getConfig(CONFIG_TRACK_CLICK) || mpEventName === MP_EV_RAGE_CLICK && !this._getClickTrackingConfig(CONFIG_TRACK_RAGE_CLICK) || mpEventName === MP_EV_DEAD_CLICK && !this._getClickTrackingConfig(CONFIG_TRACK_DEAD_CLICK));
    var props = getPropsForDOMEvent(ev, {
      allowElementCallback: this.getConfig(CONFIG_ALLOW_ELEMENT_CALLBACK),
      allowSelectors: this.getConfig(CONFIG_ALLOW_SELECTORS),
      blockAttrs: this.getConfig(CONFIG_BLOCK_ATTRS),
      blockElementCallback: this.getConfig(CONFIG_BLOCK_ELEMENT_CALLBACK),
      blockSelectors: this.getConfig(CONFIG_BLOCK_SELECTORS),
      captureExtraAttrs: this.getConfig(CONFIG_CAPTURE_EXTRA_ATTRS),
      captureTextContent: this.getConfig(CONFIG_CAPTURE_TEXT_CONTENT),
      capturedForHeatMap: isCapturedForHeatMap
    });
    if (props) {
      _3.extend(props, DEFAULT_PROPS);
      this.mp.track(mpEventName, props);
    }
  };
  Autocapture.prototype.initPageListeners = function() {
    win.removeEventListener(EV_POPSTATE, this.listenerPopstate);
    win.removeEventListener(EV_HASHCHANGE, this.listenerHashchange);
    if (!this.pageviewTrackingConfig() && !this.getConfig(CONFIG_TRACK_PAGE_LEAVE) && !this.mp.get_config("record_heatmap_data")) {
      return;
    }
    this.listenerPopstate = function() {
      win.dispatchEvent(new Event(EV_MP_LOCATION_CHANGE));
    };
    this.listenerHashchange = function() {
      win.dispatchEvent(new Event(EV_MP_LOCATION_CHANGE));
    };
    win.addEventListener(EV_POPSTATE, this.listenerPopstate);
    win.addEventListener(EV_HASHCHANGE, this.listenerHashchange);
    var nativePushState = win.history.pushState;
    if (typeof nativePushState === "function") {
      win.history.pushState = function(state, unused, url) {
        nativePushState.call(win.history, state, unused, url);
        win.dispatchEvent(new Event(EV_MP_LOCATION_CHANGE));
      };
    }
    var nativeReplaceState = win.history.replaceState;
    if (typeof nativeReplaceState === "function") {
      win.history.replaceState = function(state, unused, url) {
        nativeReplaceState.call(win.history, state, unused, url);
        win.dispatchEvent(new Event(EV_MP_LOCATION_CHANGE));
      };
    }
  };
  Autocapture.prototype._getClickTrackingConfig = function(configKey) {
    var config = this.getConfig(configKey);
    if (!config) {
      return null;
    }
    if (config === true) {
      return {};
    }
    if (typeof config === "object") {
      return config;
    }
    return {};
  };
  Autocapture.prototype._trackPageLeave = function(ev, currentUrl, currentScrollHeight) {
    if (this.hasTrackedScrollSession) {
      return;
    }
    if (!this.getConfig(CONFIG_TRACK_PAGE_LEAVE) && !this.mp.is_recording_heatmap_data()) {
      return;
    }
    this.hasTrackedScrollSession = true;
    var viewportHeight = Math.max(document$1.documentElement.clientHeight, win.innerHeight || 0);
    var scrollPercentage = Math.round(Math.max(this.maxScrollViewDepth - viewportHeight, 0) / (currentScrollHeight - viewportHeight) * 100);
    var foldLinePercentage = Math.round(viewportHeight / currentScrollHeight * 100);
    if (currentScrollHeight <= viewportHeight) {
      scrollPercentage = 100;
      foldLinePercentage = 100;
    }
    var props = _3.extend({
      "$max_scroll_view_depth": this.maxScrollViewDepth,
      "$max_scroll_percentage": scrollPercentage,
      "$fold_line_percentage": foldLinePercentage,
      "$scroll_height": currentScrollHeight,
      "$event_type": ev.type,
      "$current_url": currentUrl || _3.info.currentUrl(),
      "$viewportHeight": viewportHeight,
      // This is the fold line
      "$viewportWidth": Math.max(document$1.documentElement.clientWidth, win.innerWidth || 0),
      "$captured_for_heatmap": this.mp.is_recording_heatmap_data()
    }, DEFAULT_PROPS);
    this.mp.track(MP_EV_PAGE_LEAVE, props, { transport: "sendBeacon" });
  };
  Autocapture.prototype._initScrollDepthTracking = function() {
    win.removeEventListener(EV_SCROLL, this.listenerScrollDepth);
    win.removeEventListener(EV_SCROLLEND, this.listenerScrollDepth);
    if (!this.mp.get_config("record_heatmap_data")) {
      return;
    }
    logger$3.log("Initializing scroll depth tracking");
    this.maxScrollViewDepth = Math.max(document$1.documentElement.clientHeight, win.innerHeight || 0);
    var updateScrollDepth = function() {
      if (this.currentUrlBlocked()) {
        return;
      }
      var scrollViewHeight = Math.max(document$1.documentElement.clientHeight, win.innerHeight || 0) + win.scrollY;
      if (scrollViewHeight > this.maxScrollViewDepth) {
        this.maxScrollViewDepth = scrollViewHeight;
      }
      this.previousScrollHeight = document$1.body.scrollHeight;
    }.bind(this);
    var scrollEndPolyfill = getPolyfillScrollEndFunction(updateScrollDepth);
    this.listenerScrollDepth = scrollEndPolyfill.listener;
    win.addEventListener(scrollEndPolyfill.eventType, this.listenerScrollDepth);
  };
  Autocapture.prototype.initClickTracking = function() {
    win.removeEventListener(EV_CLICK, this.listenerClick);
    if (!this.getConfig(CONFIG_TRACK_CLICK) && !this.mp.get_config("record_heatmap_data")) {
      return;
    }
    logger$3.log("Initializing click tracking");
    this.listenerClick = function(ev) {
      if (!this.getConfig(CONFIG_TRACK_CLICK) && !this.mp.is_recording_heatmap_data()) {
        return;
      }
      this.trackDomEvent(ev, MP_EV_CLICK);
    }.bind(this);
    win.addEventListener(EV_CLICK, this.listenerClick);
  };
  Autocapture.prototype.initDeadClickTracking = function() {
    var deadClickConfig = this._getClickTrackingConfig(CONFIG_TRACK_DEAD_CLICK);
    if (!deadClickConfig && !this.mp.get_config("record_heatmap_data")) {
      this.stopDeadClickTracking();
      return;
    }
    logger$3.log("Initializing dead click tracking");
    if (!this._deadClickTracker) {
      this._deadClickTracker = new DeadClickTracker(function(deadClickEvent) {
        this.trackDomEvent(deadClickEvent, MP_EV_DEAD_CLICK);
      }.bind(this));
      this._deadClickTracker.startTracking();
    }
    if (!this.listenerDeadClick) {
      this.listenerDeadClick = function(ev) {
        var currentDeadClickConfig = this._getClickTrackingConfig(CONFIG_TRACK_DEAD_CLICK);
        if (!currentDeadClickConfig && !this.mp.is_recording_heatmap_data()) {
          return;
        }
        if (this.currentUrlBlocked()) {
          return;
        }
        var normalizedConfig = currentDeadClickConfig || {};
        if (!normalizedConfig["timeout_ms"]) {
          normalizedConfig["timeout_ms"] = DEFAULT_DEAD_CLICK_TIMEOUT_MS;
        }
        this._deadClickTracker.trackClick(ev, normalizedConfig);
      }.bind(this);
      win.addEventListener(EV_CLICK, this.listenerDeadClick);
    }
  };
  Autocapture.prototype.initInputTracking = function() {
    win.removeEventListener(EV_CHANGE, this.listenerChange);
    if (!this.getConfig(CONFIG_TRACK_INPUT)) {
      return;
    }
    logger$3.log("Initializing input tracking");
    this.listenerChange = function(ev) {
      if (!this.getConfig(CONFIG_TRACK_INPUT)) {
        return;
      }
      this.trackDomEvent(ev, MP_EV_INPUT);
    }.bind(this);
    win.addEventListener(EV_CHANGE, this.listenerChange);
  };
  Autocapture.prototype.initPageviewTracking = function() {
    win.removeEventListener(EV_MP_LOCATION_CHANGE, this.listenerLocationchange);
    if (!this.pageviewTrackingConfig()) {
      return;
    }
    logger$3.log("Initializing pageview tracking");
    var previousTrackedUrl = "";
    var tracked = false;
    if (!this.currentUrlBlocked()) {
      tracked = this.mp.track_pageview(DEFAULT_PROPS);
    }
    if (tracked) {
      previousTrackedUrl = _3.info.currentUrl();
    }
    this.listenerLocationchange = safewrap(function() {
      if (this.currentUrlBlocked()) {
        return;
      }
      var currentUrl = _3.info.currentUrl();
      var shouldTrack = false;
      var didPathChange = currentUrl.split("#")[0].split("?")[0] !== previousTrackedUrl.split("#")[0].split("?")[0];
      var trackPageviewOption = this.pageviewTrackingConfig();
      if (trackPageviewOption === PAGEVIEW_OPTION_FULL_URL) {
        shouldTrack = currentUrl !== previousTrackedUrl;
      } else if (trackPageviewOption === PAGEVIEW_OPTION_URL_WITH_PATH_AND_QUERY_STRING) {
        shouldTrack = currentUrl.split("#")[0] !== previousTrackedUrl.split("#")[0];
      } else if (trackPageviewOption === PAGEVIEW_OPTION_URL_WITH_PATH) {
        shouldTrack = didPathChange;
      }
      if (shouldTrack) {
        var tracked2 = this.mp.track_pageview(DEFAULT_PROPS);
        if (tracked2) {
          previousTrackedUrl = currentUrl;
        }
        if (didPathChange) {
          this.lastScrollCheckpoint = 0;
          logger$3.log("Path change: re-initializing scroll depth checkpoints");
        }
      }
    }.bind(this));
    win.addEventListener(EV_MP_LOCATION_CHANGE, this.listenerLocationchange);
  };
  Autocapture.prototype.initRageClickTracking = function() {
    win.removeEventListener(EV_CLICK, this.listenerRageClick);
    var rageClickConfig = this._getClickTrackingConfig(CONFIG_TRACK_RAGE_CLICK);
    if (!rageClickConfig && !this.mp.get_config("record_heatmap_data")) {
      return;
    }
    logger$3.log("Initializing rage click tracking");
    if (!this._rageClickTracker) {
      this._rageClickTracker = new RageClickTracker();
    }
    this.listenerRageClick = function(ev) {
      var currentRageClickConfig = this._getClickTrackingConfig(CONFIG_TRACK_RAGE_CLICK);
      if (!currentRageClickConfig && !this.mp.is_recording_heatmap_data()) {
        return;
      }
      if (this.currentUrlBlocked()) {
        return;
      }
      if (this._rageClickTracker.isRageClick(ev, currentRageClickConfig)) {
        this.trackDomEvent(ev, MP_EV_RAGE_CLICK);
      }
    }.bind(this);
    win.addEventListener(EV_CLICK, this.listenerRageClick);
  };
  Autocapture.prototype.initScrollTracking = function() {
    win.removeEventListener(EV_SCROLLEND, this.listenerScroll);
    win.removeEventListener(EV_SCROLL, this.listenerScroll);
    if (!this.getConfig(CONFIG_TRACK_SCROLL)) {
      return;
    }
    logger$3.log("Initializing scroll tracking");
    this.lastScrollCheckpoint = 0;
    var scrollTrackFunction = function() {
      if (!this.getConfig(CONFIG_TRACK_SCROLL)) {
        return;
      }
      if (this.currentUrlBlocked()) {
        return;
      }
      var shouldTrack = this.getConfig(CONFIG_SCROLL_CAPTURE_ALL);
      var scrollCheckpoints = (this.getConfig(CONFIG_SCROLL_CHECKPOINTS) || []).slice().sort(function(a3, b2) {
        return a3 - b2;
      });
      var scrollTop = win.scrollY;
      var props = _3.extend({ "$scroll_top": scrollTop }, DEFAULT_PROPS);
      try {
        var scrollHeight = document$1.body.scrollHeight;
        var scrollPercentage = Math.round(scrollTop / (scrollHeight - win.innerHeight) * 100);
        props["$scroll_height"] = scrollHeight;
        props["$scroll_percentage"] = scrollPercentage;
        if (scrollPercentage > this.lastScrollCheckpoint) {
          for (var i3 = 0; i3 < scrollCheckpoints.length; i3++) {
            var checkpoint = scrollCheckpoints[i3];
            if (scrollPercentage >= checkpoint && this.lastScrollCheckpoint < checkpoint) {
              props["$scroll_checkpoint"] = checkpoint;
              this.lastScrollCheckpoint = checkpoint;
              shouldTrack = true;
            }
          }
        }
      } catch (err) {
        logger$3.critical("Error while calculating scroll percentage", err);
      }
      if (shouldTrack) {
        this.mp.track(MP_EV_SCROLL, props);
      }
    }.bind(this);
    var scrollEndPolyfill = getPolyfillScrollEndFunction(scrollTrackFunction);
    this.listenerScroll = scrollEndPolyfill.listener;
    win.addEventListener(scrollEndPolyfill.eventType, this.listenerScroll);
  };
  Autocapture.prototype.initSubmitTracking = function() {
    win.removeEventListener(EV_SUBMIT, this.listenerSubmit);
    if (!this.getConfig(CONFIG_TRACK_SUBMIT)) {
      return;
    }
    logger$3.log("Initializing submit tracking");
    this.listenerSubmit = function(ev) {
      if (!this.getConfig(CONFIG_TRACK_SUBMIT)) {
        return;
      }
      this.trackDomEvent(ev, MP_EV_SUBMIT);
    }.bind(this);
    win.addEventListener(EV_SUBMIT, this.listenerSubmit);
  };
  Autocapture.prototype.initPageLeaveTracking = function() {
    document$1.removeEventListener(EV_VISIBILITYCHANGE, this.listenerPageLeaveVisibilitychange);
    win.removeEventListener(EV_MP_LOCATION_CHANGE, this.listenerPageLeaveLocationchange);
    win.removeEventListener(EV_LOAD, this.listenerPageLoad);
    if (!this.getConfig(CONFIG_TRACK_PAGE_LEAVE) && !this.mp.get_config("record_heatmap_data")) {
      return;
    }
    logger$3.log("Initializing page visibility tracking.");
    this._initScrollDepthTracking();
    var previousTrackedUrl = _3.info.currentUrl();
    this.listenerPageLoad = function() {
      this.previousScrollHeight = document$1.body.scrollHeight;
    }.bind(this);
    win.addEventListener(EV_LOAD, this.listenerPageLoad);
    this.listenerPageLeaveLocationchange = safewrap(function(ev) {
      if (this.currentUrlBlocked()) {
        return;
      }
      var currentUrl = _3.info.currentUrl();
      var shouldTrack = currentUrl !== previousTrackedUrl;
      if (shouldTrack) {
        this._trackPageLeave(ev, previousTrackedUrl, this.previousScrollHeight);
        previousTrackedUrl = currentUrl;
        this.maxScrollViewDepth = Math.max(document$1.documentElement.clientHeight, win.innerHeight || 0);
        this.previousScrollHeight = document$1.body.scrollHeight;
        this.hasTrackedScrollSession = false;
      }
    }.bind(this));
    win.addEventListener(EV_MP_LOCATION_CHANGE, this.listenerPageLeaveLocationchange);
    this.listenerPageLeaveVisibilitychange = function(ev) {
      if (document$1.hidden) {
        this._trackPageLeave(ev, previousTrackedUrl, this.previousScrollHeight);
      }
    }.bind(this);
    document$1.addEventListener(EV_VISIBILITYCHANGE, this.listenerPageLeaveVisibilitychange);
  };
  Autocapture.prototype.stopDeadClickTracking = function() {
    if (this.listenerDeadClick) {
      win.removeEventListener(EV_CLICK, this.listenerDeadClick);
      this.listenerDeadClick = null;
    }
    if (this._deadClickTracker) {
      this._deadClickTracker.stopTracking();
      this._deadClickTracker = null;
    }
  };
  safewrapClass(Autocapture);
  var logger = console_with_prefix("flags");
  var FLAGS_CONFIG_KEY = "flags";
  var CONFIG_CONTEXT = "context";
  var CONFIG_DEFAULTS = {};
  CONFIG_DEFAULTS[CONFIG_CONTEXT] = {};
  var FeatureFlagManager = function(initOptions) {
    this.fetch = win["fetch"];
    this.getFullApiRoute = initOptions.getFullApiRoute;
    this.getMpConfig = initOptions.getConfigFunc;
    this.setMpConfig = initOptions.setConfigFunc;
    this.getMpProperty = initOptions.getPropertyFunc;
    this.track = initOptions.trackingFunc;
  };
  FeatureFlagManager.prototype.init = function() {
    if (!this.minApisSupported()) {
      logger.critical("Feature Flags unavailable: missing minimum required APIs");
      return;
    }
    this.flags = null;
    this.fetchFlags();
    this.trackedFeatures = /* @__PURE__ */ new Set();
  };
  FeatureFlagManager.prototype.getFullConfig = function() {
    var ffConfig = this.getMpConfig(FLAGS_CONFIG_KEY);
    if (!ffConfig) {
      return {};
    } else if (_3.isObject(ffConfig)) {
      return _3.extend({}, CONFIG_DEFAULTS, ffConfig);
    } else {
      return CONFIG_DEFAULTS;
    }
  };
  FeatureFlagManager.prototype.getConfig = function(key) {
    return this.getFullConfig()[key];
  };
  FeatureFlagManager.prototype.isSystemEnabled = function() {
    return !!this.getMpConfig(FLAGS_CONFIG_KEY);
  };
  FeatureFlagManager.prototype.updateContext = function(newContext, options) {
    if (!this.isSystemEnabled()) {
      logger.critical("Feature Flags not enabled, cannot update context");
      return Promise.resolve();
    }
    var ffConfig = this.getMpConfig(FLAGS_CONFIG_KEY);
    if (!_3.isObject(ffConfig)) {
      ffConfig = {};
    }
    var oldContext = options && options["replace"] ? {} : this.getConfig(CONFIG_CONTEXT);
    ffConfig[CONFIG_CONTEXT] = _3.extend({}, oldContext, newContext);
    this.setMpConfig(FLAGS_CONFIG_KEY, ffConfig);
    return this.fetchFlags();
  };
  FeatureFlagManager.prototype.areFlagsReady = function() {
    if (!this.isSystemEnabled()) {
      logger.error("Feature Flags not enabled");
    }
    return !!this.flags;
  };
  FeatureFlagManager.prototype.fetchFlags = function() {
    if (!this.isSystemEnabled()) {
      return Promise.resolve();
    }
    var distinctId = this.getMpProperty("distinct_id");
    var deviceId = this.getMpProperty("$device_id");
    var traceparent = generateTraceparent();
    logger.log("Fetching flags for distinct ID: " + distinctId);
    var context = _3.extend({ "distinct_id": distinctId, "device_id": deviceId }, this.getConfig(CONFIG_CONTEXT));
    var searchParams = new URLSearchParams();
    searchParams.set("context", JSON.stringify(context));
    searchParams.set("token", this.getMpConfig("token"));
    searchParams.set("mp_lib", "web");
    searchParams.set("$lib_version", Config.LIB_VERSION);
    var url = this.getFullApiRoute() + "?" + searchParams.toString();
    this._fetchInProgressStartTime = Date.now();
    this.fetchPromise = this.fetch.call(win, url, {
      "method": "GET",
      "headers": {
        "Authorization": "Basic " + btoa(this.getMpConfig("token") + ":"),
        "traceparent": traceparent
      }
    }).then(function(response) {
      this.markFetchComplete();
      return response.json().then(function(responseBody) {
        var responseFlags = responseBody["flags"];
        if (!responseFlags) {
          throw new Error("No flags in API response");
        }
        var flags = /* @__PURE__ */ new Map();
        _3.each(responseFlags, function(data, key) {
          flags.set(key, {
            "key": data["variant_key"],
            "value": data["variant_value"],
            "experiment_id": data["experiment_id"],
            "is_experiment_active": data["is_experiment_active"],
            "is_qa_tester": data["is_qa_tester"]
          });
        });
        this.flags = flags;
        this._traceparent = traceparent;
      }.bind(this)).catch(function(error) {
        this.markFetchComplete();
        logger.error(error);
      }.bind(this));
    }.bind(this)).catch(function(error) {
      this.markFetchComplete();
      logger.error(error);
    }.bind(this));
    return this.fetchPromise;
  };
  FeatureFlagManager.prototype.markFetchComplete = function() {
    if (!this._fetchInProgressStartTime) {
      logger.error("Fetch in progress started time not set, cannot mark fetch complete");
      return;
    }
    this._fetchStartTime = this._fetchInProgressStartTime;
    this._fetchCompleteTime = Date.now();
    this._fetchLatency = this._fetchCompleteTime - this._fetchStartTime;
    this._fetchInProgressStartTime = null;
  };
  FeatureFlagManager.prototype.getVariant = function(featureName, fallback) {
    if (!this.fetchPromise) {
      return new Promise(function(resolve2) {
        logger.critical("Feature Flags not initialized");
        resolve2(fallback);
      });
    }
    return this.fetchPromise.then(function() {
      return this.getVariantSync(featureName, fallback);
    }.bind(this)).catch(function(error) {
      logger.error(error);
      return fallback;
    });
  };
  FeatureFlagManager.prototype.getVariantSync = function(featureName, fallback) {
    if (!this.areFlagsReady()) {
      logger.log("Flags not loaded yet");
      return fallback;
    }
    var feature = this.flags.get(featureName);
    if (!feature) {
      logger.log('No flag found: "' + featureName + '"');
      return fallback;
    }
    this.trackFeatureCheck(featureName, feature);
    return feature;
  };
  FeatureFlagManager.prototype.getVariantValue = function(featureName, fallbackValue) {
    return this.getVariant(featureName, { "value": fallbackValue }).then(function(feature) {
      return feature["value"];
    }).catch(function(error) {
      logger.error(error);
      return fallbackValue;
    });
  };
  FeatureFlagManager.prototype.getFeatureData = function(featureName, fallbackValue) {
    logger.critical("mixpanel.flags.get_feature_data() is deprecated and will be removed in a future release. Use mixpanel.flags.get_variant_value() instead.");
    return this.getVariantValue(featureName, fallbackValue);
  };
  FeatureFlagManager.prototype.getVariantValueSync = function(featureName, fallbackValue) {
    return this.getVariantSync(featureName, { "value": fallbackValue })["value"];
  };
  FeatureFlagManager.prototype.isEnabled = function(featureName, fallbackValue) {
    return this.getVariantValue(featureName).then(function() {
      return this.isEnabledSync(featureName, fallbackValue);
    }.bind(this)).catch(function(error) {
      logger.error(error);
      return fallbackValue;
    });
  };
  FeatureFlagManager.prototype.isEnabledSync = function(featureName, fallbackValue) {
    fallbackValue = fallbackValue || false;
    var val = this.getVariantValueSync(featureName, fallbackValue);
    if (val !== true && val !== false) {
      logger.error('Feature flag "' + featureName + '" value: ' + val + " is not a boolean; returning fallback value: " + fallbackValue);
      val = fallbackValue;
    }
    return val;
  };
  FeatureFlagManager.prototype.trackFeatureCheck = function(featureName, feature) {
    if (this.trackedFeatures.has(featureName)) {
      return;
    }
    this.trackedFeatures.add(featureName);
    var trackingProperties = {
      "Experiment name": featureName,
      "Variant name": feature["key"],
      "$experiment_type": "feature_flag",
      "Variant fetch start time": new Date(this._fetchStartTime).toISOString(),
      "Variant fetch complete time": new Date(this._fetchCompleteTime).toISOString(),
      "Variant fetch latency (ms)": this._fetchLatency,
      "Variant fetch traceparent": this._traceparent
    };
    if (feature["experiment_id"] !== "undefined") {
      trackingProperties["$experiment_id"] = feature["experiment_id"];
    }
    if (feature["is_experiment_active"] !== "undefined") {
      trackingProperties["$is_experiment_active"] = feature["is_experiment_active"];
    }
    if (feature["is_qa_tester"] !== "undefined") {
      trackingProperties["$is_qa_tester"] = feature["is_qa_tester"];
    }
    this.track("$experiment_started", trackingProperties);
  };
  FeatureFlagManager.prototype.minApisSupported = function() {
    return !!this.fetch && typeof Promise !== "undefined" && typeof Map !== "undefined" && typeof Set !== "undefined";
  };
  safewrapClass(FeatureFlagManager);
  FeatureFlagManager.prototype["are_flags_ready"] = FeatureFlagManager.prototype.areFlagsReady;
  FeatureFlagManager.prototype["get_variant"] = FeatureFlagManager.prototype.getVariant;
  FeatureFlagManager.prototype["get_variant_sync"] = FeatureFlagManager.prototype.getVariantSync;
  FeatureFlagManager.prototype["get_variant_value"] = FeatureFlagManager.prototype.getVariantValue;
  FeatureFlagManager.prototype["get_variant_value_sync"] = FeatureFlagManager.prototype.getVariantValueSync;
  FeatureFlagManager.prototype["is_enabled"] = FeatureFlagManager.prototype.isEnabled;
  FeatureFlagManager.prototype["is_enabled_sync"] = FeatureFlagManager.prototype.isEnabledSync;
  FeatureFlagManager.prototype["update_context"] = FeatureFlagManager.prototype.updateContext;
  FeatureFlagManager.prototype["get_feature_data"] = FeatureFlagManager.prototype.getFeatureData;
  var DomTracker = function() {
  };
  DomTracker.prototype.create_properties = function() {
  };
  DomTracker.prototype.event_handler = function() {
  };
  DomTracker.prototype.after_track_handler = function() {
  };
  DomTracker.prototype.init = function(mixpanel_instance) {
    this.mp = mixpanel_instance;
    return this;
  };
  DomTracker.prototype.track = function(query, event_name, properties, user_callback) {
    var that = this;
    var elements = _3.dom_query(query);
    if (elements.length === 0) {
      console$1.error("The DOM query (" + query + ") returned 0 elements");
      return;
    }
    _3.each(elements, function(element) {
      _3.register_event(element, this.override_event, function(e3) {
        var options = {};
        var props = that.create_properties(properties, this);
        var timeout = that.mp.get_config("track_links_timeout");
        that.event_handler(e3, this, options);
        window.setTimeout(that.track_callback(user_callback, props, options, true), timeout);
        that.mp.track(event_name, props, that.track_callback(user_callback, props, options));
      });
    }, this);
    return true;
  };
  DomTracker.prototype.track_callback = function(user_callback, props, options, timeout_occured) {
    timeout_occured = timeout_occured || false;
    var that = this;
    return function() {
      if (options.callback_fired) {
        return;
      }
      options.callback_fired = true;
      if (user_callback && user_callback(timeout_occured, props) === false) {
        return;
      }
      that.after_track_handler(props, options, timeout_occured);
    };
  };
  DomTracker.prototype.create_properties = function(properties, element) {
    var props;
    if (typeof properties === "function") {
      props = properties(element);
    } else {
      props = _3.extend({}, properties);
    }
    return props;
  };
  var LinkTracker = function() {
    this.override_event = "click";
  };
  _3.inherit(LinkTracker, DomTracker);
  LinkTracker.prototype.create_properties = function(properties, element) {
    var props = LinkTracker.superclass.create_properties.apply(this, arguments);
    if (element.href) {
      props["url"] = element.href;
    }
    return props;
  };
  LinkTracker.prototype.event_handler = function(evt, element, options) {
    options.new_tab = evt.which === 2 || evt.metaKey || evt.ctrlKey || element.target === "_blank";
    options.href = element.href;
    if (!options.new_tab) {
      evt.preventDefault();
    }
  };
  LinkTracker.prototype.after_track_handler = function(props, options) {
    if (options.new_tab) {
      return;
    }
    setTimeout(function() {
      window.location = options.href;
    }, 0);
  };
  var FormTracker = function() {
    this.override_event = "submit";
  };
  _3.inherit(FormTracker, DomTracker);
  FormTracker.prototype.event_handler = function(evt, element, options) {
    options.element = element;
    evt.preventDefault();
  };
  FormTracker.prototype.after_track_handler = function(props, options) {
    setTimeout(function() {
      options.element.submit();
    }, 0);
  };
  var SET_ACTION = "$set";
  var SET_ONCE_ACTION = "$set_once";
  var UNSET_ACTION = "$unset";
  var ADD_ACTION = "$add";
  var APPEND_ACTION = "$append";
  var UNION_ACTION = "$union";
  var REMOVE_ACTION = "$remove";
  var DELETE_ACTION = "$delete";
  var apiActions = {
    set_action: function(prop, to) {
      var data = {};
      var $set = {};
      if (_3.isObject(prop)) {
        _3.each(prop, function(v3, k4) {
          if (!this._is_reserved_property(k4)) {
            $set[k4] = v3;
          }
        }, this);
      } else {
        $set[prop] = to;
      }
      data[SET_ACTION] = $set;
      return data;
    },
    unset_action: function(prop) {
      var data = {};
      var $unset = [];
      if (!_3.isArray(prop)) {
        prop = [prop];
      }
      _3.each(prop, function(k4) {
        if (!this._is_reserved_property(k4)) {
          $unset.push(k4);
        }
      }, this);
      data[UNSET_ACTION] = $unset;
      return data;
    },
    set_once_action: function(prop, to) {
      var data = {};
      var $set_once = {};
      if (_3.isObject(prop)) {
        _3.each(prop, function(v3, k4) {
          if (!this._is_reserved_property(k4)) {
            $set_once[k4] = v3;
          }
        }, this);
      } else {
        $set_once[prop] = to;
      }
      data[SET_ONCE_ACTION] = $set_once;
      return data;
    },
    union_action: function(list_name, values) {
      var data = {};
      var $union = {};
      if (_3.isObject(list_name)) {
        _3.each(list_name, function(v3, k4) {
          if (!this._is_reserved_property(k4)) {
            $union[k4] = _3.isArray(v3) ? v3 : [v3];
          }
        }, this);
      } else {
        $union[list_name] = _3.isArray(values) ? values : [values];
      }
      data[UNION_ACTION] = $union;
      return data;
    },
    append_action: function(list_name, value) {
      var data = {};
      var $append = {};
      if (_3.isObject(list_name)) {
        _3.each(list_name, function(v3, k4) {
          if (!this._is_reserved_property(k4)) {
            $append[k4] = v3;
          }
        }, this);
      } else {
        $append[list_name] = value;
      }
      data[APPEND_ACTION] = $append;
      return data;
    },
    remove_action: function(list_name, value) {
      var data = {};
      var $remove = {};
      if (_3.isObject(list_name)) {
        _3.each(list_name, function(v3, k4) {
          if (!this._is_reserved_property(k4)) {
            $remove[k4] = v3;
          }
        }, this);
      } else {
        $remove[list_name] = value;
      }
      data[REMOVE_ACTION] = $remove;
      return data;
    },
    delete_action: function() {
      var data = {};
      data[DELETE_ACTION] = "";
      return data;
    }
  };
  var MixpanelGroup = function() {
  };
  _3.extend(MixpanelGroup.prototype, apiActions);
  MixpanelGroup.prototype._init = function(mixpanel_instance, group_key, group_id) {
    this._mixpanel = mixpanel_instance;
    this._group_key = group_key;
    this._group_id = group_id;
  };
  MixpanelGroup.prototype.set = addOptOutCheckMixpanelGroup(function(prop, to, callback) {
    var data = this.set_action(prop, to);
    if (_3.isObject(prop)) {
      callback = to;
    }
    return this._send_request(data, callback);
  });
  MixpanelGroup.prototype.set_once = addOptOutCheckMixpanelGroup(function(prop, to, callback) {
    var data = this.set_once_action(prop, to);
    if (_3.isObject(prop)) {
      callback = to;
    }
    return this._send_request(data, callback);
  });
  MixpanelGroup.prototype.unset = addOptOutCheckMixpanelGroup(function(prop, callback) {
    var data = this.unset_action(prop);
    return this._send_request(data, callback);
  });
  MixpanelGroup.prototype.union = addOptOutCheckMixpanelGroup(function(list_name, values, callback) {
    if (_3.isObject(list_name)) {
      callback = values;
    }
    var data = this.union_action(list_name, values);
    return this._send_request(data, callback);
  });
  MixpanelGroup.prototype["delete"] = addOptOutCheckMixpanelGroup(function(callback) {
    var data = this.delete_action();
    return this._send_request(data, callback);
  });
  MixpanelGroup.prototype.remove = addOptOutCheckMixpanelGroup(function(list_name, value, callback) {
    var data = this.remove_action(list_name, value);
    return this._send_request(data, callback);
  });
  MixpanelGroup.prototype._send_request = function(data, callback) {
    data["$group_key"] = this._group_key;
    data["$group_id"] = this._group_id;
    data["$token"] = this._get_config("token");
    var date_encoded_data = _3.encodeDates(data);
    return this._mixpanel._track_or_batch({
      type: "groups",
      data: date_encoded_data,
      endpoint: this._mixpanel.get_api_host("groups") + "/" + this._get_config("api_routes")["groups"],
      batcher: this._mixpanel.request_batchers.groups
    }, callback);
  };
  MixpanelGroup.prototype._is_reserved_property = function(prop) {
    return prop === "$group_key" || prop === "$group_id";
  };
  MixpanelGroup.prototype._get_config = function(conf) {
    return this._mixpanel.get_config(conf);
  };
  MixpanelGroup.prototype.toString = function() {
    return this._mixpanel.toString() + ".group." + this._group_key + "." + this._group_id;
  };
  MixpanelGroup.prototype["remove"] = MixpanelGroup.prototype.remove;
  MixpanelGroup.prototype["set"] = MixpanelGroup.prototype.set;
  MixpanelGroup.prototype["set_once"] = MixpanelGroup.prototype.set_once;
  MixpanelGroup.prototype["union"] = MixpanelGroup.prototype.union;
  MixpanelGroup.prototype["unset"] = MixpanelGroup.prototype.unset;
  MixpanelGroup.prototype["toString"] = MixpanelGroup.prototype.toString;
  var MixpanelPeople = function() {
  };
  _3.extend(MixpanelPeople.prototype, apiActions);
  MixpanelPeople.prototype._init = function(mixpanel_instance) {
    this._mixpanel = mixpanel_instance;
  };
  MixpanelPeople.prototype.set = addOptOutCheckMixpanelPeople(function(prop, to, callback) {
    var data = this.set_action(prop, to);
    if (_3.isObject(prop)) {
      callback = to;
    }
    if (this._get_config("save_referrer")) {
      this._mixpanel["persistence"].update_referrer_info(document.referrer);
    }
    data[SET_ACTION] = _3.extend(
      {},
      _3.info.people_properties(),
      data[SET_ACTION]
    );
    return this._send_request(data, callback);
  });
  MixpanelPeople.prototype.set_once = addOptOutCheckMixpanelPeople(function(prop, to, callback) {
    var data = this.set_once_action(prop, to);
    if (_3.isObject(prop)) {
      callback = to;
    }
    return this._send_request(data, callback);
  });
  MixpanelPeople.prototype.unset = addOptOutCheckMixpanelPeople(function(prop, callback) {
    var data = this.unset_action(prop);
    return this._send_request(data, callback);
  });
  MixpanelPeople.prototype.increment = addOptOutCheckMixpanelPeople(function(prop, by, callback) {
    var data = {};
    var $add = {};
    if (_3.isObject(prop)) {
      _3.each(prop, function(v3, k4) {
        if (!this._is_reserved_property(k4)) {
          if (isNaN(parseFloat(v3))) {
            console$1.error("Invalid increment value passed to mixpanel.people.increment - must be a number");
            return;
          } else {
            $add[k4] = v3;
          }
        }
      }, this);
      callback = by;
    } else {
      if (_3.isUndefined(by)) {
        by = 1;
      }
      $add[prop] = by;
    }
    data[ADD_ACTION] = $add;
    return this._send_request(data, callback);
  });
  MixpanelPeople.prototype.append = addOptOutCheckMixpanelPeople(function(list_name, value, callback) {
    if (_3.isObject(list_name)) {
      callback = value;
    }
    var data = this.append_action(list_name, value);
    return this._send_request(data, callback);
  });
  MixpanelPeople.prototype.remove = addOptOutCheckMixpanelPeople(function(list_name, value, callback) {
    if (_3.isObject(list_name)) {
      callback = value;
    }
    var data = this.remove_action(list_name, value);
    return this._send_request(data, callback);
  });
  MixpanelPeople.prototype.union = addOptOutCheckMixpanelPeople(function(list_name, values, callback) {
    if (_3.isObject(list_name)) {
      callback = values;
    }
    var data = this.union_action(list_name, values);
    return this._send_request(data, callback);
  });
  MixpanelPeople.prototype.track_charge = addOptOutCheckMixpanelPeople(function() {
    console$1.error("mixpanel.people.track_charge() is deprecated and no longer has any effect.");
  });
  MixpanelPeople.prototype.clear_charges = function(callback) {
    return this.set("$transactions", [], callback);
  };
  MixpanelPeople.prototype.delete_user = function() {
    if (!this._identify_called()) {
      console$1.error("mixpanel.people.delete_user() requires you to call identify() first");
      return;
    }
    var data = { "$delete": this._mixpanel.get_distinct_id() };
    return this._send_request(data);
  };
  MixpanelPeople.prototype.toString = function() {
    return this._mixpanel.toString() + ".people";
  };
  MixpanelPeople.prototype._send_request = function(data, callback) {
    data["$token"] = this._get_config("token");
    data["$distinct_id"] = this._mixpanel.get_distinct_id();
    var device_id = this._mixpanel.get_property("$device_id");
    var user_id = this._mixpanel.get_property("$user_id");
    var had_persisted_distinct_id = this._mixpanel.get_property("$had_persisted_distinct_id");
    if (device_id) {
      data["$device_id"] = device_id;
    }
    if (user_id) {
      data["$user_id"] = user_id;
    }
    if (had_persisted_distinct_id) {
      data["$had_persisted_distinct_id"] = had_persisted_distinct_id;
    }
    var date_encoded_data = _3.encodeDates(data);
    if (!this._identify_called()) {
      this._enqueue(data);
      if (!_3.isUndefined(callback)) {
        if (this._get_config("verbose")) {
          callback({ status: -1, error: null });
        } else {
          callback(-1);
        }
      }
      return _3.truncate(date_encoded_data, 255);
    }
    return this._mixpanel._track_or_batch({
      type: "people",
      data: date_encoded_data,
      endpoint: this._mixpanel.get_api_host("people") + "/" + this._get_config("api_routes")["engage"],
      batcher: this._mixpanel.request_batchers.people
    }, callback);
  };
  MixpanelPeople.prototype._get_config = function(conf_var) {
    return this._mixpanel.get_config(conf_var);
  };
  MixpanelPeople.prototype._identify_called = function() {
    return this._mixpanel._flags.identify_called === true;
  };
  MixpanelPeople.prototype._enqueue = function(data) {
    if (SET_ACTION in data) {
      this._mixpanel["persistence"]._add_to_people_queue(SET_ACTION, data);
    } else if (SET_ONCE_ACTION in data) {
      this._mixpanel["persistence"]._add_to_people_queue(SET_ONCE_ACTION, data);
    } else if (UNSET_ACTION in data) {
      this._mixpanel["persistence"]._add_to_people_queue(UNSET_ACTION, data);
    } else if (ADD_ACTION in data) {
      this._mixpanel["persistence"]._add_to_people_queue(ADD_ACTION, data);
    } else if (APPEND_ACTION in data) {
      this._mixpanel["persistence"]._add_to_people_queue(APPEND_ACTION, data);
    } else if (REMOVE_ACTION in data) {
      this._mixpanel["persistence"]._add_to_people_queue(REMOVE_ACTION, data);
    } else if (UNION_ACTION in data) {
      this._mixpanel["persistence"]._add_to_people_queue(UNION_ACTION, data);
    } else {
      console$1.error("Invalid call to _enqueue():", data);
    }
  };
  MixpanelPeople.prototype._flush_one_queue = function(action, action_method, callback, queue_to_params_fn) {
    var _this = this;
    var queued_data = _3.extend({}, this._mixpanel["persistence"].load_queue(action));
    var action_params = queued_data;
    if (!_3.isUndefined(queued_data) && _3.isObject(queued_data) && !_3.isEmptyObject(queued_data)) {
      _this._mixpanel["persistence"]._pop_from_people_queue(action, queued_data);
      _this._mixpanel["persistence"].save();
      if (queue_to_params_fn) {
        action_params = queue_to_params_fn(queued_data);
      }
      action_method.call(_this, action_params, function(response, data) {
        if (response === 0) {
          _this._mixpanel["persistence"]._add_to_people_queue(action, queued_data);
        }
        if (!_3.isUndefined(callback)) {
          callback(response, data);
        }
      });
    }
  };
  MixpanelPeople.prototype._flush = function(_set_callback, _add_callback, _append_callback, _set_once_callback, _union_callback, _unset_callback, _remove_callback) {
    var _this = this;
    this._flush_one_queue(SET_ACTION, this.set, _set_callback);
    this._flush_one_queue(SET_ONCE_ACTION, this.set_once, _set_once_callback);
    this._flush_one_queue(UNSET_ACTION, this.unset, _unset_callback, function(queue) {
      return _3.keys(queue);
    });
    this._flush_one_queue(ADD_ACTION, this.increment, _add_callback);
    this._flush_one_queue(UNION_ACTION, this.union, _union_callback);
    var $append_queue = this._mixpanel["persistence"].load_queue(APPEND_ACTION);
    if (!_3.isUndefined($append_queue) && _3.isArray($append_queue) && $append_queue.length) {
      var $append_item;
      var append_callback = function(response, data) {
        if (response === 0) {
          _this._mixpanel["persistence"]._add_to_people_queue(APPEND_ACTION, $append_item);
        }
        if (!_3.isUndefined(_append_callback)) {
          _append_callback(response, data);
        }
      };
      for (var i3 = $append_queue.length - 1; i3 >= 0; i3--) {
        $append_queue = this._mixpanel["persistence"].load_queue(APPEND_ACTION);
        $append_item = $append_queue.pop();
        _this._mixpanel["persistence"].save();
        if (!_3.isEmptyObject($append_item)) {
          _this.append($append_item, append_callback);
        }
      }
    }
    var $remove_queue = this._mixpanel["persistence"].load_queue(REMOVE_ACTION);
    if (!_3.isUndefined($remove_queue) && _3.isArray($remove_queue) && $remove_queue.length) {
      var $remove_item;
      var remove_callback = function(response, data) {
        if (response === 0) {
          _this._mixpanel["persistence"]._add_to_people_queue(REMOVE_ACTION, $remove_item);
        }
        if (!_3.isUndefined(_remove_callback)) {
          _remove_callback(response, data);
        }
      };
      for (var j4 = $remove_queue.length - 1; j4 >= 0; j4--) {
        $remove_queue = this._mixpanel["persistence"].load_queue(REMOVE_ACTION);
        $remove_item = $remove_queue.pop();
        _this._mixpanel["persistence"].save();
        if (!_3.isEmptyObject($remove_item)) {
          _this.remove($remove_item, remove_callback);
        }
      }
    }
  };
  MixpanelPeople.prototype._is_reserved_property = function(prop) {
    return prop === "$distinct_id" || prop === "$token" || prop === "$device_id" || prop === "$user_id" || prop === "$had_persisted_distinct_id";
  };
  MixpanelPeople.prototype["set"] = MixpanelPeople.prototype.set;
  MixpanelPeople.prototype["set_once"] = MixpanelPeople.prototype.set_once;
  MixpanelPeople.prototype["unset"] = MixpanelPeople.prototype.unset;
  MixpanelPeople.prototype["increment"] = MixpanelPeople.prototype.increment;
  MixpanelPeople.prototype["append"] = MixpanelPeople.prototype.append;
  MixpanelPeople.prototype["remove"] = MixpanelPeople.prototype.remove;
  MixpanelPeople.prototype["union"] = MixpanelPeople.prototype.union;
  MixpanelPeople.prototype["track_charge"] = MixpanelPeople.prototype.track_charge;
  MixpanelPeople.prototype["clear_charges"] = MixpanelPeople.prototype.clear_charges;
  MixpanelPeople.prototype["delete_user"] = MixpanelPeople.prototype.delete_user;
  MixpanelPeople.prototype["toString"] = MixpanelPeople.prototype.toString;
  var SET_QUEUE_KEY = "__mps";
  var SET_ONCE_QUEUE_KEY = "__mpso";
  var UNSET_QUEUE_KEY = "__mpus";
  var ADD_QUEUE_KEY = "__mpa";
  var APPEND_QUEUE_KEY = "__mpap";
  var REMOVE_QUEUE_KEY = "__mpr";
  var UNION_QUEUE_KEY = "__mpu";
  var PEOPLE_DISTINCT_ID_KEY = "$people_distinct_id";
  var ALIAS_ID_KEY = "__alias";
  var EVENT_TIMERS_KEY = "__timers";
  var RESERVED_PROPERTIES = [
    SET_QUEUE_KEY,
    SET_ONCE_QUEUE_KEY,
    UNSET_QUEUE_KEY,
    ADD_QUEUE_KEY,
    APPEND_QUEUE_KEY,
    REMOVE_QUEUE_KEY,
    UNION_QUEUE_KEY,
    PEOPLE_DISTINCT_ID_KEY,
    ALIAS_ID_KEY,
    EVENT_TIMERS_KEY
  ];
  var MixpanelPersistence = function(config) {
    this["props"] = {};
    this.campaign_params_saved = false;
    if (config["persistence_name"]) {
      this.name = "mp_" + config["persistence_name"];
    } else {
      this.name = "mp_" + config["token"] + "_mixpanel";
    }
    var storage_type = config["persistence"];
    if (storage_type !== "cookie" && storage_type !== "localStorage") {
      console$1.critical("Unknown persistence type " + storage_type + "; falling back to cookie");
      storage_type = config["persistence"] = "cookie";
    }
    if (storage_type === "localStorage" && _3.localStorage.is_supported()) {
      this.storage = _3.localStorage;
    } else {
      this.storage = _3.cookie;
    }
    this.load();
    this.update_config(config);
    this.upgrade();
    this.save();
  };
  MixpanelPersistence.prototype.properties = function() {
    var p3 = {};
    this.load();
    _3.each(this["props"], function(v3, k4) {
      if (!_3.include(RESERVED_PROPERTIES, k4)) {
        p3[k4] = v3;
      }
    });
    return p3;
  };
  MixpanelPersistence.prototype.load = function() {
    if (this.disabled) {
      return;
    }
    var entry = this.storage.parse(this.name);
    if (entry) {
      this["props"] = _3.extend({}, entry);
    }
  };
  MixpanelPersistence.prototype.upgrade = function() {
    var old_cookie, old_localstorage;
    if (this.storage === _3.localStorage) {
      old_cookie = _3.cookie.parse(this.name);
      _3.cookie.remove(this.name);
      _3.cookie.remove(this.name, true);
      if (old_cookie) {
        this.register_once(old_cookie);
      }
    } else if (this.storage === _3.cookie) {
      old_localstorage = _3.localStorage.parse(this.name);
      _3.localStorage.remove(this.name);
      if (old_localstorage) {
        this.register_once(old_localstorage);
      }
    }
  };
  MixpanelPersistence.prototype.save = function() {
    if (this.disabled) {
      return;
    }
    this.storage.set(
      this.name,
      JSONStringify(this["props"]),
      this.expire_days,
      this.cross_subdomain,
      this.secure,
      this.cross_site,
      this.cookie_domain
    );
  };
  MixpanelPersistence.prototype.load_prop = function(key) {
    this.load();
    return this["props"][key];
  };
  MixpanelPersistence.prototype.remove = function() {
    this.storage.remove(this.name, false, this.cookie_domain);
    this.storage.remove(this.name, true, this.cookie_domain);
  };
  MixpanelPersistence.prototype.clear = function() {
    this.remove();
    this["props"] = {};
  };
  MixpanelPersistence.prototype.register_once = function(props, default_value, days) {
    if (_3.isObject(props)) {
      if (typeof default_value === "undefined") {
        default_value = "None";
      }
      this.expire_days = typeof days === "undefined" ? this.default_expiry : days;
      this.load();
      _3.each(props, function(val, prop) {
        if (!this["props"].hasOwnProperty(prop) || this["props"][prop] === default_value) {
          this["props"][prop] = val;
        }
      }, this);
      this.save();
      return true;
    }
    return false;
  };
  MixpanelPersistence.prototype.register = function(props, days) {
    if (_3.isObject(props)) {
      this.expire_days = typeof days === "undefined" ? this.default_expiry : days;
      this.load();
      _3.extend(this["props"], props);
      this.save();
      return true;
    }
    return false;
  };
  MixpanelPersistence.prototype.unregister = function(prop) {
    this.load();
    if (prop in this["props"]) {
      delete this["props"][prop];
      this.save();
    }
  };
  MixpanelPersistence.prototype.update_search_keyword = function(referrer) {
    this.register(_3.info.searchInfo(referrer));
  };
  MixpanelPersistence.prototype.update_referrer_info = function(referrer) {
    this.register_once({
      "$initial_referrer": referrer || "$direct",
      "$initial_referring_domain": _3.info.referringDomain(referrer) || "$direct"
    }, "");
  };
  MixpanelPersistence.prototype.get_referrer_info = function() {
    return _3.strip_empty_properties({
      "$initial_referrer": this["props"]["$initial_referrer"],
      "$initial_referring_domain": this["props"]["$initial_referring_domain"]
    });
  };
  MixpanelPersistence.prototype.update_config = function(config) {
    this.default_expiry = this.expire_days = config["cookie_expiration"];
    this.set_disabled(config["disable_persistence"]);
    this.set_cookie_domain(config["cookie_domain"]);
    this.set_cross_site(config["cross_site_cookie"]);
    this.set_cross_subdomain(config["cross_subdomain_cookie"]);
    this.set_secure(config["secure_cookie"]);
  };
  MixpanelPersistence.prototype.set_disabled = function(disabled) {
    this.disabled = disabled;
    if (this.disabled) {
      this.remove();
    } else {
      this.save();
    }
  };
  MixpanelPersistence.prototype.set_cookie_domain = function(cookie_domain) {
    if (cookie_domain !== this.cookie_domain) {
      this.remove();
      this.cookie_domain = cookie_domain;
      this.save();
    }
  };
  MixpanelPersistence.prototype.set_cross_site = function(cross_site) {
    if (cross_site !== this.cross_site) {
      this.cross_site = cross_site;
      this.remove();
      this.save();
    }
  };
  MixpanelPersistence.prototype.set_cross_subdomain = function(cross_subdomain) {
    if (cross_subdomain !== this.cross_subdomain) {
      this.cross_subdomain = cross_subdomain;
      this.remove();
      this.save();
    }
  };
  MixpanelPersistence.prototype.get_cross_subdomain = function() {
    return this.cross_subdomain;
  };
  MixpanelPersistence.prototype.set_secure = function(secure) {
    if (secure !== this.secure) {
      this.secure = secure ? true : false;
      this.remove();
      this.save();
    }
  };
  MixpanelPersistence.prototype._add_to_people_queue = function(queue, data) {
    var q_key = this._get_queue_key(queue), q_data = data[queue], set_q = this._get_or_create_queue(SET_ACTION), set_once_q = this._get_or_create_queue(SET_ONCE_ACTION), unset_q = this._get_or_create_queue(UNSET_ACTION), add_q = this._get_or_create_queue(ADD_ACTION), union_q = this._get_or_create_queue(UNION_ACTION), remove_q = this._get_or_create_queue(REMOVE_ACTION, []), append_q = this._get_or_create_queue(APPEND_ACTION, []);
    if (q_key === SET_QUEUE_KEY) {
      _3.extend(set_q, q_data);
      this._pop_from_people_queue(ADD_ACTION, q_data);
      this._pop_from_people_queue(UNION_ACTION, q_data);
      this._pop_from_people_queue(UNSET_ACTION, q_data);
    } else if (q_key === SET_ONCE_QUEUE_KEY) {
      _3.each(q_data, function(v3, k4) {
        if (!(k4 in set_once_q)) {
          set_once_q[k4] = v3;
        }
      });
      this._pop_from_people_queue(UNSET_ACTION, q_data);
    } else if (q_key === UNSET_QUEUE_KEY) {
      _3.each(q_data, function(prop) {
        _3.each([set_q, set_once_q, add_q, union_q], function(enqueued_obj) {
          if (prop in enqueued_obj) {
            delete enqueued_obj[prop];
          }
        });
        _3.each(append_q, function(append_obj) {
          if (prop in append_obj) {
            delete append_obj[prop];
          }
        });
        unset_q[prop] = true;
      });
    } else if (q_key === ADD_QUEUE_KEY) {
      _3.each(q_data, function(v3, k4) {
        if (k4 in set_q) {
          set_q[k4] += v3;
        } else {
          if (!(k4 in add_q)) {
            add_q[k4] = 0;
          }
          add_q[k4] += v3;
        }
      }, this);
      this._pop_from_people_queue(UNSET_ACTION, q_data);
    } else if (q_key === UNION_QUEUE_KEY) {
      _3.each(q_data, function(v3, k4) {
        if (_3.isArray(v3)) {
          if (!(k4 in union_q)) {
            union_q[k4] = [];
          }
          _3.each(v3, function(item) {
            if (!_3.include(union_q[k4], item)) {
              union_q[k4].push(item);
            }
          });
        }
      });
      this._pop_from_people_queue(UNSET_ACTION, q_data);
    } else if (q_key === REMOVE_QUEUE_KEY) {
      remove_q.push(q_data);
      this._pop_from_people_queue(APPEND_ACTION, q_data);
    } else if (q_key === APPEND_QUEUE_KEY) {
      append_q.push(q_data);
      this._pop_from_people_queue(UNSET_ACTION, q_data);
    }
    console$1.log("MIXPANEL PEOPLE REQUEST (QUEUED, PENDING IDENTIFY):");
    console$1.log(data);
    this.save();
  };
  MixpanelPersistence.prototype._pop_from_people_queue = function(queue, data) {
    var q4 = this["props"][this._get_queue_key(queue)];
    if (!_3.isUndefined(q4)) {
      _3.each(data, function(v3, k4) {
        if (queue === APPEND_ACTION || queue === REMOVE_ACTION) {
          _3.each(q4, function(queued_action) {
            if (queued_action[k4] === v3) {
              delete queued_action[k4];
            }
          });
        } else {
          delete q4[k4];
        }
      }, this);
    }
  };
  MixpanelPersistence.prototype.load_queue = function(queue) {
    return this.load_prop(this._get_queue_key(queue));
  };
  MixpanelPersistence.prototype._get_queue_key = function(queue) {
    if (queue === SET_ACTION) {
      return SET_QUEUE_KEY;
    } else if (queue === SET_ONCE_ACTION) {
      return SET_ONCE_QUEUE_KEY;
    } else if (queue === UNSET_ACTION) {
      return UNSET_QUEUE_KEY;
    } else if (queue === ADD_ACTION) {
      return ADD_QUEUE_KEY;
    } else if (queue === APPEND_ACTION) {
      return APPEND_QUEUE_KEY;
    } else if (queue === REMOVE_ACTION) {
      return REMOVE_QUEUE_KEY;
    } else if (queue === UNION_ACTION) {
      return UNION_QUEUE_KEY;
    } else {
      console$1.error("Invalid queue:", queue);
    }
  };
  MixpanelPersistence.prototype._get_or_create_queue = function(queue, default_val) {
    var key = this._get_queue_key(queue);
    default_val = _3.isUndefined(default_val) ? {} : default_val;
    return this["props"][key] || (this["props"][key] = default_val);
  };
  MixpanelPersistence.prototype.set_event_timer = function(event_name, timestamp) {
    var timers = this.load_prop(EVENT_TIMERS_KEY) || {};
    timers[event_name] = timestamp;
    this["props"][EVENT_TIMERS_KEY] = timers;
    this.save();
  };
  MixpanelPersistence.prototype.remove_event_timer = function(event_name) {
    var timers = this.load_prop(EVENT_TIMERS_KEY) || {};
    var timestamp = timers[event_name];
    if (!_3.isUndefined(timestamp)) {
      delete this["props"][EVENT_TIMERS_KEY][event_name];
      this.save();
    }
    return timestamp;
  };
  var init_type;
  var load_extra_bundle = function(src, _onload) {
    throw new Error(src + " not available in this build.");
  };
  var mixpanel_master;
  var INIT_MODULE = 0;
  var INIT_SNIPPET = 1;
  var PRIMARY_INSTANCE_NAME = "mixpanel";
  var PAYLOAD_TYPE_BASE64 = "base64";
  var PAYLOAD_TYPE_JSON = "json";
  var DEVICE_ID_PREFIX = "$device:";
  var SETTING_STRICT = "strict";
  var SETTING_FALLBACK = "fallback";
  var SETTING_DISABLED = "disabled";
  var USE_XHR = win.XMLHttpRequest && "withCredentials" in new XMLHttpRequest();
  var ENQUEUE_REQUESTS = !USE_XHR && userAgent.indexOf("MSIE") === -1 && userAgent.indexOf("Mozilla") === -1;
  var sendBeacon = null;
  if (navigator["sendBeacon"]) {
    sendBeacon = function() {
      return navigator["sendBeacon"].apply(navigator, arguments);
    };
  }
  var DEFAULT_API_ROUTES = {
    "track": "track/",
    "engage": "engage/",
    "groups": "groups/",
    "record": "record/",
    "flags": "flags/",
    "settings": "settings/"
  };
  var DEFAULT_CONFIG = {
    "api_host": "https://api-js.mixpanel.com",
    "api_hosts": {},
    "api_routes": DEFAULT_API_ROUTES,
    "api_extra_query_params": {},
    "api_method": "POST",
    "api_transport": "XHR",
    "api_payload_format": PAYLOAD_TYPE_BASE64,
    "app_host": "https://mixpanel.com",
    "autocapture": false,
    "cdn": "https://cdn.mxpnl.com",
    "cross_site_cookie": false,
    "cross_subdomain_cookie": true,
    "error_reporter": NOOP_FUNC,
    "flags": false,
    "persistence": "cookie",
    "persistence_name": "",
    "cookie_domain": "",
    "cookie_name": "",
    "loaded": NOOP_FUNC,
    "mp_loader": null,
    "track_marketing": true,
    "track_pageview": false,
    "skip_first_touch_marketing": false,
    "store_google": true,
    "stop_utm_persistence": false,
    "save_referrer": true,
    "test": false,
    "verbose": false,
    "img": false,
    "debug": false,
    "track_links_timeout": 300,
    "cookie_expiration": 365,
    "upgrade": false,
    "disable_persistence": false,
    "disable_cookie": false,
    "secure_cookie": false,
    "ip": true,
    "opt_out_tracking_by_default": false,
    "opt_out_persistence_by_default": false,
    "opt_out_tracking_persistence_type": "localStorage",
    "opt_out_tracking_cookie_prefix": null,
    "property_blacklist": [],
    "xhr_headers": {},
    // { header: value, header2: value }
    "ignore_dnt": false,
    "batch_requests": true,
    "batch_size": 50,
    "batch_flush_interval_ms": 5e3,
    "batch_request_timeout_ms": 9e4,
    "batch_autostart": true,
    "hooks": {},
    "record_block_class": new RegExp("^(mp-block|fs-exclude|amp-block|rr-block|ph-no-capture)$"),
    "record_block_selector": "img, video, audio",
    "record_canvas": false,
    "record_collect_fonts": false,
    "record_console": true,
    "record_heatmap_data": false,
    "record_idle_timeout_ms": 30 * 60 * 1e3,
    // 30 minutes
    "record_mask_inputs": true,
    "record_max_ms": MAX_RECORDING_MS,
    "record_min_ms": 0,
    "record_sessions_percent": 0,
    "recorder_src": "https://cdn.mxpnl.com/libs/mixpanel-recorder.min.js",
    "remote_settings_mode": SETTING_DISABLED
    // 'strict', 'fallback', 'disabled'
  };
  var DOM_LOADED = false;
  var MixpanelLib = function() {
  };
  var create_mplib = function(token, config, name) {
    var instance, target = name === PRIMARY_INSTANCE_NAME ? mixpanel_master : mixpanel_master[name];
    if (target && init_type === INIT_MODULE) {
      instance = target;
    } else {
      if (target && !_3.isArray(target)) {
        console$1.error("You have already initialized " + name);
        return;
      }
      instance = new MixpanelLib();
    }
    instance._cached_groups = {};
    instance._init(token, config, name);
    instance["people"] = new MixpanelPeople();
    instance["people"]._init(instance);
    if (!instance.get_config("skip_first_touch_marketing")) {
      var utm_params = _3.info.campaignParams(null);
      var initial_utm_params = {};
      var has_utm = false;
      _3.each(utm_params, function(utm_value, utm_key) {
        initial_utm_params["initial_" + utm_key] = utm_value;
        if (utm_value) {
          has_utm = true;
        }
      });
      if (has_utm) {
        instance["people"].set_once(initial_utm_params);
      }
    }
    Config.DEBUG = Config.DEBUG || instance.get_config("debug");
    var source = init_type === INIT_MODULE ? "module" : "snippet";
    win.dispatchEvent(new win.CustomEvent("$mp_sdk_to_extension_event", {
      "detail": {
        "instance": instance,
        "source": source,
        "token": token,
        "name": name,
        "info": _3.info
      }
    }));
    if (!_3.isUndefined(target) && _3.isArray(target)) {
      instance._execute_array.call(instance["people"], target["people"]);
      instance._execute_array(target);
    }
    return instance;
  };
  MixpanelLib.prototype.init = function(token, config, name) {
    if (_3.isUndefined(name)) {
      this.report_error("You must name your new library: init(token, config, name)");
      return;
    }
    if (name === PRIMARY_INSTANCE_NAME) {
      this.report_error("You must initialize the main mixpanel object right after you include the Mixpanel js snippet");
      return;
    }
    var instance = create_mplib(token, config, name);
    mixpanel_master[name] = instance;
    instance._loaded();
    return instance;
  };
  MixpanelLib.prototype._init = function(token, config, name) {
    config = config || {};
    this["__loaded"] = true;
    this["config"] = {};
    var variable_features = {};
    if (!("api_payload_format" in config)) {
      var api_host = config["api_host"] || DEFAULT_CONFIG["api_host"];
      if (api_host.match(/\.mixpanel\.com/)) {
        variable_features["api_payload_format"] = PAYLOAD_TYPE_JSON;
      }
    }
    this.hooks = {};
    this.set_config(_3.extend({}, DEFAULT_CONFIG, variable_features, config, {
      "name": name,
      "token": token,
      "callback_fn": (name === PRIMARY_INSTANCE_NAME ? name : PRIMARY_INSTANCE_NAME + "." + name) + "._jsc"
    }));
    this["_jsc"] = NOOP_FUNC;
    this.__dom_loaded_queue = [];
    this.__request_queue = [];
    this.__disabled_events = [];
    this._flags = {
      "disable_all_events": false,
      "identify_called": false
    };
    this.request_batchers = {};
    this._batch_requests = this.get_config("batch_requests");
    if (this._batch_requests) {
      if (!_3.localStorage.is_supported(true) || !USE_XHR) {
        this._batch_requests = false;
        console$1.log("Turning off Mixpanel request-queueing; needs XHR and localStorage support");
        _3.each(this.get_batcher_configs(), function(batcher_config) {
          console$1.log("Clearing batch queue " + batcher_config.queue_key);
          _3.localStorage.remove(batcher_config.queue_key);
        });
      } else {
        this.init_batchers();
        if (sendBeacon && win.addEventListener) {
          var flush_on_unload = _3.bind(function() {
            if (!this.request_batchers.events.stopped) {
              this.request_batchers.events.flush({ unloading: true });
            }
          }, this);
          win.addEventListener("pagehide", function(ev) {
            if (ev["persisted"]) {
              flush_on_unload();
            }
          });
          win.addEventListener("visibilitychange", function() {
            if (document$1["visibilityState"] === "hidden") {
              flush_on_unload();
            }
          });
        }
      }
    }
    this["persistence"] = this["cookie"] = new MixpanelPersistence(this["config"]);
    this.unpersisted_superprops = {};
    this._gdpr_init();
    var uuid = _3.UUID();
    if (!this.get_distinct_id()) {
      this.register_once({
        "distinct_id": DEVICE_ID_PREFIX + uuid,
        "$device_id": uuid
      }, "");
    }
    this.flags = new FeatureFlagManager({
      getFullApiRoute: _3.bind(function() {
        return this.get_api_host("flags") + "/" + this.get_config("api_routes")["flags"];
      }, this),
      getConfigFunc: _3.bind(this.get_config, this),
      setConfigFunc: _3.bind(this.set_config, this),
      getPropertyFunc: _3.bind(this.get_property, this),
      trackingFunc: _3.bind(this.track, this)
    });
    this.flags.init();
    this["flags"] = this.flags;
    this.autocapture = new Autocapture(this);
    this.autocapture.init();
    this._init_tab_id();
    var mode = this.get_config("remote_settings_mode");
    if (mode === SETTING_STRICT || mode === SETTING_FALLBACK) {
      this._fetch_remote_settings(mode).then(_3.bind(function() {
        this._check_and_start_session_recording();
      }, this));
    } else {
      this._check_and_start_session_recording();
    }
  };
  MixpanelLib.prototype._init_tab_id = function() {
    if (this.get_config("disable_persistence")) {
      console$1.log("Tab ID initialization skipped due to disable_persistence config");
    } else if (_3.sessionStorage.is_supported()) {
      try {
        var key_suffix = this.get_config("name") + "_" + this.get_config("token");
        var tab_id_key = "mp_tab_id_" + key_suffix;
        var should_generate_new_tab_id_key = "mp_gen_new_tab_id_" + key_suffix;
        if (_3.sessionStorage.get(should_generate_new_tab_id_key) || !_3.sessionStorage.get(tab_id_key)) {
          _3.sessionStorage.set(tab_id_key, "$tab-" + _3.UUID());
        }
        _3.sessionStorage.set(should_generate_new_tab_id_key, "1");
        this.tab_id = _3.sessionStorage.get(tab_id_key);
        win.addEventListener("beforeunload", function() {
          _3.sessionStorage.remove(should_generate_new_tab_id_key);
        });
      } catch (err) {
        this.report_error("Error initializing tab id", err);
      }
    } else {
      this.report_error("Session storage is not supported, cannot keep track of unique tab ID.");
    }
  };
  MixpanelLib.prototype.get_tab_id = function() {
    return this.tab_id || null;
  };
  MixpanelLib.prototype._should_load_recorder = function() {
    if (this.get_config("disable_persistence")) {
      console$1.log("Load recorder check skipped due to disable_persistence config");
      return Promise.resolve(false);
    }
    var recording_registry_idb = new IDBStorageWrapper(RECORDING_REGISTRY_STORE_NAME);
    var tab_id = this.get_tab_id();
    return recording_registry_idb.init().then(function() {
      return recording_registry_idb.getAll();
    }).then(function(recordings) {
      for (var i3 = 0; i3 < recordings.length; i3++) {
        if (isRecordingExpired(recordings[i3]) || recordings[i3]["tabId"] === tab_id) {
          return true;
        }
      }
      return false;
    }).catch(_3.bind(function(err) {
      this.report_error("Error checking recording registry", err);
    }, this));
  };
  MixpanelLib.prototype._check_and_start_session_recording = addOptOutCheckMixpanelLib(function(force_start) {
    if (!win["MutationObserver"]) {
      console$1.critical("Browser does not support MutationObserver; skipping session recording");
      return;
    }
    var loadRecorder = _3.bind(function(startNewIfInactive) {
      var handleLoadedRecorder = _3.bind(function() {
        this._recorder = this._recorder || new win["__mp_recorder"](this);
        this._recorder["resumeRecording"](startNewIfInactive);
      }, this);
      if (_3.isUndefined(win["__mp_recorder"])) {
        load_extra_bundle(this.get_config("recorder_src"), handleLoadedRecorder);
      } else {
        handleLoadedRecorder();
      }
    }, this);
    var is_sampled = this.get_config("record_sessions_percent") > 0 && Math.random() * 100 <= this.get_config("record_sessions_percent");
    if (force_start || is_sampled) {
      loadRecorder(true);
    } else {
      this._should_load_recorder().then(function(shouldLoad) {
        if (shouldLoad) {
          loadRecorder(false);
        }
      });
    }
  });
  MixpanelLib.prototype.start_session_recording = function() {
    this._check_and_start_session_recording(true);
  };
  MixpanelLib.prototype.stop_session_recording = function() {
    if (this._recorder) {
      return this._recorder["stopRecording"]();
    }
    return Promise.resolve();
  };
  MixpanelLib.prototype.pause_session_recording = function() {
    if (this._recorder) {
      return this._recorder["pauseRecording"]();
    }
    return Promise.resolve();
  };
  MixpanelLib.prototype.resume_session_recording = function() {
    if (this._recorder) {
      return this._recorder["resumeRecording"]();
    }
    return Promise.resolve();
  };
  MixpanelLib.prototype.is_recording_heatmap_data = function() {
    return this._get_session_replay_id() && this.get_config("record_heatmap_data");
  };
  MixpanelLib.prototype.get_session_recording_properties = function() {
    var props = {};
    var replay_id = this._get_session_replay_id();
    if (replay_id) {
      props["$mp_replay_id"] = replay_id;
    }
    return props;
  };
  MixpanelLib.prototype.get_session_replay_url = function() {
    var replay_url = null;
    var replay_id = this._get_session_replay_id();
    if (replay_id) {
      var query_params = _3.HTTPBuildQuery({
        "replay_id": replay_id,
        "distinct_id": this.get_distinct_id(),
        "token": this.get_config("token")
      });
      replay_url = "https://mixpanel.com/projects/replay-redirect?" + query_params;
    }
    return replay_url;
  };
  MixpanelLib.prototype._get_session_replay_id = function() {
    var replay_id = null;
    if (this._recorder) {
      replay_id = this._recorder["replayId"];
    }
    return replay_id || null;
  };
  MixpanelLib.prototype.__get_recorder = function() {
    return this._recorder;
  };
  MixpanelLib.prototype._loaded = function() {
    this.get_config("loaded")(this);
    this._set_default_superprops();
    this["people"].set_once(this["persistence"].get_referrer_info());
    if (this.get_config("store_google") && this.get_config("stop_utm_persistence")) {
      var utm_params = _3.info.campaignParams(null);
      _3.each(utm_params, function(_utm_value, utm_key) {
        this.unregister(utm_key);
      }.bind(this));
    }
  };
  MixpanelLib.prototype._set_default_superprops = function() {
    this["persistence"].update_search_keyword(document$1.referrer);
    if (this.get_config("store_google") && !this.get_config("stop_utm_persistence")) {
      this.register(_3.info.campaignParams());
    }
    if (this.get_config("save_referrer")) {
      this["persistence"].update_referrer_info(document$1.referrer);
    }
  };
  MixpanelLib.prototype._dom_loaded = function() {
    _3.each(this.__dom_loaded_queue, function(item) {
      this._track_dom.apply(this, item);
    }, this);
    if (!this.has_opted_out_tracking()) {
      _3.each(this.__request_queue, function(item) {
        this._send_request.apply(this, item);
      }, this);
    }
    delete this.__dom_loaded_queue;
    delete this.__request_queue;
  };
  MixpanelLib.prototype._track_dom = function(DomClass, args) {
    if (this.get_config("img")) {
      this.report_error("You can't use DOM tracking functions with img = true.");
      return false;
    }
    if (!DOM_LOADED) {
      this.__dom_loaded_queue.push([DomClass, args]);
      return false;
    }
    var dt = new DomClass().init(this);
    return dt.track.apply(dt, args);
  };
  MixpanelLib.prototype._prepare_callback = function(callback, data) {
    if (_3.isUndefined(callback)) {
      return null;
    }
    if (USE_XHR) {
      var callback_function = function(response) {
        callback(response, data);
      };
      return callback_function;
    } else {
      var jsc = this["_jsc"];
      var randomized_cb = "" + Math.floor(Math.random() * 1e8);
      var callback_string = this.get_config("callback_fn") + "[" + randomized_cb + "]";
      jsc[randomized_cb] = function(response) {
        delete jsc[randomized_cb];
        callback(response, data);
      };
      return callback_string;
    }
  };
  MixpanelLib.prototype._send_request = function(url, data, options, callback) {
    var succeeded = true;
    if (ENQUEUE_REQUESTS) {
      this.__request_queue.push(arguments);
      return succeeded;
    }
    var DEFAULT_OPTIONS = {
      method: this.get_config("api_method"),
      transport: this.get_config("api_transport"),
      verbose: this.get_config("verbose")
    };
    var body_data = null;
    if (!callback && (_3.isFunction(options) || typeof options === "string")) {
      callback = options;
      options = null;
    }
    options = _3.extend(DEFAULT_OPTIONS, options || {});
    if (!USE_XHR) {
      options.method = "GET";
    }
    var use_post = options.method === "POST";
    var use_sendBeacon = sendBeacon && use_post && options.transport.toLowerCase() === "sendbeacon";
    var verbose_mode = options.verbose;
    if (data["verbose"]) {
      verbose_mode = true;
    }
    if (this.get_config("test")) {
      data["test"] = 1;
    }
    if (verbose_mode) {
      data["verbose"] = 1;
    }
    if (this.get_config("img")) {
      data["img"] = 1;
    }
    if (!USE_XHR) {
      if (callback) {
        data["callback"] = callback;
      } else if (verbose_mode || this.get_config("test")) {
        data["callback"] = "(function(){})";
      }
    }
    data["ip"] = this.get_config("ip") ? 1 : 0;
    data["_"] = (/* @__PURE__ */ new Date()).getTime().toString();
    if (use_post) {
      body_data = "data=" + encodeURIComponent(data["data"]);
      delete data["data"];
    }
    _3.extend(data, this.get_config("api_extra_query_params"));
    url += "?" + _3.HTTPBuildQuery(data);
    var lib = this;
    if ("img" in data) {
      var img = document$1.createElement("img");
      img.src = url;
      document$1.body.appendChild(img);
    } else if (use_sendBeacon) {
      try {
        succeeded = sendBeacon(url, body_data);
      } catch (e3) {
        lib.report_error(e3);
        succeeded = false;
      }
      try {
        if (callback) {
          callback(succeeded ? 1 : 0);
        }
      } catch (e3) {
        lib.report_error(e3);
      }
    } else if (USE_XHR) {
      try {
        var req = new XMLHttpRequest();
        req.open(options.method, url, true);
        var headers = this.get_config("xhr_headers");
        if (use_post) {
          headers["Content-Type"] = "application/x-www-form-urlencoded";
        }
        _3.each(headers, function(headerValue, headerName) {
          req.setRequestHeader(headerName, headerValue);
        });
        if (options.timeout_ms && typeof req.timeout !== "undefined") {
          req.timeout = options.timeout_ms;
          var start_time = (/* @__PURE__ */ new Date()).getTime();
        }
        req.withCredentials = true;
        req.onreadystatechange = function() {
          if (req.readyState === 4) {
            if (req.status === 200) {
              if (callback) {
                if (verbose_mode) {
                  var response;
                  try {
                    response = _3.JSONDecode(req.responseText);
                  } catch (e3) {
                    lib.report_error(e3);
                    if (options.ignore_json_errors) {
                      response = req.responseText;
                    } else {
                      return;
                    }
                  }
                  callback(response);
                } else {
                  callback(Number(req.responseText));
                }
              }
            } else {
              var error;
              if (req.timeout && !req.status && (/* @__PURE__ */ new Date()).getTime() - start_time >= req.timeout) {
                error = "timeout";
              } else {
                error = "Bad HTTP status: " + req.status + " " + req.statusText;
              }
              lib.report_error(error);
              if (callback) {
                if (verbose_mode) {
                  var response_headers = req["responseHeaders"] || {};
                  callback({ status: 0, httpStatusCode: req["status"], error, retryAfter: response_headers["Retry-After"] });
                } else {
                  callback(0);
                }
              }
            }
          }
        };
        req.send(body_data);
      } catch (e3) {
        lib.report_error(e3);
        succeeded = false;
      }
    } else {
      var script = document$1.createElement("script");
      script.type = "text/javascript";
      script.async = true;
      script.defer = true;
      script.src = url;
      var s3 = document$1.getElementsByTagName("script")[0];
      s3.parentNode.insertBefore(script, s3);
    }
    return succeeded;
  };
  MixpanelLib.prototype._fetch_remote_settings = function(mode) {
    var disableRecordingIfStrict = function() {
      if (mode === "strict") {
        self2.set_config({ "record_sessions_percent": 0 });
      }
    };
    if (!win["AbortController"]) {
      console$1.critical("Remote settings unavailable: missing minimum required APIs");
      disableRecordingIfStrict();
      return Promise.resolve();
    }
    var settings_endpoint = this.get_api_host("settings") + "/" + this.get_config("api_routes")["settings"];
    var request_params = {
      "$lib_version": Config.LIB_VERSION,
      "mp_lib": "web",
      "sdk_config": "1"
    };
    var query_string = _3.HTTPBuildQuery(request_params);
    var full_url = settings_endpoint + "?" + query_string;
    var self2 = this;
    var abortController = new AbortController();
    var timeout_id = setTimeout(function() {
      abortController.abort();
    }, 500);
    var fetchOptions = {
      "method": "GET",
      "headers": {
        "Authorization": "Basic " + btoa(self2.get_config("token") + ":")
      },
      "signal": abortController.signal
    };
    return win["fetch"](full_url, fetchOptions).then(function(response) {
      clearTimeout(timeout_id);
      if (!response["ok"]) {
        console$1.critical("Network response was not ok");
        disableRecordingIfStrict();
        return;
      }
      return response.json();
    }).then(function(result2) {
      if (result2 && result2["sdk_config"] && result2["sdk_config"]["config"]) {
        var remote_config = result2["sdk_config"]["config"];
        var valid_config = {};
        _3.each(remote_config, function(value, key) {
          if (DEFAULT_CONFIG.hasOwnProperty(key)) {
            valid_config[key] = value;
          }
        });
        if (_3.isEmptyObject(valid_config)) {
          console$1.critical("No valid config keys found in remote settings.");
          disableRecordingIfStrict();
        } else {
          self2.set_config(valid_config);
        }
      } else {
        disableRecordingIfStrict();
      }
    }).catch(function(err) {
      clearTimeout(timeout_id);
      console$1.critical("Failed to fetch remote settings", err);
      disableRecordingIfStrict();
    });
  };
  MixpanelLib.prototype._execute_array = function(array) {
    var fn_name, alias_calls = [], other_calls = [], tracking_calls = [];
    _3.each(array, function(item) {
      if (item) {
        fn_name = item[0];
        if (_3.isArray(fn_name)) {
          tracking_calls.push(item);
        } else if (typeof item === "function") {
          item.call(this);
        } else if (_3.isArray(item) && fn_name === "alias") {
          alias_calls.push(item);
        } else if (_3.isArray(item) && fn_name.indexOf("track") !== -1 && typeof this[fn_name] === "function") {
          tracking_calls.push(item);
        } else {
          other_calls.push(item);
        }
      }
    }, this);
    var execute = function(calls, context) {
      _3.each(calls, function(item) {
        if (_3.isArray(item[0])) {
          var caller = context;
          _3.each(item, function(call) {
            caller = caller[call[0]].apply(caller, call.slice(1));
          });
        } else {
          this[item[0]].apply(this, item.slice(1));
        }
      }, context);
    };
    execute(alias_calls, this);
    execute(other_calls, this);
    execute(tracking_calls, this);
  };
  MixpanelLib.prototype.are_batchers_initialized = function() {
    return !!this.request_batchers.events;
  };
  MixpanelLib.prototype.get_batcher_configs = function() {
    var queue_prefix = "__mpq_" + this.get_config("token");
    this._batcher_configs = this._batcher_configs || {
      events: { type: "events", api_name: "track", queue_key: queue_prefix + "_ev" },
      people: { type: "people", api_name: "engage", queue_key: queue_prefix + "_pp" },
      groups: { type: "groups", api_name: "groups", queue_key: queue_prefix + "_gr" }
    };
    return this._batcher_configs;
  };
  MixpanelLib.prototype.init_batchers = function() {
    if (!this.are_batchers_initialized()) {
      var batcher_for = _3.bind(function(attrs) {
        return new RequestBatcher(
          attrs.queue_key,
          {
            libConfig: this["config"],
            errorReporter: this.get_config("error_reporter"),
            sendRequestFunc: _3.bind(function(data, options, cb) {
              var api_routes = this.get_config("api_routes");
              this._send_request(
                this.get_api_host(attrs.api_name) + "/" + api_routes[attrs.api_name],
                this._encode_data_for_request(data),
                options,
                this._prepare_callback(cb, data)
              );
            }, this),
            beforeSendHook: _3.bind(function(item) {
              var ret = this._run_hook("before_send_" + attrs.type, item);
              if (ret) {
                return ret[0];
              } else {
                return null;
              }
            }, this),
            stopAllBatchingFunc: _3.bind(this.stop_batch_senders, this),
            usePersistence: true
          }
        );
      }, this);
      var batcher_configs = this.get_batcher_configs();
      this.request_batchers = {
        events: batcher_for(batcher_configs.events),
        people: batcher_for(batcher_configs.people),
        groups: batcher_for(batcher_configs.groups)
      };
    }
    if (this.get_config("batch_autostart")) {
      this.start_batch_senders();
    }
  };
  MixpanelLib.prototype.start_batch_senders = function() {
    this._batchers_were_started = true;
    if (this.are_batchers_initialized()) {
      this._batch_requests = true;
      _3.each(this.request_batchers, function(batcher) {
        batcher.start();
      });
    }
  };
  MixpanelLib.prototype.stop_batch_senders = function() {
    this._batch_requests = false;
    _3.each(this.request_batchers, function(batcher) {
      batcher.stop();
      batcher.clear();
    });
  };
  MixpanelLib.prototype.push = function(item) {
    this._execute_array([item]);
  };
  MixpanelLib.prototype.disable = function(events) {
    if (typeof events === "undefined") {
      this._flags.disable_all_events = true;
    } else {
      this.__disabled_events = this.__disabled_events.concat(events);
    }
  };
  MixpanelLib.prototype._encode_data_for_request = function(data) {
    var encoded_data = JSONStringify(data);
    if (this.get_config("api_payload_format") === PAYLOAD_TYPE_BASE64) {
      encoded_data = _3.base64Encode(encoded_data);
    }
    return { "data": encoded_data };
  };
  MixpanelLib.prototype._track_or_batch = function(options, callback) {
    var truncated_data = _3.truncate(options.data, 255);
    var endpoint = options.endpoint;
    var batcher = options.batcher;
    var should_send_immediately = options.should_send_immediately;
    var send_request_options = options.send_request_options || {};
    callback = callback || NOOP_FUNC;
    var request_enqueued_or_initiated = true;
    var send_request_immediately = _3.bind(function() {
      if (!send_request_options.skip_hooks) {
        truncated_data = this._run_hook("before_send_" + options.type, truncated_data);
        if (truncated_data) {
          truncated_data = truncated_data[0];
        }
      }
      if (truncated_data) {
        console$1.log("MIXPANEL REQUEST:");
        console$1.log(truncated_data);
        return this._send_request(
          endpoint,
          this._encode_data_for_request(truncated_data),
          send_request_options,
          this._prepare_callback(callback, truncated_data)
        );
      } else {
        return null;
      }
    }, this);
    if (this._batch_requests && !should_send_immediately) {
      batcher.enqueue(truncated_data).then(function(succeeded) {
        if (succeeded) {
          callback(1, truncated_data);
        } else {
          send_request_immediately();
        }
      });
    } else {
      request_enqueued_or_initiated = send_request_immediately();
    }
    return request_enqueued_or_initiated && truncated_data;
  };
  MixpanelLib.prototype.track = addOptOutCheckMixpanelLib(function(event_name, properties, options, callback) {
    var ret;
    if (!(options && options.skip_hooks)) {
      ret = this._run_hook("before_track", event_name, properties);
      if (ret === null) {
        return;
      } else {
        event_name = ret[0];
        properties = ret[1];
      }
    }
    if (!callback && typeof options === "function") {
      callback = options;
      options = null;
    }
    options = options || {};
    var transport = options["transport"];
    if (transport) {
      options.transport = transport;
    }
    var should_send_immediately = options["send_immediately"];
    if (typeof callback !== "function") {
      callback = NOOP_FUNC;
    }
    if (_3.isUndefined(event_name)) {
      this.report_error("No event name provided to mixpanel.track");
      return;
    }
    if (this._event_is_disabled(event_name)) {
      callback(0);
      return;
    }
    properties = _3.extend({}, properties);
    properties["token"] = this.get_config("token");
    var start_timestamp = this["persistence"].remove_event_timer(event_name);
    if (!_3.isUndefined(start_timestamp)) {
      var duration_in_ms = (/* @__PURE__ */ new Date()).getTime() - start_timestamp;
      properties["$duration"] = parseFloat((duration_in_ms / 1e3).toFixed(3));
    }
    this._set_default_superprops();
    var marketing_properties = this.get_config("track_marketing") ? _3.info.marketingParams() : {};
    properties = _3.extend(
      {},
      _3.info.properties({ "mp_loader": this.get_config("mp_loader") }),
      marketing_properties,
      this["persistence"].properties(),
      this.unpersisted_superprops,
      this.get_session_recording_properties(),
      properties
    );
    var property_blacklist = this.get_config("property_blacklist");
    if (_3.isArray(property_blacklist)) {
      _3.each(property_blacklist, function(blacklisted_prop) {
        delete properties[blacklisted_prop];
      });
    } else {
      this.report_error("Invalid value for property_blacklist config: " + property_blacklist);
    }
    var data = {
      "event": event_name,
      "properties": properties
    };
    ret = this._track_or_batch({
      type: "events",
      data,
      endpoint: this.get_api_host("events") + "/" + this.get_config("api_routes")["track"],
      batcher: this.request_batchers.events,
      should_send_immediately,
      send_request_options: options
    }, callback);
    return ret;
  });
  MixpanelLib.prototype.set_group = addOptOutCheckMixpanelLib(function(group_key, group_ids, callback) {
    if (!_3.isArray(group_ids)) {
      group_ids = [group_ids];
    }
    var prop = {};
    prop[group_key] = group_ids;
    this.register(prop);
    return this["people"].set(group_key, group_ids, callback);
  });
  MixpanelLib.prototype.add_group = addOptOutCheckMixpanelLib(function(group_key, group_id, callback) {
    var old_values = this.get_property(group_key);
    var prop = {};
    if (old_values === void 0) {
      prop[group_key] = [group_id];
      this.register(prop);
    } else {
      if (old_values.indexOf(group_id) === -1) {
        old_values.push(group_id);
        prop[group_key] = old_values;
        this.register(prop);
      }
    }
    return this["people"].union(group_key, group_id, callback);
  });
  MixpanelLib.prototype.remove_group = addOptOutCheckMixpanelLib(function(group_key, group_id, callback) {
    var old_value = this.get_property(group_key);
    if (old_value !== void 0) {
      var idx = old_value.indexOf(group_id);
      if (idx > -1) {
        old_value.splice(idx, 1);
        this.register({ group_key: old_value });
      }
      if (old_value.length === 0) {
        this.unregister(group_key);
      }
    }
    return this["people"].remove(group_key, group_id, callback);
  });
  MixpanelLib.prototype.track_with_groups = addOptOutCheckMixpanelLib(function(event_name, properties, groups, callback) {
    var tracking_props = _3.extend({}, properties || {});
    _3.each(groups, function(v3, k4) {
      if (v3 !== null && v3 !== void 0) {
        tracking_props[k4] = v3;
      }
    });
    return this.track(event_name, tracking_props, callback);
  });
  MixpanelLib.prototype._create_map_key = function(group_key, group_id) {
    return group_key + "_" + JSON.stringify(group_id);
  };
  MixpanelLib.prototype._remove_group_from_cache = function(group_key, group_id) {
    delete this._cached_groups[this._create_map_key(group_key, group_id)];
  };
  MixpanelLib.prototype.get_group = function(group_key, group_id) {
    var map_key = this._create_map_key(group_key, group_id);
    var group = this._cached_groups[map_key];
    if (group === void 0 || group._group_key !== group_key || group._group_id !== group_id) {
      group = new MixpanelGroup();
      group._init(this, group_key, group_id);
      this._cached_groups[map_key] = group;
    }
    return group;
  };
  MixpanelLib.prototype.track_pageview = addOptOutCheckMixpanelLib(function(properties, options) {
    if (typeof properties !== "object") {
      properties = {};
    }
    options = options || {};
    var event_name = options["event_name"] || "$mp_web_page_view";
    var default_page_properties = _3.extend(
      _3.info.mpPageViewProperties(),
      _3.info.campaignParams(),
      _3.info.clickParams()
    );
    var event_properties = _3.extend(
      {},
      default_page_properties,
      properties
    );
    return this.track(event_name, event_properties);
  });
  MixpanelLib.prototype.track_links = function() {
    return this._track_dom.call(this, LinkTracker, arguments);
  };
  MixpanelLib.prototype.track_forms = function() {
    return this._track_dom.call(this, FormTracker, arguments);
  };
  MixpanelLib.prototype.time_event = function(event_name) {
    if (_3.isUndefined(event_name)) {
      this.report_error("No event name provided to mixpanel.time_event");
      return;
    }
    if (this._event_is_disabled(event_name)) {
      return;
    }
    this["persistence"].set_event_timer(event_name, (/* @__PURE__ */ new Date()).getTime());
  };
  var REGISTER_DEFAULTS = {
    "persistent": true
  };
  var options_for_register = function(days_or_options) {
    var options;
    if (_3.isObject(days_or_options)) {
      options = days_or_options;
    } else if (!_3.isUndefined(days_or_options)) {
      options = { "days": days_or_options };
    } else {
      options = {};
    }
    return _3.extend({}, REGISTER_DEFAULTS, options);
  };
  MixpanelLib.prototype.register = function(props, days_or_options) {
    var ret = this._run_hook("before_register", props, days_or_options);
    if (ret === null) {
      return;
    } else {
      props = ret[0];
      days_or_options = ret[1];
    }
    var options = options_for_register(days_or_options);
    if (options["persistent"]) {
      this["persistence"].register(props, options["days"]);
    } else {
      _3.extend(this.unpersisted_superprops, props);
    }
  };
  MixpanelLib.prototype.register_once = function(props, default_value, days_or_options) {
    var ret = this._run_hook("before_register_once", props, default_value, days_or_options);
    if (ret === null) {
      return;
    } else {
      props = ret[0];
      default_value = ret[1];
      days_or_options = ret[2];
    }
    var options = options_for_register(days_or_options);
    if (options["persistent"]) {
      this["persistence"].register_once(props, default_value, options["days"]);
    } else {
      if (typeof default_value === "undefined") {
        default_value = "None";
      }
      _3.each(props, function(val, prop) {
        if (!this.unpersisted_superprops.hasOwnProperty(prop) || this.unpersisted_superprops[prop] === default_value) {
          this.unpersisted_superprops[prop] = val;
        }
      }, this);
    }
  };
  MixpanelLib.prototype.unregister = function(property, options) {
    var ret = this._run_hook("before_unregister", property, options);
    if (ret === null) {
      return;
    } else {
      property = ret[0];
      options = ret[1];
    }
    options = options_for_register(options);
    if (options["persistent"]) {
      this["persistence"].unregister(property);
    } else {
      delete this.unpersisted_superprops[property];
    }
  };
  MixpanelLib.prototype._register_single = function(prop, value) {
    var props = {};
    props[prop] = value;
    this.register(props);
  };
  MixpanelLib.prototype.identify = function(new_distinct_id, _set_callback, _add_callback, _append_callback, _set_once_callback, _union_callback, _unset_callback, _remove_callback) {
    var ret = this._run_hook("before_identify", new_distinct_id);
    if (ret === null) {
      return -1;
    } else {
      new_distinct_id = ret[0];
    }
    var previous_distinct_id = this.get_distinct_id();
    if (new_distinct_id && previous_distinct_id !== new_distinct_id) {
      if (typeof new_distinct_id === "string" && new_distinct_id.indexOf(DEVICE_ID_PREFIX) === 0) {
        this.report_error("distinct_id cannot have $device: prefix");
        return -1;
      }
      this.register({ "$user_id": new_distinct_id });
    }
    if (!this.get_property("$device_id")) {
      var device_id = previous_distinct_id;
      this.register_once({
        "$had_persisted_distinct_id": true,
        "$device_id": device_id
      }, "");
    }
    if (new_distinct_id !== previous_distinct_id && new_distinct_id !== this.get_property(ALIAS_ID_KEY)) {
      this.unregister(ALIAS_ID_KEY);
      this.register({ "distinct_id": new_distinct_id });
    }
    this._flags.identify_called = true;
    this["people"]._flush(_set_callback, _add_callback, _append_callback, _set_once_callback, _union_callback, _unset_callback, _remove_callback);
    if (new_distinct_id !== previous_distinct_id) {
      this.track("$identify", {
        "distinct_id": new_distinct_id,
        "$anon_distinct_id": previous_distinct_id
      }, { skip_hooks: true });
    }
    if (new_distinct_id !== previous_distinct_id) {
      this.flags.fetchFlags();
    }
  };
  MixpanelLib.prototype.reset = function() {
    this.stop_session_recording();
    this["persistence"].clear();
    this._flags.identify_called = false;
    var uuid = _3.UUID();
    this.register_once({
      "distinct_id": DEVICE_ID_PREFIX + uuid,
      "$device_id": uuid
    }, "");
    this._check_and_start_session_recording();
  };
  MixpanelLib.prototype.get_distinct_id = function() {
    return this.get_property("distinct_id");
  };
  MixpanelLib.prototype.alias = function(alias, original) {
    if (alias === this.get_property(PEOPLE_DISTINCT_ID_KEY)) {
      this.report_error("Attempting to create alias for existing People user - aborting.");
      return -2;
    }
    var _this = this;
    if (_3.isUndefined(original)) {
      original = this.get_distinct_id();
    }
    if (alias !== original) {
      this._register_single(ALIAS_ID_KEY, alias);
      return this.track("$create_alias", {
        "alias": alias,
        "distinct_id": original
      }, {
        skip_hooks: true
      }, function() {
        _this.identify(alias);
      });
    } else {
      this.report_error("alias matches current distinct_id - skipping api call.");
      this.identify(alias);
      return -1;
    }
  };
  MixpanelLib.prototype.name_tag = function(name_tag) {
    this._register_single("mp_name_tag", name_tag);
  };
  MixpanelLib.prototype.set_config = function(config) {
    if (_3.isObject(config)) {
      _3.extend(this["config"], config);
      var new_batch_size = config["batch_size"];
      if (new_batch_size) {
        _3.each(this.request_batchers, function(batcher) {
          batcher.resetBatchSize();
        });
      }
      if (!this.get_config("persistence_name")) {
        this["config"]["persistence_name"] = this["config"]["cookie_name"];
      }
      if (!this.get_config("disable_persistence")) {
        this["config"]["disable_persistence"] = this["config"]["disable_cookie"];
      }
      if (this["persistence"]) {
        this["persistence"].update_config(this["config"]);
      }
      Config.DEBUG = Config.DEBUG || this.get_config("debug");
      if (("autocapture" in config || "record_heatmap_data" in config) && this.autocapture) {
        this.autocapture.init();
      }
      if (_3.isObject(config["hooks"])) {
        this.hooks = {};
        _3.each(config["hooks"], function(hook_value, hook_name) {
          if (_3.isFunction(hook_value)) {
            this.hooks[hook_name] = [hook_value];
          } else if (_3.isArray(hook_value)) {
            this.hooks[hook_name] = [];
            for (var i3 = 0; i3 < hook_value.length; i3++) {
              if (!_3.isFunction(hook_value[i3])) {
                console$1.critical("Invalid hook added. Hook is not a function");
              }
              this.hooks[hook_name].push(hook_value[i3]);
            }
          } else {
            console$1.critical("Invalid hooks added. Ensure that the hook values passed into config.hooks are functions or arrays of functions.");
          }
        }, this);
      }
    }
  };
  MixpanelLib.prototype.get_config = function(prop_name) {
    return this["config"][prop_name];
  };
  MixpanelLib.prototype._run_hook = function(hook_name) {
    var hook_data = slice.call(arguments, 1);
    _3.each(this.hooks[hook_name], function(hook) {
      if (hook_data === null) {
        return null;
      }
      var ret = hook.apply(this, hook_data);
      if (typeof ret === "undefined") {
        this.report_error(hook_name + " hook did not return a valid value");
        hook_data = null;
      } else {
        if (!_3.isArray(ret)) {
          ret = [ret];
        }
        hook_data.splice.apply(hook_data, [0, ret.length].concat(ret));
      }
    }, this);
    return hook_data;
  };
  MixpanelLib.prototype.get_property = function(property_name) {
    return this["persistence"].load_prop([property_name]);
  };
  MixpanelLib.prototype.get_api_host = function(endpoint_type) {
    return this.get_config("api_hosts")[endpoint_type] || this.get_config("api_host");
  };
  MixpanelLib.prototype.toString = function() {
    var name = this.get_config("name");
    if (name !== PRIMARY_INSTANCE_NAME) {
      name = PRIMARY_INSTANCE_NAME + "." + name;
    }
    return name;
  };
  MixpanelLib.prototype._event_is_disabled = function(event_name) {
    return _3.isBlockedUA(userAgent) || this._flags.disable_all_events || _3.include(this.__disabled_events, event_name);
  };
  MixpanelLib.prototype._gdpr_init = function() {
    var is_localStorage_requested = this.get_config("opt_out_tracking_persistence_type") === "localStorage";
    if (is_localStorage_requested && _3.localStorage.is_supported()) {
      if (!this.has_opted_in_tracking() && this.has_opted_in_tracking({ "persistence_type": "cookie" })) {
        this.opt_in_tracking({ "enable_persistence": false });
      }
      if (!this.has_opted_out_tracking() && this.has_opted_out_tracking({ "persistence_type": "cookie" })) {
        this.opt_out_tracking({ "clear_persistence": false });
      }
      this.clear_opt_in_out_tracking({
        "persistence_type": "cookie",
        "enable_persistence": false
      });
    }
    if (this.has_opted_out_tracking()) {
      this._gdpr_update_persistence({ "clear_persistence": true });
    } else if (!this.has_opted_in_tracking() && (this.get_config("opt_out_tracking_by_default") || _3.cookie.get("mp_optout"))) {
      _3.cookie.remove("mp_optout");
      this.opt_out_tracking({
        "clear_persistence": this.get_config("opt_out_persistence_by_default")
      });
    }
  };
  MixpanelLib.prototype._gdpr_update_persistence = function(options) {
    var disabled;
    if (options && options["clear_persistence"]) {
      disabled = true;
    } else if (options && options["enable_persistence"]) {
      disabled = false;
    } else {
      return;
    }
    if (!this.get_config("disable_persistence") && this["persistence"].disabled !== disabled) {
      this["persistence"].set_disabled(disabled);
    }
    if (disabled) {
      this.stop_batch_senders();
      this.stop_session_recording();
    } else {
      if (this._batchers_were_started) {
        this.start_batch_senders();
      }
    }
  };
  MixpanelLib.prototype._gdpr_call_func = function(func, options) {
    options = _3.extend({
      "track": _3.bind(this.track, this),
      "persistence_type": this.get_config("opt_out_tracking_persistence_type"),
      "cookie_prefix": this.get_config("opt_out_tracking_cookie_prefix"),
      "cookie_expiration": this.get_config("cookie_expiration"),
      "cross_site_cookie": this.get_config("cross_site_cookie"),
      "cross_subdomain_cookie": this.get_config("cross_subdomain_cookie"),
      "cookie_domain": this.get_config("cookie_domain"),
      "secure_cookie": this.get_config("secure_cookie"),
      "ignore_dnt": this.get_config("ignore_dnt")
    }, options);
    if (!_3.localStorage.is_supported()) {
      options["persistence_type"] = "cookie";
    }
    return func(this.get_config("token"), {
      track: options["track"],
      trackEventName: options["track_event_name"],
      trackProperties: options["track_properties"],
      persistenceType: options["persistence_type"],
      persistencePrefix: options["cookie_prefix"],
      cookieDomain: options["cookie_domain"],
      cookieExpiration: options["cookie_expiration"],
      crossSiteCookie: options["cross_site_cookie"],
      crossSubdomainCookie: options["cross_subdomain_cookie"],
      secureCookie: options["secure_cookie"],
      ignoreDnt: options["ignore_dnt"]
    });
  };
  MixpanelLib.prototype.opt_in_tracking = function(options) {
    options = _3.extend({
      "enable_persistence": true
    }, options);
    this._gdpr_call_func(optIn, options);
    this._gdpr_update_persistence(options);
  };
  MixpanelLib.prototype.opt_out_tracking = function(options) {
    options = _3.extend({
      "clear_persistence": true,
      "delete_user": true
    }, options);
    if (options["delete_user"] && this["people"] && this["people"]._identify_called()) {
      this["people"].delete_user();
      this["people"].clear_charges();
    }
    this._gdpr_call_func(optOut, options);
    this._gdpr_update_persistence(options);
  };
  MixpanelLib.prototype.has_opted_in_tracking = function(options) {
    return this._gdpr_call_func(hasOptedIn, options);
  };
  MixpanelLib.prototype.has_opted_out_tracking = function(options) {
    return this._gdpr_call_func(hasOptedOut, options);
  };
  MixpanelLib.prototype.clear_opt_in_out_tracking = function(options) {
    options = _3.extend({
      "enable_persistence": true
    }, options);
    this._gdpr_call_func(clearOptInOut, options);
    this._gdpr_update_persistence(options);
  };
  MixpanelLib.prototype.report_error = function(msg, err) {
    console$1.error.apply(console$1.error, arguments);
    try {
      if (!err && !(msg instanceof Error)) {
        msg = new Error(msg);
      }
      this.get_config("error_reporter")(msg, err);
    } catch (err2) {
      console$1.error(err2);
    }
  };
  MixpanelLib.prototype.add_hook = function(hook_name, hook_fn) {
    if (!this.hooks[hook_name]) {
      this.hooks[hook_name] = [];
    }
    this.hooks[hook_name].push(hook_fn);
  };
  MixpanelLib.prototype.remove_hook = function(hook_name, hook_fn) {
    var fn_index;
    if (this.hooks[hook_name]) {
      fn_index = this.hooks[hook_name].indexOf(hook_fn);
      if (fn_index !== -1) {
        this.hooks[hook_name].splice(fn_index, 1);
      } else {
        console$1.log("remove_hook failed. Matching hook was not found");
      }
    }
  };
  MixpanelLib.prototype["init"] = MixpanelLib.prototype.init;
  MixpanelLib.prototype["reset"] = MixpanelLib.prototype.reset;
  MixpanelLib.prototype["disable"] = MixpanelLib.prototype.disable;
  MixpanelLib.prototype["time_event"] = MixpanelLib.prototype.time_event;
  MixpanelLib.prototype["track"] = MixpanelLib.prototype.track;
  MixpanelLib.prototype["track_links"] = MixpanelLib.prototype.track_links;
  MixpanelLib.prototype["track_forms"] = MixpanelLib.prototype.track_forms;
  MixpanelLib.prototype["track_pageview"] = MixpanelLib.prototype.track_pageview;
  MixpanelLib.prototype["register"] = MixpanelLib.prototype.register;
  MixpanelLib.prototype["register_once"] = MixpanelLib.prototype.register_once;
  MixpanelLib.prototype["unregister"] = MixpanelLib.prototype.unregister;
  MixpanelLib.prototype["identify"] = MixpanelLib.prototype.identify;
  MixpanelLib.prototype["alias"] = MixpanelLib.prototype.alias;
  MixpanelLib.prototype["name_tag"] = MixpanelLib.prototype.name_tag;
  MixpanelLib.prototype["set_config"] = MixpanelLib.prototype.set_config;
  MixpanelLib.prototype["get_config"] = MixpanelLib.prototype.get_config;
  MixpanelLib.prototype["get_api_host"] = MixpanelLib.prototype.get_api_host;
  MixpanelLib.prototype["get_property"] = MixpanelLib.prototype.get_property;
  MixpanelLib.prototype["get_distinct_id"] = MixpanelLib.prototype.get_distinct_id;
  MixpanelLib.prototype["toString"] = MixpanelLib.prototype.toString;
  MixpanelLib.prototype["opt_out_tracking"] = MixpanelLib.prototype.opt_out_tracking;
  MixpanelLib.prototype["opt_in_tracking"] = MixpanelLib.prototype.opt_in_tracking;
  MixpanelLib.prototype["has_opted_out_tracking"] = MixpanelLib.prototype.has_opted_out_tracking;
  MixpanelLib.prototype["has_opted_in_tracking"] = MixpanelLib.prototype.has_opted_in_tracking;
  MixpanelLib.prototype["clear_opt_in_out_tracking"] = MixpanelLib.prototype.clear_opt_in_out_tracking;
  MixpanelLib.prototype["get_group"] = MixpanelLib.prototype.get_group;
  MixpanelLib.prototype["set_group"] = MixpanelLib.prototype.set_group;
  MixpanelLib.prototype["add_group"] = MixpanelLib.prototype.add_group;
  MixpanelLib.prototype["remove_group"] = MixpanelLib.prototype.remove_group;
  MixpanelLib.prototype["add_hook"] = MixpanelLib.prototype.add_hook;
  MixpanelLib.prototype["remove_hook"] = MixpanelLib.prototype.remove_hook;
  MixpanelLib.prototype["track_with_groups"] = MixpanelLib.prototype.track_with_groups;
  MixpanelLib.prototype["start_batch_senders"] = MixpanelLib.prototype.start_batch_senders;
  MixpanelLib.prototype["stop_batch_senders"] = MixpanelLib.prototype.stop_batch_senders;
  MixpanelLib.prototype["start_session_recording"] = MixpanelLib.prototype.start_session_recording;
  MixpanelLib.prototype["stop_session_recording"] = MixpanelLib.prototype.stop_session_recording;
  MixpanelLib.prototype["pause_session_recording"] = MixpanelLib.prototype.pause_session_recording;
  MixpanelLib.prototype["resume_session_recording"] = MixpanelLib.prototype.resume_session_recording;
  MixpanelLib.prototype["get_session_recording_properties"] = MixpanelLib.prototype.get_session_recording_properties;
  MixpanelLib.prototype["get_session_replay_url"] = MixpanelLib.prototype.get_session_replay_url;
  MixpanelLib.prototype["get_tab_id"] = MixpanelLib.prototype.get_tab_id;
  MixpanelLib.prototype["DEFAULT_API_ROUTES"] = DEFAULT_API_ROUTES;
  MixpanelLib.prototype["__get_recorder"] = MixpanelLib.prototype.__get_recorder;
  MixpanelPersistence.prototype["properties"] = MixpanelPersistence.prototype.properties;
  MixpanelPersistence.prototype["update_search_keyword"] = MixpanelPersistence.prototype.update_search_keyword;
  MixpanelPersistence.prototype["update_referrer_info"] = MixpanelPersistence.prototype.update_referrer_info;
  MixpanelPersistence.prototype["get_cross_subdomain"] = MixpanelPersistence.prototype.get_cross_subdomain;
  MixpanelPersistence.prototype["clear"] = MixpanelPersistence.prototype.clear;
  var instances = {};
  var extend_mp = function() {
    _3.each(instances, function(instance, name) {
      if (name !== PRIMARY_INSTANCE_NAME) {
        mixpanel_master[name] = instance;
      }
    });
    mixpanel_master["_"] = _3;
  };
  var override_mp_init_func = function() {
    mixpanel_master["init"] = function(token, config, name) {
      if (name) {
        if (!mixpanel_master[name]) {
          mixpanel_master[name] = instances[name] = create_mplib(token, config, name);
          mixpanel_master[name]._loaded();
        }
        return mixpanel_master[name];
      } else {
        var instance = mixpanel_master;
        if (instances[PRIMARY_INSTANCE_NAME]) {
          instance = instances[PRIMARY_INSTANCE_NAME];
        } else if (token) {
          instance = create_mplib(token, config, PRIMARY_INSTANCE_NAME);
          instance._loaded();
          instances[PRIMARY_INSTANCE_NAME] = instance;
        }
        mixpanel_master = instance;
        if (init_type === INIT_SNIPPET) {
          win[PRIMARY_INSTANCE_NAME] = mixpanel_master;
        }
        extend_mp();
      }
    };
  };
  var add_dom_loaded_handler = function() {
    function dom_loaded_handler() {
      if (dom_loaded_handler.done) {
        return;
      }
      dom_loaded_handler.done = true;
      DOM_LOADED = true;
      ENQUEUE_REQUESTS = false;
      _3.each(instances, function(inst) {
        inst._dom_loaded();
      });
    }
    function do_scroll_check() {
      try {
        document$1.documentElement.doScroll("left");
      } catch (e3) {
        setTimeout(do_scroll_check, 1);
        return;
      }
      dom_loaded_handler();
    }
    if (document$1.addEventListener) {
      if (document$1.readyState === "complete") {
        dom_loaded_handler();
      } else {
        document$1.addEventListener("DOMContentLoaded", dom_loaded_handler, false);
      }
    } else if (document$1.attachEvent) {
      document$1.attachEvent("onreadystatechange", dom_loaded_handler);
      var toplevel = false;
      try {
        toplevel = win.frameElement === null;
      } catch (e3) {
      }
      if (document$1.documentElement.doScroll && toplevel) {
        do_scroll_check();
      }
    }
    _3.register_event(win, "load", dom_loaded_handler, true);
  };
  function init_as_module(bundle_loader) {
    load_extra_bundle = bundle_loader;
    init_type = INIT_MODULE;
    mixpanel_master = new MixpanelLib();
    override_mp_init_func();
    mixpanel_master["init"]();
    add_dom_loaded_handler();
    return mixpanel_master;
  }
  function loadNoop(_src, onload) {
    onload();
  }
  var mixpanel = init_as_module(loadNoop);

  // src/utils/bubble.js
  var sendToBubble = (fnName, action, data = {}) => {
    const payload = { output1: String(action) };
    Object.values(data).forEach((val, i3) => {
      payload[`output${i3 + 2}`] = String(val);
    });
    if (window.BubbleBridge) {
      console.log(`\u{1F4E1} [${fnName}]`, { action, ...data });
      window.BubbleBridge.send(fnName, payload);
    } else {
      console.warn(`\u26A0\uFE0F BubbleBridge not found [${fnName}]`, { action, ...data });
    }
  };

  // src/components/WelcomeScreen.jsx
  var WelcomeScreen = ({ deviceId, onAction }) => {
    const bgImage = "https://0fc323560b9c4d8afc3a7d487716abb6.cdn.bubble.io/f1744960311608x780031988693140400/BG%20%281%29.png?_gl=1*1sjnvjs*_gcl_au*MTI1MTA4NjA5OS4xNzY0NjcxNTYy*_ga*MTkwNzcwNjAyMy4xNzY0MTUwMzM2*_ga_BFPVR2DEE2*czE3NzA4ODE1ODYkbzYyJGcxJHQxNzcwODk2MDU5JGoyMyRsMCRoMA..";
    const handleAction = (action) => {
      sendToBubble("bubble_fn_welcome", { action });
      if (onAction) onAction(action);
    };
    return /* @__PURE__ */ xn.createElement("div", { className: "relative w-full h-full bg-black font-jakarta overflow-hidden" }, /* @__PURE__ */ xn.createElement("div", { className: "absolute inset-0 z-0" }, /* @__PURE__ */ xn.createElement("img", { src: bgImage, className: "w-full h-full object-cover opacity-80", alt: "Couple" }), /* @__PURE__ */ xn.createElement("div", { className: "absolute inset-0 bg-gradient-to-b from-black/30 via-transparent to-black/90" })), /* @__PURE__ */ xn.createElement("div", { className: "relative z-10 flex flex-col h-full px-6 py-10" }, /* @__PURE__ */ xn.createElement("div", { className: "mx-auto flex flex-col items-center" }, /* @__PURE__ */ xn.createElement("svg", { width: "56", height: "56", viewBox: "0 0 64 64", fill: "none" }, /* @__PURE__ */ xn.createElement("circle", { cx: "32", cy: "32", r: "32", fill: "white" }), /* @__PURE__ */ xn.createElement("rect", { x: "19", y: "19", width: "26", height: "26", fill: "#FF2258" })), /* @__PURE__ */ xn.createElement("div", { className: "text-white text-center mt-2 font-bold tracking-widest text-[10px]" }, "BONDS")), /* @__PURE__ */ xn.createElement("div", { className: "flex-1 min-h-[20px]" }), /* @__PURE__ */ xn.createElement("div", { className: "mb-8" }, /* @__PURE__ */ xn.createElement("h1", { className: "text-white text-[32px] leading-[38px] font-normal mb-3" }, "Your Relationship", /* @__PURE__ */ xn.createElement("br", null), "Superpower"), /* @__PURE__ */ xn.createElement("p", { className: "text-white/80 text-base font-light leading-relaxed" }, "We learn your dynamics and tailor expert built, AI powered insights & actions")), /* @__PURE__ */ xn.createElement("div", { className: "space-y-6" }, /* @__PURE__ */ xn.createElement(
      "button",
      {
        onClick: () => handleAction("go"),
        className: "w-full h-[58px] rounded-[40px] bg-gradient-to-l from-[#B900B0] to-[#D8003F] flex items-center justify-center shadow-lg transform transition active:scale-95 btn-pressed"
      },
      /* @__PURE__ */ xn.createElement("span", { className: "font-jakarta font-semibold text-[18px] text-white tracking-[3px] uppercase" }, "LET\u2019S GO")
    ), /* @__PURE__ */ xn.createElement("div", { className: "text-center" }, /* @__PURE__ */ xn.createElement("span", { className: "font-jakarta text-[16px] text-white tracking-[0.2px]" }, "Got an account? ", " ", /* @__PURE__ */ xn.createElement(
      "button",
      {
        onClick: () => handleAction("signin"),
        className: "font-bold border-b border-white hover:opacity-80 transition"
      },
      "Sign In here"
    ))))));
  };
  var WelcomeScreen_default = WelcomeScreen;

  // src/components/HomeSection.jsx
  var HomeSection = ({ userName, userAvatar, credits, push }) => {
    const currentJourney = {
      title: "Intimacy",
      description: "Exploring how being wanted and desired intersects with sexual fulfilment together"
    };
    const handleBubbleAction = (action, data = {}) => {
      sendToBubble("bubble_fn_home", { action, ...data });
    };
    return /* @__PURE__ */ xn.createElement("div", { className: "relative w-full pb-8" }, /* @__PURE__ */ xn.createElement("div", { className: "relative w-full px-4 pt-6 pb-4 bg-gradient-to-b from-[#2E2740] to-transparent" }, /* @__PURE__ */ xn.createElement("div", { className: "flex items-center justify-between" }, /* @__PURE__ */ xn.createElement("div", { className: "flex items-center gap-3" }, /* @__PURE__ */ xn.createElement(
      "img",
      {
        src: userAvatar,
        alt: userName,
        className: "w-12 h-12 rounded-full border-2 border-solid border-white/20"
      }
    ), /* @__PURE__ */ xn.createElement("span", { className: "font-jakarta font-semibold text-lg text-white" }, userName)), /* @__PURE__ */ xn.createElement("div", { className: "flex items-center gap-3" }, /* @__PURE__ */ xn.createElement(
      "button",
      {
        onClick: () => handleBubbleAction("send"),
        className: "w-10 h-10 rounded-full border border-solid border-white/30 flex items-center justify-center hover:bg-white/10 transition-colors"
      },
      /* @__PURE__ */ xn.createElement("svg", { width: "18", height: "18", viewBox: "0 0 24 24", fill: "none", stroke: "white", strokeWidth: "2" }, /* @__PURE__ */ xn.createElement("line", { x1: "22", y1: "2", x2: "11", y2: "13" }), /* @__PURE__ */ xn.createElement("polygon", { points: "22 2 15 22 11 13 2 9 22 2" }))
    ), /* @__PURE__ */ xn.createElement(
      "button",
      {
        onClick: () => handleBubbleAction("chat"),
        className: "w-10 h-10 rounded-full border border-solid border-white/30 flex items-center justify-center hover:bg-white/10 transition-colors"
      },
      /* @__PURE__ */ xn.createElement("svg", { width: "18", height: "18", viewBox: "0 0 24 24", fill: "none", stroke: "white", strokeWidth: "2" }, /* @__PURE__ */ xn.createElement("path", { d: "M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z" }))
    ), /* @__PURE__ */ xn.createElement(
      "button",
      {
        onClick: () => handleBubbleAction("notifications"),
        className: "relative w-10 h-10 rounded-full bg-[#FF2258] flex items-center justify-center hover:bg-[#FF2258]/90 transition-colors"
      },
      /* @__PURE__ */ xn.createElement("svg", { width: "18", height: "18", viewBox: "0 0 24 24", fill: "none", stroke: "white", strokeWidth: "2" }, /* @__PURE__ */ xn.createElement("path", { d: "M18 8A6 6 0 0 0 6 8c0 7-3 9-3 9h18s-3-2-3-9" }), /* @__PURE__ */ xn.createElement("path", { d: "M13.73 21a2 2 0 0 1-3.46 0" })),
      /* @__PURE__ */ xn.createElement("span", { className: "absolute -top-1 -right-1 w-5 h-5 bg-[#FF2258] border-2 border-solid border-[#2E2740] rounded-full flex items-center justify-center" }, /* @__PURE__ */ xn.createElement("span", { className: "font-jakarta font-bold text-[10px] text-white" }, credits))
    )))), /* @__PURE__ */ xn.createElement("div", { className: "px-4 mt-8" }, /* @__PURE__ */ xn.createElement("h2", { className: "font-jakarta font-semibold text-xs text-white/70 tracking-[0.1em] uppercase mb-4" }, "PERSONALIZED JOURNEYS"), /* @__PURE__ */ xn.createElement("div", { className: "relative w-full rounded-2xl overflow-hidden bg-gradient-to-br from-[#AD256C] to-[#8B1F57] p-6 shadow-lg" }, /* @__PURE__ */ xn.createElement(
      "button",
      {
        onClick: () => handleBubbleAction("previous_journey"),
        className: "absolute left-4 top-1/2 -translate-y-1/2 w-10 h-10 rounded-full bg-white/10 bg-white/[0.12] flex items-center justify-center hover:bg-white/20 transition-colors z-10"
      },
      /* @__PURE__ */ xn.createElement("svg", { width: "20", height: "20", viewBox: "0 0 24 24", fill: "none", stroke: "white", strokeWidth: "3" }, /* @__PURE__ */ xn.createElement("polyline", { points: "15 18 9 12 15 6" }))
    ), /* @__PURE__ */ xn.createElement(
      "button",
      {
        onClick: () => handleBubbleAction("next_journey"),
        className: "absolute right-4 top-1/2 -translate-y-1/2 w-10 h-10 rounded-full bg-white/10 bg-white/[0.12] flex items-center justify-center hover:bg-white/20 transition-colors z-10"
      },
      /* @__PURE__ */ xn.createElement("svg", { width: "20", height: "20", viewBox: "0 0 24 24", fill: "none", stroke: "white", strokeWidth: "3" }, /* @__PURE__ */ xn.createElement("polyline", { points: "9 18 15 12 9 6" }))
    ), /* @__PURE__ */ xn.createElement("div", { className: "px-8" }, /* @__PURE__ */ xn.createElement("h3", { className: "font-jakarta font-bold text-2xl text-white mb-4 text-center" }, currentJourney.title), /* @__PURE__ */ xn.createElement("div", { className: "bg-[#2E2740] rounded-xl p-4 mb-6" }, /* @__PURE__ */ xn.createElement("p", { className: "font-poppins text-sm text-white/90 leading-relaxed" }, currentJourney.description)), /* @__PURE__ */ xn.createElement("div", { className: "flex items-center justify-center gap-3" }, /* @__PURE__ */ xn.createElement(
      "button",
      {
        onClick: () => push("details", { title: currentJourney.title }),
        className: "px-8 py-3 bg-[#FF2258] rounded-full font-jakarta font-semibold text-sm text-white hover:bg-[#FF2258]/90 transition-colors btn-pressed"
      },
      "Select (Push Test)"
    ), /* @__PURE__ */ xn.createElement(
      "button",
      {
        onClick: () => handleBubbleAction("change_topic"),
        className: "px-6 py-3 border border-solid border-white/50 rounded-full font-jakarta font-medium text-sm text-white hover:bg-white/10 transition-colors flex items-center gap-2"
      },
      /* @__PURE__ */ xn.createElement("svg", { width: "16", height: "16", viewBox: "0 0 24 24", fill: "none", stroke: "currentColor", strokeWidth: "2" }, /* @__PURE__ */ xn.createElement("polyline", { points: "1 4 1 10 7 10" }), /* @__PURE__ */ xn.createElement("polyline", { points: "23 20 23 14 17 14" }), /* @__PURE__ */ xn.createElement("path", { d: "M20.49 9A9 9 0 0 0 5.64 5.64L1 10m22 4l-4.64 4.36A9 9 0 0 1 3.51 15" })),
      "Topic"
    ))))), /* @__PURE__ */ xn.createElement("div", { className: "px-4 mt-8" }, /* @__PURE__ */ xn.createElement("h2", { className: "font-jakarta font-semibold text-xs text-white/70 tracking-[0.1em] uppercase mb-4" }, "QUICK STEPS"), /* @__PURE__ */ xn.createElement("div", { className: "space-y-4" }, /* @__PURE__ */ xn.createElement(
      "div",
      {
        className: "relative rounded-2xl overflow-hidden bg-gradient-to-br from-[#6D6987] to-[#4A4660] p-6 shadow-lg cursor-pointer hover:scale-[1.02] transition-transform",
        onClick: () => handleBubbleAction("conversation_coach")
      },
      /* @__PURE__ */ xn.createElement("div", { className: "absolute -top-1 -right-1 w-20 h-20 overflow-hidden" }, /* @__PURE__ */ xn.createElement("div", { className: "absolute top-4 -right-8 w-32 bg-[#E76B0C] text-white text-center font-jakarta font-bold text-xs py-1 transform rotate-45 shadow-lg" }, "NEW")),
      /* @__PURE__ */ xn.createElement("div", { className: "flex items-center gap-4" }, /* @__PURE__ */ xn.createElement("div", { className: "w-12 h-12 rounded-full bg-[#E76B0C] flex items-center justify-center flex-shrink-0" }, /* @__PURE__ */ xn.createElement("svg", { width: "24", height: "24", viewBox: "0 0 24 24", fill: "none", stroke: "white", strokeWidth: "2" }, /* @__PURE__ */ xn.createElement("path", { d: "M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z" }))), /* @__PURE__ */ xn.createElement("div", null, /* @__PURE__ */ xn.createElement("h3", { className: "font-jakarta font-bold text-lg text-white" }, "Conversation"), /* @__PURE__ */ xn.createElement("h3", { className: "font-jakarta font-bold text-lg text-white" }, "Coach")))
    ), /* @__PURE__ */ xn.createElement("div", { className: "grid grid-cols-2 gap-4" }, /* @__PURE__ */ xn.createElement(
      "div",
      {
        className: "rounded-2xl overflow-hidden bg-gradient-to-br from-[#AD256C] to-[#8B1F57] p-5 shadow-lg cursor-pointer hover:scale-[1.02] transition-transform",
        onClick: () => handleBubbleAction("practical_actions")
      },
      /* @__PURE__ */ xn.createElement("div", { className: "flex flex-col items-start gap-2" }, /* @__PURE__ */ xn.createElement("div", { className: "w-10 h-10 rounded-full bg-white/20 flex items-center justify-center" }, /* @__PURE__ */ xn.createElement("svg", { width: "20", height: "20", viewBox: "0 0 24 24", fill: "none", stroke: "white", strokeWidth: "2" }, /* @__PURE__ */ xn.createElement("polyline", { points: "9 11 12 14 22 4" }), /* @__PURE__ */ xn.createElement("path", { d: "M21 12v7a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11" }))), /* @__PURE__ */ xn.createElement("h3", { className: "font-jakarta font-bold text-base text-white leading-tight" }, "Practical", /* @__PURE__ */ xn.createElement("br", null), "Actions"))
    ), /* @__PURE__ */ xn.createElement(
      "div",
      {
        className: "rounded-2xl overflow-hidden bg-gradient-to-br from-[#4A7C9E] to-[#3A5F7D] p-5 shadow-lg cursor-pointer hover:scale-[1.02] transition-transform",
        onClick: () => handleBubbleAction("ask_question")
      },
      /* @__PURE__ */ xn.createElement("div", { className: "flex flex-col items-start gap-2" }, /* @__PURE__ */ xn.createElement("div", { className: "w-10 h-10 rounded-full bg-white/20 flex items-center justify-center" }, /* @__PURE__ */ xn.createElement("svg", { width: "20", height: "20", viewBox: "0 0 24 24", fill: "none", stroke: "white", strokeWidth: "2" }, /* @__PURE__ */ xn.createElement("circle", { cx: "12", cy: "12", r: "10" }), /* @__PURE__ */ xn.createElement("path", { d: "M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3" }), /* @__PURE__ */ xn.createElement("line", { x1: "12", y1: "17", x2: "12.01", y2: "17" }))), /* @__PURE__ */ xn.createElement("h3", { className: "font-jakarta font-bold text-base text-white leading-tight" }, "Ask a", /* @__PURE__ */ xn.createElement("br", null), "Question"))
    )))));
  };
  var HomeSection_default = HomeSection;

  // node_modules/natively/dist/utils/globalThis.js
  function getGlobalContext() {
    if (typeof globalThis !== "undefined") {
      return globalThis;
    }
    if (typeof self !== "undefined") {
      return self;
    }
    if (typeof window !== "undefined") {
      return window;
    }
    if (typeof global !== "undefined") {
      return global;
    }
    return null;
  }
  var globalContext = getGlobalContext();
  var globalThis_default = globalContext;

  // node_modules/natively/dist/classes/Natively.js
  function asyncGeneratorStep2(n3, t3, e3, r3, o3, a3, c3) {
    try {
      var i3 = n3[a3](c3), u3 = i3.value;
    } catch (n4) {
      return void e3(n4);
    }
    i3.done ? t3(u3) : Promise.resolve(u3).then(r3, o3);
  }
  function _asyncToGenerator(n3) {
    return function() {
      var t3 = this, e3 = arguments;
      return new Promise(function(r3, o3) {
        var a3 = n3.apply(t3, e3);
        function _next(n4) {
          asyncGeneratorStep2(a3, r3, o3, _next, _throw, "next", n4);
        }
        function _throw(n4) {
          asyncGeneratorStep2(a3, r3, o3, _next, _throw, "throw", n4);
        }
        _next(void 0);
      });
    };
  }
  function _defineProperty(e3, r3, t3) {
    return (r3 = _toPropertyKey(r3)) in e3 ? Object.defineProperty(e3, r3, { value: t3, enumerable: true, configurable: true, writable: true }) : e3[r3] = t3, e3;
  }
  function _toPropertyKey(t3) {
    var i3 = _toPrimitive(t3, "string");
    return "symbol" == typeof i3 ? i3 : i3 + "";
  }
  function _toPrimitive(t3, r3) {
    if ("object" != typeof t3 || !t3) return t3;
    var e3 = t3[Symbol.toPrimitive];
    if (void 0 !== e3) {
      var i3 = e3.call(t3, r3 || "default");
      if ("object" != typeof i3) return i3;
      throw new TypeError("@@toPrimitive must return a primitive value.");
    }
    return ("string" === r3 ? String : Number)(t3);
  }
  var Natively = class {
    constructor() {
      var _globalContext$naviga, _globalContext$naviga2;
      _defineProperty(this, "isDebug", false);
      _defineProperty(this, "min_app_version", 0);
      _defineProperty(this, "app_version", 0);
      _defineProperty(this, "injected", false);
      _defineProperty(this, "observers", []);
      _defineProperty(this, "onNativeError", null);
      _defineProperty(this, "onTabChanged", null);
      _defineProperty(this, "isIOSApp", (globalThis_default === null || globalThis_default === void 0 || (_globalContext$naviga = globalThis_default.navigator) === null || _globalContext$naviga === void 0 || (_globalContext$naviga = _globalContext$naviga.userAgent) === null || _globalContext$naviga === void 0 ? void 0 : _globalContext$naviga.includes("Natively/iOS")) || false);
      _defineProperty(this, "isAndroidApp", (globalThis_default === null || globalThis_default === void 0 || (_globalContext$naviga2 = globalThis_default.navigator) === null || _globalContext$naviga2 === void 0 || (_globalContext$naviga2 = _globalContext$naviga2.userAgent) === null || _globalContext$naviga2 === void 0 ? void 0 : _globalContext$naviga2.includes("Natively/Android")) || false);
    }
    setDebug(isDebug) {
      if (globalThis_default) {
        globalThis_default.natively.isDebug = isDebug;
      }
    }
    notify(min, current) {
      if (globalThis_default) {
        globalThis_default.natively.injected = true;
        if (min) {
          globalThis_default.natively.min_app_version = min;
        }
        if (current) {
          globalThis_default.natively.app_version = current;
        }
      }
      var observers = globalThis_default === null || globalThis_default === void 0 ? void 0 : globalThis_default.natively.observers;
      if (globalThis_default !== null && globalThis_default !== void 0 && globalThis_default.natively.isDebug) {
        console.log("[INFO] Notify observers: ", observers.length);
      }
      while (observers.length > 0) {
        var observer = observers.shift();
        observer === null || observer === void 0 || observer();
      }
    }
    addObserver(fn2) {
      if (globalThis_default !== null && globalThis_default !== void 0 && globalThis_default.natively.injected) {
        fn2();
      } else {
        if (globalThis_default !== null && globalThis_default !== void 0 && globalThis_default.natively.isDebug) {
          console.log("[DEBUG] addObserver: ".concat(fn2));
        }
        globalThis_default === null || globalThis_default === void 0 || globalThis_default.natively.observers.push(fn2);
      }
    }
    trigger(respId, minVersion, callback, method, body) {
      var isTestVersion = globalThis_default === null || globalThis_default === void 0 ? void 0 : globalThis_default.natively.isDebug;
      if (!(globalThis_default !== null && globalThis_default !== void 0 && globalThis_default.natively.injected)) {
        globalThis_default === null || globalThis_default === void 0 || globalThis_default.natively.addObserver(() => {
          globalThis_default === null || globalThis_default === void 0 || globalThis_default.natively.trigger(respId, minVersion, callback, method, body);
        });
        return;
      }
      if (minVersion > (globalThis_default === null || globalThis_default === void 0 ? void 0 : globalThis_default.natively.app_version)) {
        if (isTestVersion) {
          alert("[ERROR] Please rebuild the app to use this functionality. App Version: ".concat(globalThis_default === null || globalThis_default === void 0 ? void 0 : globalThis_default.natively.app_version, ", feature version: ").concat(minVersion));
        }
        return;
      }
      if (callback) {
        var fullMethodName;
        if (respId) {
          fullMethodName = method + "_response_" + respId;
        } else {
          fullMethodName = method + "_response";
        }
        if (globalThis_default) {
          globalThis_default[fullMethodName] = function(resp, err) {
            globalThis_default === null || globalThis_default === void 0 || globalThis_default.$agent.response();
            if (err.message && isTestVersion) {
              alert("[ERROR] Error message: ".concat(err.message));
              return;
            }
            if (isTestVersion) {
              console.log("[DEBUG] Callback method: ".concat(fullMethodName, ", body: ").concat(JSON.stringify(resp), ", respId: ").concat(respId));
            }
            callback(resp);
          };
        }
        if (body) {
          body.response_id = respId;
        } else {
          body = {
            response_id: respId
          };
        }
      }
      if (isTestVersion) {
        console.log("[DEBUG] Trigger method: ".concat(method, ", body: ").concat(JSON.stringify(body)));
      }
      globalThis_default === null || globalThis_default === void 0 || globalThis_default.$agent.trigger(method, body);
    }
    setTabChangedHandler(callback) {
      if (typeof callback !== "function") {
        console.warn("[Natively] Tab changed handler must be a function");
        return;
      }
      this.onTabChanged = callback;
    }
    removeTabChangedHandler() {
      this.onTabChanged = null;
    }
    setErrorHandler(callback) {
      if (typeof callback !== "function") {
        return;
      }
      this.onNativeError = callback;
    }
    removeErrorHandler() {
      this.onNativeError = null;
    }
    setErrorScreen(showError) {
      globalThis_default === null || globalThis_default === void 0 || globalThis_default.natively.trigger(void 0, 0, void 0, "error_screen", {
        show_error: showError
      });
    }
    openLogger() {
      globalThis_default === null || globalThis_default === void 0 || globalThis_default.$agent.natively_logger();
    }
    openConsole() {
      globalThis_default === null || globalThis_default === void 0 || globalThis_default.natively.trigger(void 0, 22, void 0, "app_console");
    }
    closeApp() {
      globalThis_default === null || globalThis_default === void 0 || globalThis_default.natively.trigger(void 0, 11, void 0, "app_close");
    }
    showProgress(toggle) {
      globalThis_default === null || globalThis_default === void 0 || globalThis_default.natively.trigger(void 0, 11, void 0, "app_show_progress", {
        toggle
      });
    }
    shareImage(image_url) {
      globalThis_default === null || globalThis_default === void 0 || globalThis_default.natively.trigger(void 0, 0, void 0, "share_image", {
        url: image_url
      });
    }
    shareText(text) {
      globalThis_default === null || globalThis_default === void 0 || globalThis_default.natively.trigger(void 0, 0, void 0, "share_text", {
        text
      });
    }
    shareTextAndImage(text, image_url) {
      globalThis_default === null || globalThis_default === void 0 || globalThis_default.natively.trigger(void 0, 0, void 0, "share_text_and_image", {
        url: image_url,
        text
      });
    }
    shareFile(file_url) {
      globalThis_default === null || globalThis_default === void 0 || globalThis_default.natively.trigger(void 0, 2, void 0, "share_file", {
        url: file_url
      });
    }
    openExternalURL(url, external) {
      var params = {
        url: typeof url === "undefined" ? "https://buildnatively.com" : url,
        view: typeof external !== "undefined" && external ? "external" : "web"
      };
      globalThis_default === null || globalThis_default === void 0 || globalThis_default.natively.trigger(void 0, 18, void 0, "open_link", params);
    }
    openExternalApp(url) {
      globalThis_default === null || globalThis_default === void 0 || globalThis_default.natively.trigger(void 0, 22, void 0, "open_app", {
        url
      });
    }
    showAppToast(type, text) {
      globalThis_default === null || globalThis_default === void 0 || globalThis_default.natively.trigger(void 0, 0, void 0, "show_toast", {
        text: text || "",
        type: type || "DEFAULT"
      });
    }
    showAppBanner(type, title, description) {
      globalThis_default === null || globalThis_default === void 0 || globalThis_default.natively.trigger(void 0, 0, void 0, "show_banner", {
        type: type || "INFO",
        title: title || "",
        description: description || ""
      });
    }
    analyticsTrackEvent(name, data) {
      var params = {
        name
      };
      if (data) {
        params.data = data;
      }
      globalThis_default === null || globalThis_default === void 0 || globalThis_default.natively.trigger(void 0, 37, void 0, "analytics_log_event", params);
    }
    requestAppReview() {
      globalThis_default === null || globalThis_default === void 0 || globalThis_default.natively.trigger(void 0, 0, void 0, "request_review");
    }
    getInsets(callback) {
      globalThis_default === null || globalThis_default === void 0 || globalThis_default.natively.trigger(void 0, 36, callback, "get_insets");
    }
    getLocales(callback) {
      globalThis_default === null || globalThis_default === void 0 || globalThis_default.natively.trigger(void 0, 40, callback, "get_locales");
    }
    setLocale(locale, callback) {
      globalThis_default === null || globalThis_default === void 0 || globalThis_default.natively.trigger(void 0, 40, callback, "set_locale", {
        locale
      });
    }
    setAppBackgroundColor(color) {
      globalThis_default === null || globalThis_default === void 0 || globalThis_default.natively.trigger(void 0, 1, void 0, "app_background", {
        color
      });
    }
    setAppProgressColor(color) {
      globalThis_default === null || globalThis_default === void 0 || globalThis_default.natively.trigger(void 0, 1, void 0, "app_progress", {
        color
      });
    }
    setAppSwipeNavigation(toggle) {
      globalThis_default === null || globalThis_default === void 0 || globalThis_default.natively.trigger(void 0, 22, void 0, "app_navigation", {
        toggle
      });
    }
    setAppPullToRefresh(toggle) {
      globalThis_default === null || globalThis_default === void 0 || globalThis_default.natively.trigger(void 0, 1, void 0, "app_pull", {
        toggle
      });
    }
    setAppOrientation(orientation) {
      globalThis_default === null || globalThis_default === void 0 || globalThis_default.natively.trigger(void 0, 3, void 0, "app_orientation", {
        orientation
      });
    }
    setAppStatusBarStyle(style) {
      globalThis_default === null || globalThis_default === void 0 || globalThis_default.natively.trigger(void 0, 22, void 0, "status_bar_style", {
        style
      });
    }
    hideLoadingScreen() {
      globalThis_default === null || globalThis_default === void 0 || globalThis_default.natively.trigger(void 0, 17, void 0, "loading_screen", {
        show_loader: false,
        auto_hide: true
      });
    }
    showLoadingScreen(autoHide) {
      globalThis_default === null || globalThis_default === void 0 || globalThis_default.natively.trigger(void 0, 17, void 0, "loading_screen", {
        show_loader: true,
        auto_hide: autoHide || false
      });
    }
    openAppSettings() {
      globalThis_default === null || globalThis_default === void 0 || globalThis_default.natively.trigger(void 0, 0, void 0, "open_appsettings");
    }
    showTabBar() {
      globalThis_default === null || globalThis_default === void 0 || globalThis_default.natively.trigger(void 0, 33, void 0, "show_tab_bar");
    }
    enableWakelock() {
      globalThis_default === null || globalThis_default === void 0 || globalThis_default.natively.trigger(void 0, 34, void 0, "wakelock_enable");
    }
    disableWakelock() {
      globalThis_default === null || globalThis_default === void 0 || globalThis_default.natively.trigger(void 0, 34, void 0, "wakelock_disable");
    }
    hideTabBar() {
      globalThis_default === null || globalThis_default === void 0 || globalThis_default.natively.trigger(void 0, 33, void 0, "hide_tab_bar");
    }
    reloadWebview() {
      globalThis_default === null || globalThis_default === void 0 || globalThis_default.natively.trigger(void 0, 35, void 0, "reset_webview");
    }
    hapticPattern(pattern, delay) {
      globalThis_default === null || globalThis_default === void 0 || globalThis_default.natively.trigger(void 0, 22, void 0, "haptic_pattern", {
        pattern,
        delay
      });
    }
    openPDF(options, callback) {
      var params = {
        url: options.url || "",
        base64: options.base64 || "",
        fileName: options.fileName || "pdf-".concat((/* @__PURE__ */ new Date()).getTime(), ".pdf"),
        download: options.download === true
      };
      globalThis_default === null || globalThis_default === void 0 || globalThis_default.natively.trigger(void 0, 38, callback, "open_pdf", params);
    }
    hapticImpact(type) {
      globalThis_default === null || globalThis_default === void 0 || globalThis_default.natively.trigger(void 0, 22, void 0, "haptic_impact", {
        type
      });
    }
    hapticNotification(type) {
      globalThis_default === null || globalThis_default === void 0 || globalThis_default.natively.trigger(void 0, 22, void 0, "haptic_notification", {
        type
      });
    }
    sendPushNotification(appId, payload, player_ids, isPreview) {
      return _asyncToGenerator(function* () {
        var filtered = player_ids.filter((id) => id.length > 0);
        var include_player_ids = [...new Set(filtered)];
        var notification = {
          app_id: isPreview ? "be83022a-1d08-45d0-a07a-0c3655666e17" : appId,
          include_player_ids
        };
        if (payload.template_id) {
          notification.template_id = payload.template_id;
        } else {
          notification.headings = {
            en: payload.title || "Empty Title"
          };
          notification.contents = {
            en: payload.message || "Empty Message"
          };
          if (payload.subtitle) {
            notification.subtitle = {
              en: payload.subtitle
            };
          }
          if (payload.redirect_url) {
            notification.url = payload.redirect_url;
          }
        }
        var options = {
          method: "POST",
          headers: {
            "Content-type": "application/json"
          },
          body: JSON.stringify(notification)
        };
        return yield fetch("https://onesignal.com/api/v1/notifications", options);
      })();
    }
  };

  // node_modules/natively/dist/utils/generateID.js
  var generateID = () => Date.now().toString(36) + Math.random().toString(36).substring(2);

  // node_modules/natively/dist/classes/NativelyAppleSignInService.js
  function _defineProperty2(e3, r3, t3) {
    return (r3 = _toPropertyKey2(r3)) in e3 ? Object.defineProperty(e3, r3, { value: t3, enumerable: true, configurable: true, writable: true }) : e3[r3] = t3, e3;
  }
  function _toPropertyKey2(t3) {
    var i3 = _toPrimitive2(t3, "string");
    return "symbol" == typeof i3 ? i3 : i3 + "";
  }
  function _toPrimitive2(t3, r3) {
    if ("object" != typeof t3 || !t3) return t3;
    var e3 = t3[Symbol.toPrimitive];
    if (void 0 !== e3) {
      var i3 = e3.call(t3, r3 || "default");
      if ("object" != typeof i3) return i3;
      throw new TypeError("@@toPrimitive must return a primitive value.");
    }
    return ("string" === r3 ? String : Number)(t3);
  }
  var NativelyAppleSignInService = class {
    constructor() {
      _defineProperty2(this, "id", generateID());
    }
    signin(callback) {
      globalThis_default === null || globalThis_default === void 0 || globalThis_default.natively.trigger(this.id, 16, callback, "apple_signin", {});
    }
  };

  // node_modules/natively/dist/classes/NativelyClipboard.js
  function _defineProperty3(e3, r3, t3) {
    return (r3 = _toPropertyKey3(r3)) in e3 ? Object.defineProperty(e3, r3, { value: t3, enumerable: true, configurable: true, writable: true }) : e3[r3] = t3, e3;
  }
  function _toPropertyKey3(t3) {
    var i3 = _toPrimitive3(t3, "string");
    return "symbol" == typeof i3 ? i3 : i3 + "";
  }
  function _toPrimitive3(t3, r3) {
    if ("object" != typeof t3 || !t3) return t3;
    var e3 = t3[Symbol.toPrimitive];
    if (void 0 !== e3) {
      var i3 = e3.call(t3, r3 || "default");
      if ("object" != typeof i3) return i3;
      throw new TypeError("@@toPrimitive must return a primitive value.");
    }
    return ("string" === r3 ? String : Number)(t3);
  }
  var NativelyClipboard = class {
    constructor() {
      _defineProperty3(this, "id", generateID());
    }
    copy(text) {
      globalThis_default === null || globalThis_default === void 0 || globalThis_default.natively.trigger(void 0, 11, void 0, "clipboard_copy", {
        text
      });
    }
    paste(paste_callback) {
      globalThis_default === null || globalThis_default === void 0 || globalThis_default.natively.trigger(this.id, 11, paste_callback, "clipboard_paste");
    }
  };

  // node_modules/natively/dist/classes/NativelyInfo.js
  function _defineProperty4(e3, r3, t3) {
    return (r3 = _toPropertyKey4(r3)) in e3 ? Object.defineProperty(e3, r3, { value: t3, enumerable: true, configurable: true, writable: true }) : e3[r3] = t3, e3;
  }
  function _toPropertyKey4(t3) {
    var i3 = _toPrimitive4(t3, "string");
    return "symbol" == typeof i3 ? i3 : i3 + "";
  }
  function _toPrimitive4(t3, r3) {
    if ("object" != typeof t3 || !t3) return t3;
    var e3 = t3[Symbol.toPrimitive];
    if (void 0 !== e3) {
      var i3 = e3.call(t3, r3 || "default");
      if ("object" != typeof i3) return i3;
      throw new TypeError("@@toPrimitive must return a primitive value.");
    }
    return ("string" === r3 ? String : Number)(t3);
  }
  var NativelyInfo = class {
    constructor() {
      _defineProperty4(this, "id", generateID());
    }
    browserInfo() {
      var _globalContext$naviga, _globalContext$naviga2;
      var isNativeApp = typeof (globalThis_default === null || globalThis_default === void 0 ? void 0 : globalThis_default.$agent) !== "undefined";
      var isIOSApp = (globalThis_default === null || globalThis_default === void 0 || (_globalContext$naviga = globalThis_default.navigator) === null || _globalContext$naviga === void 0 || (_globalContext$naviga = _globalContext$naviga.userAgent) === null || _globalContext$naviga === void 0 ? void 0 : _globalContext$naviga.includes("Natively/iOS")) || false;
      var isAndroidApp = (globalThis_default === null || globalThis_default === void 0 || (_globalContext$naviga2 = globalThis_default.navigator) === null || _globalContext$naviga2 === void 0 || (_globalContext$naviga2 = _globalContext$naviga2.userAgent) === null || _globalContext$naviga2 === void 0 ? void 0 : _globalContext$naviga2.includes("Natively/Android")) || false;
      return {
        isNativeApp,
        isIOSApp,
        isAndroidApp
      };
    }
    getAppInfo(app_info_callback) {
      if (!(globalThis_default !== null && globalThis_default !== void 0 && globalThis_default.natively)) return;
      globalThis_default === null || globalThis_default === void 0 || globalThis_default.natively.trigger(this.id, 0, app_info_callback, "app_info");
    }
    connectivity(connectivity_callback) {
      if (!(globalThis_default !== null && globalThis_default !== void 0 && globalThis_default.natively)) return;
      globalThis_default === null || globalThis_default === void 0 || globalThis_default.natively.trigger(void 0, 0, connectivity_callback, "connectivity");
    }
    app_state(app_state_callback) {
      if (!(globalThis_default !== null && globalThis_default !== void 0 && globalThis_default.natively)) return;
      globalThis_default === null || globalThis_default === void 0 || globalThis_default.natively.trigger(void 0, 19, app_state_callback, "app_state");
    }
    keyboard_visibility(keyboard_visibility_callback) {
      if (!(globalThis_default !== null && globalThis_default !== void 0 && globalThis_default.natively)) return;
      globalThis_default === null || globalThis_default === void 0 || globalThis_default.natively.trigger(void 0, 34, keyboard_visibility_callback, "keyboard_visibility");
    }
  };

  // node_modules/natively/dist/classes/NativelyNotifications.js
  function _defineProperty5(e3, r3, t3) {
    return (r3 = _toPropertyKey5(r3)) in e3 ? Object.defineProperty(e3, r3, { value: t3, enumerable: true, configurable: true, writable: true }) : e3[r3] = t3, e3;
  }
  function _toPropertyKey5(t3) {
    var i3 = _toPrimitive5(t3, "string");
    return "symbol" == typeof i3 ? i3 : i3 + "";
  }
  function _toPrimitive5(t3, r3) {
    if ("object" != typeof t3 || !t3) return t3;
    var e3 = t3[Symbol.toPrimitive];
    if (void 0 !== e3) {
      var i3 = e3.call(t3, r3 || "default");
      if ("object" != typeof i3) return i3;
      throw new TypeError("@@toPrimitive must return a primitive value.");
    }
    return ("string" === r3 ? String : Number)(t3);
  }
  var NativelyNotifications = class {
    constructor() {
      _defineProperty5(this, "id", generateID());
    }
    getOneSignalId(onesignal_playerid_callback) {
      globalThis_default === null || globalThis_default === void 0 || globalThis_default.natively.trigger(this.id, 0, onesignal_playerid_callback, "onesignal_playerid");
    }
    requestPermission(fallbackToSettings, push_register_callback) {
      globalThis_default === null || globalThis_default === void 0 || globalThis_default.natively.trigger(this.id, 0, push_register_callback, "push_register", {
        fallbackToSettings
      });
    }
    getPermissionStatus(push_permission_callback) {
      globalThis_default === null || globalThis_default === void 0 || globalThis_default.natively.trigger(this.id, 0, push_permission_callback, "push_permission");
    }
    getExternalId(callback) {
      globalThis_default === null || globalThis_default === void 0 || globalThis_default.natively.trigger(this.id, 0, callback, "onesignal_externalid");
    }
    setExternalId(data, callback) {
      globalThis_default === null || globalThis_default === void 0 || globalThis_default.natively.trigger(this.id, 0, callback, "onesignal_setexternalid", data);
    }
    removeExternalId(callback) {
      globalThis_default === null || globalThis_default === void 0 || globalThis_default.natively.trigger(this.id, 0, callback, "onesignal_removeexternalid");
    }
  };

  // node_modules/natively/dist/classes/NativelyGeolocation.js
  function _defineProperty6(e3, r3, t3) {
    return (r3 = _toPropertyKey6(r3)) in e3 ? Object.defineProperty(e3, r3, { value: t3, enumerable: true, configurable: true, writable: true }) : e3[r3] = t3, e3;
  }
  function _toPropertyKey6(t3) {
    var i3 = _toPrimitive6(t3, "string");
    return "symbol" == typeof i3 ? i3 : i3 + "";
  }
  function _toPrimitive6(t3, r3) {
    if ("object" != typeof t3 || !t3) return t3;
    var e3 = t3[Symbol.toPrimitive];
    if (void 0 !== e3) {
      var i3 = e3.call(t3, r3 || "default");
      if ("object" != typeof i3) return i3;
      throw new TypeError("@@toPrimitive must return a primitive value.");
    }
    return ("string" === r3 ? String : Number)(t3);
  }
  var NativelyGeolocation = class {
    constructor() {
      _defineProperty6(this, "id", generateID());
    }
    getUserGeolocation(distance, geolocation_callback) {
      globalThis_default === null || globalThis_default === void 0 || globalThis_default.natively.trigger(this.id, 0, geolocation_callback, "geolocation", {
        distance
      });
    }
    requestPermission(geo_register_callback) {
      globalThis_default === null || globalThis_default === void 0 || globalThis_default.natively.trigger(this.id, 0, geo_register_callback, "geo_register");
    }
    getPermissionStatus(geo_permission_callback) {
      globalThis_default === null || globalThis_default === void 0 || globalThis_default.natively.trigger(this.id, 0, geo_permission_callback, "geo_permission");
    }
  };

  // node_modules/natively/dist/classes/NativelyLocation.js
  function _defineProperty7(e3, r3, t3) {
    return (r3 = _toPropertyKey7(r3)) in e3 ? Object.defineProperty(e3, r3, { value: t3, enumerable: true, configurable: true, writable: true }) : e3[r3] = t3, e3;
  }
  function _toPropertyKey7(t3) {
    var i3 = _toPrimitive7(t3, "string");
    return "symbol" == typeof i3 ? i3 : i3 + "";
  }
  function _toPrimitive7(t3, r3) {
    if ("object" != typeof t3 || !t3) return t3;
    var e3 = t3[Symbol.toPrimitive];
    if (void 0 !== e3) {
      var i3 = e3.call(t3, r3 || "default");
      if ("object" != typeof i3) return i3;
      throw new TypeError("@@toPrimitive must return a primitive value.");
    }
    return ("string" === r3 ? String : Number)(t3);
  }
  var NativelyLocation = class {
    constructor() {
      _defineProperty7(this, "id", generateID());
    }
    current(minAccuracyIOS, accuracyTypeIOS, priority_android, location_callback) {
      var fallback_to_settings = arguments.length > 4 && arguments[4] !== void 0 ? arguments[4] : true;
      globalThis_default === null || globalThis_default === void 0 || globalThis_default.natively.trigger(this.id, 12, location_callback, "location_current", {
        minAccuracy: minAccuracyIOS,
        accuracyType: accuracyTypeIOS,
        priority: priority_android,
        fallbackToSettings: fallback_to_settings
      });
    }
    permission(location_permission_callback) {
      globalThis_default === null || globalThis_default === void 0 || globalThis_default.natively.trigger(this.id, 6, location_permission_callback, "location_permission");
    }
    start(interval, minAccuracyIOS, accuracyTypeIOS, priority_android, location_callback) {
      var fallback_to_settings = arguments.length > 5 && arguments[5] !== void 0 ? arguments[5] : true;
      globalThis_default === null || globalThis_default === void 0 || globalThis_default.natively.trigger(this.id, 12, location_callback, "location_start", {
        minAccuracy: minAccuracyIOS,
        accuracyType: accuracyTypeIOS,
        priority: priority_android,
        fallbackToSettings: fallback_to_settings,
        interval
      });
    }
    stop() {
      globalThis_default === null || globalThis_default === void 0 || globalThis_default.natively.trigger(this.id, 3, void 0, "location_stop", {});
    }
    startBackground(interval, minAccuracyIOS, accuracyTypeIOS, priority_android, responseIdentifier, location_bg_callback) {
      var fallback_to_settings = arguments.length > 6 && arguments[6] !== void 0 ? arguments[6] : true;
      var params = {
        identifier: responseIdentifier !== null && responseIdentifier !== void 0 ? responseIdentifier : "empty",
        interval: interval !== null && interval !== void 0 ? interval : 1e3 * 60,
        minAccuracy: minAccuracyIOS !== null && minAccuracyIOS !== void 0 ? minAccuracyIOS : 50,
        accuracyType: accuracyTypeIOS !== null && accuracyTypeIOS !== void 0 ? accuracyTypeIOS : "Best",
        priority: priority_android !== null && priority_android !== void 0 ? priority_android : "BALANCED",
        fallbackToSettings: fallback_to_settings
      };
      globalThis_default === null || globalThis_default === void 0 || globalThis_default.natively.trigger(this.id, 12, location_bg_callback, "location_start_bg", params);
    }
    statusBackground(location_bg_status_callback) {
      globalThis_default === null || globalThis_default === void 0 || globalThis_default.natively.trigger(this.id, 20, location_bg_status_callback, "location_status_bg", {});
    }
    stopBackground(location_bg_callback) {
      globalThis_default === null || globalThis_default === void 0 || globalThis_default.natively.trigger(this.id, 4, location_bg_callback, "location_stop_bg", {});
    }
  };

  // node_modules/natively/dist/classes/NativelyMessage.js
  function _defineProperty8(e3, r3, t3) {
    return (r3 = _toPropertyKey8(r3)) in e3 ? Object.defineProperty(e3, r3, { value: t3, enumerable: true, configurable: true, writable: true }) : e3[r3] = t3, e3;
  }
  function _toPropertyKey8(t3) {
    var i3 = _toPrimitive8(t3, "string");
    return "symbol" == typeof i3 ? i3 : i3 + "";
  }
  function _toPrimitive8(t3, r3) {
    if ("object" != typeof t3 || !t3) return t3;
    var e3 = t3[Symbol.toPrimitive];
    if (void 0 !== e3) {
      var i3 = e3.call(t3, r3 || "default");
      if ("object" != typeof i3) return i3;
      throw new TypeError("@@toPrimitive must return a primitive value.");
    }
    return ("string" === r3 ? String : Number)(t3);
  }
  var NativelyMessage = class {
    constructor() {
      _defineProperty8(this, "id", generateID());
    }
    sendSMS(body, recipient, send_sms_callback) {
      var params = {
        body: body !== null && body !== void 0 ? body : "",
        recipient: recipient !== null && recipient !== void 0 ? recipient : ""
      };
      globalThis_default === null || globalThis_default === void 0 || globalThis_default.natively.trigger(this.id, 0, send_sms_callback, "send_sms", params);
    }
    sendEmail(subject, body, recipient, send_email_callback) {
      var params = {
        subject: subject !== null && subject !== void 0 ? subject : "",
        body: body !== null && body !== void 0 ? body : "",
        recipient: recipient !== null && recipient !== void 0 ? recipient : ""
      };
      globalThis_default === null || globalThis_default === void 0 || globalThis_default.natively.trigger(this.id, 0, send_email_callback, "send_email", params);
    }
  };

  // node_modules/natively/dist/classes/NativelyStorage.js
  function _defineProperty9(e3, r3, t3) {
    return (r3 = _toPropertyKey9(r3)) in e3 ? Object.defineProperty(e3, r3, { value: t3, enumerable: true, configurable: true, writable: true }) : e3[r3] = t3, e3;
  }
  function _toPropertyKey9(t3) {
    var i3 = _toPrimitive9(t3, "string");
    return "symbol" == typeof i3 ? i3 : i3 + "";
  }
  function _toPrimitive9(t3, r3) {
    if ("object" != typeof t3 || !t3) return t3;
    var e3 = t3[Symbol.toPrimitive];
    if (void 0 !== e3) {
      var i3 = e3.call(t3, r3 || "default");
      if ("object" != typeof i3) return i3;
      throw new TypeError("@@toPrimitive must return a primitive value.");
    }
    return ("string" === r3 ? String : Number)(t3);
  }
  var NativelyStorage = class {
    constructor() {
      _defineProperty9(this, "id", generateID());
    }
    setStorageValue(key, value) {
      globalThis_default === null || globalThis_default === void 0 || globalThis_default.natively.trigger(this.id, 0, void 0, "set_storage_value", {
        key,
        value
      });
    }
    getStorageValue(key, get_storage_value_callback) {
      globalThis_default === null || globalThis_default === void 0 || globalThis_default.natively.trigger(this.id, 0, get_storage_value_callback, "get_storage_value", {
        key
      });
    }
    removeStorageValue(key) {
      globalThis_default === null || globalThis_default === void 0 || globalThis_default.natively.trigger(this.id, 0, void 0, "remove_storage_value", {
        key
      });
    }
    resetStorage() {
      globalThis_default === null || globalThis_default === void 0 || globalThis_default.natively.trigger(this.id, 0, void 0, "reset_storage");
    }
  };

  // node_modules/natively/dist/classes/NativelyBiometrics.js
  function _defineProperty10(e3, r3, t3) {
    return (r3 = _toPropertyKey10(r3)) in e3 ? Object.defineProperty(e3, r3, { value: t3, enumerable: true, configurable: true, writable: true }) : e3[r3] = t3, e3;
  }
  function _toPropertyKey10(t3) {
    var i3 = _toPrimitive10(t3, "string");
    return "symbol" == typeof i3 ? i3 : i3 + "";
  }
  function _toPrimitive10(t3, r3) {
    if ("object" != typeof t3 || !t3) return t3;
    var e3 = t3[Symbol.toPrimitive];
    if (void 0 !== e3) {
      var i3 = e3.call(t3, r3 || "default");
      if ("object" != typeof i3) return i3;
      throw new TypeError("@@toPrimitive must return a primitive value.");
    }
    return ("string" === r3 ? String : Number)(t3);
  }
  var NativelyBiometrics = class {
    constructor(allowPass) {
      _defineProperty10(this, "id", generateID());
      _defineProperty10(this, "allowPass", void 0);
      this.allowPass = allowPass;
    }
    checkBiometricsSupport(biometrics_support_callback) {
      globalThis_default === null || globalThis_default === void 0 || globalThis_default.natively.trigger(this.id, 0, biometrics_support_callback, "biometrics_support", {
        allowPass: this.allowPass
      });
    }
    checkCredentials(biometrics_has_credentials_callback) {
      globalThis_default === null || globalThis_default === void 0 || globalThis_default.natively.trigger(this.id, 0, biometrics_has_credentials_callback, "biometrics_has_credentials");
    }
    verifyUserIdentify(biometrics_verify_callback) {
      globalThis_default === null || globalThis_default === void 0 || globalThis_default.natively.trigger(this.id, 0, biometrics_verify_callback, "biometrics_verify", {
        allowPass: this.allowPass
      });
    }
    getUserCredentials(biometrics_auth_callback) {
      globalThis_default === null || globalThis_default === void 0 || globalThis_default.natively.trigger(this.id, 0, biometrics_auth_callback, "biometrics_auth", {
        allowPass: this.allowPass
      });
    }
    removeUserCredentials(biometrics_remove_credentials_callback) {
      globalThis_default === null || globalThis_default === void 0 || globalThis_default.natively.trigger(this.id, 0, biometrics_remove_credentials_callback, "biometrics_remove_credentials");
    }
    saveUserCredentials(login, password, biometrics_auth_callback) {
      globalThis_default === null || globalThis_default === void 0 || globalThis_default.natively.trigger(this.id, 0, biometrics_auth_callback, "biometrics_auth", {
        allowPass: this.allowPass,
        login,
        password
      });
    }
  };

  // node_modules/natively/dist/classes/NativelyDatePicker.js
  function _defineProperty11(e3, r3, t3) {
    return (r3 = _toPropertyKey11(r3)) in e3 ? Object.defineProperty(e3, r3, { value: t3, enumerable: true, configurable: true, writable: true }) : e3[r3] = t3, e3;
  }
  function _toPropertyKey11(t3) {
    var i3 = _toPrimitive11(t3, "string");
    return "symbol" == typeof i3 ? i3 : i3 + "";
  }
  function _toPrimitive11(t3, r3) {
    if ("object" != typeof t3 || !t3) return t3;
    var e3 = t3[Symbol.toPrimitive];
    if (void 0 !== e3) {
      var i3 = e3.call(t3, r3 || "default");
      if ("object" != typeof i3) return i3;
      throw new TypeError("@@toPrimitive must return a primitive value.");
    }
    return ("string" === r3 ? String : Number)(t3);
  }
  var NativelyDatePicker = class {
    constructor() {
      _defineProperty11(this, "id", generateID());
    }
    showDatePicker(title, description, type, style, datepicker_callback) {
      var params = {
        type: type !== null && type !== void 0 ? type : "DATE",
        style: style !== null && style !== void 0 ? style : "LIGHT",
        title: title !== null && title !== void 0 ? title : "",
        description: description !== null && description !== void 0 ? description : ""
      };
      globalThis_default === null || globalThis_default === void 0 || globalThis_default.natively.trigger(this.id, 0, datepicker_callback, "datepicker", params);
    }
  };

  // node_modules/natively/dist/classes/NativelyCamera.js
  function _defineProperty12(e3, r3, t3) {
    return (r3 = _toPropertyKey12(r3)) in e3 ? Object.defineProperty(e3, r3, { value: t3, enumerable: true, configurable: true, writable: true }) : e3[r3] = t3, e3;
  }
  function _toPropertyKey12(t3) {
    var i3 = _toPrimitive12(t3, "string");
    return "symbol" == typeof i3 ? i3 : i3 + "";
  }
  function _toPrimitive12(t3, r3) {
    if ("object" != typeof t3 || !t3) return t3;
    var e3 = t3[Symbol.toPrimitive];
    if (void 0 !== e3) {
      var i3 = e3.call(t3, r3 || "default");
      if ("object" != typeof i3) return i3;
      throw new TypeError("@@toPrimitive must return a primitive value.");
    }
    return ("string" === r3 ? String : Number)(t3);
  }
  var NativelyCamera = class {
    constructor() {
      _defineProperty12(this, "id", generateID());
    }
    showCamera(type, quality, camera, open_camera_callback) {
      var params = {
        type: type !== null && type !== void 0 ? type : "photo",
        quality: quality !== null && quality !== void 0 ? quality : "high",
        camera: camera !== null && camera !== void 0 ? camera : "BACK"
      };
      globalThis_default === null || globalThis_default === void 0 || globalThis_default.natively.trigger(this.id, 2, open_camera_callback, "open_camera", params);
    }
  };

  // node_modules/natively/dist/classes/NativelyHealth.js
  function ownKeys(e3, r3) {
    var t3 = Object.keys(e3);
    if (Object.getOwnPropertySymbols) {
      var o3 = Object.getOwnPropertySymbols(e3);
      r3 && (o3 = o3.filter(function(r4) {
        return Object.getOwnPropertyDescriptor(e3, r4).enumerable;
      })), t3.push.apply(t3, o3);
    }
    return t3;
  }
  function _objectSpread(e3) {
    for (var r3 = 1; r3 < arguments.length; r3++) {
      var t3 = null != arguments[r3] ? arguments[r3] : {};
      r3 % 2 ? ownKeys(Object(t3), true).forEach(function(r4) {
        _defineProperty13(e3, r4, t3[r4]);
      }) : Object.getOwnPropertyDescriptors ? Object.defineProperties(e3, Object.getOwnPropertyDescriptors(t3)) : ownKeys(Object(t3)).forEach(function(r4) {
        Object.defineProperty(e3, r4, Object.getOwnPropertyDescriptor(t3, r4));
      });
    }
    return e3;
  }
  function _defineProperty13(e3, r3, t3) {
    return (r3 = _toPropertyKey13(r3)) in e3 ? Object.defineProperty(e3, r3, { value: t3, enumerable: true, configurable: true, writable: true }) : e3[r3] = t3, e3;
  }
  function _toPropertyKey13(t3) {
    var i3 = _toPrimitive13(t3, "string");
    return "symbol" == typeof i3 ? i3 : i3 + "";
  }
  function _toPrimitive13(t3, r3) {
    if ("object" != typeof t3 || !t3) return t3;
    var e3 = t3[Symbol.toPrimitive];
    if (void 0 !== e3) {
      var i3 = e3.call(t3, r3 || "default");
      if ("object" != typeof i3) return i3;
      throw new TypeError("@@toPrimitive must return a primitive value.");
    }
    return ("string" === r3 ? String : Number)(t3);
  }
  var NativelyHealth = class {
    constructor() {
      _defineProperty13(this, "id", generateID());
    }
    available(available_callback) {
      globalThis_default === null || globalThis_default === void 0 || globalThis_default.natively.trigger(this.id, 10, available_callback, "health_available", {});
    }
    requestAuthorization(write_data_types, read_data_types, request_callback) {
      globalThis_default === null || globalThis_default === void 0 || globalThis_default.natively.trigger(this.id, 10, request_callback, "health_register", {
        write_data_types,
        read_data_types
      });
    }
    permissionStatus(data_type, callback) {
      globalThis_default === null || globalThis_default === void 0 || globalThis_default.natively.trigger(this.id, 10, callback, "health_permission", {
        data_type
      });
    }
    getAllCharacteristics(callback) {
      globalThis_default === null || globalThis_default === void 0 || globalThis_default.natively.trigger(this.id, 10, callback, "health_get_all_characteristics", {});
    }
    getStatisticQuantity(data_type, interval, start_date, end_date, callback) {
      var obj = {
        data_type,
        interval
      };
      if (start_date) {
        obj.start_date = start_date.getTime();
      }
      if (end_date) {
        obj.end_date = end_date.getTime();
      }
      globalThis_default === null || globalThis_default === void 0 || globalThis_default.natively.trigger(this.id, 10, callback, "health_get_statistic_quantity", obj);
    }
    getDailySleepAnalysis(start_date, end_date, limit, callback) {
      var obj = {
        limit: limit || 100
      };
      if (start_date) {
        obj.start_date = start_date.getTime();
      }
      if (end_date) {
        obj.end_date = end_date.getTime();
      }
      globalThis_default === null || globalThis_default === void 0 || globalThis_default.natively.trigger(this.id, 10, callback, "health_get_daily_sleep_analysis", obj);
    }
    getWorkouts(start_date, end_date, limit, callback) {
      var obj = {
        limit: limit || 100
      };
      if (start_date) {
        obj.start_date = start_date.getTime();
      }
      if (end_date) {
        obj.end_date = end_date.getTime();
      }
      globalThis_default === null || globalThis_default === void 0 || globalThis_default.natively.trigger(this.id, 21, callback, "health_get_workouts", obj);
    }
    getHealthConnectStatus(callback) {
      globalThis_default === null || globalThis_default === void 0 || globalThis_default.natively.trigger(this.id, 40, callback, "health_connect_status", {});
    }
    installHealthConnect(callback) {
      globalThis_default === null || globalThis_default === void 0 || globalThis_default.natively.trigger(this.id, 40, callback, "health_connect_install", {});
    }
    writeWorkout(workout, callback) {
      var obj = _objectSpread({}, workout);
      if ((workout === null || workout === void 0 ? void 0 : workout.start_date) instanceof Date) {
        obj.start_date = workout.start_date.getTime();
      }
      if ((workout === null || workout === void 0 ? void 0 : workout.end_date) instanceof Date) {
        obj.end_date = workout.end_date.getTime();
      }
      globalThis_default === null || globalThis_default === void 0 || globalThis_default.natively.trigger(this.id, 39, callback, "health_write_workout", obj);
    }
    writeNutrition(nutrition, callback) {
      var obj = _objectSpread({}, nutrition);
      if ((nutrition === null || nutrition === void 0 ? void 0 : nutrition.start_date) instanceof Date) {
        obj.start_date = nutrition.start_date.getTime();
      }
      if ((nutrition === null || nutrition === void 0 ? void 0 : nutrition.end_date) instanceof Date) {
        obj.end_date = nutrition.end_date.getTime();
      }
      if (Array.isArray(nutrition === null || nutrition === void 0 ? void 0 : nutrition.items)) {
        obj.items = nutrition.items.map((item) => {
          var mappedItem = _objectSpread({}, item);
          if ((item === null || item === void 0 ? void 0 : item.start_date) instanceof Date) {
            mappedItem.start_date = item.start_date.getTime();
          }
          if ((item === null || item === void 0 ? void 0 : item.end_date) instanceof Date) {
            mappedItem.end_date = item.end_date.getTime();
          }
          return mappedItem;
        });
      }
      globalThis_default === null || globalThis_default === void 0 || globalThis_default.natively.trigger(this.id, 39, callback, "health_write_nutrition", obj);
    }
    getActivitySummary(start_date, end_date, callback) {
      var obj = {};
      if (start_date) {
        obj.start_date = start_date.getTime();
      }
      if (end_date) {
        obj.end_date = end_date.getTime();
      }
      globalThis_default === null || globalThis_default === void 0 || globalThis_default.natively.trigger(this.id, 10, callback, "health_get_activity_summary", obj);
    }
  };

  // node_modules/natively/dist/classes/NativelyScanner.js
  function _defineProperty14(e3, r3, t3) {
    return (r3 = _toPropertyKey14(r3)) in e3 ? Object.defineProperty(e3, r3, { value: t3, enumerable: true, configurable: true, writable: true }) : e3[r3] = t3, e3;
  }
  function _toPropertyKey14(t3) {
    var i3 = _toPrimitive14(t3, "string");
    return "symbol" == typeof i3 ? i3 : i3 + "";
  }
  function _toPrimitive14(t3, r3) {
    if ("object" != typeof t3 || !t3) return t3;
    var e3 = t3[Symbol.toPrimitive];
    if (void 0 !== e3) {
      var i3 = e3.call(t3, r3 || "default");
      if ("object" != typeof i3) return i3;
      throw new TypeError("@@toPrimitive must return a primitive value.");
    }
    return ("string" === r3 ? String : Number)(t3);
  }
  var NativelyScanner = class {
    constructor() {
      _defineProperty14(this, "id", generateID());
    }
    showScanner(open_scanner_callback) {
      globalThis_default === null || globalThis_default === void 0 || globalThis_default.natively.trigger(this.id, 2, open_scanner_callback, "open_scanner", {});
    }
    showDocumentScanner(jpegQuality, foregroundColor, backgroundColor, highlightColor, menuColor, defaultFlashMode, defaultScanOrientation, source, ocrLanguage, pageMode, defaultFilter, availableFilters, resultCallback) {
      var params = {};
      if (source) params.source = source;
      if (menuColor) params.menuColor = menuColor;
      if (pageMode) params.pageMode = pageMode;
      if (jpegQuality != null && !isNaN(jpegQuality)) params.jpegQuality = jpegQuality;
      if (highlightColor) params.highlightColor = highlightColor;
      if (foregroundColor) params.foregroundColor = foregroundColor;
      if (backgroundColor) params.backgroundColor = backgroundColor;
      if (defaultFlashMode) params.defaultFlashMode = defaultFlashMode;
      if (defaultScanOrientation) params.defaultScanOrientation = defaultScanOrientation;
      if (defaultFilter) params.defaultFilter = defaultFilter;
      if (availableFilters) params.availableFilters = availableFilters;
      if (ocrLanguage) {
        params.ocrConfiguration = {
          languages: [ocrLanguage]
        };
      }
      globalThis_default === null || globalThis_default === void 0 || globalThis_default.natively.trigger(this.id, 21, resultCallback, "open_document_scanner", params);
    }
  };

  // node_modules/natively/dist/classes/NativelyPurchases.js
  function _defineProperty15(e3, r3, t3) {
    return (r3 = _toPropertyKey15(r3)) in e3 ? Object.defineProperty(e3, r3, { value: t3, enumerable: true, configurable: true, writable: true }) : e3[r3] = t3, e3;
  }
  function _toPropertyKey15(t3) {
    var i3 = _toPrimitive15(t3, "string");
    return "symbol" == typeof i3 ? i3 : i3 + "";
  }
  function _toPrimitive15(t3, r3) {
    if ("object" != typeof t3 || !t3) return t3;
    var e3 = t3[Symbol.toPrimitive];
    if (void 0 !== e3) {
      var i3 = e3.call(t3, r3 || "default");
      if ("object" != typeof i3) return i3;
      throw new TypeError("@@toPrimitive must return a primitive value.");
    }
    return ("string" === r3 ? String : Number)(t3);
  }
  var NativelyPurchases = class {
    constructor() {
      _defineProperty15(this, "id", generateID());
    }
    login(login, customerEmail, login_callback) {
      var email = customerEmail !== null && customerEmail !== void 0 ? customerEmail : "";
      globalThis_default === null || globalThis_default === void 0 || globalThis_default.natively.trigger(this.id, 3, login_callback, "purchases_login", {
        login,
        email
      });
    }
    logout(logout_callback) {
      globalThis_default === null || globalThis_default === void 0 || globalThis_default.natively.trigger(this.id, 3, logout_callback, "purchases_logout", {});
    }
    customerId(customer_id_callback) {
      globalThis_default === null || globalThis_default === void 0 || globalThis_default.natively.trigger(this.id, 3, customer_id_callback, "purchases_customerid", {});
    }
    restore(restore_callback) {
      globalThis_default === null || globalThis_default === void 0 || globalThis_default.natively.trigger(this.id, 10, restore_callback, "purchases_restore", {});
    }
    showPaywall(shouldShowCloseButton, offeringId, show_paywall_callback) {
      var params = {
        offeringId,
        shouldShowCloseButton
      };
      globalThis_default === null || globalThis_default === void 0 || globalThis_default.natively.trigger(this.id, 38, show_paywall_callback, "purchases_show_paywall", params);
    }
    showPaywallIfNeeded(entitlementId, shouldShowCloseButton, offeringId, show_paywall_if_needed_callback) {
      var params = {
        offeringName: offeringId,
        entitlementId,
        shouldShowCloseButton
      };
      globalThis_default === null || globalThis_default === void 0 || globalThis_default.natively.trigger(this.id, 38, show_paywall_if_needed_callback, "purchases_show_paywall_if_needed", params);
    }
    purchasePackage(packageId, purchase_callback, oldProductId, prorationMode) {
      globalThis_default === null || globalThis_default === void 0 || globalThis_default.natively.trigger(this.id, 3, purchase_callback, "purchases_package", {
        packageId,
        oldProductId: oldProductId !== null && oldProductId !== void 0 ? oldProductId : null,
        prorationMode: prorationMode !== null && prorationMode !== void 0 ? prorationMode : null
      });
    }
    packagePrice(packageId, purchase_callback) {
      globalThis_default === null || globalThis_default === void 0 || globalThis_default.natively.trigger(this.id, 8, purchase_callback, "purchases_price", {
        packageId
      });
    }
  };

  // node_modules/natively/dist/classes/NativelyContacts.js
  function _defineProperty16(e3, r3, t3) {
    return (r3 = _toPropertyKey16(r3)) in e3 ? Object.defineProperty(e3, r3, { value: t3, enumerable: true, configurable: true, writable: true }) : e3[r3] = t3, e3;
  }
  function _toPropertyKey16(t3) {
    var i3 = _toPrimitive16(t3, "string");
    return "symbol" == typeof i3 ? i3 : i3 + "";
  }
  function _toPrimitive16(t3, r3) {
    if ("object" != typeof t3 || !t3) return t3;
    var e3 = t3[Symbol.toPrimitive];
    if (void 0 !== e3) {
      var i3 = e3.call(t3, r3 || "default");
      if ("object" != typeof i3) return i3;
      throw new TypeError("@@toPrimitive must return a primitive value.");
    }
    return ("string" === r3 ? String : Number)(t3);
  }
  var NativelyContacts = class {
    constructor() {
      _defineProperty16(this, "id", generateID());
    }
    getAllContacts(contacts_all_callback) {
      globalThis_default === null || globalThis_default === void 0 || globalThis_default.natively.trigger(this.id, 3, contacts_all_callback, "contacts_all", {});
    }
    createContact(firstName, lastName, email, phone, contacts_save_callback) {
      var params = {
        firstName,
        lastName: lastName !== null && lastName !== void 0 ? lastName : "",
        email: email !== null && email !== void 0 ? email : "",
        phone: phone !== null && phone !== void 0 ? phone : ""
      };
      globalThis_default === null || globalThis_default === void 0 || globalThis_default.natively.trigger(this.id, 3, contacts_save_callback, "contacts_save", params);
    }
  };

  // node_modules/natively/dist/classes/NativelyMediaPicker.js
  function _defineProperty17(e3, r3, t3) {
    return (r3 = _toPropertyKey17(r3)) in e3 ? Object.defineProperty(e3, r3, { value: t3, enumerable: true, configurable: true, writable: true }) : e3[r3] = t3, e3;
  }
  function _toPropertyKey17(t3) {
    var i3 = _toPrimitive17(t3, "string");
    return "symbol" == typeof i3 ? i3 : i3 + "";
  }
  function _toPrimitive17(t3, r3) {
    if ("object" != typeof t3 || !t3) return t3;
    var e3 = t3[Symbol.toPrimitive];
    if (void 0 !== e3) {
      var i3 = e3.call(t3, r3 || "default");
      if ("object" != typeof i3) return i3;
      throw new TypeError("@@toPrimitive must return a primitive value.");
    }
    return ("string" === r3 ? String : Number)(t3);
  }
  var NativelyMediaPicker = class {
    constructor() {
      _defineProperty17(this, "id", generateID());
    }
    showMediaPicker(mediapicker_callback) {
      globalThis_default === null || globalThis_default === void 0 || globalThis_default.natively.trigger(this.id, 8, mediapicker_callback, "mediapicker", {});
    }
  };

  // node_modules/natively/dist/classes/NativelyAudioRecorder.js
  function _defineProperty18(e3, r3, t3) {
    return (r3 = _toPropertyKey18(r3)) in e3 ? Object.defineProperty(e3, r3, { value: t3, enumerable: true, configurable: true, writable: true }) : e3[r3] = t3, e3;
  }
  function _toPropertyKey18(t3) {
    var i3 = _toPrimitive18(t3, "string");
    return "symbol" == typeof i3 ? i3 : i3 + "";
  }
  function _toPrimitive18(t3, r3) {
    if ("object" != typeof t3 || !t3) return t3;
    var e3 = t3[Symbol.toPrimitive];
    if (void 0 !== e3) {
      var i3 = e3.call(t3, r3 || "default");
      if ("object" != typeof i3) return i3;
      throw new TypeError("@@toPrimitive must return a primitive value.");
    }
    return ("string" === r3 ? String : Number)(t3);
  }
  var NativelyAudioRecorder = class {
    constructor() {
      _defineProperty18(this, "id", generateID());
    }
    showRecorder(max_duration, record_callback) {
      var params = {
        max_duration: max_duration !== null && max_duration !== void 0 ? max_duration : 0
      };
      globalThis_default === null || globalThis_default === void 0 || globalThis_default.natively.trigger(this.id, 13, record_callback, "record_start", params);
    }
  };

  // node_modules/natively/dist/classes/NativelyAudioPlayer.js
  function ownKeys2(e3, r3) {
    var t3 = Object.keys(e3);
    if (Object.getOwnPropertySymbols) {
      var o3 = Object.getOwnPropertySymbols(e3);
      r3 && (o3 = o3.filter(function(r4) {
        return Object.getOwnPropertyDescriptor(e3, r4).enumerable;
      })), t3.push.apply(t3, o3);
    }
    return t3;
  }
  function _objectSpread2(e3) {
    for (var r3 = 1; r3 < arguments.length; r3++) {
      var t3 = null != arguments[r3] ? arguments[r3] : {};
      r3 % 2 ? ownKeys2(Object(t3), true).forEach(function(r4) {
        _defineProperty19(e3, r4, t3[r4]);
      }) : Object.getOwnPropertyDescriptors ? Object.defineProperties(e3, Object.getOwnPropertyDescriptors(t3)) : ownKeys2(Object(t3)).forEach(function(r4) {
        Object.defineProperty(e3, r4, Object.getOwnPropertyDescriptor(t3, r4));
      });
    }
    return e3;
  }
  function _defineProperty19(e3, r3, t3) {
    return (r3 = _toPropertyKey19(r3)) in e3 ? Object.defineProperty(e3, r3, { value: t3, enumerable: true, configurable: true, writable: true }) : e3[r3] = t3, e3;
  }
  function _toPropertyKey19(t3) {
    var i3 = _toPrimitive19(t3, "string");
    return "symbol" == typeof i3 ? i3 : i3 + "";
  }
  function _toPrimitive19(t3, r3) {
    if ("object" != typeof t3 || !t3) return t3;
    var e3 = t3[Symbol.toPrimitive];
    if (void 0 !== e3) {
      var i3 = e3.call(t3, r3 || "default");
      if ("object" != typeof i3) return i3;
      throw new TypeError("@@toPrimitive must return a primitive value.");
    }
    return ("string" === r3 ? String : Number)(t3);
  }
  var NativelyAudioPlayer = class {
    constructor() {
      _defineProperty19(this, "id", generateID());
    }
    buildMetadata(metadata) {
      var params = {};
      if (!metadata) {
        return params;
      }
      if (metadata.id !== void 0) params.id = metadata.id;
      if (metadata.title !== void 0) params.title = metadata.title;
      if (metadata.artist !== void 0) params.artist = metadata.artist;
      if (metadata.album !== void 0) params.album = metadata.album;
      if (metadata.genre !== void 0) params.genre = metadata.genre;
      if (metadata.artwork !== void 0) params.artwork = metadata.artwork;
      if (metadata.duration != null) params.duration = metadata.duration;
      if (metadata.extras !== void 0) params.extras = metadata.extras;
      return params;
    }
    play(source, options, play_callback) {
      var _options$is_stream, _options$autoplay;
      var params = _objectSpread2({
        source,
        is_stream: (_options$is_stream = options === null || options === void 0 ? void 0 : options.is_stream) !== null && _options$is_stream !== void 0 ? _options$is_stream : false,
        autoplay: (_options$autoplay = options === null || options === void 0 ? void 0 : options.autoplay) !== null && _options$autoplay !== void 0 ? _options$autoplay : true
      }, this.buildMetadata(options));
      if ((options === null || options === void 0 ? void 0 : options.headers) !== void 0) params.headers = options.headers;
      if ((options === null || options === void 0 ? void 0 : options.start_position) != null) params.start_position = options.start_position;
      if ((options === null || options === void 0 ? void 0 : options.volume) != null) params.volume = options.volume;
      if ((options === null || options === void 0 ? void 0 : options.speed) != null) params.speed = options.speed;
      globalThis_default === null || globalThis_default === void 0 || globalThis_default.natively.trigger(this.id, 39, play_callback, "audio_play", params);
    }
    pause(pause_callback) {
      globalThis_default === null || globalThis_default === void 0 || globalThis_default.natively.trigger(this.id, 39, pause_callback, "audio_pause", {});
    }
    stop(stop_callback) {
      globalThis_default === null || globalThis_default === void 0 || globalThis_default.natively.trigger(this.id, 39, stop_callback, "audio_stop", {});
    }
    seek(position, seek_callback) {
      globalThis_default === null || globalThis_default === void 0 || globalThis_default.natively.trigger(this.id, 39, seek_callback, "audio_seek", {
        position
      });
    }
    queueAdd(source, options, queue_add_callback) {
      var _options$play_now, _options$is_stream2;
      var params = _objectSpread2({
        source,
        play_now: (_options$play_now = options === null || options === void 0 ? void 0 : options.play_now) !== null && _options$play_now !== void 0 ? _options$play_now : false,
        is_stream: (_options$is_stream2 = options === null || options === void 0 ? void 0 : options.is_stream) !== null && _options$is_stream2 !== void 0 ? _options$is_stream2 : false
      }, this.buildMetadata(options));
      if ((options === null || options === void 0 ? void 0 : options.headers) !== void 0) params.headers = options.headers;
      globalThis_default === null || globalThis_default === void 0 || globalThis_default.natively.trigger(this.id, 39, queue_add_callback, "audio_queue_add", params);
    }
    queueGet(queue_get_callback) {
      globalThis_default === null || globalThis_default === void 0 || globalThis_default.natively.trigger(this.id, 39, queue_get_callback, "audio_queue_get", {});
    }
    queueRemove(index2, queue_remove_callback) {
      globalThis_default === null || globalThis_default === void 0 || globalThis_default.natively.trigger(this.id, 39, queue_remove_callback, "audio_queue_remove", {
        index: index2
      });
    }
    setMetadata(metadata, set_metadata_callback) {
      var params = this.buildMetadata(metadata);
      globalThis_default === null || globalThis_default === void 0 || globalThis_default.natively.trigger(this.id, 39, set_metadata_callback, "audio_set_metadata", params);
    }
    setVolume(volume, set_volume_callback) {
      globalThis_default === null || globalThis_default === void 0 || globalThis_default.natively.trigger(this.id, 39, set_volume_callback, "audio_set_volume", {
        volume
      });
    }
    setSpeed(speed, set_speed_callback) {
      globalThis_default === null || globalThis_default === void 0 || globalThis_default.natively.trigger(this.id, 39, set_speed_callback, "audio_set_speed", {
        speed
      });
    }
  };

  // node_modules/natively/dist/classes/NativelyAdmobBanner.js
  function _defineProperty20(e3, r3, t3) {
    return (r3 = _toPropertyKey20(r3)) in e3 ? Object.defineProperty(e3, r3, { value: t3, enumerable: true, configurable: true, writable: true }) : e3[r3] = t3, e3;
  }
  function _toPropertyKey20(t3) {
    var i3 = _toPrimitive20(t3, "string");
    return "symbol" == typeof i3 ? i3 : i3 + "";
  }
  function _toPrimitive20(t3, r3) {
    if ("object" != typeof t3 || !t3) return t3;
    var e3 = t3[Symbol.toPrimitive];
    if (void 0 !== e3) {
      var i3 = e3.call(t3, r3 || "default");
      if ("object" != typeof i3) return i3;
      throw new TypeError("@@toPrimitive must return a primitive value.");
    }
    return ("string" === r3 ? String : Number)(t3);
  }
  var NativelyAdmobBanner = class {
    constructor(config, setup_callback) {
      var _config$position, _config$sizeType, _config$custom_width, _config$custom_height;
      var preload_ad = arguments.length > 2 && arguments[2] !== void 0 ? arguments[2] : false;
      var preload_callback = arguments.length > 3 ? arguments[3] : void 0;
      var show_ad = arguments.length > 4 && arguments[4] !== void 0 ? arguments[4] : false;
      var show_callback = arguments.length > 5 ? arguments[5] : void 0;
      _defineProperty20(this, "id", generateID());
      var params = {};
      if (globalThis_default !== null && globalThis_default !== void 0 && globalThis_default.natively.isAndroidApp) {
        var _config$androidUnitId;
        params.unitId = (_config$androidUnitId = config.androidUnitId) !== null && _config$androidUnitId !== void 0 ? _config$androidUnitId : "ca-app-pub-3940256099942544/6300978111";
      } else if (globalThis_default !== null && globalThis_default !== void 0 && globalThis_default.natively.isIOSApp) {
        var _config$iOSUnitId;
        params.unitId = (_config$iOSUnitId = config.iOSUnitId) !== null && _config$iOSUnitId !== void 0 ? _config$iOSUnitId : "ca-app-pub-3940256099942544/2934735716";
      }
      params.position = (_config$position = config.position) !== null && _config$position !== void 0 ? _config$position : "BOTTOM";
      params.sizeType = (_config$sizeType = config.sizeType) !== null && _config$sizeType !== void 0 ? _config$sizeType : "AUTO";
      params.width = (_config$custom_width = config.custom_width) !== null && _config$custom_width !== void 0 ? _config$custom_width : 320;
      params.height = (_config$custom_height = config.custom_height) !== null && _config$custom_height !== void 0 ? _config$custom_height : 50;
      globalThis_default === null || globalThis_default === void 0 || globalThis_default.natively.trigger(this.id, 14, (resp) => {
        setup_callback === null || setup_callback === void 0 || setup_callback(resp);
        if (preload_ad) {
          globalThis_default === null || globalThis_default === void 0 || globalThis_default.natively.trigger(this.id, 14, (resp2) => {
            preload_callback === null || preload_callback === void 0 || preload_callback(resp2);
            if (show_ad) {
              globalThis_default === null || globalThis_default === void 0 || globalThis_default.natively.trigger(this.id, 14, show_callback, "bannerad_show", {});
            }
          }, "bannerad_load", {});
        }
      }, "bannerad_setup", params);
    }
    loadAd(callback) {
      globalThis_default === null || globalThis_default === void 0 || globalThis_default.natively.trigger(this.id, 14, callback, "bannerad_load", {});
    }
    showBanner(callback) {
      globalThis_default === null || globalThis_default === void 0 || globalThis_default.natively.trigger(this.id, 14, callback, "bannerad_show", {});
    }
    hideBanner(callback) {
      globalThis_default === null || globalThis_default === void 0 || globalThis_default.natively.trigger(this.id, 14, callback, "bannerad_hide", {});
    }
    bannerIsReady(callback) {
      globalThis_default === null || globalThis_default === void 0 || globalThis_default.natively.trigger(this.id, 14, callback, "bannerad_ready", {});
    }
    bannerIsVisible(callback) {
      globalThis_default === null || globalThis_default === void 0 || globalThis_default.natively.trigger(this.id, 14, callback, "bannerad_visible", {});
    }
  };

  // node_modules/natively/dist/classes/NativelyAdmobInterstitial.js
  function _defineProperty21(e3, r3, t3) {
    return (r3 = _toPropertyKey21(r3)) in e3 ? Object.defineProperty(e3, r3, { value: t3, enumerable: true, configurable: true, writable: true }) : e3[r3] = t3, e3;
  }
  function _toPropertyKey21(t3) {
    var i3 = _toPrimitive21(t3, "string");
    return "symbol" == typeof i3 ? i3 : i3 + "";
  }
  function _toPrimitive21(t3, r3) {
    if ("object" != typeof t3 || !t3) return t3;
    var e3 = t3[Symbol.toPrimitive];
    if (void 0 !== e3) {
      var i3 = e3.call(t3, r3 || "default");
      if ("object" != typeof i3) return i3;
      throw new TypeError("@@toPrimitive must return a primitive value.");
    }
    return ("string" === r3 ? String : Number)(t3);
  }
  var NativelyAdmobInterstitial = class {
    constructor() {
      var iOSUnitId = arguments.length > 0 && arguments[0] !== void 0 ? arguments[0] : "ca-app-pub-3940256099942544/4411468910";
      var androidUnitId = arguments.length > 1 && arguments[1] !== void 0 ? arguments[1] : "ca-app-pub-3940256099942544/1033173712";
      var setup_callback = arguments.length > 2 ? arguments[2] : void 0;
      var auto_ad_reload = arguments.length > 3 && arguments[3] !== void 0 ? arguments[3] : false;
      var auto_ad_reload_callback = arguments.length > 4 ? arguments[4] : void 0;
      _defineProperty21(this, "id", generateID());
      _defineProperty21(this, "auto_ad_reload", void 0);
      _defineProperty21(this, "auto_ad_reload_callback", void 0);
      _defineProperty21(this, "unitId", void 0);
      if (globalThis_default !== null && globalThis_default !== void 0 && globalThis_default.natively.isAndroidApp) {
        this.unitId = androidUnitId;
      } else if (globalThis_default !== null && globalThis_default !== void 0 && globalThis_default.natively.isIOSApp) {
        this.unitId = iOSUnitId;
      }
      this.auto_ad_reload = auto_ad_reload;
      this.auto_ad_reload_callback = auto_ad_reload_callback;
      this.loadAd(setup_callback);
    }
    loadAd(callback) {
      var _this$unitId;
      var params = {
        unitId: (_this$unitId = this.unitId) !== null && _this$unitId !== void 0 ? _this$unitId : "ca-app-pub-3940256099942544/4411468910"
      };
      globalThis_default === null || globalThis_default === void 0 || globalThis_default.natively.trigger(this.id, 14, callback, "interstitialad_setup", params);
    }
    showInterstitialAd(callback) {
      globalThis_default === null || globalThis_default === void 0 || globalThis_default.natively.trigger(this.id, 14, (resp) => {
        callback(resp);
        if (resp.event === "DID_DISMISS_AD" && this.auto_ad_reload) {
          setTimeout(() => {
            this.loadAd(this.auto_ad_reload_callback);
          }, 500);
        }
      }, "interstitialad_show", {});
    }
    interstitialIsReady(callback) {
      globalThis_default === null || globalThis_default === void 0 || globalThis_default.natively.trigger(this.id, 14, callback, "interstitialad_ready", {});
    }
  };

  // node_modules/natively/dist/classes/NativelyNFCService.js
  function _defineProperty22(e3, r3, t3) {
    return (r3 = _toPropertyKey22(r3)) in e3 ? Object.defineProperty(e3, r3, { value: t3, enumerable: true, configurable: true, writable: true }) : e3[r3] = t3, e3;
  }
  function _toPropertyKey22(t3) {
    var i3 = _toPrimitive22(t3, "string");
    return "symbol" == typeof i3 ? i3 : i3 + "";
  }
  function _toPrimitive22(t3, r3) {
    if ("object" != typeof t3 || !t3) return t3;
    var e3 = t3[Symbol.toPrimitive];
    if (void 0 !== e3) {
      var i3 = e3.call(t3, r3 || "default");
      if ("object" != typeof i3) return i3;
      throw new TypeError("@@toPrimitive must return a primitive value.");
    }
    return ("string" === r3 ? String : Number)(t3);
  }
  var NativelyNFCService = class {
    constructor(readAlertMessage, writeAlertMessage, readDetectedMessage, writeDetectedMessage) {
      _defineProperty22(this, "id", generateID());
      _defineProperty22(this, "readAlertMessage", void 0);
      _defineProperty22(this, "writeAlertMessage", void 0);
      _defineProperty22(this, "readDetectedMessage", void 0);
      _defineProperty22(this, "writeDetectedMessage", void 0);
      this.readAlertMessage = readAlertMessage;
      this.writeAlertMessage = writeAlertMessage;
      this.readDetectedMessage = readDetectedMessage;
      this.writeDetectedMessage = writeDetectedMessage;
    }
    read(callback) {
      var _this$readAlertMessag, _this$readDetectedMes;
      var params = {
        alertMessage: (_this$readAlertMessag = this.readAlertMessage) !== null && _this$readAlertMessag !== void 0 ? _this$readAlertMessag : "please set readAlertMessage",
        detectedMessage: (_this$readDetectedMes = this.readDetectedMessage) !== null && _this$readDetectedMes !== void 0 ? _this$readDetectedMes : "readDetectedMessage"
      };
      globalThis_default === null || globalThis_default === void 0 || globalThis_default.natively.trigger(this.id, 15, callback, "nfc_read", params);
    }
    write(recordId, recordData, recordDataType, callback) {
      var _this$writeAlertMessa, _this$writeDetectedMe;
      var params = {
        alertMessage: (_this$writeAlertMessa = this.writeAlertMessage) !== null && _this$writeAlertMessa !== void 0 ? _this$writeAlertMessa : "please set writeAlertMessage",
        detectedMessage: (_this$writeDetectedMe = this.writeDetectedMessage) !== null && _this$writeDetectedMe !== void 0 ? _this$writeDetectedMe : "please set writeDetectedMessage",
        recordData: recordData !== null && recordData !== void 0 ? recordData : "please set recordData",
        recordId: recordId !== null && recordId !== void 0 ? recordId : "please set recordId",
        recordDataType: recordDataType !== null && recordDataType !== void 0 ? recordDataType : "please set recordDataType"
      };
      globalThis_default === null || globalThis_default === void 0 || globalThis_default.natively.trigger(this.id, 15, callback, "nfc_write", params);
    }
    available(callback) {
      globalThis_default === null || globalThis_default === void 0 || globalThis_default.natively.trigger(this.id, 15, callback, "nfc_available", {});
    }
  };

  // node_modules/natively/dist/classes/NativelyFirebaseNotifications.js
  function _defineProperty23(e3, r3, t3) {
    return (r3 = _toPropertyKey23(r3)) in e3 ? Object.defineProperty(e3, r3, { value: t3, enumerable: true, configurable: true, writable: true }) : e3[r3] = t3, e3;
  }
  function _toPropertyKey23(t3) {
    var i3 = _toPrimitive23(t3, "string");
    return "symbol" == typeof i3 ? i3 : i3 + "";
  }
  function _toPrimitive23(t3, r3) {
    if ("object" != typeof t3 || !t3) return t3;
    var e3 = t3[Symbol.toPrimitive];
    if (void 0 !== e3) {
      var i3 = e3.call(t3, r3 || "default");
      if ("object" != typeof i3) return i3;
      throw new TypeError("@@toPrimitive must return a primitive value.");
    }
    return ("string" === r3 ? String : Number)(t3);
  }
  var NativelyFirebaseNotifications = class {
    constructor() {
      _defineProperty23(this, "id", generateID());
    }
    firebase_get_token(token_callback) {
      globalThis_default === null || globalThis_default === void 0 || globalThis_default.natively.trigger(this.id, 31, token_callback, "firebase_get_token");
    }
    firebase_get_apns_token(apns_token_callback) {
      globalThis_default === null || globalThis_default === void 0 || globalThis_default.natively.trigger(this.id, 31, apns_token_callback, "firebase_get_apns_token");
    }
    firebase_request_permission(permission_callback) {
      globalThis_default === null || globalThis_default === void 0 || globalThis_default.natively.trigger(this.id, 31, permission_callback, "firebase_request_permission");
    }
    firebase_has_permission(permission_status_callback) {
      globalThis_default === null || globalThis_default === void 0 || globalThis_default.natively.trigger(this.id, 31, permission_status_callback, "firebase_has_permission");
    }
    firebase_subscribe_to_topic(topic, subscribe_callback) {
      globalThis_default === null || globalThis_default === void 0 || globalThis_default.natively.trigger(this.id, 31, subscribe_callback, "firebase_subscribe_to_topic", {
        topic
      });
    }
    firebase_unsubscribe_from_topic(topic, unsubscribe_callback) {
      globalThis_default === null || globalThis_default === void 0 || globalThis_default.natively.trigger(this.id, 31, unsubscribe_callback, "firebase_unsubscribe_from_topic", {
        topic
      });
    }
  };

  // node_modules/natively/dist/classes/NativelyKlaviyoNotifications.js
  function _defineProperty24(e3, r3, t3) {
    return (r3 = _toPropertyKey24(r3)) in e3 ? Object.defineProperty(e3, r3, { value: t3, enumerable: true, configurable: true, writable: true }) : e3[r3] = t3, e3;
  }
  function _toPropertyKey24(t3) {
    var i3 = _toPrimitive24(t3, "string");
    return "symbol" == typeof i3 ? i3 : i3 + "";
  }
  function _toPrimitive24(t3, r3) {
    if ("object" != typeof t3 || !t3) return t3;
    var e3 = t3[Symbol.toPrimitive];
    if (void 0 !== e3) {
      var i3 = e3.call(t3, r3 || "default");
      if ("object" != typeof i3) return i3;
      throw new TypeError("@@toPrimitive must return a primitive value.");
    }
    return ("string" === r3 ? String : Number)(t3);
  }
  var NativelyKlaviyoNotifications = class {
    constructor() {
      _defineProperty24(this, "id", generateID());
    }
    setProfile(data, callback) {
      globalThis_default === null || globalThis_default === void 0 || globalThis_default.natively.trigger(this.id, 32, callback, "klaviyo_set_profile", data);
    }
    getExternalId(callback) {
      globalThis_default === null || globalThis_default === void 0 || globalThis_default.natively.trigger(this.id, 32, callback, "klaviyo_external_id");
    }
    resetProfile(callback) {
      globalThis_default === null || globalThis_default === void 0 || globalThis_default.natively.trigger(this.id, 32, callback, "klaviyo_reset_profile");
    }
    registerToken(callback, token) {
      globalThis_default === null || globalThis_default === void 0 || globalThis_default.natively.trigger(this.id, 32, callback, "klaviyo_register_token", {
        token
      });
    }
    pushPermission(callback) {
      globalThis_default === null || globalThis_default === void 0 || globalThis_default.natively.trigger(this.id, 32, callback, "klaviyo_push_permission");
    }
    pushRegister(callback) {
      globalThis_default === null || globalThis_default === void 0 || globalThis_default.natively.trigger(this.id, 32, callback, "klaviyo_push_register");
    }
  };

  // node_modules/natively/dist/classes/NativelyCalendar.js
  function _defineProperty25(e3, r3, t3) {
    return (r3 = _toPropertyKey25(r3)) in e3 ? Object.defineProperty(e3, r3, { value: t3, enumerable: true, configurable: true, writable: true }) : e3[r3] = t3, e3;
  }
  function _toPropertyKey25(t3) {
    var i3 = _toPrimitive25(t3, "string");
    return "symbol" == typeof i3 ? i3 : i3 + "";
  }
  function _toPrimitive25(t3, r3) {
    if ("object" != typeof t3 || !t3) return t3;
    var e3 = t3[Symbol.toPrimitive];
    if (void 0 !== e3) {
      var i3 = e3.call(t3, r3 || "default");
      if ("object" != typeof i3) return i3;
      throw new TypeError("@@toPrimitive must return a primitive value.");
    }
    return ("string" === r3 ? String : Number)(t3);
  }
  var NativelyCalendar = class {
    constructor() {
      _defineProperty25(this, "id", generateID());
    }
    createCalendarEvent(title, endDate, startDate, timezone, calendarId, description, create_calendar_event_callback) {
      var params = {
        title,
        timezone,
        calendarId,
        description,
        endDate: endDate === null || endDate === void 0 ? void 0 : endDate.toISOString(),
        startDate: startDate.toISOString()
      };
      globalThis_default === null || globalThis_default === void 0 || globalThis_default.natively.trigger(void 0, 37, create_calendar_event_callback, "calendar_event", params);
    }
    retrieveCalendars(retrieve_calendars_callback) {
      globalThis_default === null || globalThis_default === void 0 || globalThis_default.natively.trigger(void 0, 37, retrieve_calendars_callback, "retrieve_calendars", {});
    }
  };

  // node_modules/natively/dist/inject.js
  if (globalThis_default) {
    globalThis_default.natively = new Natively();
    globalThis_default.NativelyAdmobBanner = NativelyAdmobBanner;
    globalThis_default.NativelyAdmobInterstitial = NativelyAdmobInterstitial;
    globalThis_default.NativelyAppleSignInService = NativelyAppleSignInService;
    globalThis_default.NativelyAudioRecorder = NativelyAudioRecorder;
    globalThis_default.NativelyAudioPlayer = NativelyAudioPlayer;
    globalThis_default.NativelyBiometrics = NativelyBiometrics;
    globalThis_default.NativelyCamera = NativelyCamera;
    globalThis_default.NativelyClipboard = NativelyClipboard;
    globalThis_default.NativelyContacts = NativelyContacts;
    globalThis_default.NativelyDatePicker = NativelyDatePicker;
    globalThis_default.NativelyGeolocation = NativelyGeolocation;
    globalThis_default.NativelyHealth = NativelyHealth;
    globalThis_default.NativelyInfo = NativelyInfo;
    globalThis_default.NativelyLocation = NativelyLocation;
    globalThis_default.NativelyMediaPicker = NativelyMediaPicker;
    globalThis_default.NativelyMessage = NativelyMessage;
    globalThis_default.NativelyNFCService = NativelyNFCService;
    globalThis_default.NativelyNotifications = NativelyNotifications;
    globalThis_default.NativelyPurchases = NativelyPurchases;
    globalThis_default.NativelyScanner = NativelyScanner;
    globalThis_default.NativelyStorage = NativelyStorage;
    globalThis_default.NativelyCalendar = NativelyCalendar;
    globalThis_default.NativelyFirebaseNotifications = NativelyFirebaseNotifications;
    globalThis_default.NativelyKlaviyoNotifications = NativelyKlaviyoNotifications;
  }

  // node_modules/natively/dist/events.js
  globalThis_default === null || globalThis_default === void 0 ? void 0 : globalThis_default.natively.addObserver(() => globalThis_default === null || globalThis_default === void 0 ? void 0 : globalThis_default.natively.trigger(void 0, 0, (resp) => {
    if (globalThis_default) {
      globalThis_default.natively.min_app_version = resp.minSDKVersion;
      globalThis_default.natively.app_version = resp.sdkVersion;
    }
  }, "app_info", {}));

  // src/hooks/useNativelyStorage.js
  var useNativelyStorage = () => {
    const isLocalhost = window.location.hostname === "localhost" || window.location.hostname === "127.0.0.1";
    const isNativelyAvailable = typeof NativelyStorage !== "undefined" && !isLocalhost;
    const storage = T2(() => {
      if (isNativelyAvailable) {
        return new NativelyStorage();
      } else {
        if (isLocalhost) {
          console.log("\u{1F527} Running on localhost: Forcing localStorage fallback (Instant).");
        } else {
          console.warn("\u26A0\uFE0F Natively SDK not found. Falling back to localStorage (Non-Production).");
        }
        return null;
      }
    }, []);
    const setItem = (key, value) => {
      localStorage.setItem(key, value);
      if (storage) {
        storage.setStorageValue(key, value);
      }
    };
    const getItem = (key) => {
      return new Promise((resolve2) => {
        if (storage) {
          const timeout = setTimeout(() => {
            console.warn(`\u23F1\uFE0F [NativelyStorage] Timeout for "${key}", falling back to localStorage.`);
            resolve2(localStorage.getItem(key));
          }, 1500);
          storage.getStorageValue(key, (resp) => {
            clearTimeout(timeout);
            console.log(`[NativelyStorage] Received value for ${resp.key}:`, resp.value);
            resolve2(resp.value);
          });
        } else {
          const val = localStorage.getItem(key);
          console.log(`[LocalStorage Fallback] Received value for ${key}:`, val);
          resolve2(val);
        }
      });
    };
    const removeItem = (key) => {
      localStorage.removeItem(key);
      if (storage) {
        storage.removeStorageValue(key);
      }
    };
    const clear = () => {
      localStorage.clear();
      if (storage) {
        storage.resetStorage();
      }
    };
    const probeNative = () => {
      return new Promise((resolve2) => {
        if (!storage) {
          resolve2("localStorage-only");
          return;
        }
        const testKey = "__natively_probe__";
        storage.setStorageValue(testKey, "ok");
        const timeout = setTimeout(() => {
          resolve2("timeout (localStorage fallback)");
        }, 1500);
        storage.getStorageValue(testKey, (resp) => {
          clearTimeout(timeout);
          storage.removeStorageValue(testKey);
          resolve2(resp.value === "ok" ? "native bridge active" : `unexpected: ${resp.value}`);
        });
      });
    };
    return {
      setItem,
      getItem,
      removeItem,
      clear,
      probeNative
    };
  };

  // src/components/NativeStorageManager.jsx
  var NativeStorageManager = () => {
    const { setItem, getItem, removeItem, clear } = useNativelyStorage();
    const [currentUserId, setCurrentUserId] = d2("");
    const [inputValue, setInputValue] = d2("");
    const [status, setStatus] = d2("");
    const STORAGE_KEY2 = "bubble_current_user_id";
    y2(() => {
      refreshStoredValue();
    }, []);
    const refreshStoredValue = async () => {
      try {
        const value = await getItem(STORAGE_KEY2);
        setCurrentUserId(value || "Not set");
      } catch (err) {
        console.error("Failed to get storage value:", err);
        setStatus("Error retrieving value");
      }
    };
    const handleSave = () => {
      if (!inputValue) {
        setStatus("Please enter a value");
        return;
      }
      setItem(STORAGE_KEY2, inputValue);
      setStatus(`Updated Current User ID: ${inputValue}`);
      setInputValue("");
      setTimeout(refreshStoredValue, 500);
    };
    const handleRemove = () => {
      removeItem(STORAGE_KEY2);
      setStatus("User ID removed from device");
      setTimeout(refreshStoredValue, 500);
    };
    const handleClear = () => {
      clear();
      setStatus("All native storage data cleared");
      setTimeout(refreshStoredValue, 500);
    };
    return /* @__PURE__ */ xn.createElement("div", { className: "p-6 text-white space-y-6 max-w-md mx-auto" }, /* @__PURE__ */ xn.createElement("div", { className: "bg-white/10 rounded-2xl p-6 border border-white/20 shadow-xl" }, /* @__PURE__ */ xn.createElement("h2", { className: "text-xl font-bold mb-2 text-[#FF2258]" }, "Native Storage"), /* @__PURE__ */ xn.createElement("p", { className: "text-sm text-white/60 mb-6" }, "Manage persistent data stored directly on this device."), /* @__PURE__ */ xn.createElement("div", { className: "space-y-4" }, /* @__PURE__ */ xn.createElement("div", { className: "p-4 bg-black/20 rounded-xl border border-white/10 space-y-3" }, /* @__PURE__ */ xn.createElement("div", null, /* @__PURE__ */ xn.createElement("span", { className: "text-xs text-white/40 uppercase tracking-wider block mb-1" }, "Current User ID"), /* @__PURE__ */ xn.createElement("span", { className: "text-sm font-mono text-white break-all" }, currentUserId)), /* @__PURE__ */ xn.createElement("div", { className: "pt-3 border-t border-white/5" }, /* @__PURE__ */ xn.createElement("span", { className: "text-xs text-[#FF2258] uppercase tracking-wider block mb-1" }, "Device ID (Mixpanel)"), /* @__PURE__ */ xn.createElement("span", { className: "text-xs font-mono text-white/80 break-all", id: "debug-device-id" }, "(See App Debug Overlay)"))), /* @__PURE__ */ xn.createElement("div", { className: "space-y-2" }, /* @__PURE__ */ xn.createElement("label", { className: "text-xs text-white/40 uppercase tracking-wider block" }, "Set New User ID"), /* @__PURE__ */ xn.createElement(
      "input",
      {
        type: "text",
        value: inputValue,
        onChange: (e3) => setInputValue(e3.target.value),
        placeholder: "Enter User ID",
        className: "w-full bg-white/5 border border-white/10 rounded-xl px-4 py-3 text-white placeholder:text-white/20 focus:outline-none focus:border-[#FF2258]/50 transition-colors"
      }
    )), /* @__PURE__ */ xn.createElement("div", { className: "grid grid-cols-2 gap-3 pt-2" }, /* @__PURE__ */ xn.createElement(
      "button",
      {
        onClick: handleSave,
        className: "bg-[#FF2258] hover:bg-[#FF2258]/80 text-white font-bold py-3 rounded-xl transition-colors active:scale-95 shadow-lg shadow-[#FF2258]/20"
      },
      "Update ID"
    ), /* @__PURE__ */ xn.createElement(
      "button",
      {
        onClick: handleRemove,
        className: "bg-white/10 hover:bg-white/20 text-white font-bold py-3 rounded-xl transition-colors active:scale-95 border border-white/10"
      },
      "Remove"
    )), /* @__PURE__ */ xn.createElement(
      "button",
      {
        onClick: handleClear,
        className: "w-full bg-red-500/10 hover:bg-red-500/20 text-red-500 font-medium py-2 rounded-xl transition-colors border border-red-500/20 text-xs"
      },
      "Clear All Data"
    )), status && /* @__PURE__ */ xn.createElement("div", { className: "mt-4 p-3 bg-[#FF2258]/10 rounded-lg text-center border border-[#FF2258]/20 animate-fade-in" }, /* @__PURE__ */ xn.createElement("span", { className: "text-xs text-white/90" }, status))), /* @__PURE__ */ xn.createElement("div", { className: "bg-white/5 border border-white/10 rounded-xl p-4" }, /* @__PURE__ */ xn.createElement("h3", { className: "text-xs font-bold text-white/40 uppercase mb-2" }, "Native Infrastructure"), /* @__PURE__ */ xn.createElement("p", { className: "text-[11px] text-white/50 leading-relaxed" }, "This system interfaces with the device's native storage layer via the Natively SDK. Data persisted here remains available across app restarts and is isolated from traditional browser cache.")));
  };
  var NativeStorageManager_default = NativeStorageManager;

  // src/components/MainTabs.jsx
  var PlaceholderSection = ({ title }) => /* @__PURE__ */ xn.createElement("div", { className: "p-8 text-white text-center" }, /* @__PURE__ */ xn.createElement("h2", { className: "text-2xl font-bold mb-4" }, title), /* @__PURE__ */ xn.createElement("p", { className: "opacity-70" }, "Coming Soon"));
  var MainTabs = ({ userProps }) => {
    const [activeTab, setActiveTab] = d2("home");
    const [stacks, setStacks] = d2({
      home: ["home"],
      learn: ["learn"],
      act: ["act"],
      ask: ["ask"]
    });
    const [navAction, setNavAction] = d2(null);
    const push = (viewId, props = {}) => {
      setNavAction("push");
      setStacks((prev) => ({
        ...prev,
        [activeTab]: [...prev[activeTab], { id: viewId, ...props }]
      }));
    };
    const pop = () => {
      setNavAction("pop");
      setStacks((prev) => {
        const currentStack2 = prev[activeTab];
        if (currentStack2.length <= 1) return prev;
        return {
          ...prev,
          [activeTab]: currentStack2.slice(0, -1)
        };
      });
    };
    const switchTab = (tabId) => {
      setNavAction(null);
      setActiveTab(tabId);
    };
    const currentStack = stacks[activeTab];
    const currentViewItem = currentStack[currentStack.length - 1];
    const currentViewId = typeof currentViewItem === "string" ? currentViewItem : currentViewItem.id;
    const currentViewProps = typeof currentViewItem === "object" ? currentViewItem : {};
    const renderView = () => {
      const commonProps = {
        ...userProps,
        push,
        pop,
        ...currentViewProps
      };
      let content;
      switch (activeTab) {
        case "home":
          if (currentViewId === "home") content = /* @__PURE__ */ xn.createElement(HomeSection_default, { ...commonProps });
          else if (currentViewId === "details") content = /* @__PURE__ */ xn.createElement(PlaceholderSection, { title: "Details View (Pushed)", ...commonProps });
          else content = /* @__PURE__ */ xn.createElement(PlaceholderSection, { title: "Unknown View" });
          break;
        case "learn":
          content = /* @__PURE__ */ xn.createElement(PlaceholderSection, { title: "Learn" });
          break;
        case "act":
          content = /* @__PURE__ */ xn.createElement(PlaceholderSection, { title: "Act" });
          break;
        case "ask":
          content = /* @__PURE__ */ xn.createElement(NativeStorageManager_default, null);
          break;
        default:
          content = /* @__PURE__ */ xn.createElement(PlaceholderSection, { title: "Not Found" });
      }
      const animationClass = navAction === "push" ? "animate-slide-in-right" : navAction === "pop" ? "animate-slide-in-left" : "";
      return /* @__PURE__ */ xn.createElement("div", { key: `${activeTab}-${currentStack.length}`, className: `w-full min-h-full ${animationClass}` }, content);
    };
    const NavButton = ({ id, label, icon }) => {
      const isActive = activeTab === id;
      return /* @__PURE__ */ xn.createElement(
        "button",
        {
          onClick: () => switchTab(id),
          className: `flex flex-col items-center justify-center gap-1 transition-[color,transform,opacity] duration-200 ease-out ${isActive ? "text-[#FF2258] font-bold scale-110 active-tab-shimmer" : "text-white/60 font-medium scale-100 opacity-70"}`
        },
        icon,
        /* @__PURE__ */ xn.createElement("span", { className: "font-jakarta text-[10px] tracking-wide" }, label)
      );
    };
    const Icons = {
      home: /* @__PURE__ */ xn.createElement("svg", { width: "24", height: "24", viewBox: "0 0 24 24", fill: "none", stroke: "currentColor", strokeWidth: "2" }, /* @__PURE__ */ xn.createElement("path", { d: "M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z" }), /* @__PURE__ */ xn.createElement("polyline", { points: "9 22 9 12 15 12 15 22" })),
      learn: /* @__PURE__ */ xn.createElement("svg", { width: "24", height: "24", viewBox: "0 0 24 24", fill: "none", stroke: "currentColor", strokeWidth: "2" }, /* @__PURE__ */ xn.createElement("path", { d: "M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z" }), /* @__PURE__ */ xn.createElement("path", { d: "M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z" })),
      act: /* @__PURE__ */ xn.createElement("svg", { width: "24", height: "24", viewBox: "0 0 24 24", fill: "none", stroke: "currentColor", strokeWidth: "2" }, /* @__PURE__ */ xn.createElement("polyline", { points: "9 11 12 14 22 4" }), /* @__PURE__ */ xn.createElement("path", { d: "M21 12v7a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11" })),
      ask: /* @__PURE__ */ xn.createElement("svg", { width: "24", height: "24", viewBox: "0 0 24 24", fill: "none", stroke: "currentColor", strokeWidth: "2" }, /* @__PURE__ */ xn.createElement("path", { d: "M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z" }))
    };
    return /* @__PURE__ */ xn.createElement("div", { className: "w-full h-full bg-gradient-to-b from-[#2E2740] to-[#1F1A2E] font-poppins flex flex-col overflow-hidden" }, /* @__PURE__ */ xn.createElement("div", { className: "flex-1 min-h-0 overflow-y-auto scrollbar-hide relative overflow-x-hidden" }, currentStack.length > 1 && /* @__PURE__ */ xn.createElement("div", { className: "absolute top-4 left-4 z-50" }, /* @__PURE__ */ xn.createElement("button", { onClick: pop, className: "p-2 rounded-full bg-black/30 text-white hover:bg-black/40 transition-colors" }, /* @__PURE__ */ xn.createElement("svg", { width: "24", height: "24", viewBox: "0 0 24 24", fill: "none", stroke: "currentColor", strokeWidth: "2" }, /* @__PURE__ */ xn.createElement("polyline", { points: "15 18 9 12 15 6" })))), renderView()), /* @__PURE__ */ xn.createElement("div", { className: "shrink-0 h-20 bg-[#1F1A2E] border-t border-solid border-white/10" }, /* @__PURE__ */ xn.createElement("div", { className: "flex items-center justify-around h-full max-w-[500px] mx-auto px-4" }, /* @__PURE__ */ xn.createElement(NavButton, { id: "home", label: "Home", icon: Icons.home }), /* @__PURE__ */ xn.createElement(NavButton, { id: "learn", label: "Learn", icon: Icons.learn }), /* @__PURE__ */ xn.createElement(NavButton, { id: "act", label: "Act", icon: Icons.act }), /* @__PURE__ */ xn.createElement(NavButton, { id: "ask", label: "Ask", icon: Icons.ask }))));
  };
  var MainTabs_default = MainTabs;

  // src/components/onboarding/SingleSelect.jsx
  var SingleSelect = ({ question, options = [], refreshable = true, previousAnswer, onAnswer, onRefresh }) => {
    const [selectedIndex, setSelectedIndex] = d2(previousAnswer?.index ?? null);
    const [refreshAnim, setRefreshAnim] = d2("");
    const [refreshKey, setRefreshKey] = d2(0);
    const iconRef = A2(null);
    const handleSelect = (opt, index2) => {
      setSelectedIndex(index2);
      const text = typeof opt === "string" ? opt : opt.text;
      const variable = typeof opt === "string" ? "" : opt.variable || "";
      if (onAnswer) onAnswer({ answer: text, variable, index: index2 });
    };
    const handleRefresh = () => {
      setRefreshAnim("out");
      if (iconRef.current) {
        iconRef.current.classList.remove("refresh-spin");
        void iconRef.current.offsetWidth;
        iconRef.current.classList.add("refresh-spin");
      }
      setTimeout(() => {
        setSelectedIndex(null);
        if (onRefresh) onRefresh();
        setRefreshKey((k4) => k4 + 1);
        setRefreshAnim("in");
        setTimeout(() => setRefreshAnim(""), 450);
      }, 300);
    };
    const listClass = refreshAnim === "out" ? "refresh-out" : refreshAnim === "in" ? "refresh-in" : "";
    return /* @__PURE__ */ xn.createElement(xn.Fragment, null, /* @__PURE__ */ xn.createElement("div", { className: "flex-1 px-7 pt-8 pb-6 w-full" }, /* @__PURE__ */ xn.createElement("h1", { className: "font-bold text-[22px] text-white leading-[30px] tracking-[0.02em] mb-8" }, question), /* @__PURE__ */ xn.createElement("div", { className: `space-y-4 ${listClass}`, key: refreshKey }, options.map((opt, i3) => {
      const text = typeof opt === "string" ? opt : opt.text;
      const isSelected = selectedIndex === i3;
      return /* @__PURE__ */ xn.createElement(
        "button",
        {
          key: i3,
          onClick: () => handleSelect(opt, i3),
          className: `w-full text-left px-5 py-4 rounded-xl border border-solid transition-colors duration-200
                                    ${isSelected ? "bg-white/20 border-white/30 shadow-[inset_0_2px_8px_rgba(255,255,255,0.1)]" : "bg-white/[0.07] border-white/10 hover:bg-white/10"}`
        },
        /* @__PURE__ */ xn.createElement("span", { className: "font-medium text-[14px] text-white leading-[22px] tracking-[0.02em]" }, text)
      );
    }))), refreshable && /* @__PURE__ */ xn.createElement("div", { className: "pb-10 w-full flex flex-col items-center gap-1" }, /* @__PURE__ */ xn.createElement("span", { className: "font-medium text-[14px] text-white tracking-[0.5px]" }, "Choose the most relevant option"), /* @__PURE__ */ xn.createElement("span", { className: "font-medium text-[10px] text-white tracking-[0.5px]" }, "or"), /* @__PURE__ */ xn.createElement(
      "button",
      {
        onClick: handleRefresh,
        className: "flex items-center gap-2 mt-1 group",
        disabled: refreshAnim !== ""
      },
      /* @__PURE__ */ xn.createElement("svg", { ref: iconRef, width: "20", height: "20", viewBox: "0 0 20 20", fill: "none", style: { willChange: "transform" } }, /* @__PURE__ */ xn.createElement("path", { d: "M1.667 3.333v5h5", stroke: "white", strokeWidth: "1.5", strokeLinecap: "round", strokeLinejoin: "round" }), /* @__PURE__ */ xn.createElement("path", { d: "M3.51 12.5a7.5 7.5 0 1 0 1.14-7.833L1.667 8.333", stroke: "white", strokeWidth: "1.5", strokeLinecap: "round", strokeLinejoin: "round" })),
      /* @__PURE__ */ xn.createElement("span", { className: "font-medium text-[14px] text-white tracking-[0.5px] underline decoration-solid" }, "Refresh answers")
    )));
  };
  var SingleSelect_default = SingleSelect;

  // src/components/onboarding/SliderSelect.jsx
  var SliderSelect = ({ question, stops = [], previousAnswer, onAnswer }) => {
    const [selectedIndex, setSelectedIndex] = d2(previousAnswer?.index ?? null);
    const [revealed, setRevealed] = d2(previousAnswer ? stops.length : 0);
    const [bounceIndex, setBounceIndex] = d2(null);
    const prevSelectedRef = A2(previousAnswer?.index ?? null);
    y2(() => {
      if (previousAnswer) return;
      stops.forEach((_4, i3) => {
        setTimeout(() => setRevealed((r3) => Math.max(r3, i3 + 1)), 120 * (i3 + 1));
      });
    }, []);
    const handleSelect = (stop, index2) => {
      prevSelectedRef.current = selectedIndex;
      setSelectedIndex(index2);
      setBounceIndex(index2);
      setTimeout(() => setBounceIndex(null), 600);
    };
    const handleContinue = () => {
      if (selectedIndex === null) return;
      const stop = stops[selectedIndex];
      onAnswer({ answer: stop.label, variable: stop.variable, index: selectedIndex });
    };
    const getTrackHeight = () => {
      if (selectedIndex === null || stops.length <= 1) return 0;
      return selectedIndex / (stops.length - 1) * 100;
    };
    return /* @__PURE__ */ xn.createElement(xn.Fragment, null, /* @__PURE__ */ xn.createElement("div", { className: "flex-1 px-7 pt-8 pb-6 w-full flex flex-col" }, /* @__PURE__ */ xn.createElement("h1", { className: "font-bold text-[22px] text-white leading-[30px] tracking-[0.02em] mb-6" }, question), /* @__PURE__ */ xn.createElement("div", { className: "flex-1 flex items-center" }, /* @__PURE__ */ xn.createElement("div", { className: "relative w-full py-2" }, stops.map((stop, i3) => {
      const isSelected = selectedIndex === i3;
      const isFilled = selectedIndex !== null && i3 <= selectedIndex;
      const isRevealed = i3 < revealed;
      const isBouncing = bounceIndex === i3;
      return /* @__PURE__ */ xn.createElement(
        "div",
        {
          key: i3,
          className: `stop-reveal flex items-center gap-4 py-[10px] ${isRevealed ? "" : "invisible"}`,
          style: { animationDelay: previousAnswer ? "0ms" : `${120 * i3}ms` }
        },
        /* @__PURE__ */ xn.createElement("div", { className: "relative flex flex-col items-center shrink-0 w-6" }, i3 > 0 && /* @__PURE__ */ xn.createElement(
          "div",
          {
            className: `absolute -top-[10px] w-[3px] h-[10px] rounded-full transition-[background-color] duration-300 ${isFilled ? "bg-[#FF2258]" : "bg-white/15"}`
          }
        ), /* @__PURE__ */ xn.createElement(
          "button",
          {
            onClick: () => handleSelect(stop, i3),
            className: `relative w-6 h-6 rounded-full border-2 border-solid transition-[background-color,border-color,box-shadow] duration-200 ${isSelected ? "bg-[#FF2258] border-[#FF2258] shadow-[0_0_16px_rgba(255,34,88,0.6)]" : isFilled ? "bg-[#FF2258] border-[#FF2258]" : "bg-white/10 border-white/30"} ${isBouncing ? "dot-pop" : ""}`
          }
        ), i3 < stops.length - 1 && /* @__PURE__ */ xn.createElement(
          "div",
          {
            className: `absolute -bottom-[10px] w-[3px] h-[10px] rounded-full transition-[background-color] duration-300 ${isFilled && i3 < selectedIndex ? "bg-[#FF2258]" : "bg-white/15"}`
          }
        )),
        /* @__PURE__ */ xn.createElement(
          "button",
          {
            onClick: () => handleSelect(stop, i3),
            className: "flex items-center gap-3 flex-1 min-w-0"
          },
          /* @__PURE__ */ xn.createElement(
            "span",
            {
              className: `text-2xl select-none ${isBouncing ? "emoji-bounce" : ""}`,
              style: { display: "inline-block" }
            },
            stop.emoji || ""
          ),
          /* @__PURE__ */ xn.createElement("span", { className: `text-[15px] leading-snug transition-colors duration-200 ${isSelected ? "text-white font-bold" : isFilled ? "text-white/80 font-medium" : "text-white/40 font-medium"}` }, stop.label)
        )
      );
    })))), /* @__PURE__ */ xn.createElement("div", { className: "pb-10 px-7 w-full" }, /* @__PURE__ */ xn.createElement(
      "button",
      {
        onClick: handleContinue,
        disabled: selectedIndex === null,
        className: `w-full h-[54px] rounded-[40px] flex items-center justify-center transition-[background-color,opacity,transform] duration-200 ${selectedIndex !== null ? "bg-gradient-to-l from-[#B900B0] to-[#D8003F] shadow-lg active:scale-95" : "bg-white/10 border border-solid border-white/10"}`
      },
      /* @__PURE__ */ xn.createElement("span", { className: `font-semibold text-[16px] tracking-[2px] uppercase ${selectedIndex !== null ? "text-white" : "text-white/30"}` }, "Continue")
    )));
  };
  var SliderSelect_default = SliderSelect;

  // src/components/onboarding/MultiSelect.jsx
  var MultiSelect = ({ question, options = [], maxSelections = 3, previousAnswer, onAnswer }) => {
    const [selectedIndices, setSelectedIndices] = d2(
      () => previousAnswer?.indices ? new Set(previousAnswer.indices) : /* @__PURE__ */ new Set()
    );
    const toggleOption = (index2) => {
      setSelectedIndices((prev) => {
        const next = new Set(prev);
        if (next.has(index2)) {
          next.delete(index2);
        } else if (next.size < maxSelections) {
          next.add(index2);
        }
        return next;
      });
    };
    const handleContinue = () => {
      if (selectedIndices.size !== maxSelections) return;
      const indices = [...selectedIndices].sort((a3, b2) => a3 - b2);
      const texts = indices.map((i3) => {
        const opt = options[i3];
        return typeof opt === "string" ? opt : opt.text;
      });
      const vars = indices.map((i3) => {
        const opt = options[i3];
        return typeof opt === "string" ? "" : opt.variable || "";
      });
      onAnswer({ answer: texts.join(","), variable: vars.join(","), indices });
    };
    const atMax = selectedIndices.size >= maxSelections;
    return /* @__PURE__ */ xn.createElement(xn.Fragment, null, /* @__PURE__ */ xn.createElement("div", { className: "flex-1 px-7 pt-8 pb-6 w-full overflow-y-auto" }, /* @__PURE__ */ xn.createElement("h1", { className: "font-bold text-[22px] text-white leading-[30px] tracking-[0.02em] mb-2" }, question), /* @__PURE__ */ xn.createElement("p", { className: "text-white/50 text-[13px] font-medium mb-6" }, selectedIndices.size, " / ", maxSelections, " selected"), /* @__PURE__ */ xn.createElement("div", { className: "flex flex-wrap gap-3" }, options.map((opt, i3) => {
      const text = typeof opt === "string" ? opt : opt.text;
      const isSelected = selectedIndices.has(i3);
      const isDimmed = atMax && !isSelected;
      return /* @__PURE__ */ xn.createElement(
        "button",
        {
          key: i3,
          onClick: () => toggleOption(i3),
          className: `px-5 py-3 rounded-full border border-solid transition-colors duration-200 ${isSelected ? "bg-white/20 border-white/40 shadow-[inset_0_2px_8px_rgba(255,255,255,0.1)]" : isDimmed ? "bg-white/[0.02] border-white/[0.06] opacity-40" : "bg-white/[0.07] border-white/10 hover:bg-white/10"}`
        },
        /* @__PURE__ */ xn.createElement("span", { className: `font-medium text-[14px] leading-[20px] tracking-[0.02em] ${isSelected ? "text-white" : "text-white/70"}` }, text)
      );
    }))), /* @__PURE__ */ xn.createElement("div", { className: "pb-10 px-7 w-full" }, /* @__PURE__ */ xn.createElement(
      "button",
      {
        onClick: handleContinue,
        disabled: selectedIndices.size !== maxSelections,
        className: `w-full h-[54px] rounded-[40px] flex items-center justify-center transition-[background-color,opacity] duration-200 ${selectedIndices.size === maxSelections ? "bg-gradient-to-l from-[#B900B0] to-[#D8003F] shadow-lg active:scale-95" : "bg-white/10 border border-solid border-white/10"}`
      },
      /* @__PURE__ */ xn.createElement("span", { className: `font-semibold text-[16px] tracking-[2px] uppercase ${selectedIndices.size === maxSelections ? "text-white" : "text-white/30"}` }, "Continue")
    )));
  };
  var MultiSelect_default = MultiSelect;

  // src/components/onboarding/OpenQuestion.jsx
  var OpenQuestion = ({ question, placeholder, charGuidance, previousAnswer, onAnswer }) => {
    const [text, setText] = d2(previousAnswer?.answer || "");
    const handleContinue = () => {
      if (!text.trim()) return;
      onAnswer({ answer: text.trim(), variable: "" });
    };
    return /* @__PURE__ */ xn.createElement(xn.Fragment, null, /* @__PURE__ */ xn.createElement("div", { className: "flex-1 px-7 pt-8 pb-6 w-full flex flex-col" }, /* @__PURE__ */ xn.createElement("h1", { className: "font-bold text-[22px] text-white leading-[30px] tracking-[0.02em] mb-6" }, question), /* @__PURE__ */ xn.createElement("div", { className: "relative flex-1 max-h-[220px]" }, /* @__PURE__ */ xn.createElement(
      "textarea",
      {
        value: text,
        onChange: (e3) => setText(e3.target.value),
        placeholder: placeholder || "Type your answer...",
        className: "w-full h-full resize-none rounded-2xl px-5 py-4 bg-white/[0.07] border border-solid border-white/10 text-white text-[15px] leading-[24px] font-medium placeholder:text-white/30 focus:outline-none focus:border-white/25 transition-colors"
      }
    ), charGuidance && /* @__PURE__ */ xn.createElement("span", { className: `absolute bottom-3 right-4 text-[11px] font-medium ${text.length > charGuidance ? "text-[#FF2258]/70" : "text-white/25"}` }, text.length, " / ", charGuidance))), /* @__PURE__ */ xn.createElement("div", { className: "pb-10 px-7 w-full" }, /* @__PURE__ */ xn.createElement(
      "button",
      {
        onClick: handleContinue,
        disabled: !text.trim(),
        className: `w-full h-[54px] rounded-[40px] flex items-center justify-center transition-[background-color,opacity] duration-200 ${text.trim() ? "bg-gradient-to-l from-[#B900B0] to-[#D8003F] shadow-lg active:scale-95" : "bg-white/10 border border-solid border-white/10"}`
      },
      /* @__PURE__ */ xn.createElement("span", { className: `font-semibold text-[16px] tracking-[2px] uppercase ${text.trim() ? "text-white" : "text-white/30"}` }, "Continue")
    )));
  };
  var OpenQuestion_default = OpenQuestion;

  // src/components/onboarding/OnboardingFlow.jsx
  var SCREEN_COMPONENTS = {
    "single-select": SingleSelect_default,
    "slider": SliderSelect_default,
    "multi-select": MultiSelect_default,
    "open-question": OpenQuestion_default
  };
  var STORAGE_KEY = "onboarding_state";
  var OnboardingFlow = ({
    steps = [],
    credits: initialCredits = 0,
    initialStep = 0,
    initialAnswers = {},
    showCredits = true,
    onComplete,
    onBack: onBackOut
  }) => {
    const [currentStep, setCurrentStep] = d2(initialStep);
    const [credits, setCredits] = d2(initialCredits);
    const [answers, setAnswers] = d2(initialAnswers);
    const [direction, setDirection] = d2("forward");
    const [animating, setAnimating] = d2(false);
    const [answeredThisVisit, setAnsweredThisVisit] = d2(false);
    const [rotationOffsets, setRotationOffsets] = d2({});
    const [ready, setReady] = d2(false);
    const [creditIntroSeen, setCreditIntroSeen] = d2(false);
    const creditsCircleRef = A2(null);
    const creditIntroRunningRef = A2(false);
    const storage = useNativelyStorage();
    y2(() => {
      let cancelled = false;
      Promise.all([
        storage.getItem(STORAGE_KEY),
        storage.getItem("credits_intro_seen")
      ]).then(([raw, introSeen]) => {
        if (cancelled) return;
        if (introSeen === "true") setCreditIntroSeen(true);
        if (raw) {
          try {
            const saved = JSON.parse(raw);
            if (saved.currentStep != null) setCurrentStep(saved.currentStep);
            if (saved.answers) setAnswers(saved.answers);
            if (saved.credits != null) setCredits(saved.credits);
            if (saved.rotationOffsets) setRotationOffsets(saved.rotationOffsets);
          } catch (e3) {
            console.warn("Failed to restore onboarding state:", e3);
          }
        }
        setReady(true);
      });
      return () => {
        cancelled = true;
      };
    }, []);
    const step = steps[currentStep];
    const totalSteps = steps.length;
    const progress = (currentStep + 1) / totalSteps * 100;
    const getVisibleOptions = q2((s3, stepIndex) => {
      if (s3.optionPool && s3.visibleCount) {
        const pool = s3.optionPool;
        const count = s3.visibleCount;
        const offset = rotationOffsets[stepIndex] || 0;
        const result2 = [];
        for (let i3 = 0; i3 < count; i3++) {
          result2.push(pool[(offset + i3) % pool.length]);
        }
        return result2;
      }
      return s3.options;
    }, [rotationOffsets]);
    const persistState = q2((stepIndex, allAnswers, currentCredits, offsets) => {
      const state = {
        currentStep: stepIndex,
        answers: allAnswers,
        credits: currentCredits,
        rotationOffsets: offsets
      };
      storage.setItem(STORAGE_KEY, JSON.stringify(state));
    }, [storage]);
    const goForward = q2(() => {
      if (animating || currentStep >= totalSteps - 1) return;
      setDirection("forward");
      setAnimating(true);
      setTimeout(() => {
        setCurrentStep((prev) => prev + 1);
        setAnimating(false);
        setAnsweredThisVisit(false);
      }, 300);
    }, [currentStep, totalSteps, animating]);
    const goBack = q2(() => {
      if (animating || currentStep === 0) return;
      setDirection("back");
      setAnimating(true);
      setTimeout(() => {
        setCurrentStep((prev) => prev - 1);
        setAnimating(false);
        setAnsweredThisVisit(false);
      }, 300);
    }, [currentStep, animating]);
    const handleAnswer = q2((data) => {
      if (answeredThisVisit) return;
      setAnsweredThisVisit(true);
      const isNewAnswer = !answers[currentStep];
      const newCredits = isNewAnswer ? credits + 1 : credits;
      const stepAnswer = {
        questionId: step?.questionId,
        type: step?.type,
        ...data
      };
      const newAnswers = { ...answers, [currentStep]: stepAnswer };
      setAnswers(newAnswers);
      if (isNewAnswer) setCredits(newCredits);
      const nextStep = currentStep + 1;
      persistState(nextStep, newAnswers, newCredits, rotationOffsets);
      sendToBubble("bubble_fn_onboarding", "step_complete", {
        step: currentStep,
        answer: data.answer || "",
        variable: data.variable || ""
      });
      const advanceOrComplete = () => {
        if (currentStep >= totalSteps - 1) {
          storage.removeItem(STORAGE_KEY);
          sendToBubble("bubble_fn_onboarding", "complete", {
            answers: JSON.stringify(newAnswers),
            credits: newCredits
          });
          if (onComplete) onComplete(newAnswers, newCredits);
        } else {
          setTimeout(() => goForward(), 600);
        }
      };
      if (isNewAnswer && credits === 0 && !creditIntroSeen && !creditIntroRunningRef.current) {
        triggerCreditIntro().then(advanceOrComplete);
      } else {
        if (isNewAnswer) triggerCreditPulse();
        advanceOrComplete();
      }
    }, [currentStep, step, answers, credits, totalSteps, goForward, persistState, storage, answeredThisVisit, rotationOffsets, onComplete, creditIntroSeen]);
    const handleRefresh = q2(() => {
      const s3 = steps[currentStep];
      if (!s3 || !s3.optionPool || !s3.visibleCount) return;
      setRotationOffsets((prev) => {
        const currentOffset = prev[currentStep] || 0;
        return { ...prev, [currentStep]: currentOffset + s3.visibleCount };
      });
      sendToBubble("bubble_fn_onboarding", "refresh", { step: currentStep });
    }, [currentStep, steps]);
    const triggerCreditPulse = () => {
      if (showCredits && creditsCircleRef.current) {
        creditsCircleRef.current.style.transition = "transform 0.3s ease";
        creditsCircleRef.current.style.transform = "translateY(-50%) scale(1.2)";
        setTimeout(() => {
          if (creditsCircleRef.current) {
            creditsCircleRef.current.style.transform = "translateY(-50%) scale(1)";
          }
        }, 300);
      }
    };
    const triggerCreditIntro = () => {
      return new Promise((resolve2) => {
        if (!creditsCircleRef.current || creditIntroRunningRef.current) {
          resolve2();
          return;
        }
        creditIntroRunningRef.current = true;
        const startRect = creditsCircleRef.current.getBoundingClientRect();
        const dim = document.createElement("div");
        dim.className = "dim-overlay";
        document.body.appendChild(dim);
        requestAnimationFrame(() => dim.classList.add("active"));
        const circle = document.createElement("div");
        circle.style.cssText = `
                position: fixed;
                top: ${startRect.top}px;
                left: ${startRect.left}px;
                width: ${startRect.width}px;
                height: ${startRect.height}px;
                z-index: 9999;
                pointer-events: none;
                transition: top 0.7s cubic-bezier(0.16, 1, 0.3, 1),
                            left 0.7s cubic-bezier(0.16, 1, 0.3, 1),
                            width 0.7s cubic-bezier(0.16, 1, 0.3, 1),
                            height 0.7s cubic-bezier(0.16, 1, 0.3, 1);
            `;
        circle.innerHTML = `
                <div style="width:100%;height:100%;background:#FF2258;border-radius:50%;display:flex;align-items:center;justify-content:center;box-shadow:0 0 40px rgba(255,34,88,0.5);">
                    <span id="credit-intro-num" style="font-family:'Plus Jakarta Sans',sans-serif;font-weight:800;font-size:0.75rem;color:white;letter-spacing:0.05em;line-height:1;transition:font-size 0.7s cubic-bezier(0.16,1,0.3,1);">0</span>
                </div>
            `;
        document.body.appendChild(circle);
        const textEl = document.createElement("div");
        textEl.style.cssText = `
                position: fixed;
                top: calc(50% + 70px);
                left: 50%;
                transform: translateX(-50%);
                z-index: 9999;
                text-align: center;
                max-width: 280px;
                opacity: 0;
                transition: opacity 0.5s ease;
            `;
        textEl.innerHTML = `
                <p style="font-family:'Plus Jakarta Sans',sans-serif;font-weight:700;font-size:18px;color:white;margin:0 0 8px 0;line-height:1.4;">
                    Meet your Credits! &#x1F389;
                </p>
                <p style="font-family:'Poppins',sans-serif;font-weight:400;font-size:14px;color:rgba(255,255,255,0.7);margin:0 0 24px 0;line-height:1.5;">
                    Every answer earns you a credit.<br/>Use them to unlock experiences in Bonds.
                </p>
                <button id="credit-intro-cta" style="
                    font-family:'Plus Jakarta Sans',sans-serif;
                    font-weight:700;
                    font-size:16px;
                    color:#FF2258;
                    background:white;
                    border:none;
                    border-radius:40px;
                    padding:14px 48px;
                    cursor:pointer;
                    letter-spacing:0.5px;
                    box-shadow:0 4px 20px rgba(255,34,88,0.3);
                    transition:transform 0.15s ease, box-shadow 0.15s ease;
                ">OK, Cool!</button>
            `;
        document.body.appendChild(textEl);
        const dismiss = () => {
          textEl.style.opacity = "0";
          setTimeout(() => {
            dim.classList.remove("active");
            const endRect = creditsCircleRef.current?.getBoundingClientRect();
            if (endRect) {
              circle.style.top = endRect.top + "px";
              circle.style.left = endRect.left + "px";
              circle.style.width = endRect.width + "px";
              circle.style.height = endRect.height + "px";
              const numEl = document.getElementById("credit-intro-num");
              if (numEl) numEl.style.fontSize = "0.75rem";
            }
          }, 500);
          setTimeout(() => {
            circle.remove();
            textEl.remove();
            dim.remove();
            triggerCreditPulse();
            setCreditIntroSeen(true);
            storage.setItem("credits_intro_seen", "true");
            creditIntroRunningRef.current = false;
            resolve2();
          }, 1300);
        };
        requestAnimationFrame(() => {
          requestAnimationFrame(() => {
            const size = 96;
            circle.style.top = `calc(50% - ${size / 2}px)`;
            circle.style.left = `calc(50% - ${size / 2}px)`;
            circle.style.width = size + "px";
            circle.style.height = size + "px";
            const numEl = document.getElementById("credit-intro-num");
            if (numEl) numEl.style.fontSize = "2.5rem";
          });
        });
        setTimeout(() => {
          const numEl = document.getElementById("credit-intro-num");
          if (numEl) numEl.innerText = "1";
        }, 800);
        setTimeout(() => {
          textEl.style.opacity = "1";
          const cta = document.getElementById("credit-intro-cta");
          if (cta) {
            cta.addEventListener("click", dismiss);
            cta.addEventListener("touchend", (e3) => {
              e3.preventDefault();
              dismiss();
            });
          }
        }, 1100);
      });
    };
    if (!ready) return null;
    const ScreenComponent = step ? SCREEN_COMPONENTS[step.type] : null;
    const getAnimClass = () => {
      if (!animating) return "animate-fade-in";
      return direction === "forward" ? "animate-slide-out-left" : "animate-slide-out-right";
    };
    const previousAnswer = answers[currentStep] || null;
    const visibleOptions = step ? getVisibleOptions(step, currentStep) : [];
    return /* @__PURE__ */ xn.createElement("div", { className: "flex flex-col w-full h-full overflow-hidden font-jakarta", style: {
      background: "linear-gradient(160deg, #2E4695 0%, #652664 100%)"
    } }, /* @__PURE__ */ xn.createElement("div", { className: "relative z-20 shrink-0 pt-[18px] pb-4 px-[18px]" }, /* @__PURE__ */ xn.createElement(
      "button",
      {
        onClick: currentStep === 0 && onBackOut ? onBackOut : goBack,
        className: `w-8 h-8 rounded-full border border-solid border-white/40 flex items-center justify-center transition-opacity duration-200 ${currentStep === 0 && !onBackOut ? "opacity-0 pointer-events-none" : "hover:bg-white/10"}`
      },
      /* @__PURE__ */ xn.createElement("svg", { width: "7", height: "12", viewBox: "0 0 7 12", fill: "none" }, /* @__PURE__ */ xn.createElement("path", { d: "M6 1L1 6L6 11", stroke: "white", strokeWidth: "1.5", strokeLinecap: "round", strokeLinejoin: "round" }))
    ), /* @__PURE__ */ xn.createElement("div", { className: "absolute left-1/2 top-[18px] -translate-x-1/2 flex flex-col gap-1.5 items-center" }, /* @__PURE__ */ xn.createElement("span", { className: "font-semibold text-[10px] text-white tracking-[0.5px]" }, currentStep + 1, "/", totalSteps), /* @__PURE__ */ xn.createElement("div", { className: "h-[14px] w-[180px] rounded-[90px] border border-solid border-white/50 bg-white/[0.06] overflow-hidden" }, /* @__PURE__ */ xn.createElement(
      "div",
      {
        className: "h-full rounded-[90px] bg-white/30 transition-[width] duration-500 ease-out",
        style: { width: `${progress}%` }
      }
    ))), showCredits && /* @__PURE__ */ xn.createElement("div", { className: "absolute top-4 -right-[95px] z-10" }, /* @__PURE__ */ xn.createElement("div", { className: "relative w-[180px] h-10 rounded-full flex items-center border border-solid border-white/50" }, /* @__PURE__ */ xn.createElement(
      "div",
      {
        ref: creditsCircleRef,
        className: "absolute left-1 top-1/2 -translate-y-1/2 w-8 h-8 bg-[#FF2258] rounded-full flex items-center justify-center shadow-lg"
      },
      /* @__PURE__ */ xn.createElement("span", { className: "font-jakarta font-extrabold text-xs text-white tracking-wide leading-none" }, credits)
    ), /* @__PURE__ */ xn.createElement("span", { className: "absolute left-[42px] top-1/2 translate-y-[6px] font-jakarta font-medium text-[10px] text-white tracking-wide leading-none" }, "Credits")))), /* @__PURE__ */ xn.createElement("div", { className: "w-full h-px bg-white/15" }), /* @__PURE__ */ xn.createElement("div", { className: `flex-1 flex flex-col overflow-hidden ${getAnimClass()}`, key: currentStep }, ScreenComponent ? /* @__PURE__ */ xn.createElement(
      ScreenComponent,
      {
        ...step,
        options: visibleOptions,
        previousAnswer,
        onAnswer: handleAnswer,
        onRefresh: handleRefresh
      }
    ) : /* @__PURE__ */ xn.createElement("div", { className: "flex-1 flex items-center justify-center" }, /* @__PURE__ */ xn.createElement("span", { className: "text-white/50 text-sm" }, "Unknown step type: ", step?.type))));
  };
  var OnboardingFlow_default = OnboardingFlow;

  // src/components/DailyQuestion.jsx
  var DailyQuestion = ({ category, question, options, userName, credits: initialCredits, selectedAnswer: initialSelectedAnswer }) => {
    const [credits, setCredits] = d2(initialCredits || 0);
    const [selectedAnswer, setSelectedAnswer] = d2(initialSelectedAnswer);
    const [isVoted, setIsVoted] = d2(initialSelectedAnswer !== void 0 && initialSelectedAnswer !== null);
    const [showFooterAfter, setShowFooterAfter] = d2(isVoted);
    const creditsCircleRef = A2(null);
    const creditsNumberRef = A2(null);
    const handleVote = (answerText, index2) => {
      if (isVoted) return;
      setIsVoted(true);
      setSelectedAnswer(index2);
      setTimeout(() => {
        setShowFooterAfter(true);
      }, 800);
      sendToBubble("bubble_fn_daily_question", "vote", { answer: answerText, index: index2 });
      setTimeout(() => {
        triggerCreditAnimation();
      }, 2e3);
    };
    const triggerCreditAnimation = () => {
      const dimOverlay = document.createElement("div");
      dimOverlay.className = "dim-overlay active";
      document.body.appendChild(dimOverlay);
      const overlay = document.createElement("div");
      overlay.className = "credit-overlay credit-center-animation";
      overlay.style.cssText = `
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            z-index: 9999;
            pointer-events: none;
        `;
      overlay.innerHTML = `
            <div class="w-24 h-24 bg-[#FF2258] rounded-full flex items-center justify-center shadow-2xl">
                <span id="overlayCreditsNumber" class="font-jakarta font-extrabold text-4xl text-white tracking-wide leading-none">
                    ${credits}
                </span>
            </div>
        `;
      document.body.appendChild(overlay);
      setTimeout(() => {
        const overlayNum = document.getElementById("overlayCreditsNumber");
        let start = credits;
        let end = credits + 1;
        let duration = 600;
        let startTime = null;
        function animateNumber(timestamp) {
          if (!startTime) startTime = timestamp;
          const progress = Math.min((timestamp - startTime) / duration, 1);
          const easeOutQuart = 1 - Math.pow(1 - progress, 4);
          const current = Math.round(start + (end - start) * easeOutQuart);
          if (overlayNum) overlayNum.innerText = current;
          if (progress < 1) requestAnimationFrame(animateNumber);
        }
        requestAnimationFrame(animateNumber);
      }, 600);
      setTimeout(() => {
        overlay.classList.remove("credit-center-animation");
        overlay.classList.add("credit-move-animation");
        dimOverlay.classList.remove("active");
        overlay.offsetHeight;
        if (creditsCircleRef.current) {
          const targetRect = creditsCircleRef.current.getBoundingClientRect();
          overlay.style.top = targetRect.top + "px";
          overlay.style.left = targetRect.left + "px";
          overlay.style.transform = "scale(1)";
          const overlayCircle = overlay.querySelector("div");
          overlayCircle.style.transition = "width 600ms cubic-bezier(0.4, 0, 0.2, 1), height 600ms cubic-bezier(0.4, 0, 0.2, 1)";
          overlayCircle.style.width = "32px";
          overlayCircle.style.height = "32px";
          overlayCircle.querySelector("span").style.fontSize = "0.75rem";
        }
      }, 1200);
      setTimeout(() => {
        setCredits((prev) => prev + 1);
        if (creditsCircleRef.current) {
          creditsCircleRef.current.style.transition = "transform 0.3s ease";
          creditsCircleRef.current.style.transform = "translateY(-50%) scale(1.2)";
          setTimeout(() => {
            if (creditsCircleRef.current) {
              creditsCircleRef.current.style.transform = "translateY(-50%) scale(1)";
            }
          }, 300);
        }
        overlay.remove();
        dimOverlay.remove();
      }, 1800);
    };
    const handleStart = () => {
      sendToBubble("bubble_fn_daily_question", "start_planning");
    };
    const handleClose = () => {
      sendToBubble("bubble_fn_daily_question", "close");
    };
    return /* @__PURE__ */ xn.createElement("div", { className: "relative w-full min-h-screen overflow-hidden gradient-purple-orange font-poppins" }, /* @__PURE__ */ xn.createElement("div", { className: "absolute top-0 left-0 w-full z-20 pointer-events-none" }, /* @__PURE__ */ xn.createElement(
      "button",
      {
        onClick: handleClose,
        className: "pointer-events-auto absolute top-[18px] left-[18px] w-8 h-8 flex items-center justify-center hover:opacity-80 transition-opacity z-20"
      },
      /* @__PURE__ */ xn.createElement("svg", { width: "14", height: "14", viewBox: "0 0 14 14", fill: "none" }, /* @__PURE__ */ xn.createElement("path", { d: "M13.6675 1.99162C14.1108 1.53601 14.1108 0.79732 13.6675 0.341709C13.2243 -0.113903 12.5056 -0.113903 12.0623 0.341709L7 5.54491L1.9377 0.341709C1.49442 -0.113903 0.775732 -0.113903 0.332457 0.341708C-0.110818 0.79732 -0.110818 1.53601 0.332457 1.99162L5.20521 7L0.332456 12.0084C-0.110819 12.464 -0.110819 13.2027 0.332456 13.6583C0.77573 14.1139 1.49442 14.1139 1.93769 13.6583L7 8.45509L12.0623 13.6583C12.5056 14.1139 13.2243 14.1139 13.6675 13.6583C14.1108 13.2027 14.1108 12.464 13.6675 12.0084L8.79479 7L13.6675 1.99162Z", fill: "white" }))
    ), /* @__PURE__ */ xn.createElement("div", { className: "absolute top-4 -right-[95px] z-10" }, /* @__PURE__ */ xn.createElement("div", { className: "relative w-[180px] h-10 rounded-full flex items-center border border-solid border-white/50" }, /* @__PURE__ */ xn.createElement(
      "div",
      {
        ref: creditsCircleRef,
        id: "creditsCircle",
        className: "absolute left-1 top-1/2 -translate-y-1/2 w-8 h-8 bg-[#FF2258] rounded-full flex items-center justify-center shadow-lg"
      },
      /* @__PURE__ */ xn.createElement("span", { className: "font-jakarta font-extrabold text-xs text-white tracking-wide leading-none" }, credits)
    ), /* @__PURE__ */ xn.createElement("span", { className: "absolute left-[42px] top-1/2 translate-y-[6px] font-jakarta font-medium text-[10px] text-white tracking-wide leading-none" }, "Credits")))), /* @__PURE__ */ xn.createElement("div", { className: "px-9 pt-[78px] max-w-[375px] mx-auto relative z-10" }, /* @__PURE__ */ xn.createElement("div", { className: "font-jakarta font-medium text-lg text-white mb-[68px]" }, category || "Time Together"), /* @__PURE__ */ xn.createElement("div", { className: "font-poppins font-semibold text-xl text-white leading-[30px] tracking-[0.02em] mb-10 max-w-[303px]" }, question), /* @__PURE__ */ xn.createElement("div", { className: "space-y-[19px] mb-16" }, options.map((opt, i3) => {
      const optIndex = opt.index !== void 0 ? opt.index : i3 + 1;
      const isSelected = isVoted && selectedAnswer === optIndex;
      return /* @__PURE__ */ xn.createElement(
        "div",
        {
          key: optIndex,
          className: `daily-question-option relative w-full max-w-[315px] h-9 bg-white/[0.07] border border-solid border-white/10 rounded-lg cursor-pointer overflow-hidden transition-[background-color] duration-200 hover:bg-white/10 ${isVoted ? "voted pointer-events-none" : ""} ${isSelected ? "selected-option" : ""}`,
          onClick: () => handleVote(opt.text, optIndex)
        },
        /* @__PURE__ */ xn.createElement(
          "div",
          {
            className: "option-bar absolute left-0 top-0 h-full bg-[#6D6987]/70 rounded-lg",
            style: { width: isVoted ? `${opt.percent}%` : "0%" }
          }
        ),
        /* @__PURE__ */ xn.createElement("div", { className: "relative flex items-center justify-between h-full px-[42px] z-10" }, /* @__PURE__ */ xn.createElement("span", { className: "font-poppins font-bold text-sm text-[#F8F8F8] tracking-[0.02em]" }, opt.text), /* @__PURE__ */ xn.createElement(
          "span",
          {
            className: `percentage font-poppins text-xs text-[#F8F8F8] tracking-[0.02em] ${isVoted ? "opacity-100" : "opacity-0"}`,
            style: { fontWeight: isSelected ? "bold" : "normal" }
          },
          opt.percent,
          "%"
        ))
      );
    })), /* @__PURE__ */ xn.createElement("div", { className: "min-h-[100px] flex flex-col items-center justify-start" }, !showFooterAfter ? /* @__PURE__ */ xn.createElement("div", { className: "font-poppins text-base text-white text-center leading-6 tracking-[0.02em] max-w-[295px]" }, "Vote and see the live results and also gain 1 credits") : /* @__PURE__ */ xn.createElement(xn.Fragment, null, /* @__PURE__ */ xn.createElement("div", { className: "font-poppins text-base text-white text-center leading-6 tracking-[0.02em] max-w-[309px] mb-6 animate-fade-in" }, /* @__PURE__ */ xn.createElement("span", { className: "font-bold" }, userName), ", we would love to plan with you that first step to creating more 'you time'"), /* @__PURE__ */ xn.createElement(
      "button",
      {
        onClick: handleStart,
        className: "px-10 py-3 bg-white rounded-[64px] btn-pressed animate-fade-in pointer-events-auto"
      },
      /* @__PURE__ */ xn.createElement("span", { className: "font-jakarta font-semibold text-[17px] text-[#E76B0C] tracking-[0.7px] pointer-events-none" }, "Start")
    )))));
  };
  var DailyQuestion_default = DailyQuestion;

  // src/data/mockOnboardingSteps.js
  var mockOnboardingSteps = [
    // Q1  Gender (single-select, no refresh)
    {
      type: "single-select",
      questionId: "gender",
      question: "What's your gender?",
      refreshable: false,
      options: [
        { text: "Male", variable: "male" },
        { text: "Female", variable: "female" },
        { text: "Non-binary", variable: "non_binary" },
        { text: "Prefer not to say", variable: "prefer_not_to_say" }
      ]
    },
    // Q2  Relationship duration (slider)
    {
      type: "slider",
      questionId: "relationship_duration",
      question: "How long have you been together?",
      stops: [
        { label: "Less than 6 months", variable: "lt_6mo", emoji: "\u{1F970}" },
        { label: "6 months \u2013 1 year", variable: "6mo_1yr", emoji: "\u{1F48C}" },
        { label: "1 \u2013 3 years", variable: "1_3yr", emoji: "\u{1F91D}" },
        { label: "3 \u2013 5 years", variable: "3_5yr", emoji: "\u{1F525}" },
        { label: "5 \u2013 10 years", variable: "5_10yr", emoji: "\u{1F48E}" },
        { label: "10+ years", variable: "10plus_yr", emoji: "\u{1F3C6}" }
      ]
    },
    // Q3  Areas to strengthen (multi-select, pick 3)
    {
      type: "multi-select",
      questionId: "strengthen_areas",
      question: "Choose 3 Areas to Strengthen Your Bond",
      maxSelections: 3,
      options: [
        { text: "Communication", variable: "communication" },
        { text: "Trust", variable: "trust" },
        { text: "Intimacy", variable: "intimacy" },
        { text: "Quality Time", variable: "quality_time" },
        { text: "Conflict Resolution", variable: "conflict_resolution" },
        { text: "Emotional Support", variable: "emotional_support" },
        { text: "Shared Goals", variable: "shared_goals" },
        { text: "Fun & Adventure", variable: "fun_adventure" }
      ]
    },
    // Q4  Last argument (single-select, refreshable, pool of 8)
    {
      type: "single-select",
      questionId: "last_argument",
      question: "Think about your last argument... what was it about?",
      refreshable: true,
      visibleCount: 4,
      optionPool: [
        { text: "Household chores", variable: "chores" },
        { text: "Money or finances", variable: "finances" },
        { text: "Quality time together", variable: "quality_time" },
        { text: "Parenting decisions", variable: "parenting" },
        { text: "Communication style", variable: "communication" },
        { text: "Social plans or friends", variable: "social" },
        { text: "Work-life balance", variable: "work_life" },
        { text: "Personal habits", variable: "habits" }
      ]
    },
    // Q5  Partner doing more (single-select, refreshable, pool of 9)
    {
      type: "single-select",
      questionId: "partner_do_more",
      question: "What do you wish your partner would do more of?",
      refreshable: true,
      visibleCount: 4,
      optionPool: [
        { text: "Listen without fixing", variable: "listen" },
        { text: "Plan surprise dates", variable: "surprise_dates" },
        { text: "Help around the house", variable: "house_help" },
        { text: 'Say "I love you" more', variable: "say_love" },
        { text: "Give compliments", variable: "compliments" },
        { text: "Initiate physical affection", variable: "affection" },
        { text: "Ask about my day", variable: "ask_day" },
        { text: "Put the phone down", variable: "phone_down" },
        { text: "Share their feelings", variable: "share_feelings" }
      ]
    },
    // Q6  What matters to partner (single-select, refreshable, pool of 10)
    {
      type: "single-select",
      questionId: "partner_matters",
      question: "What do you think matters most to your partner?",
      refreshable: true,
      visibleCount: 4,
      optionPool: [
        { text: "Feeling respected", variable: "respected" },
        { text: "Quality time together", variable: "quality_time" },
        { text: "Physical affection", variable: "physical_affection" },
        { text: "Words of encouragement", variable: "encouragement" },
        { text: "Financial security", variable: "financial" },
        { text: "Acts of service", variable: "service" },
        { text: "Having fun together", variable: "fun" },
        { text: "Being listened to", variable: "listened" },
        { text: "Personal space", variable: "space" },
        { text: "Shared goals and dreams", variable: "shared_goals" }
      ]
    },
    // Q7  Most loving gesture (single-select, refreshable, pool of 8)
    {
      type: "single-select",
      questionId: "loving_gesture",
      question: "Which would feel most loving from your partner?",
      refreshable: true,
      visibleCount: 4,
      optionPool: [
        { text: "A handwritten note", variable: "note" },
        { text: "A long hug after a tough day", variable: "hug" },
        { text: "Cooking my favorite meal", variable: "cooking" },
        { text: "Planning a weekend getaway", variable: "getaway" },
        { text: "Saying they're proud of me", variable: "proud" },
        { text: "Taking over my responsibilities", variable: "responsibilities" },
        { text: "A thoughtful gift", variable: "gift" },
        { text: "An undistracted evening together", variable: "evening" }
      ]
    },
    // Q8  Instant smile (single-select, refreshable, pool of 8)
    {
      type: "single-select",
      questionId: "instant_smile",
      question: "Which would instantly make you smile?",
      refreshable: true,
      visibleCount: 4,
      optionPool: [
        { text: 'A random "thinking of you" text', variable: "text_msg" },
        { text: "Flowers for no reason", variable: "flowers" },
        { text: "My favorite snack waiting at home", variable: "snack" },
        { text: "A playlist made just for me", variable: "playlist" },
        { text: "A spontaneous dance in the kitchen", variable: "dance" },
        { text: "A compliment in front of friends", variable: "public_compliment" },
        { text: "Breakfast in bed", variable: "breakfast" },
        { text: "A silly inside joke callback", variable: "inside_joke" }
      ]
    },
    // Q9  Open question: truly loved
    {
      type: "open-question",
      questionId: "truly_loved",
      question: "What makes you feel truly loved?",
      placeholder: "Take your time, there's no wrong answer...",
      charGuidance: 150
    },
    // Q10  Open question: communication change
    {
      type: "open-question",
      questionId: "communication_change",
      question: "If you could change one thing about how you and your partner communicate, what would it be?",
      placeholder: "Be as honest as you'd like...",
      charGuidance: 200
    }
  ];
  var mockOnboardingSteps_default = mockOnboardingSteps;

  // src/App.jsx
  var TRANSITIONS = {
    welcome: {
      onboarding: { exit: "phase-zoom-out", enter: "phase-slide-up", exitDuration: 450 },
      main: { exit: "phase-zoom-out", enter: "phase-scale-in", exitDuration: 450 }
    },
    onboarding: {
      main: { exit: "phase-complete-out", enter: "phase-scale-in", exitDuration: 600 },
      welcome: { exit: "phase-slide-down", enter: "phase-zoom-in", exitDuration: 400 }
    },
    main: {
      welcome: { exit: "phase-fade-out", enter: "phase-fade-in", exitDuration: 300 },
      onboarding: { exit: "phase-fade-out", enter: "phase-slide-up", exitDuration: 300 }
    }
  };
  var DEFAULT_TRANSITION = { exit: "phase-fade-out", enter: "phase-fade-in", exitDuration: 300 };
  var App = () => {
    const [appPhase, setAppPhase] = d2("loading");
    const [displayedPhase, setDisplayedPhase] = d2("loading");
    const [animClass, setAnimClass] = d2("");
    const [debugMode, setDebugMode] = d2(false);
    const [deviceId, setDeviceId] = d2(null);
    const [storageStatus, setStorageStatus] = d2("...");
    const transitionRef = A2(false);
    const displayedPhaseRef = A2("loading");
    const tapCountRef = A2(0);
    const tapTimerRef = A2(null);
    const { getItem, setItem, removeItem, probeNative } = useNativelyStorage();
    const SESSION_KEY = "bonds_session_active";
    const DEVICE_ID_KEY = "bonds_device_id";
    const ONBOARDING_KEY = "onboarding_complete";
    const transitionTo = q2((nextPhase) => {
      if (transitionRef.current) return;
      const fromPhase = displayedPhaseRef.current;
      if (fromPhase === nextPhase) return;
      if (fromPhase === "loading") {
        displayedPhaseRef.current = nextPhase;
        setDisplayedPhase(nextPhase);
        setAppPhase(nextPhase);
        setAnimClass("phase-fade-in");
        return;
      }
      const t3 = TRANSITIONS[fromPhase]?.[nextPhase] || DEFAULT_TRANSITION;
      transitionRef.current = true;
      setAnimClass(t3.exit);
      setTimeout(() => {
        displayedPhaseRef.current = nextPhase;
        setDisplayedPhase(nextPhase);
        setAppPhase(nextPhase);
        setAnimClass(t3.enter);
        transitionRef.current = false;
      }, t3.exitDuration);
    }, []);
    y2(() => {
      initializeAnalytics();
      window.appUI = window.appUI || {};
      window.appUI.setLoginState = (isLogged) => {
        console.log(`\u{1F511} Bubble Setting Login State: ${isLogged}`);
        if (isLogged) {
          setItem(SESSION_KEY, "true");
          getItem(ONBOARDING_KEY).then((ob) => {
            transitionTo(ob === "true" ? "main" : "onboarding");
          });
        } else {
          removeItem(SESSION_KEY);
          transitionTo("welcome");
        }
      };
      checkSession();
    }, []);
    const initializeAnalytics = async () => {
      try {
        const token = window.APP_CONFIG?.MIXPANEL_TOKEN;
        if (token) {
          mixpanel.init(token, { debug: true, track_pageview: false, persistence: "localStorage" });
          console.log("\u{1F4CA} Mixpanel Initialized");
          let storedId = await getItem(DEVICE_ID_KEY);
          if (storedId) {
            if (storedId.startsWith("$device:")) {
              console.log("\u{1F9F9} Cleaning polluted Device ID:", storedId);
              storedId = storedId.replace(/^\$device:/, "");
              await setItem(DEVICE_ID_KEY, storedId);
            }
            console.log("\u{1F4C2} Loaded Existing Device ID:", storedId);
            mixpanel.identify(storedId);
          } else {
            const rawId = mixpanel.get_distinct_id();
            storedId = rawId.replace(/^\$device:/, "");
            console.log("\u{1F195} Generated New Device ID:", storedId, "(Raw:", rawId, ")");
            await setItem(DEVICE_ID_KEY, storedId);
            mixpanel.identify(storedId);
          }
          setDeviceId(storedId);
        } else {
          console.warn("\u26A0\uFE0F Mixpanel Token NOT found in window.APP_CONFIG. Analytics disabled.");
        }
      } catch (err) {
        console.error("\u274C Analytics Init Failed:", err);
      }
    };
    const checkSession = async () => {
      try {
        console.log("\u{1F504} App: Starting session check...");
        const sessionPromise = getItem(SESSION_KEY);
        const timeoutPromise = new Promise((resolve2) => setTimeout(() => resolve2("timeout"), 2e3));
        const sessionResult = await Promise.race([sessionPromise, timeoutPromise]);
        console.log(`\u{1F4BE} App: Session check result: ${sessionResult}`);
        if (sessionResult === "timeout") {
          console.warn("\u26A0\uFE0F App: Storage check timed out. Defaulting to welcome.");
          transitionTo("welcome");
        } else if (sessionResult === "true") {
          const obResult = await getItem(ONBOARDING_KEY);
          transitionTo(obResult === "true" ? "main" : "onboarding");
        } else {
          const onboardingState = await getItem("onboarding_state");
          if (onboardingState) {
            console.log("\u{1F4CB} App: Found saved onboarding progress, resuming.");
            setItem(SESSION_KEY, "true");
            transitionTo("onboarding");
          } else {
            transitionTo("welcome");
          }
        }
      } catch (err) {
        console.error("\u274C App: Failed to check session:", err);
        transitionTo("welcome");
      } finally {
        console.log("\u2705 App: Loading finished. Rendering UI.");
      }
    };
    const handleWelcomeAction = (action) => {
      if (action === "go") {
        setItem(SESSION_KEY, "true");
        transitionTo("onboarding");
      } else if (action === "signin") {
        setItem(SESSION_KEY, "true");
        setItem(ONBOARDING_KEY, "true");
        transitionTo("main");
      }
    };
    const handleOnboardingComplete = () => {
      setItem(ONBOARDING_KEY, "true");
      transitionTo("main");
    };
    const handleDebugTap = () => {
      tapCountRef.current += 1;
      clearTimeout(tapTimerRef.current);
      tapTimerRef.current = setTimeout(() => {
        tapCountRef.current = 0;
      }, 600);
      if (tapCountRef.current >= 3) {
        tapCountRef.current = 0;
        const opening = !debugMode;
        setDebugMode(opening);
        if (opening) {
          probeNative().then(setStorageStatus);
        }
      }
    };
    if (displayedPhase === "loading") {
      return /* @__PURE__ */ xn.createElement("div", { className: "absolute inset-0 bg-black flex flex-col items-center justify-center font-jakarta" }, /* @__PURE__ */ xn.createElement("div", { className: "animate-pulse flex flex-col items-center" }, /* @__PURE__ */ xn.createElement("svg", { width: "64", height: "64", viewBox: "0 0 64 64", fill: "none", className: "mb-4" }, /* @__PURE__ */ xn.createElement("circle", { cx: "32", cy: "32", r: "32", fill: "white", opacity: "0.2" }), /* @__PURE__ */ xn.createElement("rect", { x: "24", y: "24", width: "16", height: "16", fill: "#FF2258", className: "animate-spin-slow" })), /* @__PURE__ */ xn.createElement("span", { className: "text-white/40 text-xs tracking-widest uppercase" }, "Loading Bonds...")));
    }
    const userProps = {
      userName: "Jonathan",
      userAvatar: "https://i.pravatar.cc/150?img=12",
      credits: 23
    };
    return /* @__PURE__ */ xn.createElement("div", { className: "absolute inset-0", onClick: handleDebugTap }, /* @__PURE__ */ xn.createElement("div", { className: `w-full h-full ${animClass}` }, displayedPhase === "welcome" && /* @__PURE__ */ xn.createElement(WelcomeScreen_default, { deviceId, onAction: handleWelcomeAction }), displayedPhase === "onboarding" && /* @__PURE__ */ xn.createElement(
      OnboardingFlow_default,
      {
        steps: mockOnboardingSteps_default,
        credits: 0,
        showCredits: true,
        onComplete: handleOnboardingComplete,
        onBack: () => transitionTo("welcome")
      }
    ), displayedPhase === "main" && /* @__PURE__ */ xn.createElement(MainTabs_default, { userProps }), displayedPhase === "daily-question" && /* @__PURE__ */ xn.createElement(
      DailyQuestion_default,
      {
        credits: 13,
        category: "Time Together",
        question: "How much intentional one-on-one time do you have in a typical week?",
        userName: "Danny",
        options: [
          { text: "Less than 1 hour", percent: 10, index: 1 },
          { text: "1-3 hours", percent: 45, index: 2 },
          { text: "4-7 hours", percent: 30, index: 3 },
          { text: "More than 7 hours", percent: 15, index: 4 }
        ]
      }
    )), debugMode && /* @__PURE__ */ xn.createElement("div", { className: "fixed top-4 right-4 z-[9999] flex flex-col gap-2 scale-75 origin-top-right" }, /* @__PURE__ */ xn.createElement("div", { className: "bg-black/80 text-white p-2 text-[10px] font-mono rounded border border-white/20" }, /* @__PURE__ */ xn.createElement("p", null, "Phase: ", appPhase.toUpperCase()), /* @__PURE__ */ xn.createElement("p", null, "Device ID: ", deviceId || "N/A (no Mixpanel token)"), /* @__PURE__ */ xn.createElement("p", null, "Mixpanel: ", window.APP_CONFIG?.MIXPANEL_TOKEN ? "configured" : "NO TOKEN"), /* @__PURE__ */ xn.createElement("p", null, "Storage: ", storageStatus)), /* @__PURE__ */ xn.createElement(
      "button",
      {
        onClick: () => transitionTo("welcome"),
        className: "bg-blue-600 text-white text-[10px] px-2 py-1 rounded shadow-lg font-mono opacity-80 hover:opacity-100"
      },
      "\u2192 Welcome"
    ), /* @__PURE__ */ xn.createElement(
      "button",
      {
        onClick: () => transitionTo("onboarding"),
        className: "bg-purple-600 text-white text-[10px] px-2 py-1 rounded shadow-lg font-mono opacity-80 hover:opacity-100"
      },
      "\u2192 Onboarding"
    ), /* @__PURE__ */ xn.createElement(
      "button",
      {
        onClick: () => transitionTo("main"),
        className: "bg-green-600 text-white text-[10px] px-2 py-1 rounded shadow-lg font-mono opacity-80 hover:opacity-100"
      },
      "\u2192 Main"
    ), /* @__PURE__ */ xn.createElement(
      "button",
      {
        onClick: () => transitionTo("daily-question"),
        className: "bg-orange-600 text-white text-[10px] px-2 py-1 rounded shadow-lg font-mono opacity-80 hover:opacity-100"
      },
      "\u2192 Daily Q"
    ), /* @__PURE__ */ xn.createElement(
      "button",
      {
        onClick: () => {
          removeItem(SESSION_KEY);
          removeItem(DEVICE_ID_KEY);
          removeItem(ONBOARDING_KEY);
          removeItem("onboarding_state");
          removeItem("credits_intro_seen");
          window.location.reload();
        },
        className: "bg-red-600 text-white text-[10px] px-2 py-1 rounded shadow-lg font-mono opacity-80 hover:opacity-100"
      },
      "Reset All Storage"
    )));
  };
  var App_default = App;

  // src/index.jsx
  window.appUI = window.appUI || {};
  var initGlobals = () => {
    const fonts = [
      "https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;600;700;800&family=Poppins:wght@300;400;500;600;700&display=swap"
    ];
    fonts.forEach((url) => {
      if (!document.querySelector(`link[href="${url}"]`)) {
        const link = document.createElement("link");
        link.href = url;
        link.rel = "stylesheet";
        document.head.appendChild(link);
      }
    });
    window.BubbleBridge = {
      send: (fnName, data) => {
        const payload = typeof data === "object" && data !== null ? JSON.stringify(data) : data;
        console.log(`\u{1F4E4} Sending to Bubble [${fnName}]:`, payload);
        if (window[fnName]) window[fnName](payload);
      }
    };
    console.log("\u{1F30D} Globals Initialized");
  };
  initGlobals();
  window.appUI.mountMainApp = (container2) => {
    const root2 = createRoot(container2);
    root2.render(/* @__PURE__ */ xn.createElement(App_default, null));
    return root2;
  };
  window.appUI.mountWelcome = (container2, props = {}) => {
    const root2 = createRoot(container2);
    root2.render(/* @__PURE__ */ xn.createElement(WelcomeScreen_default, { ...props }));
    return root2;
  };
  window.appUI.mountDailyQuestion = (container2, props = {}) => {
    const root2 = createRoot(container2);
    root2.render(/* @__PURE__ */ xn.createElement(DailyQuestion_default, { ...props }));
    return root2;
  };
  window.appUI.mountOnboarding = (container2, props = {}) => {
    const defaults = { steps: mockOnboardingSteps_default, credits: 0, showCredits: true };
    const root2 = createRoot(container2);
    root2.render(/* @__PURE__ */ xn.createElement(OnboardingFlow_default, { ...defaults, ...props }));
    return root2;
  };
  var appContainer = document.getElementById("app-content-area");
  if (appContainer) {
    window.appUI.mountMainApp(appContainer);
    console.log("\u{1F680} Main App Auto-Mounted into #app-content-area");
  } else if (document.getElementById("component-selector")) {
    console.log("\u{1F6E0}\uFE0F Preview Mode detected: Waiting for manual mount.");
  } else {
    console.log("\u{1F4E6} UI Kit loaded. Mount functions ready on window.appUI");
  }
})();
